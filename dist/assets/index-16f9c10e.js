(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();var cA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function LE(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var nf={},RE={get exports(){return nf},set exports(e){nf=e}},Kg={},ko={},OE={get exports(){return ko},set exports(e){ko=e}},$t={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var up=Symbol.for("react.element"),kE=Symbol.for("react.portal"),DE=Symbol.for("react.fragment"),BE=Symbol.for("react.strict_mode"),FE=Symbol.for("react.profiler"),NE=Symbol.for("react.provider"),zE=Symbol.for("react.context"),UE=Symbol.for("react.forward_ref"),GE=Symbol.for("react.suspense"),$E=Symbol.for("react.memo"),VE=Symbol.for("react.lazy"),X_=Symbol.iterator;function HE(e){return e===null||typeof e!="object"?null:(e=X_&&e[X_]||e["@@iterator"],typeof e=="function"?e:null)}var lA={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},uA=Object.assign,hA={};function Pu(e,t,n){this.props=e,this.context=t,this.refs=hA,this.updater=n||lA}Pu.prototype.isReactComponent={};Pu.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Pu.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function fA(){}fA.prototype=Pu.prototype;function gb(e,t,n){this.props=e,this.context=t,this.refs=hA,this.updater=n||lA}var yb=gb.prototype=new fA;yb.constructor=gb;uA(yb,Pu.prototype);yb.isPureReactComponent=!0;var Y_=Array.isArray,pA=Object.prototype.hasOwnProperty,vb={current:null},dA={key:!0,ref:!0,__self:!0,__source:!0};function mA(e,t,n){var i,r={},o=null,s=null;if(t!=null)for(i in t.ref!==void 0&&(s=t.ref),t.key!==void 0&&(o=""+t.key),t)pA.call(t,i)&&!dA.hasOwnProperty(i)&&(r[i]=t[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];r.children=c}if(e&&e.defaultProps)for(i in a=e.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:up,type:e,key:o,ref:s,props:r,_owner:vb.current}}function jE(e,t){return{$$typeof:up,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function xb(e){return typeof e=="object"&&e!==null&&e.$$typeof===up}function WE(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Z_=/\/+/g;function N0(e,t){return typeof e=="object"&&e!==null&&e.key!=null?WE(""+e.key):t.toString(36)}function Zd(e,t,n,i,r){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var s=!1;if(e===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case up:case kE:s=!0}}if(s)return s=e,r=r(s),e=i===""?"."+N0(s,0):i,Y_(r)?(n="",e!=null&&(n=e.replace(Z_,"$&/")+"/"),Zd(r,t,n,"",function(l){return l})):r!=null&&(xb(r)&&(r=jE(r,n+(!r.key||s&&s.key===r.key?"":(""+r.key).replace(Z_,"$&/")+"/")+e)),t.push(r)),1;if(s=0,i=i===""?".":i+":",Y_(e))for(var a=0;a<e.length;a++){o=e[a];var c=i+N0(o,a);s+=Zd(o,t,n,c,r)}else if(c=HE(e),typeof c=="function")for(e=c.call(e),a=0;!(o=e.next()).done;)o=o.value,c=i+N0(o,a++),s+=Zd(o,t,n,c,r);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function Pp(e,t,n){if(e==null)return e;var i=[],r=0;return Zd(e,i,"","",function(o){return t.call(n,o,r++)}),i}function qE(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Gi={current:null},Kd={transition:null},XE={ReactCurrentDispatcher:Gi,ReactCurrentBatchConfig:Kd,ReactCurrentOwner:vb};$t.Children={map:Pp,forEach:function(e,t,n){Pp(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Pp(e,function(){t++}),t},toArray:function(e){return Pp(e,function(t){return t})||[]},only:function(e){if(!xb(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};$t.Component=Pu;$t.Fragment=DE;$t.Profiler=FE;$t.PureComponent=gb;$t.StrictMode=BE;$t.Suspense=GE;$t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=XE;$t.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=uA({},e.props),r=e.key,o=e.ref,s=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,s=vb.current),t.key!==void 0&&(r=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)pA.call(t,c)&&!dA.hasOwnProperty(c)&&(i[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)i.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];i.children=a}return{$$typeof:up,type:e.type,key:r,ref:o,props:i,_owner:s}};$t.createContext=function(e){return e={$$typeof:zE,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:NE,_context:e},e.Consumer=e};$t.createElement=mA;$t.createFactory=function(e){var t=mA.bind(null,e);return t.type=e,t};$t.createRef=function(){return{current:null}};$t.forwardRef=function(e){return{$$typeof:UE,render:e}};$t.isValidElement=xb;$t.lazy=function(e){return{$$typeof:VE,_payload:{_status:-1,_result:e},_init:qE}};$t.memo=function(e,t){return{$$typeof:$E,type:e,compare:t===void 0?null:t}};$t.startTransition=function(e){var t=Kd.transition;Kd.transition={};try{e()}finally{Kd.transition=t}};$t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};$t.useCallback=function(e,t){return Gi.current.useCallback(e,t)};$t.useContext=function(e){return Gi.current.useContext(e)};$t.useDebugValue=function(){};$t.useDeferredValue=function(e){return Gi.current.useDeferredValue(e)};$t.useEffect=function(e,t){return Gi.current.useEffect(e,t)};$t.useId=function(){return Gi.current.useId()};$t.useImperativeHandle=function(e,t,n){return Gi.current.useImperativeHandle(e,t,n)};$t.useInsertionEffect=function(e,t){return Gi.current.useInsertionEffect(e,t)};$t.useLayoutEffect=function(e,t){return Gi.current.useLayoutEffect(e,t)};$t.useMemo=function(e,t){return Gi.current.useMemo(e,t)};$t.useReducer=function(e,t,n){return Gi.current.useReducer(e,t,n)};$t.useRef=function(e){return Gi.current.useRef(e)};$t.useState=function(e){return Gi.current.useState(e)};$t.useSyncExternalStore=function(e,t,n){return Gi.current.useSyncExternalStore(e,t,n)};$t.useTransition=function(){return Gi.current.useTransition()};$t.version="18.2.0";(function(e){e.exports=$t})(OE);const YE=LE(ko);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZE=ko,KE=Symbol.for("react.element"),QE=Symbol.for("react.fragment"),JE=Object.prototype.hasOwnProperty,eI=ZE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,tI={key:!0,ref:!0,__self:!0,__source:!0};function gA(e,t,n){var i,r={},o=null,s=null;n!==void 0&&(o=""+n),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(s=t.ref);for(i in t)JE.call(t,i)&&!tI.hasOwnProperty(i)&&(r[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps,t)r[i]===void 0&&(r[i]=t[i]);return{$$typeof:KE,type:e,key:o,ref:s,props:r,_owner:eI.current}}Kg.Fragment=QE;Kg.jsx=gA;Kg.jsxs=gA;(function(e){e.exports=Kg})(RE);const nI=nf.Fragment,Di=nf.jsx,gl=nf.jsxs;var Jy={},ev={},iI={get exports(){return ev},set exports(e){ev=e}},vr={},tv={},rI={get exports(){return tv},set exports(e){tv=e}},yA={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(B,q){var ee=B.length;B.push(q);e:for(;0<ee;){var W=ee-1>>>1,Q=B[W];if(0<r(Q,q))B[W]=q,B[ee]=Q,ee=W;else break e}}function n(B){return B.length===0?null:B[0]}function i(B){if(B.length===0)return null;var q=B[0],ee=B.pop();if(ee!==q){B[0]=ee;e:for(var W=0,Q=B.length,Z=Q>>>1;W<Z;){var re=2*(W+1)-1,he=B[re],K=re+1,ce=B[K];if(0>r(he,ee))K<Q&&0>r(ce,he)?(B[W]=ce,B[K]=ee,W=K):(B[W]=he,B[re]=ee,W=re);else if(K<Q&&0>r(ce,ee))B[W]=ce,B[K]=ee,W=K;else break e}}return q}function r(B,q){var ee=B.sortIndex-q.sortIndex;return ee!==0?ee:B.id-q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();e.unstable_now=function(){return s.now()-a}}var c=[],l=[],u=1,h=null,f=3,p=!1,m=!1,y=!1,v=typeof setTimeout=="function"?setTimeout:null,d=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(B){for(var q=n(l);q!==null;){if(q.callback===null)i(l);else if(q.startTime<=B)i(l),q.sortIndex=q.expirationTime,t(c,q);else break;q=n(l)}}function x(B){if(y=!1,b(B),!m)if(n(c)!==null)m=!0,N(_);else{var q=n(l);q!==null&&$(x,q.startTime-B)}}function _(B,q){m=!1,y&&(y=!1,d(C),C=-1),p=!0;var ee=f;try{for(b(q),h=n(c);h!==null&&(!(h.expirationTime>q)||B&&!L());){var W=h.callback;if(typeof W=="function"){h.callback=null,f=h.priorityLevel;var Q=W(h.expirationTime<=q);q=e.unstable_now(),typeof Q=="function"?h.callback=Q:h===n(c)&&i(c),b(q)}else i(c);h=n(c)}if(h!==null)var Z=!0;else{var re=n(l);re!==null&&$(x,re.startTime-q),Z=!1}return Z}finally{h=null,f=ee,p=!1}}var S=!1,w=null,C=-1,A=5,k=-1;function L(){return!(e.unstable_now()-k<A)}function D(){if(w!==null){var B=e.unstable_now();k=B;var q=!0;try{q=w(!0,B)}finally{q?F():(S=!1,w=null)}}else S=!1}var F;if(typeof g=="function")F=function(){g(D)};else if(typeof MessageChannel<"u"){var I=new MessageChannel,P=I.port2;I.port1.onmessage=D,F=function(){P.postMessage(null)}}else F=function(){v(D,0)};function N(B){w=B,S||(S=!0,F())}function $(B,q){C=v(function(){B(e.unstable_now())},q)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(B){B.callback=null},e.unstable_continueExecution=function(){m||p||(m=!0,N(_))},e.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<B?Math.floor(1e3/B):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(B){switch(f){case 1:case 2:case 3:var q=3;break;default:q=f}var ee=f;f=q;try{return B()}finally{f=ee}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(B,q){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var ee=f;f=B;try{return q()}finally{f=ee}},e.unstable_scheduleCallback=function(B,q,ee){var W=e.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?W+ee:W):ee=W,B){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=ee+Q,B={id:u++,callback:q,priorityLevel:B,startTime:ee,expirationTime:Q,sortIndex:-1},ee>W?(B.sortIndex=ee,t(l,B),n(c)===null&&B===n(l)&&(y?(d(C),C=-1):y=!0,$(x,ee-W))):(B.sortIndex=Q,t(c,B),m||p||(m=!0,N(_))),B},e.unstable_shouldYield=L,e.unstable_wrapCallback=function(B){var q=f;return function(){var ee=f;f=q;try{return B.apply(this,arguments)}finally{f=ee}}}})(yA);(function(e){e.exports=yA})(rI);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vA=ko,fr=tv;function Ne(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var xA=new Set,rf={};function Lc(e,t){Zl(e,t),Zl(e+"Capture",t)}function Zl(e,t){for(rf[e]=t,e=0;e<t.length;e++)xA.add(t[e])}var ds=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),nv=Object.prototype.hasOwnProperty,oI=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,K_={},Q_={};function sI(e){return nv.call(Q_,e)?!0:nv.call(K_,e)?!1:oI.test(e)?Q_[e]=!0:(K_[e]=!0,!1)}function aI(e,t,n,i){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function cI(e,t,n,i){if(t===null||typeof t>"u"||aI(e,t,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function $i(e,t,n,i,r,o,s){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var gi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){gi[e]=new $i(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];gi[t]=new $i(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){gi[e]=new $i(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){gi[e]=new $i(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){gi[e]=new $i(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){gi[e]=new $i(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){gi[e]=new $i(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){gi[e]=new $i(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){gi[e]=new $i(e,5,!1,e.toLowerCase(),null,!1,!1)});var bb=/[\-:]([a-z])/g;function _b(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(bb,_b);gi[t]=new $i(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(bb,_b);gi[t]=new $i(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(bb,_b);gi[t]=new $i(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){gi[e]=new $i(e,1,!1,e.toLowerCase(),null,!1,!1)});gi.xlinkHref=new $i("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){gi[e]=new $i(e,1,!1,e.toLowerCase(),null,!0,!0)});function wb(e,t,n,i){var r=gi.hasOwnProperty(t)?gi[t]:null;(r!==null?r.type!==0:i||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(cI(t,n,r,i)&&(n=null),i||r===null?sI(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=n===null?r.type===3?!1:"":n:(t=r.attributeName,i=r.attributeNamespace,n===null?e.removeAttribute(t):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}var Ts=vA.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Tp=Symbol.for("react.element"),yl=Symbol.for("react.portal"),vl=Symbol.for("react.fragment"),Sb=Symbol.for("react.strict_mode"),iv=Symbol.for("react.profiler"),bA=Symbol.for("react.provider"),_A=Symbol.for("react.context"),Mb=Symbol.for("react.forward_ref"),rv=Symbol.for("react.suspense"),ov=Symbol.for("react.suspense_list"),Ab=Symbol.for("react.memo"),Qs=Symbol.for("react.lazy"),wA=Symbol.for("react.offscreen"),J_=Symbol.iterator;function Wu(e){return e===null||typeof e!="object"?null:(e=J_&&e[J_]||e["@@iterator"],typeof e=="function"?e:null)}var Rn=Object.assign,z0;function Sh(e){if(z0===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);z0=t&&t[1]||""}return`
`+z0+e}var U0=!1;function G0(e,t){if(!e||U0)return"";U0=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var i=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){i=l}e.call(t.prototype)}else{try{throw Error()}catch(l){i=l}e()}}catch(l){if(l&&i&&typeof l.stack=="string"){for(var r=l.stack.split(`
`),o=i.stack.split(`
`),s=r.length-1,a=o.length-1;1<=s&&0<=a&&r[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(r[s]!==o[a]){if(s!==1||a!==1)do if(s--,a--,0>a||r[s]!==o[a]){var c=`
`+r[s].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=s&&0<=a);break}}}finally{U0=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Sh(e):""}function lI(e){switch(e.tag){case 5:return Sh(e.type);case 16:return Sh("Lazy");case 13:return Sh("Suspense");case 19:return Sh("SuspenseList");case 0:case 2:case 15:return e=G0(e.type,!1),e;case 11:return e=G0(e.type.render,!1),e;case 1:return e=G0(e.type,!0),e;default:return""}}function sv(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case vl:return"Fragment";case yl:return"Portal";case iv:return"Profiler";case Sb:return"StrictMode";case rv:return"Suspense";case ov:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case _A:return(e.displayName||"Context")+".Consumer";case bA:return(e._context.displayName||"Context")+".Provider";case Mb:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Ab:return t=e.displayName||null,t!==null?t:sv(e.type)||"Memo";case Qs:t=e._payload,e=e._init;try{return sv(e(t))}catch{}}return null}function uI(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return sv(t);case 8:return t===Sb?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function _a(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function SA(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function hI(e){var t=SA(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(s){i=""+s,o.call(this,s)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(s){i=""+s},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Ep(e){e._valueTracker||(e._valueTracker=hI(e))}function MA(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=SA(e)?e.checked?"true":"false":e.value),e=i,e!==n?(t.setValue(e),!0):!1}function Tm(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function av(e,t){var n=t.checked;return Rn({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function e2(e,t){var n=t.defaultValue==null?"":t.defaultValue,i=t.checked!=null?t.checked:t.defaultChecked;n=_a(t.value!=null?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function AA(e,t){t=t.checked,t!=null&&wb(e,"checked",t,!1)}function cv(e,t){AA(e,t);var n=_a(t.value),i=t.type;if(n!=null)i==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(i==="submit"||i==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?lv(e,t.type,n):t.hasOwnProperty("defaultValue")&&lv(e,t.type,_a(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function t2(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!(i!=="submit"&&i!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function lv(e,t,n){(t!=="number"||Tm(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Mh=Array.isArray;function Nl(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+_a(n),t=null,r=0;r<e.length;r++){if(e[r].value===n){e[r].selected=!0,i&&(e[r].defaultSelected=!0);return}t!==null||e[r].disabled||(t=e[r])}t!==null&&(t.selected=!0)}}function uv(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Ne(91));return Rn({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function n2(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(Ne(92));if(Mh(n)){if(1<n.length)throw Error(Ne(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:_a(n)}}function CA(e,t){var n=_a(t.value),i=_a(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),i!=null&&(e.defaultValue=""+i)}function i2(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function PA(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function hv(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?PA(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Ip,TA=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,i,r){MSApp.execUnsafeLocalFunction(function(){return e(t,n,i,r)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Ip=Ip||document.createElement("div"),Ip.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Ip.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function of(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Bh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fI=["Webkit","ms","Moz","O"];Object.keys(Bh).forEach(function(e){fI.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Bh[t]=Bh[e]})});function EA(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Bh.hasOwnProperty(e)&&Bh[e]?(""+t).trim():t+"px"}function IA(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=EA(n,t[n],i);n==="float"&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}var pI=Rn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function fv(e,t){if(t){if(pI[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Ne(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Ne(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Ne(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Ne(62))}}function pv(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dv=null;function Cb(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var mv=null,zl=null,Ul=null;function r2(e){if(e=pp(e)){if(typeof mv!="function")throw Error(Ne(280));var t=e.stateNode;t&&(t=n0(t),mv(e.stateNode,e.type,t))}}function LA(e){zl?Ul?Ul.push(e):Ul=[e]:zl=e}function RA(){if(zl){var e=zl,t=Ul;if(Ul=zl=null,r2(e),t)for(e=0;e<t.length;e++)r2(t[e])}}function OA(e,t){return e(t)}function kA(){}var $0=!1;function DA(e,t,n){if($0)return e(t,n);$0=!0;try{return OA(e,t,n)}finally{$0=!1,(zl!==null||Ul!==null)&&(kA(),RA())}}function sf(e,t){var n=e.stateNode;if(n===null)return null;var i=n0(n);if(i===null)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(e=e.type,i=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!i;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(Ne(231,t,typeof n));return n}var gv=!1;if(ds)try{var qu={};Object.defineProperty(qu,"passive",{get:function(){gv=!0}}),window.addEventListener("test",qu,qu),window.removeEventListener("test",qu,qu)}catch{gv=!1}function dI(e,t,n,i,r,o,s,a,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(u){this.onError(u)}}var Fh=!1,Em=null,Im=!1,yv=null,mI={onError:function(e){Fh=!0,Em=e}};function gI(e,t,n,i,r,o,s,a,c){Fh=!1,Em=null,dI.apply(mI,arguments)}function yI(e,t,n,i,r,o,s,a,c){if(gI.apply(this,arguments),Fh){if(Fh){var l=Em;Fh=!1,Em=null}else throw Error(Ne(198));Im||(Im=!0,yv=l)}}function Rc(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function BA(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function o2(e){if(Rc(e)!==e)throw Error(Ne(188))}function vI(e){var t=e.alternate;if(!t){if(t=Rc(e),t===null)throw Error(Ne(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(r===null)break;var o=r.alternate;if(o===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return o2(r),e;if(o===i)return o2(r),t;o=o.sibling}throw Error(Ne(188))}if(n.return!==i.return)n=r,i=o;else{for(var s=!1,a=r.child;a;){if(a===n){s=!0,n=r,i=o;break}if(a===i){s=!0,i=r,n=o;break}a=a.sibling}if(!s){for(a=o.child;a;){if(a===n){s=!0,n=o,i=r;break}if(a===i){s=!0,i=o,n=r;break}a=a.sibling}if(!s)throw Error(Ne(189))}}if(n.alternate!==i)throw Error(Ne(190))}if(n.tag!==3)throw Error(Ne(188));return n.stateNode.current===n?e:t}function FA(e){return e=vI(e),e!==null?NA(e):null}function NA(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=NA(e);if(t!==null)return t;e=e.sibling}return null}var zA=fr.unstable_scheduleCallback,s2=fr.unstable_cancelCallback,xI=fr.unstable_shouldYield,bI=fr.unstable_requestPaint,Gn=fr.unstable_now,_I=fr.unstable_getCurrentPriorityLevel,Pb=fr.unstable_ImmediatePriority,UA=fr.unstable_UserBlockingPriority,Lm=fr.unstable_NormalPriority,wI=fr.unstable_LowPriority,GA=fr.unstable_IdlePriority,Qg=null,Do=null;function SI(e){if(Do&&typeof Do.onCommitFiberRoot=="function")try{Do.onCommitFiberRoot(Qg,e,void 0,(e.current.flags&128)===128)}catch{}}var ro=Math.clz32?Math.clz32:CI,MI=Math.log,AI=Math.LN2;function CI(e){return e>>>=0,e===0?32:31-(MI(e)/AI|0)|0}var Lp=64,Rp=4194304;function Ah(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Rm(e,t){var n=e.pendingLanes;if(n===0)return 0;var i=0,r=e.suspendedLanes,o=e.pingedLanes,s=n&268435455;if(s!==0){var a=s&~r;a!==0?i=Ah(a):(o&=s,o!==0&&(i=Ah(o)))}else s=n&~r,s!==0?i=Ah(s):o!==0&&(i=Ah(o));if(i===0)return 0;if(t!==0&&t!==i&&!(t&r)&&(r=i&-i,o=t&-t,r>=o||r===16&&(o&4194240)!==0))return t;if(i&4&&(i|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=i;0<t;)n=31-ro(t),r=1<<n,i|=e[n],t&=~r;return i}function PI(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function TI(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-ro(o),a=1<<s,c=r[s];c===-1?(!(a&n)||a&i)&&(r[s]=PI(a,t)):c<=t&&(e.expiredLanes|=a),o&=~a}}function vv(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function $A(){var e=Lp;return Lp<<=1,!(Lp&4194240)&&(Lp=64),e}function V0(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function hp(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-ro(t),e[t]=n}function EI(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-ro(n),o=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~o}}function Tb(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-ro(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var sn=0;function VA(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var HA,Eb,jA,WA,qA,xv=!1,Op=[],aa=null,ca=null,la=null,af=new Map,cf=new Map,ta=[],II="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function a2(e,t){switch(e){case"focusin":case"focusout":aa=null;break;case"dragenter":case"dragleave":ca=null;break;case"mouseover":case"mouseout":la=null;break;case"pointerover":case"pointerout":af.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":cf.delete(t.pointerId)}}function Xu(e,t,n,i,r,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:o,targetContainers:[r]},t!==null&&(t=pp(t),t!==null&&Eb(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,r!==null&&t.indexOf(r)===-1&&t.push(r),e)}function LI(e,t,n,i,r){switch(t){case"focusin":return aa=Xu(aa,e,t,n,i,r),!0;case"dragenter":return ca=Xu(ca,e,t,n,i,r),!0;case"mouseover":return la=Xu(la,e,t,n,i,r),!0;case"pointerover":var o=r.pointerId;return af.set(o,Xu(af.get(o)||null,e,t,n,i,r)),!0;case"gotpointercapture":return o=r.pointerId,cf.set(o,Xu(cf.get(o)||null,e,t,n,i,r)),!0}return!1}function XA(e){var t=Ja(e.target);if(t!==null){var n=Rc(t);if(n!==null){if(t=n.tag,t===13){if(t=BA(n),t!==null){e.blockedOn=t,qA(e.priority,function(){jA(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Qd(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=bv(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var i=new n.constructor(n.type,n);dv=i,n.target.dispatchEvent(i),dv=null}else return t=pp(n),t!==null&&Eb(t),e.blockedOn=n,!1;t.shift()}return!0}function c2(e,t,n){Qd(e)&&n.delete(t)}function RI(){xv=!1,aa!==null&&Qd(aa)&&(aa=null),ca!==null&&Qd(ca)&&(ca=null),la!==null&&Qd(la)&&(la=null),af.forEach(c2),cf.forEach(c2)}function Yu(e,t){e.blockedOn===t&&(e.blockedOn=null,xv||(xv=!0,fr.unstable_scheduleCallback(fr.unstable_NormalPriority,RI)))}function lf(e){function t(r){return Yu(r,e)}if(0<Op.length){Yu(Op[0],e);for(var n=1;n<Op.length;n++){var i=Op[n];i.blockedOn===e&&(i.blockedOn=null)}}for(aa!==null&&Yu(aa,e),ca!==null&&Yu(ca,e),la!==null&&Yu(la,e),af.forEach(t),cf.forEach(t),n=0;n<ta.length;n++)i=ta[n],i.blockedOn===e&&(i.blockedOn=null);for(;0<ta.length&&(n=ta[0],n.blockedOn===null);)XA(n),n.blockedOn===null&&ta.shift()}var Gl=Ts.ReactCurrentBatchConfig,Om=!0;function OI(e,t,n,i){var r=sn,o=Gl.transition;Gl.transition=null;try{sn=1,Ib(e,t,n,i)}finally{sn=r,Gl.transition=o}}function kI(e,t,n,i){var r=sn,o=Gl.transition;Gl.transition=null;try{sn=4,Ib(e,t,n,i)}finally{sn=r,Gl.transition=o}}function Ib(e,t,n,i){if(Om){var r=bv(e,t,n,i);if(r===null)J0(e,t,i,km,n),a2(e,i);else if(LI(r,e,t,n,i))i.stopPropagation();else if(a2(e,i),t&4&&-1<II.indexOf(e)){for(;r!==null;){var o=pp(r);if(o!==null&&HA(o),o=bv(e,t,n,i),o===null&&J0(e,t,i,km,n),o===r)break;r=o}r!==null&&i.stopPropagation()}else J0(e,t,i,null,n)}}var km=null;function bv(e,t,n,i){if(km=null,e=Cb(i),e=Ja(e),e!==null)if(t=Rc(e),t===null)e=null;else if(n=t.tag,n===13){if(e=BA(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return km=e,null}function YA(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(_I()){case Pb:return 1;case UA:return 4;case Lm:case wI:return 16;case GA:return 536870912;default:return 16}default:return 16}}var ra=null,Lb=null,Jd=null;function ZA(){if(Jd)return Jd;var e,t=Lb,n=t.length,i,r="value"in ra?ra.value:ra.textContent,o=r.length;for(e=0;e<n&&t[e]===r[e];e++);var s=n-e;for(i=1;i<=s&&t[n-i]===r[o-i];i++);return Jd=r.slice(e,1<i?1-i:void 0)}function em(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function kp(){return!0}function l2(){return!1}function xr(e){function t(n,i,r,o,s){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var a in e)e.hasOwnProperty(a)&&(n=e[a],this[a]=n?n(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?kp:l2,this.isPropagationStopped=l2,this}return Rn(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=kp)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=kp)},persist:function(){},isPersistent:kp}),t}var Tu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Rb=xr(Tu),fp=Rn({},Tu,{view:0,detail:0}),DI=xr(fp),H0,j0,Zu,Jg=Rn({},fp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ob,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Zu&&(Zu&&e.type==="mousemove"?(H0=e.screenX-Zu.screenX,j0=e.screenY-Zu.screenY):j0=H0=0,Zu=e),H0)},movementY:function(e){return"movementY"in e?e.movementY:j0}}),u2=xr(Jg),BI=Rn({},Jg,{dataTransfer:0}),FI=xr(BI),NI=Rn({},fp,{relatedTarget:0}),W0=xr(NI),zI=Rn({},Tu,{animationName:0,elapsedTime:0,pseudoElement:0}),UI=xr(zI),GI=Rn({},Tu,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),$I=xr(GI),VI=Rn({},Tu,{data:0}),h2=xr(VI),HI={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},jI={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},WI={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function qI(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=WI[e])?!!t[e]:!1}function Ob(){return qI}var XI=Rn({},fp,{key:function(e){if(e.key){var t=HI[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=em(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?jI[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ob,charCode:function(e){return e.type==="keypress"?em(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?em(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),YI=xr(XI),ZI=Rn({},Jg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),f2=xr(ZI),KI=Rn({},fp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ob}),QI=xr(KI),JI=Rn({},Tu,{propertyName:0,elapsedTime:0,pseudoElement:0}),e4=xr(JI),t4=Rn({},Jg,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),n4=xr(t4),i4=[9,13,27,32],kb=ds&&"CompositionEvent"in window,Nh=null;ds&&"documentMode"in document&&(Nh=document.documentMode);var r4=ds&&"TextEvent"in window&&!Nh,KA=ds&&(!kb||Nh&&8<Nh&&11>=Nh),p2=String.fromCharCode(32),d2=!1;function QA(e,t){switch(e){case"keyup":return i4.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function JA(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var xl=!1;function o4(e,t){switch(e){case"compositionend":return JA(t);case"keypress":return t.which!==32?null:(d2=!0,p2);case"textInput":return e=t.data,e===p2&&d2?null:e;default:return null}}function s4(e,t){if(xl)return e==="compositionend"||!kb&&QA(e,t)?(e=ZA(),Jd=Lb=ra=null,xl=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return KA&&t.locale!=="ko"?null:t.data;default:return null}}var a4={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function m2(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!a4[e.type]:t==="textarea"}function eC(e,t,n,i){LA(i),t=Dm(t,"onChange"),0<t.length&&(n=new Rb("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var zh=null,uf=null;function c4(e){hC(e,0)}function e0(e){var t=wl(e);if(MA(t))return e}function l4(e,t){if(e==="change")return t}var tC=!1;if(ds){var q0;if(ds){var X0="oninput"in document;if(!X0){var g2=document.createElement("div");g2.setAttribute("oninput","return;"),X0=typeof g2.oninput=="function"}q0=X0}else q0=!1;tC=q0&&(!document.documentMode||9<document.documentMode)}function y2(){zh&&(zh.detachEvent("onpropertychange",nC),uf=zh=null)}function nC(e){if(e.propertyName==="value"&&e0(uf)){var t=[];eC(t,uf,e,Cb(e)),DA(c4,t)}}function u4(e,t,n){e==="focusin"?(y2(),zh=t,uf=n,zh.attachEvent("onpropertychange",nC)):e==="focusout"&&y2()}function h4(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return e0(uf)}function f4(e,t){if(e==="click")return e0(t)}function p4(e,t){if(e==="input"||e==="change")return e0(t)}function d4(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var co=typeof Object.is=="function"?Object.is:d4;function hf(e,t){if(co(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!nv.call(t,r)||!co(e[r],t[r]))return!1}return!0}function v2(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function x2(e,t){var n=v2(e);e=0;for(var i;n;){if(n.nodeType===3){if(i=e+n.textContent.length,e<=t&&i>=t)return{node:n,offset:t-e};e=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=v2(n)}}function iC(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?iC(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function rC(){for(var e=window,t=Tm();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Tm(e.document)}return t}function Db(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function m4(e){var t=rC(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&iC(n.ownerDocument.documentElement,n)){if(i!==null&&Db(n)){if(t=i.start,e=i.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(i.start,r);i=i.end===void 0?o:Math.min(i.end,r),!e.extend&&o>i&&(r=i,i=o,o=r),r=x2(n,o);var s=x2(n,i);r&&s&&(e.rangeCount!==1||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&(t=t.createRange(),t.setStart(r.node,r.offset),e.removeAllRanges(),o>i?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var g4=ds&&"documentMode"in document&&11>=document.documentMode,bl=null,_v=null,Uh=null,wv=!1;function b2(e,t,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;wv||bl==null||bl!==Tm(i)||(i=bl,"selectionStart"in i&&Db(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Uh&&hf(Uh,i)||(Uh=i,i=Dm(_v,"onSelect"),0<i.length&&(t=new Rb("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=bl)))}function Dp(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var _l={animationend:Dp("Animation","AnimationEnd"),animationiteration:Dp("Animation","AnimationIteration"),animationstart:Dp("Animation","AnimationStart"),transitionend:Dp("Transition","TransitionEnd")},Y0={},oC={};ds&&(oC=document.createElement("div").style,"AnimationEvent"in window||(delete _l.animationend.animation,delete _l.animationiteration.animation,delete _l.animationstart.animation),"TransitionEvent"in window||delete _l.transitionend.transition);function t0(e){if(Y0[e])return Y0[e];if(!_l[e])return e;var t=_l[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in oC)return Y0[e]=t[n];return e}var sC=t0("animationend"),aC=t0("animationiteration"),cC=t0("animationstart"),lC=t0("transitionend"),uC=new Map,_2="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ia(e,t){uC.set(e,t),Lc(t,[e])}for(var Z0=0;Z0<_2.length;Z0++){var K0=_2[Z0],y4=K0.toLowerCase(),v4=K0[0].toUpperCase()+K0.slice(1);Ia(y4,"on"+v4)}Ia(sC,"onAnimationEnd");Ia(aC,"onAnimationIteration");Ia(cC,"onAnimationStart");Ia("dblclick","onDoubleClick");Ia("focusin","onFocus");Ia("focusout","onBlur");Ia(lC,"onTransitionEnd");Zl("onMouseEnter",["mouseout","mouseover"]);Zl("onMouseLeave",["mouseout","mouseover"]);Zl("onPointerEnter",["pointerout","pointerover"]);Zl("onPointerLeave",["pointerout","pointerover"]);Lc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Lc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Lc("onBeforeInput",["compositionend","keypress","textInput","paste"]);Lc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Lc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Lc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ch="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),x4=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ch));function w2(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,yI(i,t,void 0,e),e.currentTarget=null}function hC(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var o=void 0;if(t)for(var s=i.length-1;0<=s;s--){var a=i[s],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==o&&r.isPropagationStopped())break e;w2(r,a,l),o=c}else for(s=0;s<i.length;s++){if(a=i[s],c=a.instance,l=a.currentTarget,a=a.listener,c!==o&&r.isPropagationStopped())break e;w2(r,a,l),o=c}}}if(Im)throw e=yv,Im=!1,yv=null,e}function xn(e,t){var n=t[Pv];n===void 0&&(n=t[Pv]=new Set);var i=e+"__bubble";n.has(i)||(fC(t,e,2,!1),n.add(i))}function Q0(e,t,n){var i=0;t&&(i|=4),fC(n,e,i,t)}var Bp="_reactListening"+Math.random().toString(36).slice(2);function ff(e){if(!e[Bp]){e[Bp]=!0,xA.forEach(function(n){n!=="selectionchange"&&(x4.has(n)||Q0(n,!1,e),Q0(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Bp]||(t[Bp]=!0,Q0("selectionchange",!1,t))}}function fC(e,t,n,i){switch(YA(t)){case 1:var r=OI;break;case 4:r=kI;break;default:r=Ib}n=r.bind(null,t,n,e),r=void 0,!gv||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(r=!0),i?r!==void 0?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):r!==void 0?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function J0(e,t,n,i,r){var o=i;if(!(t&1)&&!(t&2)&&i!==null)e:for(;;){if(i===null)return;var s=i.tag;if(s===3||s===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(s===4)for(s=i.return;s!==null;){var c=s.tag;if((c===3||c===4)&&(c=s.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;s=s.return}for(;a!==null;){if(s=Ja(a),s===null)return;if(c=s.tag,c===5||c===6){i=o=s;continue e}a=a.parentNode}}i=i.return}DA(function(){var l=o,u=Cb(n),h=[];e:{var f=uC.get(e);if(f!==void 0){var p=Rb,m=e;switch(e){case"keypress":if(em(n)===0)break e;case"keydown":case"keyup":p=YI;break;case"focusin":m="focus",p=W0;break;case"focusout":m="blur",p=W0;break;case"beforeblur":case"afterblur":p=W0;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=u2;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=FI;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=QI;break;case sC:case aC:case cC:p=UI;break;case lC:p=e4;break;case"scroll":p=DI;break;case"wheel":p=n4;break;case"copy":case"cut":case"paste":p=$I;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=f2}var y=(t&4)!==0,v=!y&&e==="scroll",d=y?f!==null?f+"Capture":null:f;y=[];for(var g=l,b;g!==null;){b=g;var x=b.stateNode;if(b.tag===5&&x!==null&&(b=x,d!==null&&(x=sf(g,d),x!=null&&y.push(pf(g,x,b)))),v)break;g=g.return}0<y.length&&(f=new p(f,m,null,n,u),h.push({event:f,listeners:y}))}}if(!(t&7)){e:{if(f=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",f&&n!==dv&&(m=n.relatedTarget||n.fromElement)&&(Ja(m)||m[ms]))break e;if((p||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,p?(m=n.relatedTarget||n.toElement,p=l,m=m?Ja(m):null,m!==null&&(v=Rc(m),m!==v||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=l),p!==m)){if(y=u2,x="onMouseLeave",d="onMouseEnter",g="mouse",(e==="pointerout"||e==="pointerover")&&(y=f2,x="onPointerLeave",d="onPointerEnter",g="pointer"),v=p==null?f:wl(p),b=m==null?f:wl(m),f=new y(x,g+"leave",p,n,u),f.target=v,f.relatedTarget=b,x=null,Ja(u)===l&&(y=new y(d,g+"enter",m,n,u),y.target=b,y.relatedTarget=v,x=y),v=x,p&&m)t:{for(y=p,d=m,g=0,b=y;b;b=Dc(b))g++;for(b=0,x=d;x;x=Dc(x))b++;for(;0<g-b;)y=Dc(y),g--;for(;0<b-g;)d=Dc(d),b--;for(;g--;){if(y===d||d!==null&&y===d.alternate)break t;y=Dc(y),d=Dc(d)}y=null}else y=null;p!==null&&S2(h,f,p,y,!1),m!==null&&v!==null&&S2(h,v,m,y,!0)}}e:{if(f=l?wl(l):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var _=l4;else if(m2(f))if(tC)_=p4;else{_=h4;var S=u4}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(_=f4);if(_&&(_=_(e,l))){eC(h,_,n,u);break e}S&&S(e,f,l),e==="focusout"&&(S=f._wrapperState)&&S.controlled&&f.type==="number"&&lv(f,"number",f.value)}switch(S=l?wl(l):window,e){case"focusin":(m2(S)||S.contentEditable==="true")&&(bl=S,_v=l,Uh=null);break;case"focusout":Uh=_v=bl=null;break;case"mousedown":wv=!0;break;case"contextmenu":case"mouseup":case"dragend":wv=!1,b2(h,n,u);break;case"selectionchange":if(g4)break;case"keydown":case"keyup":b2(h,n,u)}var w;if(kb)e:{switch(e){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else xl?QA(e,n)&&(C="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(C="onCompositionStart");C&&(KA&&n.locale!=="ko"&&(xl||C!=="onCompositionStart"?C==="onCompositionEnd"&&xl&&(w=ZA()):(ra=u,Lb="value"in ra?ra.value:ra.textContent,xl=!0)),S=Dm(l,C),0<S.length&&(C=new h2(C,e,null,n,u),h.push({event:C,listeners:S}),w?C.data=w:(w=JA(n),w!==null&&(C.data=w)))),(w=r4?o4(e,n):s4(e,n))&&(l=Dm(l,"onBeforeInput"),0<l.length&&(u=new h2("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:l}),u.data=w))}hC(h,t)})}function pf(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Dm(e,t){for(var n=t+"Capture",i=[];e!==null;){var r=e,o=r.stateNode;r.tag===5&&o!==null&&(r=o,o=sf(e,n),o!=null&&i.unshift(pf(e,o,r)),o=sf(e,t),o!=null&&i.push(pf(e,o,r))),e=e.return}return i}function Dc(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function S2(e,t,n,i,r){for(var o=t._reactName,s=[];n!==null&&n!==i;){var a=n,c=a.alternate,l=a.stateNode;if(c!==null&&c===i)break;a.tag===5&&l!==null&&(a=l,r?(c=sf(n,o),c!=null&&s.unshift(pf(n,c,a))):r||(c=sf(n,o),c!=null&&s.push(pf(n,c,a)))),n=n.return}s.length!==0&&e.push({event:t,listeners:s})}var b4=/\r\n?/g,_4=/\u0000|\uFFFD/g;function M2(e){return(typeof e=="string"?e:""+e).replace(b4,`
`).replace(_4,"")}function Fp(e,t,n){if(t=M2(t),M2(e)!==t&&n)throw Error(Ne(425))}function Bm(){}var Sv=null,Mv=null;function Av(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Cv=typeof setTimeout=="function"?setTimeout:void 0,w4=typeof clearTimeout=="function"?clearTimeout:void 0,A2=typeof Promise=="function"?Promise:void 0,S4=typeof queueMicrotask=="function"?queueMicrotask:typeof A2<"u"?function(e){return A2.resolve(null).then(e).catch(M4)}:Cv;function M4(e){setTimeout(function(){throw e})}function e1(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){e.removeChild(r),lf(t);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);lf(t)}function ua(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function C2(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Eu=Math.random().toString(36).slice(2),Lo="__reactFiber$"+Eu,df="__reactProps$"+Eu,ms="__reactContainer$"+Eu,Pv="__reactEvents$"+Eu,A4="__reactListeners$"+Eu,C4="__reactHandles$"+Eu;function Ja(e){var t=e[Lo];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ms]||n[Lo]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=C2(e);e!==null;){if(n=e[Lo])return n;e=C2(e)}return t}e=n,n=e.parentNode}return null}function pp(e){return e=e[Lo]||e[ms],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function wl(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Ne(33))}function n0(e){return e[df]||null}var Tv=[],Sl=-1;function La(e){return{current:e}}function bn(e){0>Sl||(e.current=Tv[Sl],Tv[Sl]=null,Sl--)}function gn(e,t){Sl++,Tv[Sl]=e.current,e.current=t}var wa={},Pi=La(wa),Ki=La(!1),hc=wa;function Kl(e,t){var n=e.type.contextTypes;if(!n)return wa;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r={},o;for(o in n)r[o]=t[o];return i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function Qi(e){return e=e.childContextTypes,e!=null}function Fm(){bn(Ki),bn(Pi)}function P2(e,t,n){if(Pi.current!==wa)throw Error(Ne(168));gn(Pi,t),gn(Ki,n)}function pC(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in t))throw Error(Ne(108,uI(e)||"Unknown",r));return Rn({},n,i)}function Nm(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||wa,hc=Pi.current,gn(Pi,e),gn(Ki,Ki.current),!0}function T2(e,t,n){var i=e.stateNode;if(!i)throw Error(Ne(169));n?(e=pC(e,t,hc),i.__reactInternalMemoizedMergedChildContext=e,bn(Ki),bn(Pi),gn(Pi,e)):bn(Ki),gn(Ki,n)}var os=null,i0=!1,t1=!1;function dC(e){os===null?os=[e]:os.push(e)}function P4(e){i0=!0,dC(e)}function Ra(){if(!t1&&os!==null){t1=!0;var e=0,t=sn;try{var n=os;for(sn=1;e<n.length;e++){var i=n[e];do i=i(!0);while(i!==null)}os=null,i0=!1}catch(r){throw os!==null&&(os=os.slice(e+1)),zA(Pb,Ra),r}finally{sn=t,t1=!1}}return null}var Ml=[],Al=0,zm=null,Um=0,Er=[],Ir=0,fc=null,us=1,hs="";function Xa(e,t){Ml[Al++]=Um,Ml[Al++]=zm,zm=e,Um=t}function mC(e,t,n){Er[Ir++]=us,Er[Ir++]=hs,Er[Ir++]=fc,fc=e;var i=us;e=hs;var r=32-ro(i)-1;i&=~(1<<r),n+=1;var o=32-ro(t)+r;if(30<o){var s=r-r%5;o=(i&(1<<s)-1).toString(32),i>>=s,r-=s,us=1<<32-ro(t)+r|n<<r|i,hs=o+e}else us=1<<o|n<<r|i,hs=e}function Bb(e){e.return!==null&&(Xa(e,1),mC(e,1,0))}function Fb(e){for(;e===zm;)zm=Ml[--Al],Ml[Al]=null,Um=Ml[--Al],Ml[Al]=null;for(;e===fc;)fc=Er[--Ir],Er[Ir]=null,hs=Er[--Ir],Er[Ir]=null,us=Er[--Ir],Er[Ir]=null}var hr=null,ur=null,Mn=!1,eo=null;function gC(e,t){var n=Lr(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function E2(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,hr=e,ur=ua(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,hr=e,ur=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=fc!==null?{id:us,overflow:hs}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=Lr(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,hr=e,ur=null,!0):!1;default:return!1}}function Ev(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Iv(e){if(Mn){var t=ur;if(t){var n=t;if(!E2(e,t)){if(Ev(e))throw Error(Ne(418));t=ua(n.nextSibling);var i=hr;t&&E2(e,t)?gC(i,n):(e.flags=e.flags&-4097|2,Mn=!1,hr=e)}}else{if(Ev(e))throw Error(Ne(418));e.flags=e.flags&-4097|2,Mn=!1,hr=e}}}function I2(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;hr=e}function Np(e){if(e!==hr)return!1;if(!Mn)return I2(e),Mn=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Av(e.type,e.memoizedProps)),t&&(t=ur)){if(Ev(e))throw yC(),Error(Ne(418));for(;t;)gC(e,t),t=ua(t.nextSibling)}if(I2(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Ne(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){ur=ua(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}ur=null}}else ur=hr?ua(e.stateNode.nextSibling):null;return!0}function yC(){for(var e=ur;e;)e=ua(e.nextSibling)}function Ql(){ur=hr=null,Mn=!1}function Nb(e){eo===null?eo=[e]:eo.push(e)}var T4=Ts.ReactCurrentBatchConfig;function Zr(e,t){if(e&&e.defaultProps){t=Rn({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}var Gm=La(null),$m=null,Cl=null,zb=null;function Ub(){zb=Cl=$m=null}function Gb(e){var t=Gm.current;bn(Gm),e._currentValue=t}function Lv(e,t,n){for(;e!==null;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,i!==null&&(i.childLanes|=t)):i!==null&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function $l(e,t){$m=e,zb=Cl=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Zi=!0),e.firstContext=null)}function Dr(e){var t=e._currentValue;if(zb!==e)if(e={context:e,memoizedValue:t,next:null},Cl===null){if($m===null)throw Error(Ne(308));Cl=e,$m.dependencies={lanes:0,firstContext:e}}else Cl=Cl.next=e;return t}var ec=null;function $b(e){ec===null?ec=[e]:ec.push(e)}function vC(e,t,n,i){var r=t.interleaved;return r===null?(n.next=n,$b(t)):(n.next=r.next,r.next=n),t.interleaved=n,gs(e,i)}function gs(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var Js=!1;function Vb(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function xC(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function fs(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ha(e,t,n){var i=e.updateQueue;if(i===null)return null;if(i=i.shared,Wt&2){var r=i.pending;return r===null?t.next=t:(t.next=r.next,r.next=t),i.pending=t,gs(e,n)}return r=i.interleaved,r===null?(t.next=t,$b(i)):(t.next=r.next,r.next=t),i.interleaved=t,gs(e,n)}function tm(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var i=t.lanes;i&=e.pendingLanes,n|=i,t.lanes=n,Tb(e,n)}}function L2(e,t){var n=e.updateQueue,i=e.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?r=o=s:o=o.next=s,n=n.next}while(n!==null);o===null?r=o=t:o=o.next=t}else r=o=t;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:i.shared,effects:i.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Vm(e,t,n,i){var r=e.updateQueue;Js=!1;var o=r.firstBaseUpdate,s=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var c=a,l=c.next;c.next=null,s===null?o=l:s.next=l,s=c;var u=e.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==s&&(a===null?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(o!==null){var h=r.baseState;s=0,u=l=c=null,a=o;do{var f=a.lane,p=a.eventTime;if((i&f)===f){u!==null&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=e,y=a;switch(f=t,p=n,y.tag){case 1:if(m=y.payload,typeof m=="function"){h=m.call(p,h,f);break e}h=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=y.payload,f=typeof m=="function"?m.call(p,h,f):m,f==null)break e;h=Rn({},h,f);break e;case 2:Js=!0}}a.callback!==null&&a.lane!==0&&(e.flags|=64,f=r.effects,f===null?r.effects=[a]:f.push(a))}else p={eventTime:p,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(l=u=p,c=h):u=u.next=p,s|=f;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;f=a,a=f.next,f.next=null,r.lastBaseUpdate=f,r.shared.pending=null}}while(1);if(u===null&&(c=h),r.baseState=c,r.firstBaseUpdate=l,r.lastBaseUpdate=u,t=r.shared.interleaved,t!==null){r=t;do s|=r.lane,r=r.next;while(r!==t)}else o===null&&(r.shared.lanes=0);dc|=s,e.lanes=s,e.memoizedState=h}}function R2(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(Ne(191,r));r.call(i)}}}var bC=new vA.Component().refs;function Rv(e,t,n,i){t=e.memoizedState,n=n(i,t),n=n==null?t:Rn({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var r0={isMounted:function(e){return(e=e._reactInternals)?Rc(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=Ni(),r=pa(e),o=fs(i,r);o.payload=t,n!=null&&(o.callback=n),t=ha(e,o,r),t!==null&&(oo(t,e,r,i),tm(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=Ni(),r=pa(e),o=fs(i,r);o.tag=1,o.payload=t,n!=null&&(o.callback=n),t=ha(e,o,r),t!==null&&(oo(t,e,r,i),tm(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Ni(),i=pa(e),r=fs(n,i);r.tag=2,t!=null&&(r.callback=t),t=ha(e,r,i),t!==null&&(oo(t,e,i,n),tm(t,e,i))}};function O2(e,t,n,i,r,o,s){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(i,o,s):t.prototype&&t.prototype.isPureReactComponent?!hf(n,i)||!hf(r,o):!0}function _C(e,t,n){var i=!1,r=wa,o=t.contextType;return typeof o=="object"&&o!==null?o=Dr(o):(r=Qi(t)?hc:Pi.current,i=t.contextTypes,o=(i=i!=null)?Kl(e,r):wa),t=new t(n,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=r0,e.stateNode=t,t._reactInternals=e,i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function k2(e,t,n,i){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,i),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&r0.enqueueReplaceState(t,t.state,null)}function Ov(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=bC,Vb(e);var o=t.contextType;typeof o=="object"&&o!==null?r.context=Dr(o):(o=Qi(t)?hc:Pi.current,r.context=Kl(e,o)),r.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(Rv(e,t,o,n),r.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(t=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),t!==r.state&&r0.enqueueReplaceState(r,r.state,null),Vm(e,n,r,i),r.state=e.memoizedState),typeof r.componentDidMount=="function"&&(e.flags|=4194308)}function Ku(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Ne(309));var i=n.stateNode}if(!i)throw Error(Ne(147,e));var r=i,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(s){var a=r.refs;a===bC&&(a=r.refs={}),s===null?delete a[o]:a[o]=s},t._stringRef=o,t)}if(typeof e!="string")throw Error(Ne(284));if(!n._owner)throw Error(Ne(290,e))}return e}function zp(e,t){throw e=Object.prototype.toString.call(t),Error(Ne(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function D2(e){var t=e._init;return t(e._payload)}function wC(e){function t(d,g){if(e){var b=d.deletions;b===null?(d.deletions=[g],d.flags|=16):b.push(g)}}function n(d,g){if(!e)return null;for(;g!==null;)t(d,g),g=g.sibling;return null}function i(d,g){for(d=new Map;g!==null;)g.key!==null?d.set(g.key,g):d.set(g.index,g),g=g.sibling;return d}function r(d,g){return d=da(d,g),d.index=0,d.sibling=null,d}function o(d,g,b){return d.index=b,e?(b=d.alternate,b!==null?(b=b.index,b<g?(d.flags|=2,g):b):(d.flags|=2,g)):(d.flags|=1048576,g)}function s(d){return e&&d.alternate===null&&(d.flags|=2),d}function a(d,g,b,x){return g===null||g.tag!==6?(g=c1(b,d.mode,x),g.return=d,g):(g=r(g,b),g.return=d,g)}function c(d,g,b,x){var _=b.type;return _===vl?u(d,g,b.props.children,x,b.key):g!==null&&(g.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===Qs&&D2(_)===g.type)?(x=r(g,b.props),x.ref=Ku(d,g,b),x.return=d,x):(x=am(b.type,b.key,b.props,null,d.mode,x),x.ref=Ku(d,g,b),x.return=d,x)}function l(d,g,b,x){return g===null||g.tag!==4||g.stateNode.containerInfo!==b.containerInfo||g.stateNode.implementation!==b.implementation?(g=l1(b,d.mode,x),g.return=d,g):(g=r(g,b.children||[]),g.return=d,g)}function u(d,g,b,x,_){return g===null||g.tag!==7?(g=ic(b,d.mode,x,_),g.return=d,g):(g=r(g,b),g.return=d,g)}function h(d,g,b){if(typeof g=="string"&&g!==""||typeof g=="number")return g=c1(""+g,d.mode,b),g.return=d,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Tp:return b=am(g.type,g.key,g.props,null,d.mode,b),b.ref=Ku(d,null,g),b.return=d,b;case yl:return g=l1(g,d.mode,b),g.return=d,g;case Qs:var x=g._init;return h(d,x(g._payload),b)}if(Mh(g)||Wu(g))return g=ic(g,d.mode,b,null),g.return=d,g;zp(d,g)}return null}function f(d,g,b,x){var _=g!==null?g.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return _!==null?null:a(d,g,""+b,x);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Tp:return b.key===_?c(d,g,b,x):null;case yl:return b.key===_?l(d,g,b,x):null;case Qs:return _=b._init,f(d,g,_(b._payload),x)}if(Mh(b)||Wu(b))return _!==null?null:u(d,g,b,x,null);zp(d,b)}return null}function p(d,g,b,x,_){if(typeof x=="string"&&x!==""||typeof x=="number")return d=d.get(b)||null,a(g,d,""+x,_);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Tp:return d=d.get(x.key===null?b:x.key)||null,c(g,d,x,_);case yl:return d=d.get(x.key===null?b:x.key)||null,l(g,d,x,_);case Qs:var S=x._init;return p(d,g,b,S(x._payload),_)}if(Mh(x)||Wu(x))return d=d.get(b)||null,u(g,d,x,_,null);zp(g,x)}return null}function m(d,g,b,x){for(var _=null,S=null,w=g,C=g=0,A=null;w!==null&&C<b.length;C++){w.index>C?(A=w,w=null):A=w.sibling;var k=f(d,w,b[C],x);if(k===null){w===null&&(w=A);break}e&&w&&k.alternate===null&&t(d,w),g=o(k,g,C),S===null?_=k:S.sibling=k,S=k,w=A}if(C===b.length)return n(d,w),Mn&&Xa(d,C),_;if(w===null){for(;C<b.length;C++)w=h(d,b[C],x),w!==null&&(g=o(w,g,C),S===null?_=w:S.sibling=w,S=w);return Mn&&Xa(d,C),_}for(w=i(d,w);C<b.length;C++)A=p(w,d,C,b[C],x),A!==null&&(e&&A.alternate!==null&&w.delete(A.key===null?C:A.key),g=o(A,g,C),S===null?_=A:S.sibling=A,S=A);return e&&w.forEach(function(L){return t(d,L)}),Mn&&Xa(d,C),_}function y(d,g,b,x){var _=Wu(b);if(typeof _!="function")throw Error(Ne(150));if(b=_.call(b),b==null)throw Error(Ne(151));for(var S=_=null,w=g,C=g=0,A=null,k=b.next();w!==null&&!k.done;C++,k=b.next()){w.index>C?(A=w,w=null):A=w.sibling;var L=f(d,w,k.value,x);if(L===null){w===null&&(w=A);break}e&&w&&L.alternate===null&&t(d,w),g=o(L,g,C),S===null?_=L:S.sibling=L,S=L,w=A}if(k.done)return n(d,w),Mn&&Xa(d,C),_;if(w===null){for(;!k.done;C++,k=b.next())k=h(d,k.value,x),k!==null&&(g=o(k,g,C),S===null?_=k:S.sibling=k,S=k);return Mn&&Xa(d,C),_}for(w=i(d,w);!k.done;C++,k=b.next())k=p(w,d,C,k.value,x),k!==null&&(e&&k.alternate!==null&&w.delete(k.key===null?C:k.key),g=o(k,g,C),S===null?_=k:S.sibling=k,S=k);return e&&w.forEach(function(D){return t(d,D)}),Mn&&Xa(d,C),_}function v(d,g,b,x){if(typeof b=="object"&&b!==null&&b.type===vl&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case Tp:e:{for(var _=b.key,S=g;S!==null;){if(S.key===_){if(_=b.type,_===vl){if(S.tag===7){n(d,S.sibling),g=r(S,b.props.children),g.return=d,d=g;break e}}else if(S.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===Qs&&D2(_)===S.type){n(d,S.sibling),g=r(S,b.props),g.ref=Ku(d,S,b),g.return=d,d=g;break e}n(d,S);break}else t(d,S);S=S.sibling}b.type===vl?(g=ic(b.props.children,d.mode,x,b.key),g.return=d,d=g):(x=am(b.type,b.key,b.props,null,d.mode,x),x.ref=Ku(d,g,b),x.return=d,d=x)}return s(d);case yl:e:{for(S=b.key;g!==null;){if(g.key===S)if(g.tag===4&&g.stateNode.containerInfo===b.containerInfo&&g.stateNode.implementation===b.implementation){n(d,g.sibling),g=r(g,b.children||[]),g.return=d,d=g;break e}else{n(d,g);break}else t(d,g);g=g.sibling}g=l1(b,d.mode,x),g.return=d,d=g}return s(d);case Qs:return S=b._init,v(d,g,S(b._payload),x)}if(Mh(b))return m(d,g,b,x);if(Wu(b))return y(d,g,b,x);zp(d,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,g!==null&&g.tag===6?(n(d,g.sibling),g=r(g,b),g.return=d,d=g):(n(d,g),g=c1(b,d.mode,x),g.return=d,d=g),s(d)):n(d,g)}return v}var Jl=wC(!0),SC=wC(!1),dp={},Bo=La(dp),mf=La(dp),gf=La(dp);function tc(e){if(e===dp)throw Error(Ne(174));return e}function Hb(e,t){switch(gn(gf,t),gn(mf,e),gn(Bo,dp),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:hv(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=hv(t,e)}bn(Bo),gn(Bo,t)}function eu(){bn(Bo),bn(mf),bn(gf)}function MC(e){tc(gf.current);var t=tc(Bo.current),n=hv(t,e.type);t!==n&&(gn(mf,e),gn(Bo,n))}function jb(e){mf.current===e&&(bn(Bo),bn(mf))}var Cn=La(0);function Hm(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var n1=[];function Wb(){for(var e=0;e<n1.length;e++)n1[e]._workInProgressVersionPrimary=null;n1.length=0}var nm=Ts.ReactCurrentDispatcher,i1=Ts.ReactCurrentBatchConfig,pc=0,In=null,Qn=null,si=null,jm=!1,Gh=!1,yf=0,E4=0;function vi(){throw Error(Ne(321))}function qb(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!co(e[n],t[n]))return!1;return!0}function Xb(e,t,n,i,r,o){if(pc=o,In=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,nm.current=e===null||e.memoizedState===null?O4:k4,e=n(i,r),Gh){o=0;do{if(Gh=!1,yf=0,25<=o)throw Error(Ne(301));o+=1,si=Qn=null,t.updateQueue=null,nm.current=D4,e=n(i,r)}while(Gh)}if(nm.current=Wm,t=Qn!==null&&Qn.next!==null,pc=0,si=Qn=In=null,jm=!1,t)throw Error(Ne(300));return e}function Yb(){var e=yf!==0;return yf=0,e}function Po(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return si===null?In.memoizedState=si=e:si=si.next=e,si}function Br(){if(Qn===null){var e=In.alternate;e=e!==null?e.memoizedState:null}else e=Qn.next;var t=si===null?In.memoizedState:si.next;if(t!==null)si=t,Qn=e;else{if(e===null)throw Error(Ne(310));Qn=e,e={memoizedState:Qn.memoizedState,baseState:Qn.baseState,baseQueue:Qn.baseQueue,queue:Qn.queue,next:null},si===null?In.memoizedState=si=e:si=si.next=e}return si}function vf(e,t){return typeof t=="function"?t(e):t}function r1(e){var t=Br(),n=t.queue;if(n===null)throw Error(Ne(311));n.lastRenderedReducer=e;var i=Qn,r=i.baseQueue,o=n.pending;if(o!==null){if(r!==null){var s=r.next;r.next=o.next,o.next=s}i.baseQueue=r=o,n.pending=null}if(r!==null){o=r.next,i=i.baseState;var a=s=null,c=null,l=o;do{var u=l.lane;if((pc&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),i=l.hasEagerState?l.eagerState:e(i,l.action);else{var h={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=h,s=i):c=c.next=h,In.lanes|=u,dc|=u}l=l.next}while(l!==null&&l!==o);c===null?s=i:c.next=a,co(i,t.memoizedState)||(Zi=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=c,n.lastRenderedState=i}if(e=n.interleaved,e!==null){r=e;do o=r.lane,In.lanes|=o,dc|=o,r=r.next;while(r!==e)}else r===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function o1(e){var t=Br(),n=t.queue;if(n===null)throw Error(Ne(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,o=t.memoizedState;if(r!==null){n.pending=null;var s=r=r.next;do o=e(o,s.action),s=s.next;while(s!==r);co(o,t.memoizedState)||(Zi=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function AC(){}function CC(e,t){var n=In,i=Br(),r=t(),o=!co(i.memoizedState,r);if(o&&(i.memoizedState=r,Zi=!0),i=i.queue,Zb(EC.bind(null,n,i,e),[e]),i.getSnapshot!==t||o||si!==null&&si.memoizedState.tag&1){if(n.flags|=2048,xf(9,TC.bind(null,n,i,r,t),void 0,null),ai===null)throw Error(Ne(349));pc&30||PC(n,t,r)}return r}function PC(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=In.updateQueue,t===null?(t={lastEffect:null,stores:null},In.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function TC(e,t,n,i){t.value=n,t.getSnapshot=i,IC(t)&&LC(e)}function EC(e,t,n){return n(function(){IC(t)&&LC(e)})}function IC(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!co(e,n)}catch{return!0}}function LC(e){var t=gs(e,1);t!==null&&oo(t,e,1,-1)}function B2(e){var t=Po();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:vf,lastRenderedState:e},t.queue=e,e=e.dispatch=R4.bind(null,In,e),[t.memoizedState,e]}function xf(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},t=In.updateQueue,t===null?(t={lastEffect:null,stores:null},In.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e)),e}function RC(){return Br().memoizedState}function im(e,t,n,i){var r=Po();In.flags|=e,r.memoizedState=xf(1|t,n,void 0,i===void 0?null:i)}function o0(e,t,n,i){var r=Br();i=i===void 0?null:i;var o=void 0;if(Qn!==null){var s=Qn.memoizedState;if(o=s.destroy,i!==null&&qb(i,s.deps)){r.memoizedState=xf(t,n,o,i);return}}In.flags|=e,r.memoizedState=xf(1|t,n,o,i)}function F2(e,t){return im(8390656,8,e,t)}function Zb(e,t){return o0(2048,8,e,t)}function OC(e,t){return o0(4,2,e,t)}function kC(e,t){return o0(4,4,e,t)}function DC(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function BC(e,t,n){return n=n!=null?n.concat([e]):null,o0(4,4,DC.bind(null,t,e),n)}function Kb(){}function FC(e,t){var n=Br();t=t===void 0?null:t;var i=n.memoizedState;return i!==null&&t!==null&&qb(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function NC(e,t){var n=Br();t=t===void 0?null:t;var i=n.memoizedState;return i!==null&&t!==null&&qb(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function zC(e,t,n){return pc&21?(co(n,t)||(n=$A(),In.lanes|=n,dc|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Zi=!0),e.memoizedState=n)}function I4(e,t){var n=sn;sn=n!==0&&4>n?n:4,e(!0);var i=i1.transition;i1.transition={};try{e(!1),t()}finally{sn=n,i1.transition=i}}function UC(){return Br().memoizedState}function L4(e,t,n){var i=pa(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},GC(e))$C(t,n);else if(n=vC(e,t,n,i),n!==null){var r=Ni();oo(n,e,i,r),VC(n,t,i)}}function R4(e,t,n){var i=pa(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(GC(e))$C(t,r);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var s=t.lastRenderedState,a=o(s,n);if(r.hasEagerState=!0,r.eagerState=a,co(a,s)){var c=t.interleaved;c===null?(r.next=r,$b(t)):(r.next=c.next,c.next=r),t.interleaved=r;return}}catch{}finally{}n=vC(e,t,r,i),n!==null&&(r=Ni(),oo(n,e,i,r),VC(n,t,i))}}function GC(e){var t=e.alternate;return e===In||t!==null&&t===In}function $C(e,t){Gh=jm=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function VC(e,t,n){if(n&4194240){var i=t.lanes;i&=e.pendingLanes,n|=i,t.lanes=n,Tb(e,n)}}var Wm={readContext:Dr,useCallback:vi,useContext:vi,useEffect:vi,useImperativeHandle:vi,useInsertionEffect:vi,useLayoutEffect:vi,useMemo:vi,useReducer:vi,useRef:vi,useState:vi,useDebugValue:vi,useDeferredValue:vi,useTransition:vi,useMutableSource:vi,useSyncExternalStore:vi,useId:vi,unstable_isNewReconciler:!1},O4={readContext:Dr,useCallback:function(e,t){return Po().memoizedState=[e,t===void 0?null:t],e},useContext:Dr,useEffect:F2,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,im(4194308,4,DC.bind(null,t,e),n)},useLayoutEffect:function(e,t){return im(4194308,4,e,t)},useInsertionEffect:function(e,t){return im(4,2,e,t)},useMemo:function(e,t){var n=Po();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=Po();return t=n!==void 0?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=L4.bind(null,In,e),[i.memoizedState,e]},useRef:function(e){var t=Po();return e={current:e},t.memoizedState=e},useState:B2,useDebugValue:Kb,useDeferredValue:function(e){return Po().memoizedState=e},useTransition:function(){var e=B2(!1),t=e[0];return e=I4.bind(null,e[1]),Po().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=In,r=Po();if(Mn){if(n===void 0)throw Error(Ne(407));n=n()}else{if(n=t(),ai===null)throw Error(Ne(349));pc&30||PC(i,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,F2(EC.bind(null,i,o,e),[e]),i.flags|=2048,xf(9,TC.bind(null,i,o,n,t),void 0,null),n},useId:function(){var e=Po(),t=ai.identifierPrefix;if(Mn){var n=hs,i=us;n=(i&~(1<<32-ro(i)-1)).toString(32)+n,t=":"+t+"R"+n,n=yf++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=E4++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},k4={readContext:Dr,useCallback:FC,useContext:Dr,useEffect:Zb,useImperativeHandle:BC,useInsertionEffect:OC,useLayoutEffect:kC,useMemo:NC,useReducer:r1,useRef:RC,useState:function(){return r1(vf)},useDebugValue:Kb,useDeferredValue:function(e){var t=Br();return zC(t,Qn.memoizedState,e)},useTransition:function(){var e=r1(vf)[0],t=Br().memoizedState;return[e,t]},useMutableSource:AC,useSyncExternalStore:CC,useId:UC,unstable_isNewReconciler:!1},D4={readContext:Dr,useCallback:FC,useContext:Dr,useEffect:Zb,useImperativeHandle:BC,useInsertionEffect:OC,useLayoutEffect:kC,useMemo:NC,useReducer:o1,useRef:RC,useState:function(){return o1(vf)},useDebugValue:Kb,useDeferredValue:function(e){var t=Br();return Qn===null?t.memoizedState=e:zC(t,Qn.memoizedState,e)},useTransition:function(){var e=o1(vf)[0],t=Br().memoizedState;return[e,t]},useMutableSource:AC,useSyncExternalStore:CC,useId:UC,unstable_isNewReconciler:!1};function tu(e,t){try{var n="",i=t;do n+=lI(i),i=i.return;while(i);var r=n}catch(o){r=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:r,digest:null}}function s1(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function kv(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var B4=typeof WeakMap=="function"?WeakMap:Map;function HC(e,t,n){n=fs(-1,n),n.tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Xm||(Xm=!0,Hv=i),kv(e,t)},n}function jC(e,t,n){n=fs(-1,n),n.tag=3;var i=e.type.getDerivedStateFromError;if(typeof i=="function"){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){kv(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){kv(e,t),typeof i!="function"&&(fa===null?fa=new Set([this]):fa.add(this));var s=t.stack;this.componentDidCatch(t.value,{componentStack:s!==null?s:""})}),n}function N2(e,t,n){var i=e.pingCache;if(i===null){i=e.pingCache=new B4;var r=new Set;i.set(t,r)}else r=i.get(t),r===void 0&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Z4.bind(null,e,t,n),t.then(e,e))}function z2(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function U2(e,t,n,i,r){return e.mode&1?(e.flags|=65536,e.lanes=r,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=fs(-1,1),t.tag=2,ha(n,t,1))),n.lanes|=1),e)}var F4=Ts.ReactCurrentOwner,Zi=!1;function Oi(e,t,n,i){t.child=e===null?SC(t,null,n,i):Jl(t,e.child,n,i)}function G2(e,t,n,i,r){n=n.render;var o=t.ref;return $l(t,r),i=Xb(e,t,n,i,o,r),n=Yb(),e!==null&&!Zi?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,ys(e,t,r)):(Mn&&n&&Bb(t),t.flags|=1,Oi(e,t,i,r),t.child)}function $2(e,t,n,i,r){if(e===null){var o=n.type;return typeof o=="function"&&!o_(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=o,WC(e,t,o,i,r)):(e=am(n.type,null,i,t,t.mode,r),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&r)){var s=o.memoizedProps;if(n=n.compare,n=n!==null?n:hf,n(s,i)&&e.ref===t.ref)return ys(e,t,r)}return t.flags|=1,e=da(o,i),e.ref=t.ref,e.return=t,t.child=e}function WC(e,t,n,i,r){if(e!==null){var o=e.memoizedProps;if(hf(o,i)&&e.ref===t.ref)if(Zi=!1,t.pendingProps=i=o,(e.lanes&r)!==0)e.flags&131072&&(Zi=!0);else return t.lanes=e.lanes,ys(e,t,r)}return Dv(e,t,n,i,r)}function qC(e,t,n){var i=t.pendingProps,r=i.children,o=e!==null?e.memoizedState:null;if(i.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},gn(Tl,ar),ar|=n;else{if(!(n&1073741824))return e=o!==null?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,gn(Tl,ar),ar|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=o!==null?o.baseLanes:n,gn(Tl,ar),ar|=i}else o!==null?(i=o.baseLanes|n,t.memoizedState=null):i=n,gn(Tl,ar),ar|=i;return Oi(e,t,r,n),t.child}function XC(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Dv(e,t,n,i,r){var o=Qi(n)?hc:Pi.current;return o=Kl(t,o),$l(t,r),n=Xb(e,t,n,i,o,r),i=Yb(),e!==null&&!Zi?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,ys(e,t,r)):(Mn&&i&&Bb(t),t.flags|=1,Oi(e,t,n,r),t.child)}function V2(e,t,n,i,r){if(Qi(n)){var o=!0;Nm(t)}else o=!1;if($l(t,r),t.stateNode===null)rm(e,t),_C(t,n,i),Ov(t,n,i,r),i=!0;else if(e===null){var s=t.stateNode,a=t.memoizedProps;s.props=a;var c=s.context,l=n.contextType;typeof l=="object"&&l!==null?l=Dr(l):(l=Qi(n)?hc:Pi.current,l=Kl(t,l));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof s.getSnapshotBeforeUpdate=="function";h||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==i||c!==l)&&k2(t,s,i,l),Js=!1;var f=t.memoizedState;s.state=f,Vm(t,i,s,r),c=t.memoizedState,a!==i||f!==c||Ki.current||Js?(typeof u=="function"&&(Rv(t,n,u,i),c=t.memoizedState),(a=Js||O2(t,n,a,i,f,c,l))?(h||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(t.flags|=4194308)):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=c),s.props=i,s.state=c,s.context=l,i=a):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),i=!1)}else{s=t.stateNode,xC(e,t),a=t.memoizedProps,l=t.type===t.elementType?a:Zr(t.type,a),s.props=l,h=t.pendingProps,f=s.context,c=n.contextType,typeof c=="object"&&c!==null?c=Dr(c):(c=Qi(n)?hc:Pi.current,c=Kl(t,c));var p=n.getDerivedStateFromProps;(u=typeof p=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==h||f!==c)&&k2(t,s,i,c),Js=!1,f=t.memoizedState,s.state=f,Vm(t,i,s,r);var m=t.memoizedState;a!==h||f!==m||Ki.current||Js?(typeof p=="function"&&(Rv(t,n,p,i),m=t.memoizedState),(l=Js||O2(t,n,l,i,f,m,c)||!1)?(u||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(i,m,c),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(i,m,c)),typeof s.componentDidUpdate=="function"&&(t.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=m),s.props=i,s.state=m,s.context=c,i=l):(typeof s.componentDidUpdate!="function"||a===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),i=!1)}return Bv(e,t,n,i,o,r)}function Bv(e,t,n,i,r,o){XC(e,t);var s=(t.flags&128)!==0;if(!i&&!s)return r&&T2(t,n,!1),ys(e,t,o);i=t.stateNode,F4.current=t;var a=s&&typeof n.getDerivedStateFromError!="function"?null:i.render();return t.flags|=1,e!==null&&s?(t.child=Jl(t,e.child,null,o),t.child=Jl(t,null,a,o)):Oi(e,t,a,o),t.memoizedState=i.state,r&&T2(t,n,!0),t.child}function YC(e){var t=e.stateNode;t.pendingContext?P2(e,t.pendingContext,t.pendingContext!==t.context):t.context&&P2(e,t.context,!1),Hb(e,t.containerInfo)}function H2(e,t,n,i,r){return Ql(),Nb(r),t.flags|=256,Oi(e,t,n,i),t.child}var Fv={dehydrated:null,treeContext:null,retryLane:0};function Nv(e){return{baseLanes:e,cachePool:null,transitions:null}}function ZC(e,t,n){var i=t.pendingProps,r=Cn.current,o=!1,s=(t.flags&128)!==0,a;if((a=s)||(a=e!==null&&e.memoizedState===null?!1:(r&2)!==0),a?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(r|=1),gn(Cn,r&1),e===null)return Iv(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=i.children,e=i.fallback,o?(i=t.mode,o=t.child,s={mode:"hidden",children:s},!(i&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=c0(s,i,0,null),e=ic(e,i,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Nv(n),t.memoizedState=Fv,e):Qb(t,s));if(r=e.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return N4(e,t,s,i,a,r,n);if(o){o=i.fallback,s=t.mode,r=e.child,a=r.sibling;var c={mode:"hidden",children:i.children};return!(s&1)&&t.child!==r?(i=t.child,i.childLanes=0,i.pendingProps=c,t.deletions=null):(i=da(r,c),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?o=da(a,o):(o=ic(o,s,n,null),o.flags|=2),o.return=t,i.return=t,i.sibling=o,t.child=i,i=o,o=t.child,s=e.child.memoizedState,s=s===null?Nv(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=e.childLanes&~n,t.memoizedState=Fv,i}return o=e.child,e=o.sibling,i=da(o,{mode:"visible",children:i.children}),!(t.mode&1)&&(i.lanes=n),i.return=t,i.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Qb(e,t){return t=c0({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Up(e,t,n,i){return i!==null&&Nb(i),Jl(t,e.child,null,n),e=Qb(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function N4(e,t,n,i,r,o,s){if(n)return t.flags&256?(t.flags&=-257,i=s1(Error(Ne(422))),Up(e,t,s,i)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=i.fallback,r=t.mode,i=c0({mode:"visible",children:i.children},r,0,null),o=ic(o,r,s,null),o.flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,t.mode&1&&Jl(t,e.child,null,s),t.child.memoizedState=Nv(s),t.memoizedState=Fv,o);if(!(t.mode&1))return Up(e,t,s,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,o=Error(Ne(419)),i=s1(o,i,void 0),Up(e,t,s,i)}if(a=(s&e.childLanes)!==0,Zi||a){if(i=ai,i!==null){switch(s&-s){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|s)?0:r,r!==0&&r!==o.retryLane&&(o.retryLane=r,gs(e,r),oo(i,e,r,-1))}return r_(),i=s1(Error(Ne(421))),Up(e,t,s,i)}return r.data==="$?"?(t.flags|=128,t.child=e.child,t=K4.bind(null,e),r._reactRetry=t,null):(e=o.treeContext,ur=ua(r.nextSibling),hr=t,Mn=!0,eo=null,e!==null&&(Er[Ir++]=us,Er[Ir++]=hs,Er[Ir++]=fc,us=e.id,hs=e.overflow,fc=t),t=Qb(t,i.children),t.flags|=4096,t)}function j2(e,t,n){e.lanes|=t;var i=e.alternate;i!==null&&(i.lanes|=t),Lv(e.return,t,n)}function a1(e,t,n,i,r){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r)}function KC(e,t,n){var i=t.pendingProps,r=i.revealOrder,o=i.tail;if(Oi(e,t,i.children,n),i=Cn.current,i&2)i=i&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&j2(e,n,t);else if(e.tag===19)j2(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(gn(Cn,i),!(t.mode&1))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;n!==null;)e=n.alternate,e!==null&&Hm(e)===null&&(r=n),n=n.sibling;n=r,n===null?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),a1(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;r!==null;){if(e=r.alternate,e!==null&&Hm(e)===null){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}a1(t,!0,n,null,o);break;case"together":a1(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function rm(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function ys(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),dc|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Ne(153));if(t.child!==null){for(e=t.child,n=da(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=da(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function z4(e,t,n){switch(t.tag){case 3:YC(t),Ql();break;case 5:MC(t);break;case 1:Qi(t.type)&&Nm(t);break;case 4:Hb(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;gn(Gm,i._currentValue),i._currentValue=r;break;case 13:if(i=t.memoizedState,i!==null)return i.dehydrated!==null?(gn(Cn,Cn.current&1),t.flags|=128,null):n&t.child.childLanes?ZC(e,t,n):(gn(Cn,Cn.current&1),e=ys(e,t,n),e!==null?e.sibling:null);gn(Cn,Cn.current&1);break;case 19:if(i=(n&t.childLanes)!==0,e.flags&128){if(i)return KC(e,t,n);t.flags|=128}if(r=t.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),gn(Cn,Cn.current),i)break;return null;case 22:case 23:return t.lanes=0,qC(e,t,n)}return ys(e,t,n)}var QC,zv,JC,eP;QC=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};zv=function(){};JC=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,tc(Bo.current);var o=null;switch(n){case"input":r=av(e,r),i=av(e,i),o=[];break;case"select":r=Rn({},r,{value:void 0}),i=Rn({},i,{value:void 0}),o=[];break;case"textarea":r=uv(e,r),i=uv(e,i),o=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(e.onclick=Bm)}fv(n,i);var s;n=null;for(l in r)if(!i.hasOwnProperty(l)&&r.hasOwnProperty(l)&&r[l]!=null)if(l==="style"){var a=r[l];for(s in a)a.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(rf.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in i){var c=i[l];if(a=r!=null?r[l]:void 0,i.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(s in a)!a.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&a[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(o||(o=[]),o.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(o=o||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(rf.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&xn("scroll",e),o||a===c||(o=[])):(o=o||[]).push(l,c))}n&&(o=o||[]).push("style",n);var l=o;(t.updateQueue=l)&&(t.flags|=4)}};eP=function(e,t,n,i){n!==i&&(t.flags|=4)};function Qu(e,t){if(!Mn)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:i.sibling=null}}function xi(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=e,r=r.sibling;else for(r=e.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function U4(e,t,n){var i=t.pendingProps;switch(Fb(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xi(t),null;case 1:return Qi(t.type)&&Fm(),xi(t),null;case 3:return i=t.stateNode,eu(),bn(Ki),bn(Pi),Wb(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(Np(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,eo!==null&&(qv(eo),eo=null))),zv(e,t),xi(t),null;case 5:jb(t);var r=tc(gf.current);if(n=t.type,e!==null&&t.stateNode!=null)JC(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(t.stateNode===null)throw Error(Ne(166));return xi(t),null}if(e=tc(Bo.current),Np(t)){i=t.stateNode,n=t.type;var o=t.memoizedProps;switch(i[Lo]=t,i[df]=o,e=(t.mode&1)!==0,n){case"dialog":xn("cancel",i),xn("close",i);break;case"iframe":case"object":case"embed":xn("load",i);break;case"video":case"audio":for(r=0;r<Ch.length;r++)xn(Ch[r],i);break;case"source":xn("error",i);break;case"img":case"image":case"link":xn("error",i),xn("load",i);break;case"details":xn("toggle",i);break;case"input":e2(i,o),xn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},xn("invalid",i);break;case"textarea":n2(i,o),xn("invalid",i)}fv(n,o),r=null;for(var s in o)if(o.hasOwnProperty(s)){var a=o[s];s==="children"?typeof a=="string"?i.textContent!==a&&(o.suppressHydrationWarning!==!0&&Fp(i.textContent,a,e),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&Fp(i.textContent,a,e),r=["children",""+a]):rf.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&xn("scroll",i)}switch(n){case"input":Ep(i),t2(i,o,!0);break;case"textarea":Ep(i),i2(i);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(i.onclick=Bm)}i=r,t.updateQueue=i,i!==null&&(t.flags|=4)}else{s=r.nodeType===9?r:r.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=PA(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=s.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof i.is=="string"?e=s.createElement(n,{is:i.is}):(e=s.createElement(n),n==="select"&&(s=e,i.multiple?s.multiple=!0:i.size&&(s.size=i.size))):e=s.createElementNS(e,n),e[Lo]=t,e[df]=i,QC(e,t,!1,!1),t.stateNode=e;e:{switch(s=pv(n,i),n){case"dialog":xn("cancel",e),xn("close",e),r=i;break;case"iframe":case"object":case"embed":xn("load",e),r=i;break;case"video":case"audio":for(r=0;r<Ch.length;r++)xn(Ch[r],e);r=i;break;case"source":xn("error",e),r=i;break;case"img":case"image":case"link":xn("error",e),xn("load",e),r=i;break;case"details":xn("toggle",e),r=i;break;case"input":e2(e,i),r=av(e,i),xn("invalid",e);break;case"option":r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=Rn({},i,{value:void 0}),xn("invalid",e);break;case"textarea":n2(e,i),r=uv(e,i),xn("invalid",e);break;default:r=i}fv(n,r),a=r;for(o in a)if(a.hasOwnProperty(o)){var c=a[o];o==="style"?IA(e,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&TA(e,c)):o==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&of(e,c):typeof c=="number"&&of(e,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(rf.hasOwnProperty(o)?c!=null&&o==="onScroll"&&xn("scroll",e):c!=null&&wb(e,o,c,s))}switch(n){case"input":Ep(e),t2(e,i,!1);break;case"textarea":Ep(e),i2(e);break;case"option":i.value!=null&&e.setAttribute("value",""+_a(i.value));break;case"select":e.multiple=!!i.multiple,o=i.value,o!=null?Nl(e,!!i.multiple,o,!1):i.defaultValue!=null&&Nl(e,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(e.onclick=Bm)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return xi(t),null;case 6:if(e&&t.stateNode!=null)eP(e,t,e.memoizedProps,i);else{if(typeof i!="string"&&t.stateNode===null)throw Error(Ne(166));if(n=tc(gf.current),tc(Bo.current),Np(t)){if(i=t.stateNode,n=t.memoizedProps,i[Lo]=t,(o=i.nodeValue!==n)&&(e=hr,e!==null))switch(e.tag){case 3:Fp(i.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Fp(i.nodeValue,n,(e.mode&1)!==0)}o&&(t.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Lo]=t,t.stateNode=i}return xi(t),null;case 13:if(bn(Cn),i=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Mn&&ur!==null&&t.mode&1&&!(t.flags&128))yC(),Ql(),t.flags|=98560,o=!1;else if(o=Np(t),i!==null&&i.dehydrated!==null){if(e===null){if(!o)throw Error(Ne(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Ne(317));o[Lo]=t}else Ql(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;xi(t),o=!1}else eo!==null&&(qv(eo),eo=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(i=i!==null,i!==(e!==null&&e.memoizedState!==null)&&i&&(t.child.flags|=8192,t.mode&1&&(e===null||Cn.current&1?ei===0&&(ei=3):r_())),t.updateQueue!==null&&(t.flags|=4),xi(t),null);case 4:return eu(),zv(e,t),e===null&&ff(t.stateNode.containerInfo),xi(t),null;case 10:return Gb(t.type._context),xi(t),null;case 17:return Qi(t.type)&&Fm(),xi(t),null;case 19:if(bn(Cn),o=t.memoizedState,o===null)return xi(t),null;if(i=(t.flags&128)!==0,s=o.rendering,s===null)if(i)Qu(o,!1);else{if(ei!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(s=Hm(e),s!==null){for(t.flags|=128,Qu(o,!1),i=s.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;n!==null;)o=n,e=i,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,e=s.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return gn(Cn,Cn.current&1|2),t.child}e=e.sibling}o.tail!==null&&Gn()>nu&&(t.flags|=128,i=!0,Qu(o,!1),t.lanes=4194304)}else{if(!i)if(e=Hm(s),e!==null){if(t.flags|=128,i=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Qu(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!Mn)return xi(t),null}else 2*Gn()-o.renderingStartTime>nu&&n!==1073741824&&(t.flags|=128,i=!0,Qu(o,!1),t.lanes=4194304);o.isBackwards?(s.sibling=t.child,t.child=s):(n=o.last,n!==null?n.sibling=s:t.child=s,o.last=s)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Gn(),t.sibling=null,n=Cn.current,gn(Cn,i?n&1|2:n&1),t):(xi(t),null);case 22:case 23:return i_(),i=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==i&&(t.flags|=8192),i&&t.mode&1?ar&1073741824&&(xi(t),t.subtreeFlags&6&&(t.flags|=8192)):xi(t),null;case 24:return null;case 25:return null}throw Error(Ne(156,t.tag))}function G4(e,t){switch(Fb(t),t.tag){case 1:return Qi(t.type)&&Fm(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return eu(),bn(Ki),bn(Pi),Wb(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return jb(t),null;case 13:if(bn(Cn),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Ne(340));Ql()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return bn(Cn),null;case 4:return eu(),null;case 10:return Gb(t.type._context),null;case 22:case 23:return i_(),null;case 24:return null;default:return null}}var Gp=!1,Mi=!1,$4=typeof WeakSet=="function"?WeakSet:Set,Ke=null;function Pl(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){Bn(e,t,i)}else n.current=null}function Uv(e,t,n){try{n()}catch(i){Bn(e,t,i)}}var W2=!1;function V4(e,t){if(Sv=Om,e=rC(),Db(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var s=0,a=-1,c=-1,l=0,u=0,h=e,f=null;t:for(;;){for(var p;h!==n||r!==0&&h.nodeType!==3||(a=s+r),h!==o||i!==0&&h.nodeType!==3||(c=s+i),h.nodeType===3&&(s+=h.nodeValue.length),(p=h.firstChild)!==null;)f=h,h=p;for(;;){if(h===e)break t;if(f===n&&++l===r&&(a=s),f===o&&++u===i&&(c=s),(p=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=p}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Mv={focusedElem:e,selectionRange:n},Om=!1,Ke=t;Ke!==null;)if(t=Ke,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ke=e;else for(;Ke!==null;){t=Ke;try{var m=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var y=m.memoizedProps,v=m.memoizedState,d=t.stateNode,g=d.getSnapshotBeforeUpdate(t.elementType===t.type?y:Zr(t.type,y),v);d.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var b=t.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ne(163))}}catch(x){Bn(t,t.return,x)}if(e=t.sibling,e!==null){e.return=t.return,Ke=e;break}Ke=t.return}return m=W2,W2=!1,m}function $h(e,t,n){var i=t.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,o!==void 0&&Uv(t,n,o)}r=r.next}while(r!==i)}}function s0(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function Gv(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function tP(e){var t=e.alternate;t!==null&&(e.alternate=null,tP(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Lo],delete t[df],delete t[Pv],delete t[A4],delete t[C4])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function nP(e){return e.tag===5||e.tag===3||e.tag===4}function q2(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||nP(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function $v(e,t,n){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Bm));else if(i!==4&&(e=e.child,e!==null))for($v(e,t,n),e=e.sibling;e!==null;)$v(e,t,n),e=e.sibling}function Vv(e,t,n){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(i!==4&&(e=e.child,e!==null))for(Vv(e,t,n),e=e.sibling;e!==null;)Vv(e,t,n),e=e.sibling}var ui=null,Kr=!1;function Fs(e,t,n){for(n=n.child;n!==null;)iP(e,t,n),n=n.sibling}function iP(e,t,n){if(Do&&typeof Do.onCommitFiberUnmount=="function")try{Do.onCommitFiberUnmount(Qg,n)}catch{}switch(n.tag){case 5:Mi||Pl(n,t);case 6:var i=ui,r=Kr;ui=null,Fs(e,t,n),ui=i,Kr=r,ui!==null&&(Kr?(e=ui,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):ui.removeChild(n.stateNode));break;case 18:ui!==null&&(Kr?(e=ui,n=n.stateNode,e.nodeType===8?e1(e.parentNode,n):e.nodeType===1&&e1(e,n),lf(e)):e1(ui,n.stateNode));break;case 4:i=ui,r=Kr,ui=n.stateNode.containerInfo,Kr=!0,Fs(e,t,n),ui=i,Kr=r;break;case 0:case 11:case 14:case 15:if(!Mi&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var o=r,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&Uv(n,t,s),r=r.next}while(r!==i)}Fs(e,t,n);break;case 1:if(!Mi&&(Pl(n,t),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){Bn(n,t,a)}Fs(e,t,n);break;case 21:Fs(e,t,n);break;case 22:n.mode&1?(Mi=(i=Mi)||n.memoizedState!==null,Fs(e,t,n),Mi=i):Fs(e,t,n);break;default:Fs(e,t,n)}}function X2(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new $4),t.forEach(function(i){var r=Q4.bind(null,e,i);n.has(i)||(n.add(i),i.then(r,r))})}}function $r(e,t){var n=t.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var o=e,s=t,a=s;e:for(;a!==null;){switch(a.tag){case 5:ui=a.stateNode,Kr=!1;break e;case 3:ui=a.stateNode.containerInfo,Kr=!0;break e;case 4:ui=a.stateNode.containerInfo,Kr=!0;break e}a=a.return}if(ui===null)throw Error(Ne(160));iP(o,s,r),ui=null,Kr=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(l){Bn(r,t,l)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)rP(t,e),t=t.sibling}function rP(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if($r(t,e),yo(e),i&4){try{$h(3,e,e.return),s0(3,e)}catch(y){Bn(e,e.return,y)}try{$h(5,e,e.return)}catch(y){Bn(e,e.return,y)}}break;case 1:$r(t,e),yo(e),i&512&&n!==null&&Pl(n,n.return);break;case 5:if($r(t,e),yo(e),i&512&&n!==null&&Pl(n,n.return),e.flags&32){var r=e.stateNode;try{of(r,"")}catch(y){Bn(e,e.return,y)}}if(i&4&&(r=e.stateNode,r!=null)){var o=e.memoizedProps,s=n!==null?n.memoizedProps:o,a=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&AA(r,o),pv(a,s);var l=pv(a,o);for(s=0;s<c.length;s+=2){var u=c[s],h=c[s+1];u==="style"?IA(r,h):u==="dangerouslySetInnerHTML"?TA(r,h):u==="children"?of(r,h):wb(r,u,h,l)}switch(a){case"input":cv(r,o);break;case"textarea":CA(r,o);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var p=o.value;p!=null?Nl(r,!!o.multiple,p,!1):f!==!!o.multiple&&(o.defaultValue!=null?Nl(r,!!o.multiple,o.defaultValue,!0):Nl(r,!!o.multiple,o.multiple?[]:"",!1))}r[df]=o}catch(y){Bn(e,e.return,y)}}break;case 6:if($r(t,e),yo(e),i&4){if(e.stateNode===null)throw Error(Ne(162));r=e.stateNode,o=e.memoizedProps;try{r.nodeValue=o}catch(y){Bn(e,e.return,y)}}break;case 3:if($r(t,e),yo(e),i&4&&n!==null&&n.memoizedState.isDehydrated)try{lf(t.containerInfo)}catch(y){Bn(e,e.return,y)}break;case 4:$r(t,e),yo(e);break;case 13:$r(t,e),yo(e),r=e.child,r.flags&8192&&(o=r.memoizedState!==null,r.stateNode.isHidden=o,!o||r.alternate!==null&&r.alternate.memoizedState!==null||(t_=Gn())),i&4&&X2(e);break;case 22:if(u=n!==null&&n.memoizedState!==null,e.mode&1?(Mi=(l=Mi)||u,$r(t,e),Mi=l):$r(t,e),yo(e),i&8192){if(l=e.memoizedState!==null,(e.stateNode.isHidden=l)&&!u&&e.mode&1)for(Ke=e,u=e.child;u!==null;){for(h=Ke=u;Ke!==null;){switch(f=Ke,p=f.child,f.tag){case 0:case 11:case 14:case 15:$h(4,f,f.return);break;case 1:Pl(f,f.return);var m=f.stateNode;if(typeof m.componentWillUnmount=="function"){i=f,n=f.return;try{t=i,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(y){Bn(i,n,y)}}break;case 5:Pl(f,f.return);break;case 22:if(f.memoizedState!==null){Z2(h);continue}}p!==null?(p.return=f,Ke=p):Z2(h)}u=u.sibling}e:for(u=null,h=e;;){if(h.tag===5){if(u===null){u=h;try{r=h.stateNode,l?(o=r.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=h.stateNode,c=h.memoizedProps.style,s=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=EA("display",s))}catch(y){Bn(e,e.return,y)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(y){Bn(e,e.return,y)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:$r(t,e),yo(e),i&4&&X2(e);break;case 21:break;default:$r(t,e),yo(e)}}function yo(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(nP(n)){var i=n;break e}n=n.return}throw Error(Ne(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(of(r,""),i.flags&=-33);var o=q2(e);Vv(e,o,r);break;case 3:case 4:var s=i.stateNode.containerInfo,a=q2(e);$v(e,a,s);break;default:throw Error(Ne(161))}}catch(c){Bn(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function H4(e,t,n){Ke=e,oP(e)}function oP(e,t,n){for(var i=(e.mode&1)!==0;Ke!==null;){var r=Ke,o=r.child;if(r.tag===22&&i){var s=r.memoizedState!==null||Gp;if(!s){var a=r.alternate,c=a!==null&&a.memoizedState!==null||Mi;a=Gp;var l=Mi;if(Gp=s,(Mi=c)&&!l)for(Ke=r;Ke!==null;)s=Ke,c=s.child,s.tag===22&&s.memoizedState!==null?K2(r):c!==null?(c.return=s,Ke=c):K2(r);for(;o!==null;)Ke=o,oP(o),o=o.sibling;Ke=r,Gp=a,Mi=l}Y2(e)}else r.subtreeFlags&8772&&o!==null?(o.return=r,Ke=o):Y2(e)}}function Y2(e){for(;Ke!==null;){var t=Ke;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Mi||s0(5,t);break;case 1:var i=t.stateNode;if(t.flags&4&&!Mi)if(n===null)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:Zr(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&R2(t,o,i);break;case 3:var s=t.updateQueue;if(s!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}R2(t,s,n)}break;case 5:var a=t.stateNode;if(n===null&&t.flags&4){n=a;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var l=t.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&lf(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ne(163))}Mi||t.flags&512&&Gv(t)}catch(f){Bn(t,t.return,f)}}if(t===e){Ke=null;break}if(n=t.sibling,n!==null){n.return=t.return,Ke=n;break}Ke=t.return}}function Z2(e){for(;Ke!==null;){var t=Ke;if(t===e){Ke=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Ke=n;break}Ke=t.return}}function K2(e){for(;Ke!==null;){var t=Ke;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{s0(4,t)}catch(c){Bn(t,n,c)}break;case 1:var i=t.stateNode;if(typeof i.componentDidMount=="function"){var r=t.return;try{i.componentDidMount()}catch(c){Bn(t,r,c)}}var o=t.return;try{Gv(t)}catch(c){Bn(t,o,c)}break;case 5:var s=t.return;try{Gv(t)}catch(c){Bn(t,s,c)}}}catch(c){Bn(t,t.return,c)}if(t===e){Ke=null;break}var a=t.sibling;if(a!==null){a.return=t.return,Ke=a;break}Ke=t.return}}var j4=Math.ceil,qm=Ts.ReactCurrentDispatcher,Jb=Ts.ReactCurrentOwner,Or=Ts.ReactCurrentBatchConfig,Wt=0,ai=null,qn=null,mi=0,ar=0,Tl=La(0),ei=0,bf=null,dc=0,a0=0,e_=0,Vh=null,Xi=null,t_=0,nu=1/0,is=null,Xm=!1,Hv=null,fa=null,$p=!1,oa=null,Ym=0,Hh=0,jv=null,om=-1,sm=0;function Ni(){return Wt&6?Gn():om!==-1?om:om=Gn()}function pa(e){return e.mode&1?Wt&2&&mi!==0?mi&-mi:T4.transition!==null?(sm===0&&(sm=$A()),sm):(e=sn,e!==0||(e=window.event,e=e===void 0?16:YA(e.type)),e):1}function oo(e,t,n,i){if(50<Hh)throw Hh=0,jv=null,Error(Ne(185));hp(e,n,i),(!(Wt&2)||e!==ai)&&(e===ai&&(!(Wt&2)&&(a0|=n),ei===4&&na(e,mi)),Ji(e,i),n===1&&Wt===0&&!(t.mode&1)&&(nu=Gn()+500,i0&&Ra()))}function Ji(e,t){var n=e.callbackNode;TI(e,t);var i=Rm(e,e===ai?mi:0);if(i===0)n!==null&&s2(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(n!=null&&s2(n),t===1)e.tag===0?P4(Q2.bind(null,e)):dC(Q2.bind(null,e)),S4(function(){!(Wt&6)&&Ra()}),n=null;else{switch(VA(i)){case 1:n=Pb;break;case 4:n=UA;break;case 16:n=Lm;break;case 536870912:n=GA;break;default:n=Lm}n=pP(n,sP.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function sP(e,t){if(om=-1,sm=0,Wt&6)throw Error(Ne(327));var n=e.callbackNode;if(Vl()&&e.callbackNode!==n)return null;var i=Rm(e,e===ai?mi:0);if(i===0)return null;if(i&30||i&e.expiredLanes||t)t=Zm(e,i);else{t=i;var r=Wt;Wt|=2;var o=cP();(ai!==e||mi!==t)&&(is=null,nu=Gn()+500,nc(e,t));do try{X4();break}catch(a){aP(e,a)}while(1);Ub(),qm.current=o,Wt=r,qn!==null?t=0:(ai=null,mi=0,t=ei)}if(t!==0){if(t===2&&(r=vv(e),r!==0&&(i=r,t=Wv(e,r))),t===1)throw n=bf,nc(e,0),na(e,i),Ji(e,Gn()),n;if(t===6)na(e,i);else{if(r=e.current.alternate,!(i&30)&&!W4(r)&&(t=Zm(e,i),t===2&&(o=vv(e),o!==0&&(i=o,t=Wv(e,o))),t===1))throw n=bf,nc(e,0),na(e,i),Ji(e,Gn()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(Ne(345));case 2:Ya(e,Xi,is);break;case 3:if(na(e,i),(i&130023424)===i&&(t=t_+500-Gn(),10<t)){if(Rm(e,0)!==0)break;if(r=e.suspendedLanes,(r&i)!==i){Ni(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=Cv(Ya.bind(null,e,Xi,is),t);break}Ya(e,Xi,is);break;case 4:if(na(e,i),(i&4194240)===i)break;for(t=e.eventTimes,r=-1;0<i;){var s=31-ro(i);o=1<<s,s=t[s],s>r&&(r=s),i&=~o}if(i=r,i=Gn()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*j4(i/1960))-i,10<i){e.timeoutHandle=Cv(Ya.bind(null,e,Xi,is),i);break}Ya(e,Xi,is);break;case 5:Ya(e,Xi,is);break;default:throw Error(Ne(329))}}}return Ji(e,Gn()),e.callbackNode===n?sP.bind(null,e):null}function Wv(e,t){var n=Vh;return e.current.memoizedState.isDehydrated&&(nc(e,t).flags|=256),e=Zm(e,t),e!==2&&(t=Xi,Xi=n,t!==null&&qv(t)),e}function qv(e){Xi===null?Xi=e:Xi.push.apply(Xi,e)}function W4(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],o=r.getSnapshot;r=r.value;try{if(!co(o(),r))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function na(e,t){for(t&=~e_,t&=~a0,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ro(t),i=1<<n;e[n]=-1,t&=~i}}function Q2(e){if(Wt&6)throw Error(Ne(327));Vl();var t=Rm(e,0);if(!(t&1))return Ji(e,Gn()),null;var n=Zm(e,t);if(e.tag!==0&&n===2){var i=vv(e);i!==0&&(t=i,n=Wv(e,i))}if(n===1)throw n=bf,nc(e,0),na(e,t),Ji(e,Gn()),n;if(n===6)throw Error(Ne(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Ya(e,Xi,is),Ji(e,Gn()),null}function n_(e,t){var n=Wt;Wt|=1;try{return e(t)}finally{Wt=n,Wt===0&&(nu=Gn()+500,i0&&Ra())}}function mc(e){oa!==null&&oa.tag===0&&!(Wt&6)&&Vl();var t=Wt;Wt|=1;var n=Or.transition,i=sn;try{if(Or.transition=null,sn=1,e)return e()}finally{sn=i,Or.transition=n,Wt=t,!(Wt&6)&&Ra()}}function i_(){ar=Tl.current,bn(Tl)}function nc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,w4(n)),qn!==null)for(n=qn.return;n!==null;){var i=n;switch(Fb(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Fm();break;case 3:eu(),bn(Ki),bn(Pi),Wb();break;case 5:jb(i);break;case 4:eu();break;case 13:bn(Cn);break;case 19:bn(Cn);break;case 10:Gb(i.type._context);break;case 22:case 23:i_()}n=n.return}if(ai=e,qn=e=da(e.current,null),mi=ar=t,ei=0,bf=null,e_=a0=dc=0,Xi=Vh=null,ec!==null){for(t=0;t<ec.length;t++)if(n=ec[t],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,o=n.pending;if(o!==null){var s=o.next;o.next=r,i.next=s}n.pending=i}ec=null}return e}function aP(e,t){do{var n=qn;try{if(Ub(),nm.current=Wm,jm){for(var i=In.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}jm=!1}if(pc=0,si=Qn=In=null,Gh=!1,yf=0,Jb.current=null,n===null||n.return===null){ei=1,bf=t,qn=null;break}e:{var o=e,s=n.return,a=n,c=t;if(t=mi,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=z2(s);if(p!==null){p.flags&=-257,U2(p,s,a,o,t),p.mode&1&&N2(o,l,t),t=p,c=l;var m=t.updateQueue;if(m===null){var y=new Set;y.add(c),t.updateQueue=y}else m.add(c);break e}else{if(!(t&1)){N2(o,l,t),r_();break e}c=Error(Ne(426))}}else if(Mn&&a.mode&1){var v=z2(s);if(v!==null){!(v.flags&65536)&&(v.flags|=256),U2(v,s,a,o,t),Nb(tu(c,a));break e}}o=c=tu(c,a),ei!==4&&(ei=2),Vh===null?Vh=[o]:Vh.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var d=HC(o,c,t);L2(o,d);break e;case 1:a=c;var g=o.type,b=o.stateNode;if(!(o.flags&128)&&(typeof g.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(fa===null||!fa.has(b)))){o.flags|=65536,t&=-t,o.lanes|=t;var x=jC(o,a,t);L2(o,x);break e}}o=o.return}while(o!==null)}uP(n)}catch(_){t=_,qn===n&&n!==null&&(qn=n=n.return);continue}break}while(1)}function cP(){var e=qm.current;return qm.current=Wm,e===null?Wm:e}function r_(){(ei===0||ei===3||ei===2)&&(ei=4),ai===null||!(dc&268435455)&&!(a0&268435455)||na(ai,mi)}function Zm(e,t){var n=Wt;Wt|=2;var i=cP();(ai!==e||mi!==t)&&(is=null,nc(e,t));do try{q4();break}catch(r){aP(e,r)}while(1);if(Ub(),Wt=n,qm.current=i,qn!==null)throw Error(Ne(261));return ai=null,mi=0,ei}function q4(){for(;qn!==null;)lP(qn)}function X4(){for(;qn!==null&&!xI();)lP(qn)}function lP(e){var t=fP(e.alternate,e,ar);e.memoizedProps=e.pendingProps,t===null?uP(e):qn=t,Jb.current=null}function uP(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=G4(n,t),n!==null){n.flags&=32767,qn=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{ei=6,qn=null;return}}else if(n=U4(n,t,ar),n!==null){qn=n;return}if(t=t.sibling,t!==null){qn=t;return}qn=t=e}while(t!==null);ei===0&&(ei=5)}function Ya(e,t,n){var i=sn,r=Or.transition;try{Or.transition=null,sn=1,Y4(e,t,n,i)}finally{Or.transition=r,sn=i}return null}function Y4(e,t,n,i){do Vl();while(oa!==null);if(Wt&6)throw Error(Ne(327));n=e.finishedWork;var r=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(Ne(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(EI(e,o),e===ai&&(qn=ai=null,mi=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||$p||($p=!0,pP(Lm,function(){return Vl(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=Or.transition,Or.transition=null;var s=sn;sn=1;var a=Wt;Wt|=4,Jb.current=null,V4(e,n),rP(n,e),m4(Mv),Om=!!Sv,Mv=Sv=null,e.current=n,H4(n),bI(),Wt=a,sn=s,Or.transition=o}else e.current=n;if($p&&($p=!1,oa=e,Ym=r),o=e.pendingLanes,o===0&&(fa=null),SI(n.stateNode),Ji(e,Gn()),t!==null)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Xm)throw Xm=!1,e=Hv,Hv=null,e;return Ym&1&&e.tag!==0&&Vl(),o=e.pendingLanes,o&1?e===jv?Hh++:(Hh=0,jv=e):Hh=0,Ra(),null}function Vl(){if(oa!==null){var e=VA(Ym),t=Or.transition,n=sn;try{if(Or.transition=null,sn=16>e?16:e,oa===null)var i=!1;else{if(e=oa,oa=null,Ym=0,Wt&6)throw Error(Ne(331));var r=Wt;for(Wt|=4,Ke=e.current;Ke!==null;){var o=Ke,s=o.child;if(Ke.flags&16){var a=o.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(Ke=l;Ke!==null;){var u=Ke;switch(u.tag){case 0:case 11:case 15:$h(8,u,o)}var h=u.child;if(h!==null)h.return=u,Ke=h;else for(;Ke!==null;){u=Ke;var f=u.sibling,p=u.return;if(tP(u),u===l){Ke=null;break}if(f!==null){f.return=p,Ke=f;break}Ke=p}}}var m=o.alternate;if(m!==null){var y=m.child;if(y!==null){m.child=null;do{var v=y.sibling;y.sibling=null,y=v}while(y!==null)}}Ke=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,Ke=s;else e:for(;Ke!==null;){if(o=Ke,o.flags&2048)switch(o.tag){case 0:case 11:case 15:$h(9,o,o.return)}var d=o.sibling;if(d!==null){d.return=o.return,Ke=d;break e}Ke=o.return}}var g=e.current;for(Ke=g;Ke!==null;){s=Ke;var b=s.child;if(s.subtreeFlags&2064&&b!==null)b.return=s,Ke=b;else e:for(s=g;Ke!==null;){if(a=Ke,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:s0(9,a)}}catch(_){Bn(a,a.return,_)}if(a===s){Ke=null;break e}var x=a.sibling;if(x!==null){x.return=a.return,Ke=x;break e}Ke=a.return}}if(Wt=r,Ra(),Do&&typeof Do.onPostCommitFiberRoot=="function")try{Do.onPostCommitFiberRoot(Qg,e)}catch{}i=!0}return i}finally{sn=n,Or.transition=t}}return!1}function J2(e,t,n){t=tu(n,t),t=HC(e,t,1),e=ha(e,t,1),t=Ni(),e!==null&&(hp(e,1,t),Ji(e,t))}function Bn(e,t,n){if(e.tag===3)J2(e,e,n);else for(;t!==null;){if(t.tag===3){J2(t,e,n);break}else if(t.tag===1){var i=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(fa===null||!fa.has(i))){e=tu(n,e),e=jC(t,e,1),t=ha(t,e,1),e=Ni(),t!==null&&(hp(t,1,e),Ji(t,e));break}}t=t.return}}function Z4(e,t,n){var i=e.pingCache;i!==null&&i.delete(t),t=Ni(),e.pingedLanes|=e.suspendedLanes&n,ai===e&&(mi&n)===n&&(ei===4||ei===3&&(mi&130023424)===mi&&500>Gn()-t_?nc(e,0):e_|=n),Ji(e,t)}function hP(e,t){t===0&&(e.mode&1?(t=Rp,Rp<<=1,!(Rp&130023424)&&(Rp=4194304)):t=1);var n=Ni();e=gs(e,t),e!==null&&(hp(e,t,n),Ji(e,n))}function K4(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),hP(e,n)}function Q4(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(Ne(314))}i!==null&&i.delete(t),hP(e,n)}var fP;fP=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Ki.current)Zi=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return Zi=!1,z4(e,t,n);Zi=!!(e.flags&131072)}else Zi=!1,Mn&&t.flags&1048576&&mC(t,Um,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;rm(e,t),e=t.pendingProps;var r=Kl(t,Pi.current);$l(t,n),r=Xb(null,t,i,e,r,n);var o=Yb();return t.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Qi(i)?(o=!0,Nm(t)):o=!1,t.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Vb(t),r.updater=r0,t.stateNode=r,r._reactInternals=t,Ov(t,i,e,n),t=Bv(null,t,i,!0,o,n)):(t.tag=0,Mn&&o&&Bb(t),Oi(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(rm(e,t),e=t.pendingProps,r=i._init,i=r(i._payload),t.type=i,r=t.tag=eL(i),e=Zr(i,e),r){case 0:t=Dv(null,t,i,e,n);break e;case 1:t=V2(null,t,i,e,n);break e;case 11:t=G2(null,t,i,e,n);break e;case 14:t=$2(null,t,i,Zr(i.type,e),n);break e}throw Error(Ne(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:Zr(i,r),Dv(e,t,i,r,n);case 1:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:Zr(i,r),V2(e,t,i,r,n);case 3:e:{if(YC(t),e===null)throw Error(Ne(387));i=t.pendingProps,o=t.memoizedState,r=o.element,xC(e,t),Vm(t,i,null,n);var s=t.memoizedState;if(i=s.element,o.isDehydrated)if(o={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){r=tu(Error(Ne(423)),t),t=H2(e,t,i,n,r);break e}else if(i!==r){r=tu(Error(Ne(424)),t),t=H2(e,t,i,n,r);break e}else for(ur=ua(t.stateNode.containerInfo.firstChild),hr=t,Mn=!0,eo=null,n=SC(t,null,i,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ql(),i===r){t=ys(e,t,n);break e}Oi(e,t,i,n)}t=t.child}return t;case 5:return MC(t),e===null&&Iv(t),i=t.type,r=t.pendingProps,o=e!==null?e.memoizedProps:null,s=r.children,Av(i,r)?s=null:o!==null&&Av(i,o)&&(t.flags|=32),XC(e,t),Oi(e,t,s,n),t.child;case 6:return e===null&&Iv(t),null;case 13:return ZC(e,t,n);case 4:return Hb(t,t.stateNode.containerInfo),i=t.pendingProps,e===null?t.child=Jl(t,null,i,n):Oi(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:Zr(i,r),G2(e,t,i,r,n);case 7:return Oi(e,t,t.pendingProps,n),t.child;case 8:return Oi(e,t,t.pendingProps.children,n),t.child;case 12:return Oi(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,o=t.memoizedProps,s=r.value,gn(Gm,i._currentValue),i._currentValue=s,o!==null)if(co(o.value,s)){if(o.children===r.children&&!Ki.current){t=ys(e,t,n);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var a=o.dependencies;if(a!==null){s=o.child;for(var c=a.firstContext;c!==null;){if(c.context===i){if(o.tag===1){c=fs(-1,n&-n),c.tag=2;var l=o.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}o.lanes|=n,c=o.alternate,c!==null&&(c.lanes|=n),Lv(o.return,n,t),a.lanes|=n;break}c=c.next}}else if(o.tag===10)s=o.type===t.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(Ne(341));s.lanes|=n,a=s.alternate,a!==null&&(a.lanes|=n),Lv(s,n,t),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===t){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}Oi(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,$l(t,n),r=Dr(r),i=i(r),t.flags|=1,Oi(e,t,i,n),t.child;case 14:return i=t.type,r=Zr(i,t.pendingProps),r=Zr(i.type,r),$2(e,t,i,r,n);case 15:return WC(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:Zr(i,r),rm(e,t),t.tag=1,Qi(i)?(e=!0,Nm(t)):e=!1,$l(t,n),_C(t,i,r),Ov(t,i,r,n),Bv(null,t,i,!0,e,n);case 19:return KC(e,t,n);case 22:return qC(e,t,n)}throw Error(Ne(156,t.tag))};function pP(e,t){return zA(e,t)}function J4(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lr(e,t,n,i){return new J4(e,t,n,i)}function o_(e){return e=e.prototype,!(!e||!e.isReactComponent)}function eL(e){if(typeof e=="function")return o_(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Mb)return 11;if(e===Ab)return 14}return 2}function da(e,t){var n=e.alternate;return n===null?(n=Lr(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function am(e,t,n,i,r,o){var s=2;if(i=e,typeof e=="function")o_(e)&&(s=1);else if(typeof e=="string")s=5;else e:switch(e){case vl:return ic(n.children,r,o,t);case Sb:s=8,r|=8;break;case iv:return e=Lr(12,n,t,r|2),e.elementType=iv,e.lanes=o,e;case rv:return e=Lr(13,n,t,r),e.elementType=rv,e.lanes=o,e;case ov:return e=Lr(19,n,t,r),e.elementType=ov,e.lanes=o,e;case wA:return c0(n,r,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case bA:s=10;break e;case _A:s=9;break e;case Mb:s=11;break e;case Ab:s=14;break e;case Qs:s=16,i=null;break e}throw Error(Ne(130,e==null?e:typeof e,""))}return t=Lr(s,n,t,r),t.elementType=e,t.type=i,t.lanes=o,t}function ic(e,t,n,i){return e=Lr(7,e,i,t),e.lanes=n,e}function c0(e,t,n,i){return e=Lr(22,e,i,t),e.elementType=wA,e.lanes=n,e.stateNode={isHidden:!1},e}function c1(e,t,n){return e=Lr(6,e,null,t),e.lanes=n,e}function l1(e,t,n){return t=Lr(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function tL(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=V0(0),this.expirationTimes=V0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=V0(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function s_(e,t,n,i,r,o,s,a,c){return e=new tL(e,t,n,a,c),t===1?(t=1,o===!0&&(t|=8)):t=0,o=Lr(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Vb(o),e}function nL(e,t,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:yl,key:i==null?null:""+i,children:e,containerInfo:t,implementation:n}}function dP(e){if(!e)return wa;e=e._reactInternals;e:{if(Rc(e)!==e||e.tag!==1)throw Error(Ne(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Qi(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Ne(171))}if(e.tag===1){var n=e.type;if(Qi(n))return pC(e,n,t)}return t}function mP(e,t,n,i,r,o,s,a,c){return e=s_(n,i,!0,e,r,o,s,a,c),e.context=dP(null),n=e.current,i=Ni(),r=pa(n),o=fs(i,r),o.callback=t??null,ha(n,o,r),e.current.lanes=r,hp(e,r,i),Ji(e,i),e}function l0(e,t,n,i){var r=t.current,o=Ni(),s=pa(r);return n=dP(n),t.context===null?t.context=n:t.pendingContext=n,t=fs(o,s),t.payload={element:e},i=i===void 0?null:i,i!==null&&(t.callback=i),e=ha(r,t,s),e!==null&&(oo(e,r,s,o),tm(e,r,s)),s}function Km(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function ew(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function a_(e,t){ew(e,t),(e=e.alternate)&&ew(e,t)}function iL(){return null}var gP=typeof reportError=="function"?reportError:function(e){console.error(e)};function c_(e){this._internalRoot=e}u0.prototype.render=c_.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Ne(409));l0(e,t,null,null)};u0.prototype.unmount=c_.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;mc(function(){l0(null,e,null,null)}),t[ms]=null}};function u0(e){this._internalRoot=e}u0.prototype.unstable_scheduleHydration=function(e){if(e){var t=WA();e={blockedOn:null,target:e,priority:t};for(var n=0;n<ta.length&&t!==0&&t<ta[n].priority;n++);ta.splice(n,0,e),n===0&&XA(e)}};function l_(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function h0(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function tw(){}function rL(e,t,n,i,r){if(r){if(typeof i=="function"){var o=i;i=function(){var l=Km(s);o.call(l)}}var s=mP(t,i,e,0,null,!1,!1,"",tw);return e._reactRootContainer=s,e[ms]=s.current,ff(e.nodeType===8?e.parentNode:e),mc(),s}for(;r=e.lastChild;)e.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var l=Km(c);a.call(l)}}var c=s_(e,0,!1,null,null,!1,!1,"",tw);return e._reactRootContainer=c,e[ms]=c.current,ff(e.nodeType===8?e.parentNode:e),mc(function(){l0(t,c,n,i)}),c}function f0(e,t,n,i,r){var o=n._reactRootContainer;if(o){var s=o;if(typeof r=="function"){var a=r;r=function(){var c=Km(s);a.call(c)}}l0(t,s,e,r)}else s=rL(n,t,e,r,i);return Km(s)}HA=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Ah(t.pendingLanes);n!==0&&(Tb(t,n|1),Ji(t,Gn()),!(Wt&6)&&(nu=Gn()+500,Ra()))}break;case 13:mc(function(){var i=gs(e,1);if(i!==null){var r=Ni();oo(i,e,1,r)}}),a_(e,1)}};Eb=function(e){if(e.tag===13){var t=gs(e,134217728);if(t!==null){var n=Ni();oo(t,e,134217728,n)}a_(e,134217728)}};jA=function(e){if(e.tag===13){var t=pa(e),n=gs(e,t);if(n!==null){var i=Ni();oo(n,e,t,i)}a_(e,t)}};WA=function(){return sn};qA=function(e,t){var n=sn;try{return sn=e,t()}finally{sn=n}};mv=function(e,t,n){switch(t){case"input":if(cv(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=n0(i);if(!r)throw Error(Ne(90));MA(i),cv(i,r)}}}break;case"textarea":CA(e,n);break;case"select":t=n.value,t!=null&&Nl(e,!!n.multiple,t,!1)}};OA=n_;kA=mc;var oL={usingClientEntryPoint:!1,Events:[pp,wl,n0,LA,RA,n_]},Ju={findFiberByHostInstance:Ja,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},sL={bundleType:Ju.bundleType,version:Ju.version,rendererPackageName:Ju.rendererPackageName,rendererConfig:Ju.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ts.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=FA(e),e===null?null:e.stateNode},findFiberByHostInstance:Ju.findFiberByHostInstance||iL,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Vp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Vp.isDisabled&&Vp.supportsFiber)try{Qg=Vp.inject(sL),Do=Vp}catch{}}vr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=oL;vr.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!l_(t))throw Error(Ne(200));return nL(e,t,null,n)};vr.createRoot=function(e,t){if(!l_(e))throw Error(Ne(299));var n=!1,i="",r=gP;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(r=t.onRecoverableError)),t=s_(e,1,!1,null,null,n,!1,i,r),e[ms]=t.current,ff(e.nodeType===8?e.parentNode:e),new c_(t)};vr.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Ne(188)):(e=Object.keys(e).join(","),Error(Ne(268,e)));return e=FA(t),e=e===null?null:e.stateNode,e};vr.flushSync=function(e){return mc(e)};vr.hydrate=function(e,t,n){if(!h0(t))throw Error(Ne(200));return f0(null,e,t,!0,n)};vr.hydrateRoot=function(e,t,n){if(!l_(e))throw Error(Ne(405));var i=n!=null&&n.hydratedSources||null,r=!1,o="",s=gP;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),t=mP(t,null,e,1,n??null,r,!1,o,s),e[ms]=t.current,ff(e),i)for(e=0;e<i.length;e++)n=i[e],r=n._getVersion,r=r(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new u0(t)};vr.render=function(e,t,n){if(!h0(t))throw Error(Ne(200));return f0(null,e,t,!1,n)};vr.unmountComponentAtNode=function(e){if(!h0(e))throw Error(Ne(40));return e._reactRootContainer?(mc(function(){f0(null,null,e,!1,function(){e._reactRootContainer=null,e[ms]=null})}),!0):!1};vr.unstable_batchedUpdates=n_;vr.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!h0(n))throw Error(Ne(200));if(e==null||e._reactInternals===void 0)throw Error(Ne(38));return f0(e,t,n,!1,i)};vr.version="18.2.0-next-9e3b772b8-20220608";(function(e){function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(n){console.error(n)}}t(),e.exports=vr})(iI);var nw=ev;Jy.createRoot=nw.createRoot,Jy.hydrateRoot=nw.hydrateRoot;function aL(e){var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){return t.reject(n)})})}function cL(e){var t=this;return new t(function(n,i){if(!(e&&typeof e.length<"u"))return i(new TypeError(typeof e+" "+e+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var r=Array.prototype.slice.call(e);if(r.length===0)return n([]);var o=r.length;function s(c,l){if(l&&(typeof l=="object"||typeof l=="function")){var u=l.then;if(typeof u=="function"){u.call(l,function(h){s(c,h)},function(h){r[c]={status:"rejected",reason:h},--o===0&&n(r)});return}}r[c]={status:"fulfilled",value:l},--o===0&&n(r)}for(var a=0;a<r.length;a++)s(a,r[a])})}function yP(e,t){this.name="AggregateError",this.errors=e,this.message=t||""}yP.prototype=Error.prototype;function lL(e){var t=this;return new t(function(n,i){if(!(e&&typeof e.length<"u"))return i(new TypeError("Promise.any accepts an array"));var r=Array.prototype.slice.call(e);if(r.length===0)return i();for(var o=[],s=0;s<r.length;s++)try{t.resolve(r[s]).then(n).catch(function(a){o.push(a),o.length===r.length&&i(new yP(o,"All promises were rejected"))})}catch(a){i(a)}})}var uL=setTimeout;function vP(e){return!!(e&&typeof e.length<"u")}function hL(){}function fL(e,t){return function(){e.apply(t,arguments)}}function Ln(e){if(!(this instanceof Ln))throw new TypeError("Promises must be constructed via new");if(typeof e!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],bP(e,this)}function xP(e,t){for(;e._state===3;)e=e._value;if(e._state===0){e._deferreds.push(t);return}e._handled=!0,Ln._immediateFn(function(){var n=e._state===1?t.onFulfilled:t.onRejected;if(n===null){(e._state===1?Xv:_f)(t.promise,e._value);return}var i;try{i=n(e._value)}catch(r){_f(t.promise,r);return}Xv(t.promise,i)})}function Xv(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&(typeof t=="object"||typeof t=="function")){var n=t.then;if(t instanceof Ln){e._state=3,e._value=t,Yv(e);return}else if(typeof n=="function"){bP(fL(n,t),e);return}}e._state=1,e._value=t,Yv(e)}catch(i){_f(e,i)}}function _f(e,t){e._state=2,e._value=t,Yv(e)}function Yv(e){e._state===2&&e._deferreds.length===0&&Ln._immediateFn(function(){e._handled||Ln._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)xP(e,e._deferreds[t]);e._deferreds=null}function pL(e,t,n){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.promise=n}function bP(e,t){var n=!1;try{e(function(i){n||(n=!0,Xv(t,i))},function(i){n||(n=!0,_f(t,i))})}catch(i){if(n)return;n=!0,_f(t,i)}}Ln.prototype.catch=function(e){return this.then(null,e)};Ln.prototype.then=function(e,t){var n=new this.constructor(hL);return xP(this,new pL(e,t,n)),n};Ln.prototype.finally=aL;Ln.all=function(e){return new Ln(function(t,n){if(!vP(e))return n(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(e);if(i.length===0)return t([]);var r=i.length;function o(a,c){try{if(c&&(typeof c=="object"||typeof c=="function")){var l=c.then;if(typeof l=="function"){l.call(c,function(u){o(a,u)},n);return}}i[a]=c,--r===0&&t(i)}catch(u){n(u)}}for(var s=0;s<i.length;s++)o(s,i[s])})};Ln.any=lL;Ln.allSettled=cL;Ln.resolve=function(e){return e&&typeof e=="object"&&e.constructor===Ln?e:new Ln(function(t){t(e)})};Ln.reject=function(e){return new Ln(function(t,n){n(e)})};Ln.race=function(e){return new Ln(function(t,n){if(!vP(e))return n(new TypeError("Promise.race accepts an array"));for(var i=0,r=e.length;i<r;i++)Ln.resolve(e[i]).then(t,n)})};Ln._immediateFn=typeof setImmediate=="function"&&function(e){setImmediate(e)}||function(e){uL(e,0)};Ln._unhandledRejectionFn=function(t){typeof console<"u"&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};Number.EPSILON===void 0&&(Number.EPSILON=Math.pow(2,-52));Number.isInteger===void 0&&(Number.isInteger=function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e});Math.sign===void 0&&(Math.sign=function(e){return e<0?-1:e>0?1:+e});"name"in Function.prototype||Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}});Object.assign===void 0&&(Object.assign=function(e){if(e==null)throw new TypeError("Cannot convert undefined or null to object");const t=Object(e);for(let n=1;n<arguments.length;n++){const i=arguments[n];if(i!=null)for(const r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t});const dL="118",mL=0,iw=1,gL=2,_P=1,yL=2,Ph=3,Iu=0,Kn=1,mp=2,wP=1,ps=0,ma=1,Zv=2,rw=3,ow=4,vL=5,sl=100,xL=101,bL=102,sw=103,aw=104,_L=200,wL=201,SL=202,ML=203,SP=204,MP=205,AL=206,CL=207,PL=208,TL=209,EL=210,IL=0,LL=1,RL=2,Kv=3,OL=4,kL=5,DL=6,BL=7,p0=0,FL=1,NL=2,Hl=0,zL=1,UL=2,GL=3,$L=4,VL=5,u_=300,h_=301,f_=302,AP=303,p_=304,gp=306,d_=307,Qm=1e3,Yi=1001,Jm=1002,ln=1003,Qv=1004,Jv=1005,Xn=1006,CP=1007,d0=1008,gc=1009,HL=1010,jL=1011,eg=1012,WL=1013,cm=1014,cs=1015,tg=1016,qL=1017,XL=1018,YL=1019,jh=1020,ZL=1021,rc=1022,er=1023,KL=1024,QL=1025,JL=er,jl=1026,wf=1027,eR=1028,tR=1029,nR=1030,iR=1031,rR=1032,oR=1033,cw=33776,lw=33777,uw=33778,hw=33779,fw=35840,pw=35841,dw=35842,mw=35843,sR=36196,gw=37492,yw=37496,aR=37808,cR=37809,lR=37810,uR=37811,hR=37812,fR=37813,pR=37814,dR=37815,mR=37816,gR=37817,yR=37818,vR=37819,xR=37820,bR=37821,_R=36492,wR=37840,SR=37841,MR=37842,AR=37843,CR=37844,PR=37845,TR=37846,ER=37847,IR=37848,LR=37849,RR=37850,OR=37851,kR=37852,DR=37853,BR=2200,FR=2201,NR=2202,ng=2300,lm=2301,u1=2302,iu=2400,El=2401,ig=2402,m_=2500,PP=2501,zR=0,Ti=3e3,yp=3001,g_=3007,y_=3002,UR=3003,TP=3004,EP=3005,IP=3006,GR=3200,$R=3201,Lu=0,VR=1,h1=7680,HR=519,m0=35044,Sf=35048;function Es(){}Object.assign(Es.prototype,{addEventListener:function(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)},hasEventListener:function(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1},removeEventListener:function(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const r=i.indexOf(t);r!==-1&&i.splice(r,1)}},dispatchEvent:function(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let r=0,o=i.length;r<o;r++)i[r].call(this,e)}}});const ci=[];for(let e=0;e<256;e++)ci[e]=(e<16?"0":"")+e.toString(16);const It={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(ci[e&255]+ci[e>>8&255]+ci[e>>16&255]+ci[e>>24&255]+"-"+ci[t&255]+ci[t>>8&255]+"-"+ci[t>>16&15|64]+ci[t>>24&255]+"-"+ci[n&63|128]+ci[n>>8&255]+"-"+ci[n>>16&255]+ci[n>>24&255]+ci[i&255]+ci[i>>8&255]+ci[i>>16&255]+ci[i>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*(3-2*e))},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*e*(e*(e*6-15)+10))},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*It.DEG2RAD},radToDeg:function(e){return e*It.RAD2DEG},isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,i,r){const o=Math.cos,s=Math.sin,a=o(n/2),c=s(n/2),l=o((t+i)/2),u=s((t+i)/2),h=o((t-i)/2),f=s((t-i)/2),p=o((i-t)/2),m=s((i-t)/2);switch(r){case"XYX":e.set(a*u,c*h,c*f,a*l);break;case"YZY":e.set(c*f,a*u,c*h,a*l);break;case"ZXZ":e.set(c*h,c*f,a*u,a*l);break;case"XZX":e.set(a*u,c*m,c*p,a*l);break;case"YXY":e.set(c*p,a*u,c*m,a*l);break;case"ZYZ":e.set(c*m,c*p,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}};function Ee(e=0,t=0){this.x=e,this.y=t}Object.defineProperties(Ee.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}});Object.assign(Ee.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return n!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*i+e.x,this.y=r*i+o*n+e.y,this},random:function(){return this.x=Math.random(),this.y=Math.random(),this}});function di(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(di.prototype,{isMatrix3:!0,set:function(e,t,n,i,r,o,s,a,c){const l=this.elements;return l[0]=e,l[1]=i,l[2]=s,l[3]=t,l[4]=r,l[5]=a,l[6]=n,l[7]=o,l[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},extractBasis:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},setFromMatrix4:function(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],s=n[3],a=n[6],c=n[1],l=n[4],u=n[7],h=n[2],f=n[5],p=n[8],m=i[0],y=i[3],v=i[6],d=i[1],g=i[4],b=i[7],x=i[2],_=i[5],S=i[8];return r[0]=o*m+s*d+a*x,r[3]=o*y+s*g+a*_,r[6]=o*v+s*b+a*S,r[1]=c*m+l*d+u*x,r[4]=c*y+l*g+u*_,r[7]=c*v+l*b+u*S,r[2]=h*m+f*d+p*x,r[5]=h*y+f*g+p*_,r[8]=h*v+f*b+p*S,this},multiplyScalar:function(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],c=e[7],l=e[8];return t*o*l-t*s*c-n*r*l+n*s*a+i*r*c-i*o*a},getInverse:function(e,t){t!==void 0&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");const n=e.elements,i=this.elements,r=n[0],o=n[1],s=n[2],a=n[3],c=n[4],l=n[5],u=n[6],h=n[7],f=n[8],p=f*c-l*h,m=l*u-f*a,y=h*a-c*u,v=r*p+o*m+s*y;if(v===0)return this.set(0,0,0,0,0,0,0,0,0);const d=1/v;return i[0]=p*d,i[1]=(s*h-f*o)*d,i[2]=(l*o-s*c)*d,i[3]=m*d,i[4]=(f*r-s*u)*d,i[5]=(s*a-l*r)*d,i[6]=y*d,i[7]=(o*u-h*r)*d,i[8]=(c*r-o*a)*d,this},transpose:function(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,n,i,r,o,s){const a=Math.cos(r),c=Math.sin(r);this.set(n*a,n*c,-n*(a*o+c*s)+o+e,-i*c,i*a,-i*(-c*o+a*s)+s+t,0,0,1)},scale:function(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this},rotate:function(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],o=i[3],s=i[6],a=i[1],c=i[4],l=i[7];return i[0]=t*r+n*a,i[3]=t*o+n*c,i[6]=t*s+n*l,i[1]=-n*r+t*a,i[4]=-n*o+t*c,i[7]=-n*s+t*l,this},translate:function(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this},equals:function(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){t===void 0&&(t=0);for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}});let Bc;const yc={getDataURL:function(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Bc===void 0&&(Bc=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Bc.width=e.width,Bc.height=e.height;const n=Bc.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Bc}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}};let jR=0;function dn(e,t,n,i,r,o,s,a,c,l){Object.defineProperty(this,"id",{value:jR++}),this.uuid=It.generateUUID(),this.name="",this.image=e!==void 0?e:dn.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=t!==void 0?t:dn.DEFAULT_MAPPING,this.wrapS=n!==void 0?n:Yi,this.wrapT=i!==void 0?i:Yi,this.magFilter=r!==void 0?r:Xn,this.minFilter=o!==void 0?o:d0,this.anisotropy=c!==void 0?c:1,this.format=s!==void 0?s:er,this.internalFormat=null,this.type=a!==void 0?a:gc,this.offset=new Ee(0,0),this.repeat=new Ee(1,1),this.center=new Ee(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new di,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=l!==void 0?l:Ti,this.version=0,this.onUpdate=null}dn.DEFAULT_IMAGE=void 0;dn.DEFAULT_MAPPING=u_;dn.prototype=Object.assign(Object.create(Es.prototype),{constructor:dn,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const i=this.image;if(i.uuid===void 0&&(i.uuid=It.generateUUID()),!t&&e.images[i.uuid]===void 0){let r;if(Array.isArray(i)){r=[];for(let o=0,s=i.length;o<s;o++)r.push(yc.getDataURL(i[o]))}else r=yc.getDataURL(i);e.images[i.uuid]={uuid:i.uuid,url:r}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==u_)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Qm:e.x=e.x-Math.floor(e.x);break;case Yi:e.x=e.x<0?0:1;break;case Jm:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Qm:e.y=e.y-Math.floor(e.y);break;case Yi:e.y=e.y<0?0:1;break;case Jm:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}});Object.defineProperty(dn.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}});function on(e=0,t=0,n=0,i=1){this.x=e,this.y=t,this.z=n,this.w=i}Object.defineProperties(on.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}});Object.assign(on.prototype,{isVector4:!0,set:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){const t=this.x,n=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*r,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){let t,n,i,r;const a=e.elements,c=a[0],l=a[4],u=a[8],h=a[1],f=a[5],p=a[9],m=a[2],y=a[6],v=a[10];if(Math.abs(l-h)<.01&&Math.abs(u-m)<.01&&Math.abs(p-y)<.01){if(Math.abs(l+h)<.1&&Math.abs(u+m)<.1&&Math.abs(p+y)<.1&&Math.abs(c+f+v-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const g=(c+1)/2,b=(f+1)/2,x=(v+1)/2,_=(l+h)/4,S=(u+m)/4,w=(p+y)/4;return g>b&&g>x?g<.01?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(g),i=_/n,r=S/n):b>x?b<.01?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(b),n=_/i,r=w/i):x<.01?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(x),n=S/r,i=w/r),this.set(n,i,r,t),this}let d=Math.sqrt((y-p)*(y-p)+(u-m)*(u-m)+(h-l)*(h-l));return Math.abs(d)<.001&&(d=1),this.x=(y-p)/d,this.y=(u-m)/d,this.z=(h-l)/d,this.w=Math.acos((c+f+v-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,n){return n!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}});function zi(e,t,n){this.width=e,this.height=t,this.scissor=new on(0,0,e,t),this.scissorTest=!1,this.viewport=new on(0,0,e,t),n=n||{},this.texture=new dn(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:Xn,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!0,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null}zi.prototype=Object.assign(Object.create(Es.prototype),{constructor:zi,isWebGLRenderTarget:!0,setSize:function(e,t){(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});function vw(e,t,n){zi.call(this,e,t,n),this.samples=4}vw.prototype=Object.assign(Object.create(zi.prototype),{constructor:vw,isWebGLMultisampleRenderTarget:!0,copy:function(e){return zi.prototype.copy.call(this,e),this.samples=e.samples,this}});function un(e=0,t=0,n=0,i=1){this._x=e,this._y=t,this._z=n,this._w=i}Object.assign(un,{slerp:function(e,t,n,i){return n.copy(e).slerp(t,i)},slerpFlat:function(e,t,n,i,r,o,s){let a=n[i+0],c=n[i+1],l=n[i+2],u=n[i+3];const h=r[o+0],f=r[o+1],p=r[o+2],m=r[o+3];if(u!==m||a!==h||c!==f||l!==p){let y=1-s,v=a*h+c*f+l*p+u*m,d=v>=0?1:-1,g=1-v*v;if(g>Number.EPSILON){const x=Math.sqrt(g),_=Math.atan2(x,v*d);y=Math.sin(y*_)/x,s=Math.sin(s*_)/x}const b=s*d;if(a=a*y+h*b,c=c*y+f*b,l=l*y+p*b,u=u*y+m*b,y===1-s){const x=1/Math.sqrt(a*a+c*c+l*l+u*u);a*=x,c*=x,l*=x,u*=x}}e[t]=a,e[t+1]=c,e[t+2]=l,e[t+3]=u},multiplyQuaternionsFlat:function(e,t,n,i,r,o){const s=n[i],a=n[i+1],c=n[i+2],l=n[i+3],u=r[o],h=r[o+1],f=r[o+2],p=r[o+3];return e[t]=s*p+l*u+a*f-c*h,e[t+1]=a*p+l*h+c*u-s*f,e[t+2]=c*p+l*f+s*h-a*u,e[t+3]=l*p-s*u-a*h-c*f,e}});Object.defineProperties(un.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}});Object.assign(un.prototype,{isQuaternion:!0,set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,i=e._y,r=e._z,o=e.order,s=Math.cos,a=Math.sin,c=s(n/2),l=s(i/2),u=s(r/2),h=a(n/2),f=a(i/2),p=a(r/2);switch(o){case"XYZ":this._x=h*l*u+c*f*p,this._y=c*f*u-h*l*p,this._z=c*l*p+h*f*u,this._w=c*l*u-h*f*p;break;case"YXZ":this._x=h*l*u+c*f*p,this._y=c*f*u-h*l*p,this._z=c*l*p-h*f*u,this._w=c*l*u+h*f*p;break;case"ZXY":this._x=h*l*u-c*f*p,this._y=c*f*u+h*l*p,this._z=c*l*p+h*f*u,this._w=c*l*u-h*f*p;break;case"ZYX":this._x=h*l*u-c*f*p,this._y=c*f*u+h*l*p,this._z=c*l*p-h*f*u,this._w=c*l*u+h*f*p;break;case"YZX":this._x=h*l*u+c*f*p,this._y=c*f*u+h*l*p,this._z=c*l*p-h*f*u,this._w=c*l*u-h*f*p;break;case"XZY":this._x=h*l*u-c*f*p,this._y=c*f*u-h*l*p,this._z=c*l*p+h*f*u,this._w=c*l*u+h*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(e){const t=e.elements,n=t[0],i=t[4],r=t[8],o=t[1],s=t[5],a=t[9],c=t[2],l=t[6],u=t[10],h=n+s+u;if(h>0){const f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(l-a)*f,this._y=(r-c)*f,this._z=(o-i)*f}else if(n>s&&n>u){const f=2*Math.sqrt(1+n-s-u);this._w=(l-a)/f,this._x=.25*f,this._y=(i+o)/f,this._z=(r+c)/f}else if(s>u){const f=2*Math.sqrt(1+s-n-u);this._w=(r-c)/f,this._x=(i+o)/f,this._y=.25*f,this._z=(a+l)/f}else{const f=2*Math.sqrt(1+u-n-s);this._w=(o-i)/f,this._x=(r+c)/f,this._y=(a+l)/f,this._z=.25*f}return this._onChangeCallback(),this},setFromUnitVectors:function(e,t){let i=e.dot(t)+1;return i<1e-6?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(It.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){const n=e._x,i=e._y,r=e._z,o=e._w,s=t._x,a=t._y,c=t._z,l=t._w;return this._x=n*l+o*s+i*c-r*a,this._y=i*l+o*a+r*s-n*c,this._z=r*l+o*c+n*a-i*s,this._w=o*l-n*s-i*a-r*c,this._onChangeCallback(),this},slerp:function(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,i=this._y,r=this._z,o=this._w;let s=o*e._w+n*e._x+i*e._y+r*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const a=1-s*s;if(a<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*n+t*this._x,this._y=f*i+t*this._y,this._z=f*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(a),l=Math.atan2(c,s),u=Math.sin((1-t)*l)/c,h=Math.sin(t*l)/c;return this._w=o*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return t===void 0&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},fromBufferAttribute:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});const f1=new T,xw=new un;function T(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}Object.assign(T.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(xw.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(xw.setFromAxisAngle(e,t))},applyMatrix3:function(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){const t=this.x,n=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*o,this},applyQuaternion:function(e){const t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,s=e.z,a=e.w,c=a*t+o*i-s*n,l=a*n+s*t-r*i,u=a*i+r*n-o*t,h=-r*t-o*n-s*i;return this.x=c*a+h*-r+l*-s-u*-o,this.y=l*a+h*-o+u*-r-c*-s,this.z=u*a+h*-s+c*-o-l*-r,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this},cross:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){const n=e.x,i=e.y,r=e.z,o=t.x,s=t.y,a=t.z;return this.x=i*a-r*s,this.y=r*o-n*a,this.z=n*s-i*o,this},projectOnVector:function(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)},projectOnPlane:function(e){return f1.copy(this).projectOnVector(e),this.sub(f1)},reflect:function(e){return this.sub(f1.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(It.clamp(n,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,t*4)},setFromMatrix3Column:function(e,t){return this.fromArray(e.elements,t*3)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,n){return n!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}});const Fc=new T,Vr=new De,WR=new T(0,0,0),qR=new T(1,1,1),Ns=new T,Hp=new T,ir=new T;function De(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(De.prototype,{isMatrix4:!0,set:function(e,t,n,i,r,o,s,a,c,l,u,h,f,p,m,y){const v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=i,v[1]=r,v[5]=o,v[9]=s,v[13]=a,v[2]=c,v[6]=l,v[10]=u,v[14]=h,v[3]=f,v[7]=p,v[11]=m,v[15]=y,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new De().fromArray(this.elements)},copy:function(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(e){const t=this.elements,n=e.elements,i=1/Fc.setFromMatrixColumn(e,0).length(),r=1/Fc.setFromMatrixColumn(e,1).length(),o=1/Fc.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,i=e.y,r=e.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(i),c=Math.sin(i),l=Math.cos(r),u=Math.sin(r);if(e.order==="XYZ"){const h=o*l,f=o*u,p=s*l,m=s*u;t[0]=a*l,t[4]=-a*u,t[8]=c,t[1]=f+p*c,t[5]=h-m*c,t[9]=-s*a,t[2]=m-h*c,t[6]=p+f*c,t[10]=o*a}else if(e.order==="YXZ"){const h=a*l,f=a*u,p=c*l,m=c*u;t[0]=h+m*s,t[4]=p*s-f,t[8]=o*c,t[1]=o*u,t[5]=o*l,t[9]=-s,t[2]=f*s-p,t[6]=m+h*s,t[10]=o*a}else if(e.order==="ZXY"){const h=a*l,f=a*u,p=c*l,m=c*u;t[0]=h-m*s,t[4]=-o*u,t[8]=p+f*s,t[1]=f+p*s,t[5]=o*l,t[9]=m-h*s,t[2]=-o*c,t[6]=s,t[10]=o*a}else if(e.order==="ZYX"){const h=o*l,f=o*u,p=s*l,m=s*u;t[0]=a*l,t[4]=p*c-f,t[8]=h*c+m,t[1]=a*u,t[5]=m*c+h,t[9]=f*c-p,t[2]=-c,t[6]=s*a,t[10]=o*a}else if(e.order==="YZX"){const h=o*a,f=o*c,p=s*a,m=s*c;t[0]=a*l,t[4]=m-h*u,t[8]=p*u+f,t[1]=u,t[5]=o*l,t[9]=-s*l,t[2]=-c*l,t[6]=f*u+p,t[10]=h-m*u}else if(e.order==="XZY"){const h=o*a,f=o*c,p=s*a,m=s*c;t[0]=a*l,t[4]=-u,t[8]=c*l,t[1]=h*u+m,t[5]=o*l,t[9]=f*u-p,t[2]=p*u-f,t[6]=s*l,t[10]=m*u+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(WR,e,qR)},lookAt:function(e,t,n){const i=this.elements;return ir.subVectors(e,t),ir.lengthSq()===0&&(ir.z=1),ir.normalize(),Ns.crossVectors(n,ir),Ns.lengthSq()===0&&(Math.abs(n.z)===1?ir.x+=1e-4:ir.z+=1e-4,ir.normalize(),Ns.crossVectors(n,ir)),Ns.normalize(),Hp.crossVectors(ir,Ns),i[0]=Ns.x,i[4]=Hp.x,i[8]=ir.x,i[1]=Ns.y,i[5]=Hp.y,i[9]=ir.y,i[2]=Ns.z,i[6]=Hp.z,i[10]=ir.z,this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){const n=e.elements,i=t.elements,r=this.elements,o=n[0],s=n[4],a=n[8],c=n[12],l=n[1],u=n[5],h=n[9],f=n[13],p=n[2],m=n[6],y=n[10],v=n[14],d=n[3],g=n[7],b=n[11],x=n[15],_=i[0],S=i[4],w=i[8],C=i[12],A=i[1],k=i[5],L=i[9],D=i[13],F=i[2],I=i[6],P=i[10],N=i[14],$=i[3],B=i[7],q=i[11],ee=i[15];return r[0]=o*_+s*A+a*F+c*$,r[4]=o*S+s*k+a*I+c*B,r[8]=o*w+s*L+a*P+c*q,r[12]=o*C+s*D+a*N+c*ee,r[1]=l*_+u*A+h*F+f*$,r[5]=l*S+u*k+h*I+f*B,r[9]=l*w+u*L+h*P+f*q,r[13]=l*C+u*D+h*N+f*ee,r[2]=p*_+m*A+y*F+v*$,r[6]=p*S+m*k+y*I+v*B,r[10]=p*w+m*L+y*P+v*q,r[14]=p*C+m*D+y*N+v*ee,r[3]=d*_+g*A+b*F+x*$,r[7]=d*S+g*k+b*I+x*B,r[11]=d*w+g*L+b*P+x*q,r[15]=d*C+g*D+b*N+x*ee,this},multiplyScalar:function(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],o=e[1],s=e[5],a=e[9],c=e[13],l=e[2],u=e[6],h=e[10],f=e[14],p=e[3],m=e[7],y=e[11],v=e[15];return p*(+r*a*u-i*c*u-r*s*h+n*c*h+i*s*f-n*a*f)+m*(+t*a*f-t*c*h+r*o*h-i*o*f+i*c*l-r*a*l)+y*(+t*c*u-t*s*f-r*o*u+n*o*f+r*s*l-n*c*l)+v*(-i*s*l-t*a*u+t*s*h+i*o*u-n*o*h+n*a*l)},transpose:function(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this},getInverse:function(e,t){t!==void 0&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");const n=this.elements,i=e.elements,r=i[0],o=i[1],s=i[2],a=i[3],c=i[4],l=i[5],u=i[6],h=i[7],f=i[8],p=i[9],m=i[10],y=i[11],v=i[12],d=i[13],g=i[14],b=i[15],x=p*g*h-d*m*h+d*u*y-l*g*y-p*u*b+l*m*b,_=v*m*h-f*g*h-v*u*y+c*g*y+f*u*b-c*m*b,S=f*d*h-v*p*h+v*l*y-c*d*y-f*l*b+c*p*b,w=v*p*u-f*d*u-v*l*m+c*d*m+f*l*g-c*p*g,C=r*x+o*_+s*S+a*w;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/C;return n[0]=x*A,n[1]=(d*m*a-p*g*a-d*s*y+o*g*y+p*s*b-o*m*b)*A,n[2]=(l*g*a-d*u*a+d*s*h-o*g*h-l*s*b+o*u*b)*A,n[3]=(p*u*a-l*m*a-p*s*h+o*m*h+l*s*y-o*u*y)*A,n[4]=_*A,n[5]=(f*g*a-v*m*a+v*s*y-r*g*y-f*s*b+r*m*b)*A,n[6]=(v*u*a-c*g*a-v*s*h+r*g*h+c*s*b-r*u*b)*A,n[7]=(c*m*a-f*u*a+f*s*h-r*m*h-c*s*y+r*u*y)*A,n[8]=S*A,n[9]=(v*p*a-f*d*a-v*o*y+r*d*y+f*o*b-r*p*b)*A,n[10]=(c*d*a-v*l*a+v*o*h-r*d*h-c*o*b+r*l*b)*A,n[11]=(f*l*a-c*p*a-f*o*h+r*p*h+c*o*y-r*l*y)*A,n[12]=w*A,n[13]=(f*d*s-v*p*s+v*o*m-r*d*m-f*o*g+r*p*g)*A,n[14]=(v*l*s-c*d*s-v*o*u+r*d*u+c*o*g-r*l*g)*A,n[15]=(c*p*s-f*l*s+f*o*u-r*p*u-c*o*m+r*l*m)*A,this},scale:function(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this},getMaxScaleOnAxis:function(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,s=e.y,a=e.z,c=r*o,l=r*s;return this.set(c*o+n,c*s-i*a,c*a+i*s,0,c*s+i*a,l*s+n,l*a-i*o,0,c*a-i*s,l*a+i*o,r*a*a+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){const i=this.elements,r=t._x,o=t._y,s=t._z,a=t._w,c=r+r,l=o+o,u=s+s,h=r*c,f=r*l,p=r*u,m=o*l,y=o*u,v=s*u,d=a*c,g=a*l,b=a*u,x=n.x,_=n.y,S=n.z;return i[0]=(1-(m+v))*x,i[1]=(f+b)*x,i[2]=(p-g)*x,i[3]=0,i[4]=(f-b)*_,i[5]=(1-(h+v))*_,i[6]=(y+d)*_,i[7]=0,i[8]=(p+g)*S,i[9]=(y-d)*S,i[10]=(1-(h+m))*S,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this},decompose:function(e,t,n){const i=this.elements;let r=Fc.set(i[0],i[1],i[2]).length(),o=Fc.set(i[4],i[5],i[6]).length(),s=Fc.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Vr.copy(this);const c=1/r,l=1/o,u=1/s;return Vr.elements[0]*=c,Vr.elements[1]*=c,Vr.elements[2]*=c,Vr.elements[4]*=l,Vr.elements[5]*=l,Vr.elements[6]*=l,Vr.elements[8]*=u,Vr.elements[9]*=u,Vr.elements[10]*=u,t.setFromRotationMatrix(Vr),n.x=r,n.y=o,n.z=s,this},makePerspective:function(e,t,n,i,r,o){o===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements,a=2*r/(t-e),c=2*r/(n-i),l=(t+e)/(t-e),u=(n+i)/(n-i),h=-(o+r)/(o-r),f=-2*o*r/(o-r);return s[0]=a,s[4]=0,s[8]=l,s[12]=0,s[1]=0,s[5]=c,s[9]=u,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=f,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(e,t,n,i,r,o){const s=this.elements,a=1/(t-e),c=1/(n-i),l=1/(o-r),u=(t+e)*a,h=(n+i)*c,f=(o+r)*l;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-u,s[1]=0,s[5]=2*c,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*l,s[14]=-f,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){t===void 0&&(t=0);for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}});const bw=new De,_w=new un;function Sa(e=0,t=0,n=0,i=Sa.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=i}Sa.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];Sa.DefaultOrder="XYZ";Object.defineProperties(Sa.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}});Object.assign(Sa.prototype,{isEuler:!0,set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){const i=It.clamp,r=e.elements,o=r[0],s=r[4],a=r[8],c=r[1],l=r[5],u=r[9],h=r[2],f=r[6],p=r[10];switch(t=t||this._order,t){case"XYZ":this._y=Math.asin(i(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(f,l),this._z=0);break;case"YXZ":this._x=Math.asin(-i(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(i(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-i(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(i(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-i(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(f,l),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n!==!1&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,n){return bw.makeRotationFromQuaternion(e),this.setFromRotationMatrix(bw,t,n)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return _w.setFromEuler(this),this.setFromQuaternion(_w,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new T(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});function v_(){this.mask=1}Object.assign(v_.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return(this.mask&e.mask)!==0}});let XR=0;const ww=new T,Nc=new un,qo=new De,jp=new T,eh=new T,YR=new T,ZR=new un,Sw=new T(1,0,0),Mw=new T(0,1,0),Aw=new T(0,0,1),KR={type:"added"},QR={type:"removed"};function je(){Object.defineProperty(this,"id",{value:XR++}),this.uuid=It.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=je.DefaultUp.clone();const e=new T,t=new Sa,n=new un,i=new T(1,1,1);function r(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(r),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new De},normalMatrix:{value:new di}}),this.matrix=new De,this.matrixWorld=new De,this.matrixAutoUpdate=je.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new v_,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}je.DefaultUp=new T(0,1,0);je.DefaultMatrixAutoUpdate=!0;je.prototype=Object.assign(Object.create(Es.prototype),{constructor:je,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return Nc.setFromAxisAngle(e,t),this.quaternion.multiply(Nc),this},rotateOnWorldAxis:function(e,t){return Nc.setFromAxisAngle(e,t),this.quaternion.premultiply(Nc),this},rotateX:function(e){return this.rotateOnAxis(Sw,e)},rotateY:function(e){return this.rotateOnAxis(Mw,e)},rotateZ:function(e){return this.rotateOnAxis(Aw,e)},translateOnAxis:function(e,t){return ww.copy(e).applyQuaternion(this.quaternion),this.position.add(ww.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(Sw,e)},translateY:function(e){return this.translateOnAxis(Mw,e)},translateZ:function(e){return this.translateOnAxis(Aw,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(qo.getInverse(this.matrixWorld))},lookAt:function(e,t,n){e.isVector3?jp.copy(e):jp.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),eh.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?qo.lookAt(eh,jp,this.up):qo.lookAt(jp,eh,this.up),this.quaternion.setFromRotationMatrix(qo),i&&(qo.extractRotation(i.matrixWorld),Nc.setFromRotationMatrix(qo),this.quaternion.premultiply(Nc.inverse()))},add:function(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(KR)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(QR)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),qo.getInverse(this.matrixWorld),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),qo.multiply(e.parent.matrixWorld)),e.applyMatrix4(qo),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}},getWorldPosition:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new T),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new un),this.updateMatrixWorld(!0),this.matrixWorld.decompose(eh,e,YR),e},getWorldScale:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new T),this.updateMatrixWorld(!0),this.matrixWorld.decompose(eh,ZR,e),e},getWorldDirection:function(e){e===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new T),this.updateMatrixWorld(!0);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)},traverseVisible:function(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)},traverseAncestors:function(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const i=this.children;for(let r=0,o=i.length;r<o;r++)i[r].updateWorldMatrix(!1,!0)}},toJSON:function(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON());function r(s,a){return s[a.uuid]===void 0&&(s[a.uuid]=a.toJSON(e)),a.uuid}if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const s=this.geometry.parameters;if(s!==void 0&&s.shapes!==void 0){const a=s.shapes;if(Array.isArray(a))for(let c=0,l=a.length;c<l;c++){const u=a[c];r(e.shapes,u)}else r(e.shapes,a)}}if(this.material!==void 0)if(Array.isArray(this.material)){const s=[];for(let a=0,c=this.material.length;a<c;a++)s.push(r(e.materials,this.material[a]));i.material=s}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let s=0;s<this.children.length;s++)i.children.push(this.children[s].toJSON(e).object)}if(t){const s=o(e.geometries),a=o(e.materials),c=o(e.textures),l=o(e.images),u=o(e.shapes);s.length>0&&(n.geometries=s),a.length>0&&(n.materials=a),c.length>0&&(n.textures=c),l.length>0&&(n.images=l),u.length>0&&(n.shapes=u)}return n.object=i,n;function o(s){const a=[];for(const c in s){const l=s[c];delete l.metadata,a.push(l)}return a}},clone:function(e){return new this.constructor().copy(this,e)},copy:function(e,t){if(t===void 0&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}});function ru(){je.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}ru.prototype=Object.assign(Object.create(je.prototype),{constructor:ru,isScene:!0,copy:function(e,t){return je.prototype.copy.call(this,e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){const t=je.prototype.toJSON.call(this,e);return this.background!==null&&(t.object.background=this.background.toJSON(e)),this.environment!==null&&(t.object.environment=this.environment.toJSON(e)),this.fog!==null&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});const Xo=[new T,new T,new T,new T,new T,new T,new T,new T],th=new T,p1=new hn,zc=new T,Uc=new T,Gc=new T,zs=new T,Us=new T,za=new T,nh=new T,Wp=new T,qp=new T,Ua=new T;function hn(e,t){this.min=e!==void 0?e:new T(1/0,1/0,1/0),this.max=t!==void 0?t:new T(-1/0,-1/0,-1/0)}Object.assign(hn.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,s=-1/0;for(let a=0,c=e.length;a<c;a+=3){const l=e[a],u=e[a+1],h=e[a+2];l<t&&(t=l),u<n&&(n=u),h<i&&(i=h),l>r&&(r=l),u>o&&(o=u),h>s&&(s=h)}return this.min.set(t,n,i),this.max.set(r,o,s),this},setFromBufferAttribute:function(e){let t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,s=-1/0;for(let a=0,c=e.count;a<c;a++){const l=e.getX(a),u=e.getY(a),h=e.getZ(a);l<t&&(t=l),u<n&&(n=u),h<i&&(i=h),l>r&&(r=l),u>o&&(o=u),h>s&&(s=h)}return this.min.set(t,n,i),this.max.set(r,o,s),this},setFromPoints:function(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){const n=th.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return e===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new T),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return e===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new T),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),p1.copy(t.boundingBox),p1.applyMatrix4(e.matrixWorld),this.union(p1));const n=e.children;for(let i=0,r=n.length;i<r;i++)this.expandByObject(n[i]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return t===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new T),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,th),th.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(nh),Wp.subVectors(this.max,nh),zc.subVectors(e.a,nh),Uc.subVectors(e.b,nh),Gc.subVectors(e.c,nh),zs.subVectors(Uc,zc),Us.subVectors(Gc,Uc),za.subVectors(zc,Gc);let t=[0,-zs.z,zs.y,0,-Us.z,Us.y,0,-za.z,za.y,zs.z,0,-zs.x,Us.z,0,-Us.x,za.z,0,-za.x,-zs.y,zs.x,0,-Us.y,Us.x,0,-za.y,za.x,0];return!d1(t,zc,Uc,Gc,Wp)||(t=[1,0,0,0,1,0,0,0,1],!d1(t,zc,Uc,Gc,Wp))?!1:(qp.crossVectors(zs,Us),t=[qp.x,qp.y,qp.z],d1(t,zc,Uc,Gc,Wp))},clampPoint:function(e,t){return t===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new T),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return th.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return e===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=this.getSize(th).length()*.5,e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()?this:(Xo[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Xo[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Xo[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Xo[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Xo[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Xo[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Xo[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Xo[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Xo),this)},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});function d1(e,t,n,i,r){for(let o=0,s=e.length-3;o<=s;o+=3){Ua.fromArray(e,o);const a=r.x*Math.abs(Ua.x)+r.y*Math.abs(Ua.y)+r.z*Math.abs(Ua.z),c=t.dot(Ua),l=n.dot(Ua),u=i.dot(Ua);if(Math.max(-Math.max(c,l,u),Math.min(c,l,u))>a)return!1}return!0}const JR=new hn;function Is(e,t){this.center=e!==void 0?e:new T,this.radius=t!==void 0?t:-1}Object.assign(Is.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){const n=this.center;t!==void 0?n.copy(t):JR.setFromPoints(e).getCenter(n);let i=0;for(let r=0,o=e.length;r<o;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},isEmpty:function(){return this.radius<0},makeEmpty:function(){return this.center.set(0,0,0),this.radius=-1,this},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){const n=this.center.distanceToSquared(e);return t===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new T),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return e===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new hn),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});const Yo=new T,m1=new T,Xp=new T,Gs=new T,g1=new T,Yp=new T,y1=new T;function Ru(e,t){this.origin=e!==void 0?e:new T,this.direction=t!==void 0?t:new T(0,0,-1)}Object.assign(Ru.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return t===void 0&&(console.warn("THREE.Ray: .at() target is now required"),t=new T),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,Yo)),this},closestPointToPoint:function(e,t){t===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new T),t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){const t=Yo.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Yo.copy(this.direction).multiplyScalar(t).add(this.origin),Yo.distanceToSquared(e))},distanceSqToSegment:function(e,t,n,i){m1.copy(e).add(t).multiplyScalar(.5),Xp.copy(t).sub(e).normalize(),Gs.copy(this.origin).sub(m1);const r=e.distanceTo(t)*.5,o=-this.direction.dot(Xp),s=Gs.dot(this.direction),a=-Gs.dot(Xp),c=Gs.lengthSq(),l=Math.abs(1-o*o);let u,h,f,p;if(l>0)if(u=o*a-s,h=o*s-a,p=r*l,u>=0)if(h>=-p)if(h<=p){const m=1/l;u*=m,h*=m,f=u*(u+o*h+2*s)+h*(o*u+h+2*a)+c}else h=r,u=Math.max(0,-(o*h+s)),f=-u*u+h*(h+2*a)+c;else h=-r,u=Math.max(0,-(o*h+s)),f=-u*u+h*(h+2*a)+c;else h<=-p?(u=Math.max(0,-(-o*r+s)),h=u>0?-r:Math.min(Math.max(-r,-a),r),f=-u*u+h*(h+2*a)+c):h<=p?(u=0,h=Math.min(Math.max(-r,-a),r),f=h*(h+2*a)+c):(u=Math.max(0,-(o*r+s)),h=u>0?r:Math.min(Math.max(-r,-a),r),f=-u*u+h*(h+2*a)+c);else h=o>0?-r:r,u=Math.max(0,-(o*h+s)),f=-u*u+h*(h+2*a)+c;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),i&&i.copy(Xp).multiplyScalar(h).add(m1),f},intersectSphere:function(e,t){Yo.subVectors(e.center,this.origin);const n=Yo.dot(this.direction),i=Yo.dot(Yo)-n*n,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),s=n-o,a=n+o;return s<0&&a<0?null:s<0?this.at(a,t):this.at(s,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)},intersectsPlane:function(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){let n,i,r,o,s,a;const c=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z,h=this.origin;return c>=0?(n=(e.min.x-h.x)*c,i=(e.max.x-h.x)*c):(n=(e.max.x-h.x)*c,i=(e.min.x-h.x)*c),l>=0?(r=(e.min.y-h.y)*l,o=(e.max.y-h.y)*l):(r=(e.max.y-h.y)*l,o=(e.min.y-h.y)*l),n>o||r>i||((r>n||n!==n)&&(n=r),(o<i||i!==i)&&(i=o),u>=0?(s=(e.min.z-h.z)*u,a=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,a=(e.min.z-h.z)*u),n>a||s>i)||((s>n||n!==n)&&(n=s),(a<i||i!==i)&&(i=a),i<0)?null:this.at(n>=0?n:i,t)},intersectsBox:function(e){return this.intersectBox(e,Yo)!==null},intersectTriangle:function(e,t,n,i,r){g1.subVectors(t,e),Yp.subVectors(n,e),y1.crossVectors(g1,Yp);let o=this.direction.dot(y1),s;if(o>0){if(i)return null;s=1}else if(o<0)s=-1,o=-o;else return null;Gs.subVectors(this.origin,e);const a=s*this.direction.dot(Yp.crossVectors(Gs,Yp));if(a<0)return null;const c=s*this.direction.dot(g1.cross(Gs));if(c<0||a+c>o)return null;const l=-s*Gs.dot(y1);return l<0?null:this.at(l/o,r)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});const v1=new T,eO=new T,tO=new di;function Io(e,t){this.normal=e!==void 0?e:new T(1,0,0),this.constant=t!==void 0?t:0}Object.assign(Io.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,n){const i=v1.subVectors(n,t).cross(eO.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return t===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new T),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){t===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new T);const n=e.delta(v1),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):void 0;const r=-(e.start.dot(this.normal)+this.constant)/i;if(!(r<0||r>1))return t.copy(n).multiplyScalar(r).add(e.start)},intersectsLine:function(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return e===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new T),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){const n=t||tO.getNormalMatrix(e),i=this.coplanarPoint(v1).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});const Yr=new T,rs=new T,x1=new T,Zo=new T,$c=new T,Vc=new T,Cw=new T,b1=new T,_1=new T,w1=new T;function pi(e,t,n){this.a=e!==void 0?e:new T,this.b=t!==void 0?t:new T,this.c=n!==void 0?n:new T}Object.assign(pi,{getNormal:function(e,t,n,i){i===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new T),i.subVectors(n,t),Yr.subVectors(e,t),i.cross(Yr);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)},getBarycoord:function(e,t,n,i,r){Yr.subVectors(i,t),rs.subVectors(n,t),x1.subVectors(e,t);const o=Yr.dot(Yr),s=Yr.dot(rs),a=Yr.dot(x1),c=rs.dot(rs),l=rs.dot(x1),u=o*c-s*s;if(r===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new T),u===0)return r.set(-2,-1,-1);const h=1/u,f=(c*a-s*l)*h,p=(o*l-s*a)*h;return r.set(1-f-p,p,f)},containsPoint:function(e,t,n,i){return pi.getBarycoord(e,t,n,i,Zo),Zo.x>=0&&Zo.y>=0&&Zo.x+Zo.y<=1},getUV:function(e,t,n,i,r,o,s,a){return this.getBarycoord(e,t,n,i,Zo),a.set(0,0),a.addScaledVector(r,Zo.x),a.addScaledVector(o,Zo.y),a.addScaledVector(s,Zo.z),a},isFrontFacing:function(e,t,n,i){return Yr.subVectors(n,t),rs.subVectors(e,t),Yr.cross(rs).dot(i)<0}});Object.assign(pi.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return Yr.subVectors(this.c,this.b),rs.subVectors(this.a,this.b),Yr.cross(rs).length()*.5},getMidpoint:function(e){return e===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new T),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return pi.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return e===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Io),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return pi.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,n,i,r){return pi.getUV(e,this.a,this.b,this.c,t,n,i,r)},containsPoint:function(e){return pi.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return pi.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){t===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new T);const n=this.a,i=this.b,r=this.c;let o,s;$c.subVectors(i,n),Vc.subVectors(r,n),b1.subVectors(e,n);const a=$c.dot(b1),c=Vc.dot(b1);if(a<=0&&c<=0)return t.copy(n);_1.subVectors(e,i);const l=$c.dot(_1),u=Vc.dot(_1);if(l>=0&&u<=l)return t.copy(i);const h=a*u-l*c;if(h<=0&&a>=0&&l<=0)return o=a/(a-l),t.copy(n).addScaledVector($c,o);w1.subVectors(e,r);const f=$c.dot(w1),p=Vc.dot(w1);if(p>=0&&f<=p)return t.copy(r);const m=f*c-a*p;if(m<=0&&c>=0&&p<=0)return s=c/(c-p),t.copy(n).addScaledVector(Vc,s);const y=l*p-f*u;if(y<=0&&u-l>=0&&f-p>=0)return Cw.subVectors(r,i),s=(u-l)/(u-l+(f-p)),t.copy(i).addScaledVector(Cw,s);const v=1/(y+m+h);return o=m*v,s=h*v,t.copy(n).addScaledVector($c,o).addScaledVector(Vc,s)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});const LP={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Hr={h:0,s:0,l:0},Zp={h:0,s:0,l:0};function Fe(e,t,n){return t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}function S1(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*6*(2/3-n):e}function M1(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function A1(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}Object.assign(Fe.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(e=It.euclideanModulo(e,1),t=It.clamp(t,0,1),n=It.clamp(n,0,1),t===0)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=S1(r,i,e+1/3),this.g=S1(r,i,e),this.b=S1(r,i,e-1/3)}return this},setStyle:function(e){function t(i){i!==void 0&&parseFloat(i)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){let i;const r=n[1],o=n[2];switch(r){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){const s=parseFloat(i[1])/360,a=parseInt(i[2],10)/100,c=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(s,a,c)}break}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){const i=n[1],r=i.length;if(r===3)return this.r=parseInt(i.charAt(0)+i.charAt(0),16)/255,this.g=parseInt(i.charAt(1)+i.charAt(1),16)/255,this.b=parseInt(i.charAt(2)+i.charAt(2),16)/255,this;if(r===6)return this.r=parseInt(i.charAt(0)+i.charAt(1),16)/255,this.g=parseInt(i.charAt(2)+i.charAt(3),16)/255,this.b=parseInt(i.charAt(4)+i.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this},setColorName:function(e){const t=LP[e];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return t===void 0&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){t===void 0&&(t=2);const n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=M1(e.r),this.g=M1(e.g),this.b=M1(e.b),this},copyLinearToSRGB:function(e){return this.r=A1(e.r),this.g=A1(e.g),this.b=A1(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){e===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});const t=this.r,n=this.g,i=this.b,r=Math.max(t,n,i),o=Math.min(t,n,i);let s,a;const c=(o+r)/2;if(o===r)s=0,a=0;else{const l=r-o;switch(a=c<=.5?l/(r+o):l/(2-r-o),r){case t:s=(n-i)/l+(n<i?6:0);break;case n:s=(i-t)/l+2;break;case i:s=(t-n)/l+4;break}s/=6}return e.h=s,e.s=a,e.l=c,e},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(e,t,n){return this.getHSL(Hr),Hr.h+=e,Hr.s+=t,Hr.l+=n,this.setHSL(Hr.h,Hr.s,Hr.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(Hr),e.getHSL(Zp);const n=It.lerp(Hr.h,Zp.h,t),i=It.lerp(Hr.s,Zp.s,t),r=It.lerp(Hr.l,Zp.l,t);return this.setHSL(n,i,r),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return t===void 0&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},fromBufferAttribute:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this},toJSON:function(){return this.getHex()}});Fe.NAMES=LP;function oc(e,t,n,i,r,o){this.a=e,this.b=t,this.c=n,this.normal=i&&i.isVector3?i:new T,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new Fe,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=o!==void 0?o:0}Object.assign(oc.prototype,{clone:function(){return new this.constructor().copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});let nO=0;function bt(){Object.defineProperty(this,"id",{value:nO++}),this.uuid=It.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=ma,this.side=Iu,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=SP,this.blendDst=MP,this.blendEquation=sl,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Kv,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=HR,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=h1,this.stencilZFail=h1,this.stencilZPass=h1,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}bt.prototype=Object.assign(Object.create(Es.prototype),{constructor:bt,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===wP;continue}const i=this[t];if(i===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}},toJSON:function(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,this.combine!==void 0&&(n.combine=this.combine),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.size!==void 0&&(n.size=this.size),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==ma&&(n.blending=this.blending),this.flatShading===!0&&(n.flatShading=this.flatShading),this.side!==Iu&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(n.morphTargets=!0),this.morphNormals===!0&&(n.morphNormals=!0),this.skinning===!0&&(n.skinning=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function i(r){const o=[];for(const s in r){const a=r[s];delete a.metadata,o.push(a)}return o}if(t){const r=i(e.textures),o=i(e.images);r.length>0&&(n.textures=r),o.length>0&&(n.images=o)}return n},clone:function(){return new this.constructor().copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const i=t.length;n=new Array(i);for(let r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Object.defineProperty(bt.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}});function lo(e){bt.call(this),this.type="MeshBasicMaterial",this.color=new Fe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=p0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}lo.prototype=Object.create(bt.prototype);lo.prototype.constructor=lo;lo.prototype.isMeshBasicMaterial=!0;lo.prototype.copy=function(e){return bt.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};const mn=new T,Kp=new Ee;function rt(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n===!0,this.usage=m0,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(rt.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}});Object.assign(rt.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let o=e[i];o===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),o=new Fe),t[n++]=o.r,t[n++]=o.g,t[n++]=o.b}return this},copyVector2sArray:function(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let o=e[i];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),o=new Ee),t[n++]=o.x,t[n++]=o.y}return this},copyVector3sArray:function(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let o=e[i];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),o=new T),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z}return this},copyVector4sArray:function(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let o=e[i];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),o=new on),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z,t[n++]=o.w}return this},applyMatrix3:function(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)Kp.fromBufferAttribute(this,t),Kp.applyMatrix3(e),this.setXY(t,Kp.x,Kp.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)mn.fromBufferAttribute(this,t),mn.applyMatrix3(e),this.setXYZ(t,mn.x,mn.y,mn.z);return this},applyMatrix4:function(e){for(let t=0,n=this.count;t<n;t++)mn.x=this.getX(t),mn.y=this.getY(t),mn.z=this.getZ(t),mn.applyMatrix4(e),this.setXYZ(t,mn.x,mn.y,mn.z);return this},applyNormalMatrix:function(e){for(let t=0,n=this.count;t<n;t++)mn.x=this.getX(t),mn.y=this.getY(t),mn.z=this.getZ(t),mn.applyNormalMatrix(e),this.setXYZ(t,mn.x,mn.y,mn.z);return this},transformDirection:function(e){for(let t=0,n=this.count;t<n;t++)mn.x=this.getX(t),mn.y=this.getY(t),mn.z=this.getZ(t),mn.transformDirection(e),this.setXYZ(t,mn.x,mn.y,mn.z);return this},set:function(e,t){return t===void 0&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}});function ex(e,t,n){rt.call(this,new Int8Array(e),t,n)}ex.prototype=Object.create(rt.prototype);ex.prototype.constructor=ex;function tx(e,t,n){rt.call(this,new Uint8Array(e),t,n)}tx.prototype=Object.create(rt.prototype);tx.prototype.constructor=tx;function nx(e,t,n){rt.call(this,new Uint8ClampedArray(e),t,n)}nx.prototype=Object.create(rt.prototype);nx.prototype.constructor=nx;function ix(e,t,n){rt.call(this,new Int16Array(e),t,n)}ix.prototype=Object.create(rt.prototype);ix.prototype.constructor=ix;function Mf(e,t,n){rt.call(this,new Uint16Array(e),t,n)}Mf.prototype=Object.create(rt.prototype);Mf.prototype.constructor=Mf;function rx(e,t,n){rt.call(this,new Int32Array(e),t,n)}rx.prototype=Object.create(rt.prototype);rx.prototype.constructor=rx;function Af(e,t,n){rt.call(this,new Uint32Array(e),t,n)}Af.prototype=Object.create(rt.prototype);Af.prototype.constructor=Af;function Xe(e,t,n){rt.call(this,new Float32Array(e),t,n)}Xe.prototype=Object.create(rt.prototype);Xe.prototype.constructor=Xe;function ox(e,t,n){rt.call(this,new Float64Array(e),t,n)}ox.prototype=Object.create(rt.prototype);ox.prototype.constructor=ox;function RP(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}Object.assign(RP.prototype,{computeGroups:function(e){const t=[];let n,i,r;const o=e.faces;for(i=0;i<o.length;i++){const s=o[i];s.materialIndex!==r&&(r=s.materialIndex,n!==void 0&&(n.count=i*3-n.start,t.push(n)),n={start:i*3,materialIndex:r})}n!==void 0&&(n.count=i*3-n.start,t.push(n)),this.groups=t},fromGeometry:function(e){const t=e.faces,n=e.vertices,i=e.faceVertexUvs,r=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=e.morphTargets,a=s.length;let c;if(a>0){c=[];for(let v=0;v<a;v++)c[v]={name:s[v].name,data:[]};this.morphTargets.position=c}const l=e.morphNormals,u=l.length;let h;if(u>0){h=[];for(let v=0;v<u;v++)h[v]={name:l[v].name,data:[]};this.morphTargets.normal=h}const f=e.skinIndices,p=e.skinWeights,m=f.length===n.length,y=p.length===n.length;n.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let v=0;v<t.length;v++){const d=t[v];this.vertices.push(n[d.a],n[d.b],n[d.c]);const g=d.vertexNormals;if(g.length===3)this.normals.push(g[0],g[1],g[2]);else{const x=d.normal;this.normals.push(x,x,x)}const b=d.vertexColors;if(b.length===3)this.colors.push(b[0],b[1],b[2]);else{const x=d.color;this.colors.push(x,x,x)}if(r===!0){const x=i[0][v];x!==void 0?this.uvs.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",v),this.uvs.push(new Ee,new Ee,new Ee))}if(o===!0){const x=i[1][v];x!==void 0?this.uvs2.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",v),this.uvs2.push(new Ee,new Ee,new Ee))}for(let x=0;x<a;x++){const _=s[x].vertices;c[x].data.push(_[d.a],_[d.b],_[d.c])}for(let x=0;x<u;x++){const _=l[x].vertexNormals[v];h[x].data.push(_.a,_.b,_.c)}m&&this.skinIndices.push(f[d.a],f[d.b],f[d.c]),y&&this.skinWeights.push(p[d.a],p[d.b],p[d.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}});function OP(e){if(e.length===0)return-1/0;let t=e[0];for(let n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}let iO=1;const vo=new De,C1=new je,Hc=new T,rr=new hn,ih=new hn,ni=new T;function We(){Object.defineProperty(this,"id",{value:iO+=2}),this.uuid=It.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}We.prototype=Object.assign(Object.create(Es.prototype),{constructor:We,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(OP(e)>65535?Af:Mf)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:n!==void 0?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const r=new di().getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(e){return vo.makeRotationX(e),this.applyMatrix4(vo),this},rotateY:function(e){return vo.makeRotationY(e),this.applyMatrix4(vo),this},rotateZ:function(e){return vo.makeRotationZ(e),this.applyMatrix4(vo),this},translate:function(e,t,n){return vo.makeTranslation(e,t,n),this.applyMatrix4(vo),this},scale:function(e,t,n){return vo.makeScale(e,t,n),this.applyMatrix4(vo),this},lookAt:function(e){return C1.lookAt(e),C1.updateMatrix(),this.applyMatrix4(C1.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Hc).negate(),this.translate(Hc.x,Hc.y,Hc.z),this},setFromObject:function(e){const t=e.geometry;if(e.isPoints||e.isLine){const n=new Xe(t.vertices.length*3,3),i=new Xe(t.colors.length*3,3);if(this.setAttribute("position",n.copyVector3sArray(t.vertices)),this.setAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){const r=new Xe(t.lineDistances.length,1);this.setAttribute("lineDistance",r.copyArray(t.lineDistances))}t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){const t=[];for(let n=0,i=e.length;n<i;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Xe(t,3)),this},updateFromObject:function(e){let t=e.geometry;if(e.isMesh){let n=t.__directGeometry;if(t.elementsNeedUpdate===!0&&(n=void 0,t.elementsNeedUpdate=!1),n===void 0)return this.fromGeometry(t);n.verticesNeedUpdate=t.verticesNeedUpdate,n.normalsNeedUpdate=t.normalsNeedUpdate,n.colorsNeedUpdate=t.colorsNeedUpdate,n.uvsNeedUpdate=t.uvsNeedUpdate,n.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=n}if(t.verticesNeedUpdate===!0){const n=this.attributes.position;n!==void 0&&(n.copyVector3sArray(t.vertices),n.needsUpdate=!0),t.verticesNeedUpdate=!1}if(t.normalsNeedUpdate===!0){const n=this.attributes.normal;n!==void 0&&(n.copyVector3sArray(t.normals),n.needsUpdate=!0),t.normalsNeedUpdate=!1}if(t.colorsNeedUpdate===!0){const n=this.attributes.color;n!==void 0&&(n.copyColorsArray(t.colors),n.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.uvsNeedUpdate){const n=this.attributes.uv;n!==void 0&&(n.copyVector2sArray(t.uvs),n.needsUpdate=!0),t.uvsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){const n=this.attributes.lineDistance;n!==void 0&&(n.copyArray(t.lineDistances),n.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=new RP().fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){const t=new Float32Array(e.vertices.length*3);if(this.setAttribute("position",new rt(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){const n=new Float32Array(e.normals.length*3);this.setAttribute("normal",new rt(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){const n=new Float32Array(e.colors.length*3);this.setAttribute("color",new rt(n,3).copyColorsArray(e.colors))}if(e.uvs.length>0){const n=new Float32Array(e.uvs.length*2);this.setAttribute("uv",new rt(n,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){const n=new Float32Array(e.uvs2.length*2);this.setAttribute("uv2",new rt(n,2).copyVector2sArray(e.uvs2))}this.groups=e.groups;for(const n in e.morphTargets){const i=[],r=e.morphTargets[n];for(let o=0,s=r.length;o<s;o++){const a=r[o],c=new Xe(a.data.length*3,3);c.name=a.name,i.push(c.copyVector3sArray(a.data))}this.morphAttributes[n]=i}if(e.skinIndices.length>0){const n=new Xe(e.skinIndices.length*4,4);this.setAttribute("skinIndex",n.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){const n=new Xe(e.skinWeights.length*4,4);this.setAttribute("skinWeight",n.copyVector4sArray(e.skinWeights))}return e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new hn);const e=this.attributes.position,t=this.morphAttributes.position;if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const r=t[n];rr.setFromBufferAttribute(r),this.morphTargetsRelative?(ni.addVectors(this.boundingBox.min,rr.min),this.boundingBox.expandByPoint(ni),ni.addVectors(this.boundingBox.max,rr.max),this.boundingBox.expandByPoint(ni)):(this.boundingBox.expandByPoint(rr.min),this.boundingBox.expandByPoint(rr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new Is);const e=this.attributes.position,t=this.morphAttributes.position;if(e){const n=this.boundingSphere.center;if(rr.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const s=t[r];ih.setFromBufferAttribute(s),this.morphTargetsRelative?(ni.addVectors(rr.min,ih.min),rr.expandByPoint(ni),ni.addVectors(rr.max,ih.max),rr.expandByPoint(ni)):(rr.expandByPoint(ih.min),rr.expandByPoint(ih.max))}rr.getCenter(n);let i=0;for(let r=0,o=e.count;r<o;r++)ni.fromBufferAttribute(e,r),i=Math.max(i,n.distanceToSquared(ni));if(t)for(let r=0,o=t.length;r<o;r++){const s=t[r],a=this.morphTargetsRelative;for(let c=0,l=s.count;c<l;c++)ni.fromBufferAttribute(s,c),a&&(Hc.fromBufferAttribute(e,c),ni.add(Hc)),i=Math.max(i,n.distanceToSquared(ni))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new rt(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let h=0,f=n.count;h<f;h++)n.setXYZ(h,0,0,0);const i=new T,r=new T,o=new T,s=new T,a=new T,c=new T,l=new T,u=new T;if(e)for(let h=0,f=e.count;h<f;h+=3){const p=e.getX(h+0),m=e.getX(h+1),y=e.getX(h+2);i.fromBufferAttribute(t,p),r.fromBufferAttribute(t,m),o.fromBufferAttribute(t,y),l.subVectors(o,r),u.subVectors(i,r),l.cross(u),s.fromBufferAttribute(n,p),a.fromBufferAttribute(n,m),c.fromBufferAttribute(n,y),s.add(l),a.add(l),c.add(l),n.setXYZ(p,s.x,s.y,s.z),n.setXYZ(m,a.x,a.y,a.z),n.setXYZ(y,c.x,c.y,c.z)}else for(let h=0,f=t.count;h<f;h+=3)i.fromBufferAttribute(t,h+0),r.fromBufferAttribute(t,h+1),o.fromBufferAttribute(t,h+2),l.subVectors(o,r),u.subVectors(i,r),l.cross(u),n.setXYZ(h+0,l.x,l.y,l.z),n.setXYZ(h+1,l.x,l.y,l.z),n.setXYZ(h+2,l.x,l.y,l.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(e.attributes[i]===void 0)continue;const o=n[i].array,s=e.attributes[i],a=s.array,c=s.itemSize*t,l=Math.min(a.length,o.length-c);for(let u=0,h=c;u<l;u++,h++)o[h]=a[u]}return this},normalizeNormals:function(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)ni.fromBufferAttribute(e,t),ni.normalize(),e.setXYZ(t,ni.x,ni.y,ni.z)},toNonIndexed:function(){function e(s,a){const c=s.array,l=s.itemSize,u=s.normalized,h=new c.constructor(a.length*l);let f=0,p=0;for(let m=0,y=a.length;m<y;m++){f=a[m]*l;for(let v=0;v<l;v++)h[p++]=c[f++]}return new rt(h,l,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const t=new We,n=this.index.array,i=this.attributes;for(const s in i){const a=i[s],c=e(a,n);t.setAttribute(s,c)}const r=this.morphAttributes;for(const s in r){const a=[],c=r[s];for(let l=0,u=c.length;l<u;l++){const h=c[l],f=e(h,n);a.push(f)}t.morphAttributes[s]=a}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let s=0,a=o.length;s<a;s++){const c=o[s];t.addGroup(c.start,c.count,c.materialIndex)}return t},toJSON:function(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const a=this.parameters;for(const c in a)a[c]!==void 0&&(e[c]=a[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const a in n){const c=n[a],l=c.toJSON(e.data);c.name!==""&&(l.name=c.name),e.data.attributes[a]=l}const i={};let r=!1;for(const a in this.morphAttributes){const c=this.morphAttributes[a],l=[];for(let u=0,h=c.length;u<h;u++){const f=c[u],p=f.toJSON(e.data);f.name!==""&&(p.name=f.name),l.push(p)}l.length>0&&(i[a]=l,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return s!==null&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e},clone:function(){return new We().copy(this)},copy:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const i=e.attributes;for(const c in i){const l=i[c];this.setAttribute(c,l.clone(t))}const r=e.morphAttributes;for(const c in r){const l=[],u=r[c];for(let h=0,f=u.length;h<f;h++)l.push(u[h].clone(t));this.morphAttributes[c]=l}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,l=o.length;c<l;c++){const u=o[c];this.addGroup(u.start,u.count,u.materialIndex)}const s=e.boundingBox;s!==null&&(this.boundingBox=s.clone());const a=e.boundingSphere;return a!==null&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const Pw=new De,Ga=new Ru,P1=new Is,$s=new T,Vs=new T,Hs=new T,T1=new T,E1=new T,I1=new T,Qp=new T,Jp=new T,ed=new T,Il=new Ee,Ll=new Ee,Rl=new Ee,Wh=new T,td=new T;function pn(e,t){je.call(this),this.type="Mesh",this.geometry=e!==void 0?e:new We,this.material=t!==void 0?t:new lo,this.updateMorphTargets()}pn.prototype=Object.assign(Object.create(je.prototype),{constructor:pn,isMesh:!0,copy:function(e){return je.prototype.copy.call(this,e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(i===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),P1.copy(n.boundingSphere),P1.applyMatrix4(r),e.ray.intersectsSphere(P1)===!1)||(Pw.getInverse(r),Ga.copy(e.ray).applyMatrix4(Pw),n.boundingBox!==null&&Ga.intersectsBox(n.boundingBox)===!1))return;let o;if(n.isBufferGeometry){const s=n.index,a=n.attributes.position,c=n.morphAttributes.position,l=n.morphTargetsRelative,u=n.attributes.uv,h=n.attributes.uv2,f=n.groups,p=n.drawRange;if(s!==null)if(Array.isArray(i))for(let m=0,y=f.length;m<y;m++){const v=f[m],d=i[v.materialIndex],g=Math.max(v.start,p.start),b=Math.min(v.start+v.count,p.start+p.count);for(let x=g,_=b;x<_;x+=3){const S=s.getX(x),w=s.getX(x+1),C=s.getX(x+2);o=nd(this,d,e,Ga,a,c,l,u,h,S,w,C),o&&(o.faceIndex=Math.floor(x/3),o.face.materialIndex=v.materialIndex,t.push(o))}}else{const m=Math.max(0,p.start),y=Math.min(s.count,p.start+p.count);for(let v=m,d=y;v<d;v+=3){const g=s.getX(v),b=s.getX(v+1),x=s.getX(v+2);o=nd(this,i,e,Ga,a,c,l,u,h,g,b,x),o&&(o.faceIndex=Math.floor(v/3),t.push(o))}}else if(a!==void 0)if(Array.isArray(i))for(let m=0,y=f.length;m<y;m++){const v=f[m],d=i[v.materialIndex],g=Math.max(v.start,p.start),b=Math.min(v.start+v.count,p.start+p.count);for(let x=g,_=b;x<_;x+=3){const S=x,w=x+1,C=x+2;o=nd(this,d,e,Ga,a,c,l,u,h,S,w,C),o&&(o.faceIndex=Math.floor(x/3),o.face.materialIndex=v.materialIndex,t.push(o))}}else{const m=Math.max(0,p.start),y=Math.min(a.count,p.start+p.count);for(let v=m,d=y;v<d;v+=3){const g=v,b=v+1,x=v+2;o=nd(this,i,e,Ga,a,c,l,u,h,g,b,x),o&&(o.faceIndex=Math.floor(v/3),t.push(o))}}}else if(n.isGeometry){const s=Array.isArray(i),a=n.vertices,c=n.faces;let l;const u=n.faceVertexUvs[0];u.length>0&&(l=u);for(let h=0,f=c.length;h<f;h++){const p=c[h],m=s?i[p.materialIndex]:i;if(m===void 0)continue;const y=a[p.a],v=a[p.b],d=a[p.c];if(o=kP(this,m,e,Ga,y,v,d,Wh),o){if(l&&l[h]){const g=l[h];Il.copy(g[0]),Ll.copy(g[1]),Rl.copy(g[2]),o.uv=pi.getUV(Wh,y,v,d,Il,Ll,Rl,new Ee)}o.face=p,o.faceIndex=h,t.push(o)}}}}});function kP(e,t,n,i,r,o,s,a){let c;if(t.side===Kn?c=i.intersectTriangle(s,o,r,!0,a):c=i.intersectTriangle(r,o,s,t.side!==mp,a),c===null)return null;td.copy(a),td.applyMatrix4(e.matrixWorld);const l=n.ray.origin.distanceTo(td);return l<n.near||l>n.far?null:{distance:l,point:td.clone(),object:e}}function nd(e,t,n,i,r,o,s,a,c,l,u,h){$s.fromBufferAttribute(r,l),Vs.fromBufferAttribute(r,u),Hs.fromBufferAttribute(r,h);const f=e.morphTargetInfluences;if(t.morphTargets&&o&&f){Qp.set(0,0,0),Jp.set(0,0,0),ed.set(0,0,0);for(let m=0,y=o.length;m<y;m++){const v=f[m],d=o[m];v!==0&&(T1.fromBufferAttribute(d,l),E1.fromBufferAttribute(d,u),I1.fromBufferAttribute(d,h),s?(Qp.addScaledVector(T1,v),Jp.addScaledVector(E1,v),ed.addScaledVector(I1,v)):(Qp.addScaledVector(T1.sub($s),v),Jp.addScaledVector(E1.sub(Vs),v),ed.addScaledVector(I1.sub(Hs),v)))}$s.add(Qp),Vs.add(Jp),Hs.add(ed)}e.isSkinnedMesh&&(e.boneTransform(l,$s),e.boneTransform(u,Vs),e.boneTransform(h,Hs));const p=kP(e,t,n,i,$s,Vs,Hs,Wh);if(p){a&&(Il.fromBufferAttribute(a,l),Ll.fromBufferAttribute(a,u),Rl.fromBufferAttribute(a,h),p.uv=pi.getUV(Wh,$s,Vs,Hs,Il,Ll,Rl,new Ee)),c&&(Il.fromBufferAttribute(c,l),Ll.fromBufferAttribute(c,u),Rl.fromBufferAttribute(c,h),p.uv2=pi.getUV(Wh,$s,Vs,Hs,Il,Ll,Rl,new Ee));const m=new oc(l,u,h);pi.getNormal($s,Vs,Hs,m.normal),p.face=m}return p}let rO=0;const xo=new De,L1=new je,id=new T;function dt(){Object.defineProperty(this,"id",{value:rO+=2}),this.uuid=It.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}dt.prototype=Object.assign(Object.create(Es.prototype),{constructor:dt,isGeometry:!0,applyMatrix4:function(e){const t=new di().getNormalMatrix(e);for(let n=0,i=this.vertices.length;n<i;n++)this.vertices[n].applyMatrix4(e);for(let n=0,i=this.faces.length;n<i;n++){const r=this.faces[n];r.normal.applyMatrix3(t).normalize();for(let o=0,s=r.vertexNormals.length;o<s;o++)r.vertexNormals[o].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return xo.makeRotationX(e),this.applyMatrix4(xo),this},rotateY:function(e){return xo.makeRotationY(e),this.applyMatrix4(xo),this},rotateZ:function(e){return xo.makeRotationZ(e),this.applyMatrix4(xo),this},translate:function(e,t,n){return xo.makeTranslation(e,t,n),this.applyMatrix4(xo),this},scale:function(e,t,n){return xo.makeScale(e,t,n),this.applyMatrix4(xo),this},lookAt:function(e){return L1.lookAt(e),L1.updateMatrix(),this.applyMatrix4(L1.matrix),this},fromBufferGeometry:function(e){const t=this,n=e.index!==null?e.index:void 0,i=e.attributes;if(i.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const r=i.position,o=i.normal,s=i.color,a=i.uv,c=i.uv2;c!==void 0&&(this.faceVertexUvs[1]=[]);for(let h=0;h<r.count;h++)t.vertices.push(new T().fromBufferAttribute(r,h)),s!==void 0&&t.colors.push(new Fe().fromBufferAttribute(s,h));function l(h,f,p,m){const y=s===void 0?[]:[t.colors[h].clone(),t.colors[f].clone(),t.colors[p].clone()],v=o===void 0?[]:[new T().fromBufferAttribute(o,h),new T().fromBufferAttribute(o,f),new T().fromBufferAttribute(o,p)],d=new oc(h,f,p,v,y,m);t.faces.push(d),a!==void 0&&t.faceVertexUvs[0].push([new Ee().fromBufferAttribute(a,h),new Ee().fromBufferAttribute(a,f),new Ee().fromBufferAttribute(a,p)]),c!==void 0&&t.faceVertexUvs[1].push([new Ee().fromBufferAttribute(c,h),new Ee().fromBufferAttribute(c,f),new Ee().fromBufferAttribute(c,p)])}const u=e.groups;if(u.length>0)for(let h=0;h<u.length;h++){const f=u[h],p=f.start,m=f.count;for(let y=p,v=p+m;y<v;y+=3)n!==void 0?l(n.getX(y),n.getX(y+1),n.getX(y+2),f.materialIndex):l(y,y+1,y+2,f.materialIndex)}else if(n!==void 0)for(let h=0;h<n.count;h+=3)l(n.getX(h),n.getX(h+1),n.getX(h+2));else for(let h=0;h<r.count;h+=3)l(h,h+1,h+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(id).negate(),this.translate(id.x,id.y,id.z),this},normalize:function(){this.computeBoundingSphere();const e=this.boundingSphere.center,t=this.boundingSphere.radius,n=t===0?1:1/t,i=new De;return i.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(i),this},computeFaceNormals:function(){const e=new T,t=new T;for(let n=0,i=this.faces.length;n<i;n++){const r=this.faces[n],o=this.vertices[r.a],s=this.vertices[r.b],a=this.vertices[r.c];e.subVectors(a,s),t.subVectors(o,s),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e){e===void 0&&(e=!0);const t=new Array(this.vertices.length);for(let n=0,i=this.vertices.length;n<i;n++)t[n]=new T;if(e){const n=new T,i=new T;for(let r=0,o=this.faces.length;r<o;r++){const s=this.faces[r],a=this.vertices[s.a],c=this.vertices[s.b],l=this.vertices[s.c];n.subVectors(l,c),i.subVectors(a,c),n.cross(i),t[s.a].add(n),t[s.b].add(n),t[s.c].add(n)}}else{this.computeFaceNormals();for(let n=0,i=this.faces.length;n<i;n++){const r=this.faces[n];t[r.a].add(r.normal),t[r.b].add(r.normal),t[r.c].add(r.normal)}}for(let n=0,i=this.vertices.length;n<i;n++)t[n].normalize();for(let n=0,i=this.faces.length;n<i;n++){const r=this.faces[n],o=r.vertexNormals;o.length===3?(o[0].copy(t[r.a]),o[1].copy(t[r.b]),o[2].copy(t[r.c])):(o[0]=t[r.a].clone(),o[1]=t[r.b].clone(),o[2]=t[r.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){const n=this.faces[e],i=n.vertexNormals;i.length===3?(i[0].copy(n.normal),i[1].copy(n.normal),i[2].copy(n.normal)):(i[0]=n.normal.clone(),i[1]=n.normal.clone(),i[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let t=0,n=this.faces.length;t<n;t++){const i=this.faces[t];i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]);for(let r=0,o=i.vertexNormals.length;r<o;r++)i.__originalVertexNormals[r]?i.__originalVertexNormals[r].copy(i.vertexNormals[r]):i.__originalVertexNormals[r]=i.vertexNormals[r].clone()}const e=new dt;e.faces=this.faces;for(let t=0,n=this.morphTargets.length;t<n;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];const r=this.morphNormals[t].faceNormals,o=this.morphNormals[t].vertexNormals;for(let s=0,a=this.faces.length;s<a;s++){const c=new T,l={a:new T,b:new T,c:new T};r.push(c),o.push(l)}}const i=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let r=0,o=this.faces.length;r<o;r++){const s=this.faces[r],a=i.faceNormals[r],c=i.vertexNormals[r];a.copy(s.normal),c.a.copy(s.vertexNormals[0]),c.b.copy(s.vertexNormals[1]),c.c.copy(s.vertexNormals[2])}}for(let t=0,n=this.faces.length;t<n;t++){const i=this.faces[t];i.normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals}},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new hn),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new Is),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let i,r=this.vertices.length,o=this.vertices,s=e.vertices,a=this.faces,c=e.faces,l=this.colors,u=e.colors;n===void 0&&(n=0),t!==void 0&&(i=new di().getNormalMatrix(t));for(let h=0,f=s.length;h<f;h++){const m=s[h].clone();t!==void 0&&m.applyMatrix4(t),o.push(m)}for(let h=0,f=u.length;h<f;h++)l.push(u[h].clone());for(let h=0,f=c.length;h<f;h++){let p=c[h],m,y,v,d=p.vertexNormals,g=p.vertexColors;m=new oc(p.a+r,p.b+r,p.c+r),m.normal.copy(p.normal),i!==void 0&&m.normal.applyMatrix3(i).normalize();for(let b=0,x=d.length;b<x;b++)y=d[b].clone(),i!==void 0&&y.applyMatrix3(i).normalize(),m.vertexNormals.push(y);m.color.copy(p.color);for(let b=0,x=g.length;b<x;b++)v=g[b],m.vertexColors.push(v.clone());m.materialIndex=p.materialIndex+n,a.push(m)}for(let h=0,f=e.faceVertexUvs.length;h<f;h++){const p=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let m=0,y=p.length;m<y;m++){const v=p[m],d=[];for(let g=0,b=v.length;g<b;g++)d.push(v[g].clone());this.faceVertexUvs[h].push(d)}}},mergeMesh:function(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)},mergeVertices:function(){const e={},t=[],n=[],r=Math.pow(10,4);for(let a=0,c=this.vertices.length;a<c;a++){const l=this.vertices[a],u=Math.round(l.x*r)+"_"+Math.round(l.y*r)+"_"+Math.round(l.z*r);e[u]===void 0?(e[u]=a,t.push(this.vertices[a]),n[a]=t.length-1):n[a]=n[e[u]]}const o=[];for(let a=0,c=this.faces.length;a<c;a++){const l=this.faces[a];l.a=n[l.a],l.b=n[l.b],l.c=n[l.c];const u=[l.a,l.b,l.c];for(let h=0;h<3;h++)if(u[h]===u[(h+1)%3]){o.push(a);break}}for(let a=o.length-1;a>=0;a--){const c=o[a];this.faces.splice(c,1);for(let l=0,u=this.faceVertexUvs.length;l<u;l++)this.faceVertexUvs[l].splice(c,1)}const s=this.vertices.length-t.length;return this.vertices=t,s},setFromPoints:function(e){this.vertices=[];for(let t=0,n=e.length;t<n;t++){const i=e[t];this.vertices.push(new T(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){const e=this.faces,t=e.length;for(let a=0;a<t;a++)e[a]._id=a;function n(a,c){return a.materialIndex-c.materialIndex}e.sort(n);const i=this.faceVertexUvs[0],r=this.faceVertexUvs[1];let o,s;i&&i.length===t&&(o=[]),r&&r.length===t&&(s=[]);for(let a=0;a<t;a++){const c=e[a]._id;o&&o.push(i[c]),s&&s.push(r[c])}o&&(this.faceVertexUvs[0]=o),s&&(this.faceVertexUvs[1]=s)},toJSON:function(){const e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){const p=this.parameters;for(const m in p)p[m]!==void 0&&(e[m]=p[m]);return e}const t=[];for(let p=0;p<this.vertices.length;p++){const m=this.vertices[p];t.push(m.x,m.y,m.z)}const n=[],i=[],r={},o=[],s={},a=[],c={};for(let p=0;p<this.faces.length;p++){const m=this.faces[p],y=!0,v=!1,d=this.faceVertexUvs[0][p]!==void 0,g=m.normal.length()>0,b=m.vertexNormals.length>0,x=m.color.r!==1||m.color.g!==1||m.color.b!==1,_=m.vertexColors.length>0;let S=0;if(S=l(S,0,0),S=l(S,1,y),S=l(S,2,v),S=l(S,3,d),S=l(S,4,g),S=l(S,5,b),S=l(S,6,x),S=l(S,7,_),n.push(S),n.push(m.a,m.b,m.c),n.push(m.materialIndex),d){const w=this.faceVertexUvs[0][p];n.push(f(w[0]),f(w[1]),f(w[2]))}if(g&&n.push(u(m.normal)),b){const w=m.vertexNormals;n.push(u(w[0]),u(w[1]),u(w[2]))}if(x&&n.push(h(m.color)),_){const w=m.vertexColors;n.push(h(w[0]),h(w[1]),h(w[2]))}}function l(p,m,y){return y?p|1<<m:p&~(1<<m)}function u(p){const m=p.x.toString()+p.y.toString()+p.z.toString();return r[m]!==void 0||(r[m]=i.length/3,i.push(p.x,p.y,p.z)),r[m]}function h(p){const m=p.r.toString()+p.g.toString()+p.b.toString();return s[m]!==void 0||(s[m]=o.length,o.push(p.getHex())),s[m]}function f(p){const m=p.x.toString()+p.y.toString();return c[m]!==void 0||(c[m]=a.length/2,a.push(p.x,p.y)),c[m]}return e.data={},e.data.vertices=t,e.data.normals=i,o.length>0&&(e.data.colors=o),a.length>0&&(e.data.uvs=[a]),e.data.faces=n,e},clone:function(){return new dt().copy(this)},copy:function(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;const t=e.vertices;for(let h=0,f=t.length;h<f;h++)this.vertices.push(t[h].clone());const n=e.colors;for(let h=0,f=n.length;h<f;h++)this.colors.push(n[h].clone());const i=e.faces;for(let h=0,f=i.length;h<f;h++)this.faces.push(i[h].clone());for(let h=0,f=e.faceVertexUvs.length;h<f;h++){const p=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let m=0,y=p.length;m<y;m++){const v=p[m],d=[];for(let g=0,b=v.length;g<b;g++){const x=v[g];d.push(x.clone())}this.faceVertexUvs[h].push(d)}}const r=e.morphTargets;for(let h=0,f=r.length;h<f;h++){const p={};if(p.name=r[h].name,r[h].vertices!==void 0){p.vertices=[];for(let m=0,y=r[h].vertices.length;m<y;m++)p.vertices.push(r[h].vertices[m].clone())}if(r[h].normals!==void 0){p.normals=[];for(let m=0,y=r[h].normals.length;m<y;m++)p.normals.push(r[h].normals[m].clone())}this.morphTargets.push(p)}const o=e.morphNormals;for(let h=0,f=o.length;h<f;h++){const p={};if(o[h].vertexNormals!==void 0){p.vertexNormals=[];for(let m=0,y=o[h].vertexNormals.length;m<y;m++){const v=o[h].vertexNormals[m],d={};d.a=v.a.clone(),d.b=v.b.clone(),d.c=v.c.clone(),p.vertexNormals.push(d)}}if(o[h].faceNormals!==void 0){p.faceNormals=[];for(let m=0,y=o[h].faceNormals.length;m<y;m++)p.faceNormals.push(o[h].faceNormals[m].clone())}this.morphNormals.push(p)}const s=e.skinWeights;for(let h=0,f=s.length;h<f;h++)this.skinWeights.push(s[h].clone());const a=e.skinIndices;for(let h=0,f=a.length;h<f;h++)this.skinIndices.push(a[h].clone());const c=e.lineDistances;for(let h=0,f=c.length;h<f;h++)this.lineDistances.push(c[h]);const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const u=e.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class oO extends dt{constructor(t,n,i,r,o,s){super(),this.type="BoxGeometry",this.parameters={width:t,height:n,depth:i,widthSegments:r,heightSegments:o,depthSegments:s},this.fromBufferGeometry(new vp(t,n,i,r,o,s)),this.mergeVertices()}}class vp extends We{constructor(t,n,i,r,o,s){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:n,depth:i,widthSegments:r,heightSegments:o,depthSegments:s};const a=this;t=t||1,n=n||1,i=i||1,r=Math.floor(r)||1,o=Math.floor(o)||1,s=Math.floor(s)||1;const c=[],l=[],u=[],h=[];let f=0,p=0;m("z","y","x",-1,-1,i,n,t,s,o,0),m("z","y","x",1,-1,i,n,-t,s,o,1),m("x","z","y",1,1,t,i,n,r,s,2),m("x","z","y",1,-1,t,i,-n,r,s,3),m("x","y","z",1,-1,t,n,i,r,o,4),m("x","y","z",-1,-1,t,n,-i,r,o,5),this.setIndex(c),this.setAttribute("position",new Xe(l,3)),this.setAttribute("normal",new Xe(u,3)),this.setAttribute("uv",new Xe(h,2));function m(y,v,d,g,b,x,_,S,w,C,A){const k=x/w,L=_/C,D=x/2,F=_/2,I=S/2,P=w+1,N=C+1;let $=0,B=0;const q=new T;for(let ee=0;ee<N;ee++){const W=ee*L-F;for(let Q=0;Q<P;Q++){const Z=Q*k-D;q[y]=Z*g,q[v]=W*b,q[d]=I,l.push(q.x,q.y,q.z),q[y]=0,q[v]=0,q[d]=S>0?1:-1,u.push(q.x,q.y,q.z),h.push(Q/w),h.push(1-ee/C),$+=1}}for(let ee=0;ee<C;ee++)for(let W=0;W<w;W++){const Q=f+W+P*ee,Z=f+W+P*(ee+1),re=f+(W+1)+P*(ee+1),he=f+(W+1)+P*ee;c.push(Q,Z,he),c.push(Z,re,he),B+=6}a.addGroup(p,B,A),p+=B,f+=$}}}function ou(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function wi(e){const t={};for(let n=0;n<e.length;n++){const i=ou(e[n]);for(const r in i)t[r]=i[r]}return t}const rg={clone:ou,merge:wi};var sO=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,aO=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;function ti(e){bt.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=sO,this.fragmentShader=aO,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}ti.prototype=Object.create(bt.prototype);ti.prototype.constructor=ti;ti.prototype.isShaderMaterial=!0;ti.prototype.copy=function(e){return bt.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ou(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this};ti.prototype.toJSON=function(e){const t=bt.prototype.toJSON.call(this,e);t.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?t.uniforms[i]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[i]={type:"m4",value:o.toArray()}:t.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t};function vs(){je.call(this),this.type="Camera",this.matrixWorldInverse=new De,this.projectionMatrix=new De,this.projectionMatrixInverse=new De}vs.prototype=Object.assign(Object.create(je.prototype),{constructor:vs,isCamera:!0,copy:function(e,t){return je.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){e===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new T),this.updateMatrixWorld(!0);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){je.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(e,t){je.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return new this.constructor().copy(this)}});function jn(e,t,n,i){vs.call(this),this.type="PerspectiveCamera",this.fov=e!==void 0?e:50,this.zoom=1,this.near=n!==void 0?n:.1,this.far=i!==void 0?i:2e3,this.focus=10,this.aspect=t!==void 0?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}jn.prototype=Object.assign(Object.create(vs.prototype),{constructor:jn,isPerspectiveCamera:!0,copy:function(e,t){return vs.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){const t=.5*this.getFilmHeight()/e;this.fov=It.RAD2DEG*2*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){const e=Math.tan(It.DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/e},getEffectiveFOV:function(){return It.RAD2DEG*2*Math.atan(Math.tan(It.DEG2RAD*.5*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,i,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){let e=this.near,t=e*Math.tan(It.DEG2RAD*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,o=this.view;if(this.view!==null&&this.view.enabled){const a=o.fullWidth,c=o.fullHeight;r+=o.offsetX*i/a,t-=o.offsetY*n/c,i*=o.width/a,n*=o.height/c}const s=this.filmOffset;s!==0&&(r+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){const t=je.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});const jc=90,Wc=1;function Cf(e,t,n){if(je.call(this),this.type="CubeCamera",n.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=n;const i=new jn(jc,Wc,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new T(1,0,0)),this.add(i);const r=new jn(jc,Wc,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new T(-1,0,0)),this.add(r);const o=new jn(jc,Wc,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new T(0,1,0)),this.add(o);const s=new jn(jc,Wc,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new T(0,-1,0)),this.add(s);const a=new jn(jc,Wc,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new T(0,0,1)),this.add(a);const c=new jn(jc,Wc,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new T(0,0,-1)),this.add(c),this.update=function(l,u){this.parent===null&&this.updateMatrixWorld();const h=l.xr.enabled,f=l.getRenderTarget();l.xr.enabled=!1;const p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,l.setRenderTarget(n,0),l.render(u,i),l.setRenderTarget(n,1),l.render(u,r),l.setRenderTarget(n,2),l.render(u,o),l.setRenderTarget(n,3),l.render(u,s),l.setRenderTarget(n,4),l.render(u,a),n.texture.generateMipmaps=p,l.setRenderTarget(n,5),l.render(u,c),l.setRenderTarget(f),l.xr.enabled=h},this.clear=function(l,u,h,f){const p=l.getRenderTarget();for(let m=0;m<6;m++)l.setRenderTarget(n,m),l.clear(u,h,f);l.setRenderTarget(p)}}Cf.prototype=Object.create(je.prototype);Cf.prototype.constructor=Cf;function Pf(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),zi.call(this,e,e,t)}Pf.prototype=Object.create(zi.prototype);Pf.prototype.constructor=Pf;Pf.prototype.isWebGLCubeRenderTarget=!0;Pf.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;const n=new ru,i={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","	vWorldDirection = transformDirection( position, modelMatrix );","	#include <begin_vertex>","	#include <project_vertex>","}"].join(`
`),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#include <common>","void main() {","	vec3 direction = normalize( vWorldDirection );","	vec2 sampleUV = equirectUv( direction );","	gl_FragColor = texture2D( tEquirect, sampleUV );","}"].join(`
`)},r=new ti({name:"CubemapFromEquirect",uniforms:ou(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Kn,blending:ps});r.uniforms.tEquirect.value=t;const o=new pn(new vp(5,5,5),r);return n.add(o),new Cf(1,10,this).update(e,n),o.geometry.dispose(),o.material.dispose(),this};function xs(e,t,n,i,r,o,s,a,c,l,u,h){dn.call(this,null,o,s,a,c,l,i,r,u,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=c!==void 0?c:ln,this.minFilter=l!==void 0?l:ln,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}xs.prototype=Object.create(dn.prototype);xs.prototype.constructor=xs;xs.prototype.isDataTexture=!0;const qc=new Is,rd=new T;function xp(e,t,n,i,r,o){this.planes=[e!==void 0?e:new Io,t!==void 0?t:new Io,n!==void 0?n:new Io,i!==void 0?i:new Io,r!==void 0?r:new Io,o!==void 0?o:new Io]}Object.assign(xp.prototype,{set:function(e,t,n,i,r,o){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(i),s[4].copy(r),s[5].copy(o),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromProjectionMatrix:function(e){const t=this.planes,n=e.elements,i=n[0],r=n[1],o=n[2],s=n[3],a=n[4],c=n[5],l=n[6],u=n[7],h=n[8],f=n[9],p=n[10],m=n[11],y=n[12],v=n[13],d=n[14],g=n[15];return t[0].setComponents(s-i,u-a,m-h,g-y).normalize(),t[1].setComponents(s+i,u+a,m+h,g+y).normalize(),t[2].setComponents(s+r,u+c,m+f,g+v).normalize(),t[3].setComponents(s-r,u-c,m-f,g-v).normalize(),t[4].setComponents(s-o,u-l,m-p,g-d).normalize(),t[5].setComponents(s+o,u+l,m+p,g+d).normalize(),this},intersectsObject:function(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),qc.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(qc)},intersectsSprite:function(e){return qc.center.set(0,0,0),qc.radius=.7071067811865476,qc.applyMatrix4(e.matrixWorld),this.intersectsSphere(qc)},intersectsSphere:function(e){const t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<i)return!1;return!0},intersectsBox:function(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(rd.x=i.normal.x>0?e.max.x:e.min.x,rd.y=i.normal.y>0?e.max.y:e.min.y,rd.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(rd)<0)return!1}return!0},containsPoint:function(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}});const He={common:{diffuse:{value:new Fe(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new di},uv2Transform:{value:new di},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ee(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Fe(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Fe(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new di}},sprite:{diffuse:{value:new Fe(15658734)},opacity:{value:1},center:{value:new Ee(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new di}}};function DP(){let e=null,t=!1,n=null,i=null;function r(o,s){n(o,s),i=e.requestAnimationFrame(r)}return{start:function(){t!==!0&&n!==null&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(o){n=o},setContext:function(o){e=o}}}function cO(e,t){const n=t.isWebGL2,i=new WeakMap;function r(l,u){const h=l.array,f=l.usage,p=e.createBuffer();e.bindBuffer(u,p),e.bufferData(u,h,f),l.onUploadCallback();let m=5126;return h instanceof Float32Array?m=5126:h instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):h instanceof Uint16Array?m=5123:h instanceof Int16Array?m=5122:h instanceof Uint32Array?m=5125:h instanceof Int32Array?m=5124:h instanceof Int8Array?m=5120:h instanceof Uint8Array&&(m=5121),{buffer:p,type:m,bytesPerElement:h.BYTES_PER_ELEMENT,version:l.version}}function o(l,u,h){const f=u.array,p=u.updateRange;e.bindBuffer(h,l),p.count===-1?e.bufferSubData(h,0,f):(n?e.bufferSubData(h,p.offset*f.BYTES_PER_ELEMENT,f,p.offset,p.count):e.bufferSubData(h,p.offset*f.BYTES_PER_ELEMENT,f.subarray(p.offset,p.offset+p.count)),p.count=-1)}function s(l){return l.isInterleavedBufferAttribute&&(l=l.data),i.get(l)}function a(l){l.isInterleavedBufferAttribute&&(l=l.data);const u=i.get(l);u&&(e.deleteBuffer(u.buffer),i.delete(l))}function c(l,u){l.isInterleavedBufferAttribute&&(l=l.data);const h=i.get(l);h===void 0?i.set(l,r(l,u)):h.version<l.version&&(o(h.buffer,l,u),h.version=l.version)}return{get:s,remove:a,update:c}}function Tf(e,t,n,i){dt.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i},this.fromBufferGeometry(new su(e,t,n,i)),this.mergeVertices()}Tf.prototype=Object.create(dt.prototype);Tf.prototype.constructor=Tf;function su(e,t,n,i){We.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i},e=e||1,t=t||1;const r=e/2,o=t/2,s=Math.floor(n)||1,a=Math.floor(i)||1,c=s+1,l=a+1,u=e/s,h=t/a,f=[],p=[],m=[],y=[];for(let v=0;v<l;v++){const d=v*h-o;for(let g=0;g<c;g++){const b=g*u-r;p.push(b,-d,0),m.push(0,0,1),y.push(g/s),y.push(1-v/a)}}for(let v=0;v<a;v++)for(let d=0;d<s;d++){const g=d+c*v,b=d+c*(v+1),x=d+1+c*(v+1),_=d+1+c*v;f.push(g,b,_),f.push(b,x,_)}this.setIndex(f),this.setAttribute("position",new Xe(p,3)),this.setAttribute("normal",new Xe(m,3)),this.setAttribute("uv",new Xe(y,2))}su.prototype=Object.create(We.prototype);su.prototype.constructor=su;var lO=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,uO=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,hO=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,fO=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,pO=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,dO="vec3 transformed = vec3( position );",mO=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,gO=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE  = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS  = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha  = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,yO=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 );
		fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,vO=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,xO=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,bO=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,_O=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,wO=`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,SO=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,MO=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,AO=`#ifdef USE_COLOR
	vColor.xyz = color.xyz;
#endif`,CO=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
  return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,PO=`#ifdef ENVMAP_TYPE_CUBE_UV
#define cubeUV_maxMipLevel 8.0
#define cubeUV_minMipLevel 4.0
#define cubeUV_maxTileSize 256.0
#define cubeUV_minTileSize 16.0
float getFace(vec3 direction) {
    vec3 absDirection = abs(direction);
    float face = -1.0;
    if (absDirection.x > absDirection.z) {
      if (absDirection.x > absDirection.y)
        face = direction.x > 0.0 ? 0.0 : 3.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    } else {
      if (absDirection.z > absDirection.y)
        face = direction.z > 0.0 ? 2.0 : 5.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    }
    return face;
}
vec2 getUV(vec3 direction, float face) {
    vec2 uv;
    if (face == 0.0) {
      uv = vec2(direction.z, direction.y) / abs(direction.x);    } else if (face == 1.0) {
      uv = vec2(-direction.x, -direction.z) / abs(direction.y);    } else if (face == 2.0) {
      uv = vec2(-direction.x, direction.y) / abs(direction.z);    } else if (face == 3.0) {
      uv = vec2(-direction.z, direction.y) / abs(direction.x);    } else if (face == 4.0) {
      uv = vec2(-direction.x, direction.z) / abs(direction.y);    } else {
      uv = vec2(direction.x, direction.y) / abs(direction.z);    }
    return 0.5 * (uv + 1.0);
}
vec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
  float face = getFace(direction);
  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
  mipInt = max(mipInt, cubeUV_minMipLevel);
  float faceSize = exp2(mipInt);
  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
  vec2 uv = getUV(direction, face) * (faceSize - 1.0);
  vec2 f = fract(uv);
  uv += 0.5 - f;
  if (face > 2.0) {
    uv.y += faceSize;
    face -= 3.0;
  }
  uv.x += face * faceSize;
  if(mipInt < cubeUV_maxMipLevel){
    uv.y += 2.0 * cubeUV_maxTileSize;
  }
  uv.y += filterInt * 2.0 * cubeUV_minTileSize;
  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
  uv *= texelSize;
  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x += texelSize;
  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.y += texelSize;
  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x -= texelSize;
  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  vec3 tm = mix(tl, tr, f.x);
  vec3 bm = mix(bl, br, f.x);
  return mix(tm, bm, f.y);
}
#define r0 1.0
#define v0 0.339
#define m0 -2.0
#define r1 0.8
#define v1 0.276
#define m1 -1.0
#define r4 0.4
#define v4 0.046
#define m4 2.0
#define r5 0.305
#define v5 0.016
#define m5 3.0
#define r6 0.21
#define v6 0.0038
#define m6 4.0
float roughnessToMip(float roughness) {
  float mip = 0.0;
  if (roughness >= r1) {
    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
  } else if (roughness >= r4) {
    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
  } else if (roughness >= r5) {
    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
  } else if (roughness >= r6) {
    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
  } else {
    mip = -2.0 * log2(1.16 * roughness);  }
  return mip;
}
vec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {
  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);
  float mipF = fract(mip);
  float mipInt = floor(mip);
  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);
  if (mipF == 0.0) {
    return vec4(color0, 1.0);
  } else {
    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);
    return vec4(mix(color0, color1, mipF), 1.0);
  }
}
#endif`,TO=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,EO=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,IO=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,LO=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,RO=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,OO="gl_FragColor = linearToOutputTexel( gl_FragColor );",kO=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value )  {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,DO=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		}  else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#elif defined( ENVMAP_TYPE_EQUIREC )
		reflectVec = normalize( reflectVec );
		vec2 sampleUV = equirectUv( reflectVec );
		vec4 envColor = texture2D( envMap, sampleUV );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,BO=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,FO=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,NO=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,zO=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) { 
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,UO=`#ifdef USE_FOG
	fogDepth = -mvPosition.z;
#endif`,GO=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,$O=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,VO=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,HO=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,jO=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,WO=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,qO=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,XO=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,YO=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
		  vec3 reflectVec = reflect( -viewDir, normal );
		  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
		  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#elif defined( ENVMAP_TYPE_EQUIREC )
			vec2 sampleUV = equirectUv( reflectVec );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,ZO=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,KO=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3	diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,QO=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,JO=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,e5=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,t5=`struct PhysicalMaterial {
	vec3	diffuseColor;
	float	specularRoughness;
	vec3	specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,n5=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,i5=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,r5=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,o5=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,s5=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,a5=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,c5=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,l5=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,u5=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,h5=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,f5=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,p5=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,d5=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,m5=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,g5=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
	uniform float morphTargetInfluences[ 8 ];
	#else
	uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,y5=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
	transformed += morphTarget4 * morphTargetInfluences[ 4 ];
	transformed += morphTarget5 * morphTargetInfluences[ 5 ];
	transformed += morphTarget6 * morphTargetInfluences[ 6 ];
	transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,v5=`#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
			bitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,x5=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );
#endif`,b5=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		float scale = sign( st1.t * st0.s - st0.t * st1.s );
		vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );
		vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );
		vec3 N = normalize( surf_norm );
		mat3 tsn = mat3( S, T, N );
		mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		return normalize( tsn * mapN );
	}
#endif`,_5=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,w5=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );
	#endif
#endif`,S5=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,M5=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,A5=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,C5=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,P5=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,T5=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,E5=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,I5=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,L5=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,R5=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,O5=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,k5=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,D5=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,B5=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,F5=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,N5=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,z5=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,U5=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,G5=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,$5=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,V5=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,H5=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,j5=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,W5=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,q5=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,X5=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,Y5=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,Z5=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,K5=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Q5=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,J5=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,ek=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,tk=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,nk=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,ik=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,rk=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,ok=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,sk=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,ak=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,ck=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,lk=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,uk=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,hk=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fk=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,pk=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,dk=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mk=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,gk=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yk=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,vk=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSPARENCY
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef TRANSPARENCY
	uniform float transparency;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#ifdef TRANSPARENCY
		diffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );
	#endif
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xk=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,bk=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,_k=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,wk=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Sk=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Mk=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Ak=`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Ck=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Pk=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`;const Dt={alphamap_fragment:lO,alphamap_pars_fragment:uO,alphatest_fragment:hO,aomap_fragment:fO,aomap_pars_fragment:pO,begin_vertex:dO,beginnormal_vertex:mO,bsdfs:gO,bumpmap_pars_fragment:yO,clipping_planes_fragment:vO,clipping_planes_pars_fragment:xO,clipping_planes_pars_vertex:bO,clipping_planes_vertex:_O,color_fragment:wO,color_pars_fragment:SO,color_pars_vertex:MO,color_vertex:AO,common:CO,cube_uv_reflection_fragment:PO,defaultnormal_vertex:TO,displacementmap_pars_vertex:EO,displacementmap_vertex:IO,emissivemap_fragment:LO,emissivemap_pars_fragment:RO,encodings_fragment:OO,encodings_pars_fragment:kO,envmap_fragment:DO,envmap_common_pars_fragment:BO,envmap_pars_fragment:FO,envmap_pars_vertex:NO,envmap_physical_pars_fragment:YO,envmap_vertex:zO,fog_vertex:UO,fog_pars_vertex:GO,fog_fragment:$O,fog_pars_fragment:VO,gradientmap_pars_fragment:HO,lightmap_fragment:jO,lightmap_pars_fragment:WO,lights_lambert_vertex:qO,lights_pars_begin:XO,lights_toon_fragment:ZO,lights_toon_pars_fragment:KO,lights_phong_fragment:QO,lights_phong_pars_fragment:JO,lights_physical_fragment:e5,lights_physical_pars_fragment:t5,lights_fragment_begin:n5,lights_fragment_maps:i5,lights_fragment_end:r5,logdepthbuf_fragment:o5,logdepthbuf_pars_fragment:s5,logdepthbuf_pars_vertex:a5,logdepthbuf_vertex:c5,map_fragment:l5,map_pars_fragment:u5,map_particle_fragment:h5,map_particle_pars_fragment:f5,metalnessmap_fragment:p5,metalnessmap_pars_fragment:d5,morphnormal_vertex:m5,morphtarget_pars_vertex:g5,morphtarget_vertex:y5,normal_fragment_begin:v5,normal_fragment_maps:x5,normalmap_pars_fragment:b5,clearcoat_normal_fragment_begin:_5,clearcoat_normal_fragment_maps:w5,clearcoat_pars_fragment:S5,packing:M5,premultiplied_alpha_fragment:A5,project_vertex:C5,dithering_fragment:P5,dithering_pars_fragment:T5,roughnessmap_fragment:E5,roughnessmap_pars_fragment:I5,shadowmap_pars_fragment:L5,shadowmap_pars_vertex:R5,shadowmap_vertex:O5,shadowmask_pars_fragment:k5,skinbase_vertex:D5,skinning_pars_vertex:B5,skinning_vertex:F5,skinnormal_vertex:N5,specularmap_fragment:z5,specularmap_pars_fragment:U5,tonemapping_fragment:G5,tonemapping_pars_fragment:$5,uv_pars_fragment:V5,uv_pars_vertex:H5,uv_vertex:j5,uv2_pars_fragment:W5,uv2_pars_vertex:q5,uv2_vertex:X5,worldpos_vertex:Y5,background_frag:Z5,background_vert:K5,cube_frag:Q5,cube_vert:J5,depth_frag:ek,depth_vert:tk,distanceRGBA_frag:nk,distanceRGBA_vert:ik,equirect_frag:rk,equirect_vert:ok,linedashed_frag:sk,linedashed_vert:ak,meshbasic_frag:ck,meshbasic_vert:lk,meshlambert_frag:uk,meshlambert_vert:hk,meshmatcap_frag:fk,meshmatcap_vert:pk,meshtoon_frag:dk,meshtoon_vert:mk,meshphong_frag:gk,meshphong_vert:yk,meshphysical_frag:vk,meshphysical_vert:xk,normal_frag:bk,normal_vert:_k,points_frag:wk,points_vert:Sk,shadow_frag:Mk,shadow_vert:Ak,sprite_frag:Ck,sprite_vert:Pk},ss={basic:{uniforms:wi([He.common,He.specularmap,He.envmap,He.aomap,He.lightmap,He.fog]),vertexShader:Dt.meshbasic_vert,fragmentShader:Dt.meshbasic_frag},lambert:{uniforms:wi([He.common,He.specularmap,He.envmap,He.aomap,He.lightmap,He.emissivemap,He.fog,He.lights,{emissive:{value:new Fe(0)}}]),vertexShader:Dt.meshlambert_vert,fragmentShader:Dt.meshlambert_frag},phong:{uniforms:wi([He.common,He.specularmap,He.envmap,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.fog,He.lights,{emissive:{value:new Fe(0)},specular:{value:new Fe(1118481)},shininess:{value:30}}]),vertexShader:Dt.meshphong_vert,fragmentShader:Dt.meshphong_frag},standard:{uniforms:wi([He.common,He.envmap,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.roughnessmap,He.metalnessmap,He.fog,He.lights,{emissive:{value:new Fe(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Dt.meshphysical_vert,fragmentShader:Dt.meshphysical_frag},toon:{uniforms:wi([He.common,He.aomap,He.lightmap,He.emissivemap,He.bumpmap,He.normalmap,He.displacementmap,He.gradientmap,He.fog,He.lights,{emissive:{value:new Fe(0)}}]),vertexShader:Dt.meshtoon_vert,fragmentShader:Dt.meshtoon_frag},matcap:{uniforms:wi([He.common,He.bumpmap,He.normalmap,He.displacementmap,He.fog,{matcap:{value:null}}]),vertexShader:Dt.meshmatcap_vert,fragmentShader:Dt.meshmatcap_frag},points:{uniforms:wi([He.points,He.fog]),vertexShader:Dt.points_vert,fragmentShader:Dt.points_frag},dashed:{uniforms:wi([He.common,He.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Dt.linedashed_vert,fragmentShader:Dt.linedashed_frag},depth:{uniforms:wi([He.common,He.displacementmap]),vertexShader:Dt.depth_vert,fragmentShader:Dt.depth_frag},normal:{uniforms:wi([He.common,He.bumpmap,He.normalmap,He.displacementmap,{opacity:{value:1}}]),vertexShader:Dt.normal_vert,fragmentShader:Dt.normal_frag},sprite:{uniforms:wi([He.sprite,He.fog]),vertexShader:Dt.sprite_vert,fragmentShader:Dt.sprite_frag},background:{uniforms:{uvTransform:{value:new di},t2D:{value:null}},vertexShader:Dt.background_vert,fragmentShader:Dt.background_frag},cube:{uniforms:wi([He.envmap,{opacity:{value:1}}]),vertexShader:Dt.cube_vert,fragmentShader:Dt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Dt.equirect_vert,fragmentShader:Dt.equirect_frag},distanceRGBA:{uniforms:wi([He.common,He.displacementmap,{referencePosition:{value:new T},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Dt.distanceRGBA_vert,fragmentShader:Dt.distanceRGBA_frag},shadow:{uniforms:wi([He.lights,He.fog,{color:{value:new Fe(0)},opacity:{value:1}}]),vertexShader:Dt.shadow_vert,fragmentShader:Dt.shadow_frag}};ss.physical={uniforms:wi([ss.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ee(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Fe(0)},transparency:{value:0}}]),vertexShader:Dt.meshphysical_vert,fragmentShader:Dt.meshphysical_frag};function Tk(e,t,n,i){const r=new Fe(0);let o=0,s,a,c=null,l=0,u=null;function h(p,m,y,v){let d=m.isScene===!0?m.background:null;const g=e.xr,b=g.getSession&&g.getSession();if(b&&b.environmentBlendMode==="additive"&&(d=null),d===null?f(r,o):d&&d.isColor&&(f(d,1),v=!0),(e.autoClear||v)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),d&&(d.isCubeTexture||d.isWebGLCubeRenderTarget||d.mapping===gp)){a===void 0&&(a=new pn(new vp(1,1,1),new ti({name:"BackgroundCubeMaterial",uniforms:ou(ss.cube.uniforms),vertexShader:ss.cube.vertexShader,fragmentShader:ss.cube.fragmentShader,side:Kn,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(_,S,w){this.matrixWorld.copyPosition(w.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(a));const x=d.isWebGLCubeRenderTarget?d.texture:d;a.material.uniforms.envMap.value=x,a.material.uniforms.flipEnvMap.value=x.isCubeTexture?-1:1,(c!==d||l!==x.version||u!==e.toneMapping)&&(a.material.needsUpdate=!0,c=d,l=x.version,u=e.toneMapping),p.unshift(a,a.geometry,a.material,0,0,null)}else d&&d.isTexture&&(s===void 0&&(s=new pn(new su(2,2),new ti({name:"BackgroundMaterial",uniforms:ou(ss.background.uniforms),vertexShader:ss.background.vertexShader,fragmentShader:ss.background.fragmentShader,side:Iu,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(s)),s.material.uniforms.t2D.value=d,d.matrixAutoUpdate===!0&&d.updateMatrix(),s.material.uniforms.uvTransform.value.copy(d.matrix),(c!==d||l!==d.version||u!==e.toneMapping)&&(s.material.needsUpdate=!0,c=d,l=d.version,u=e.toneMapping),p.unshift(s,s.geometry,s.material,0,0,null))}function f(p,m){t.buffers.color.setClear(p.r,p.g,p.b,m,i)}return{getClearColor:function(){return r},setClearColor:function(p,m){r.set(p),o=m!==void 0?m:1,f(r,o)},getClearAlpha:function(){return o},setClearAlpha:function(p){o=p,f(r,o)},render:h}}function Ek(e,t,n,i){const r=e.getParameter(34921),o=i.isWebGL2?null:t.get("OES_vertex_array_object"),s=i.isWebGL2||o!==null,a={},c=y(null);let l=c;function u(F,I,P,N,$){let B=!1;if(s){const q=m(N,P,I);l!==q&&(l=q,f(l.object)),B=v(N),B&&d(N)}else{const q=I.wireframe===!0;(l.geometry!==N.id||l.program!==P.id||l.wireframe!==q)&&(l.geometry=N.id,l.program=P.id,l.wireframe=q,B=!0)}F.isInstancedMesh===!0&&(B=!0),$!==null&&n.update($,34963),B&&(w(F,I,P,N),$!==null&&e.bindBuffer(34963,n.get($).buffer))}function h(){return i.isWebGL2?e.createVertexArray():o.createVertexArrayOES()}function f(F){return i.isWebGL2?e.bindVertexArray(F):o.bindVertexArrayOES(F)}function p(F){return i.isWebGL2?e.deleteVertexArray(F):o.deleteVertexArrayOES(F)}function m(F,I,P){const N=P.wireframe===!0;let $=a[F.id];$===void 0&&($={},a[F.id]=$);let B=$[I.id];B===void 0&&(B={},$[I.id]=B);let q=B[N];return q===void 0&&(q=y(h()),B[N]=q),q}function y(F){const I=[],P=[],N=[];for(let $=0;$<r;$++)I[$]=0,P[$]=0,N[$]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:I,enabledAttributes:P,attributeDivisors:N,object:F,attributes:{}}}function v(F){const I=l.attributes,P=F.attributes;if(Object.keys(I).length!==Object.keys(P).length)return!0;for(const N in P){const $=I[N],B=P[N];if($.attribute!==B||$.data!==B.data)return!0}return!1}function d(F){const I={},P=F.attributes;for(const N in P){const $=P[N],B={};B.attribute=$,$.data&&(B.data=$.data),I[N]=B}l.attributes=I}function g(){const F=l.newAttributes;for(let I=0,P=F.length;I<P;I++)F[I]=0}function b(F){x(F,0)}function x(F,I){const P=l.newAttributes,N=l.enabledAttributes,$=l.attributeDivisors;P[F]=1,N[F]===0&&(e.enableVertexAttribArray(F),N[F]=1),$[F]!==I&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](F,I),$[F]=I)}function _(){const F=l.newAttributes,I=l.enabledAttributes;for(let P=0,N=I.length;P<N;P++)I[P]!==F[P]&&(e.disableVertexAttribArray(P),I[P]=0)}function S(F,I,P,N,$,B){i.isWebGL2===!0&&(P===5124||P===5125)?e.vertexAttribIPointer(F,I,P,N,$,B):e.vertexAttribPointer(F,I,P,N,$,B)}function w(F,I,P,N){if(i.isWebGL2===!1&&(F.isInstancedMesh||N.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;g();const $=N.attributes,B=P.getAttributes(),q=I.defaultAttributeValues;for(const ee in B){const W=B[ee];if(W>=0){const Q=$[ee];if(Q!==void 0){const Z=Q.normalized,re=Q.itemSize,he=n.get(Q);if(he===void 0)continue;const K=he.buffer,ce=he.type,se=he.bytesPerElement;if(Q.isInterleavedBufferAttribute){const ue=Q.data,H=ue.stride,j=Q.offset;ue&&ue.isInstancedInterleavedBuffer?(x(W,ue.meshPerAttribute),N._maxInstanceCount===void 0&&(N._maxInstanceCount=ue.meshPerAttribute*ue.count)):b(W),e.bindBuffer(34962,K),S(W,re,ce,Z,H*se,j*se)}else Q.isInstancedBufferAttribute?(x(W,Q.meshPerAttribute),N._maxInstanceCount===void 0&&(N._maxInstanceCount=Q.meshPerAttribute*Q.count)):b(W),e.bindBuffer(34962,K),S(W,re,ce,Z,0,0)}else if(ee==="instanceMatrix"){const Z=n.get(F.instanceMatrix);if(Z===void 0)continue;const re=Z.buffer,he=Z.type;x(W+0,1),x(W+1,1),x(W+2,1),x(W+3,1),e.bindBuffer(34962,re),e.vertexAttribPointer(W+0,4,he,!1,64,0),e.vertexAttribPointer(W+1,4,he,!1,64,16),e.vertexAttribPointer(W+2,4,he,!1,64,32),e.vertexAttribPointer(W+3,4,he,!1,64,48)}else if(q!==void 0){const Z=q[ee];if(Z!==void 0)switch(Z.length){case 2:e.vertexAttrib2fv(W,Z);break;case 3:e.vertexAttrib3fv(W,Z);break;case 4:e.vertexAttrib4fv(W,Z);break;default:e.vertexAttrib1fv(W,Z)}}}}_()}function C(){L();for(const F in a){const I=a[F];for(const P in I){const N=I[P];for(const $ in N)p(N[$].object),delete N[$];delete I[P]}delete a[F]}}function A(F){if(a[F.id]===void 0)return;const I=a[F.id];for(const P in I){const N=I[P];for(const $ in N)p(N[$].object),delete N[$];delete I[P]}delete a[F.id]}function k(F){for(const I in a){const P=a[I];if(P[F.id]===void 0)continue;const N=P[F.id];for(const $ in N)p(N[$].object),delete N[$];delete P[F.id]}}function L(){D(),l!==c&&(l=c,f(l.object))}function D(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:u,reset:L,resetDefaultState:D,dispose:C,releaseStatesOfGeometry:A,releaseStatesOfProgram:k,initAttributes:g,enableAttribute:b,disableUnusedAttributes:_}}function Ik(e,t,n,i){const r=i.isWebGL2;let o;function s(l){o=l}function a(l,u){e.drawArrays(o,l,u),n.update(u,o)}function c(l,u,h,f){if(f===0)return;let p,m;if(r)p=e,m="drawArraysInstanced";else if(p=t.get("ANGLE_instanced_arrays"),m="drawArraysInstancedANGLE",p===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}p[m](o,u,h,f),n.update(h,o,f)}this.setMode=s,this.render=a,this.renderInstances=c}function Lk(e,t,n){let i;function r(){if(i!==void 0)return i;const S=t.get("EXT_texture_filter_anisotropic");return S!==null?i=e.getParameter(S.MAX_TEXTURE_MAX_ANISOTROPY_EXT):i=0,i}function o(S){if(S==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";S="mediump"}return S==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&e instanceof WebGL2ComputeRenderingContext;let a=n.precision!==void 0?n.precision:"highp";const c=o(a);c!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",c,"instead."),a=c);const l=n.logarithmicDepthBuffer===!0,u=e.getParameter(34930),h=e.getParameter(35660),f=e.getParameter(3379),p=e.getParameter(34076),m=e.getParameter(34921),y=e.getParameter(36347),v=e.getParameter(36348),d=e.getParameter(36349),g=h>0,b=s||!!t.get("OES_texture_float"),x=g&&b,_=s?e.getParameter(36183):0;return{isWebGL2:s,getMaxAnisotropy:r,getMaxPrecision:o,precision:a,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:h,maxTextureSize:f,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:y,maxVaryings:v,maxFragmentUniforms:d,vertexTextures:g,floatFragmentTextures:b,floatVertexTextures:x,maxSamples:_}}function Rk(){const e=this;let t=null,n=0,i=!1,r=!1;const o=new Io,s=new di,a={value:null,needsUpdate:!1};this.uniform=a,this.numPlanes=0,this.numIntersection=0,this.init=function(u,h,f){const p=u.length!==0||h||n!==0||i;return i=h,t=l(u,f,0),n=u.length,p},this.beginShadows=function(){r=!0,l(null)},this.endShadows=function(){r=!1,c()},this.setState=function(u,h,f,p,m,y){if(!i||u===null||u.length===0||r&&!f)r?l(null):c();else{const v=r?0:n,d=v*4;let g=m.clippingState||null;a.value=g,g=l(u,p,d,y);for(let b=0;b!==d;++b)g[b]=t[b];m.clippingState=g,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=v}};function c(){a.value!==t&&(a.value=t,a.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function l(u,h,f,p){let m=u!==null?u.length:0,y=null;if(m!==0){if(y=a.value,p!==!0||y===null){const v=f+m*4,d=h.matrixWorldInverse;s.getNormalMatrix(d),(y===null||y.length<v)&&(y=new Float32Array(v));for(let g=0,b=f;g!==m;++g,b+=4)o.copy(u[g]).applyMatrix4(d,s),o.normal.toArray(y,b),y[b+3]=o.constant}a.value=y,a.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,y}}function Ok(e){const t={};return{get:function(n){if(t[n]!==void 0)return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return i===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=i,i}}}function kk(e,t,n,i){const r=new WeakMap,o=new WeakMap;function s(h){const f=h.target,p=r.get(f);p.index!==null&&t.remove(p.index);for(const y in p.attributes)t.remove(p.attributes[y]);f.removeEventListener("dispose",s),r.delete(f);const m=o.get(p);m&&(t.remove(m),o.delete(p)),i.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,n.memory.geometries--}function a(h,f){let p=r.get(f);return p||(f.addEventListener("dispose",s),f.isBufferGeometry?p=f:f.isGeometry&&(f._bufferGeometry===void 0&&(f._bufferGeometry=new We().setFromObject(h)),p=f._bufferGeometry),r.set(f,p),n.memory.geometries++,p)}function c(h){const f=h.attributes;for(const m in f)t.update(f[m],34962);const p=h.morphAttributes;for(const m in p){const y=p[m];for(let v=0,d=y.length;v<d;v++)t.update(y[v],34962)}}function l(h){const f=[],p=h.index,m=h.attributes.position;let y=0;if(p!==null){const g=p.array;y=p.version;for(let b=0,x=g.length;b<x;b+=3){const _=g[b+0],S=g[b+1],w=g[b+2];f.push(_,S,S,w,w,_)}}else{const g=m.array;y=m.version;for(let b=0,x=g.length/3-1;b<x;b+=3){const _=b+0,S=b+1,w=b+2;f.push(_,S,S,w,w,_)}}const v=new(OP(f)>65535?Af:Mf)(f,1);v.version=y;const d=o.get(h);d&&t.remove(d),o.set(h,v)}function u(h){const f=o.get(h);if(f){const p=h.index;p!==null&&f.version<p.version&&l(h)}else l(h);return o.get(h)}return{get:a,update:c,getWireframeAttribute:u}}function Dk(e,t,n,i){const r=i.isWebGL2;let o;function s(f){o=f}let a,c;function l(f){a=f.type,c=f.bytesPerElement}function u(f,p){e.drawElements(o,p,a,f*c),n.update(p,o)}function h(f,p,m,y){if(y===0)return;let v,d;if(r)v=e,d="drawElementsInstanced";else if(v=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",v===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[d](o,m,a,p*c,y),n.update(m,o,y)}this.setMode=s,this.setIndex=l,this.render=u,this.renderInstances=h}function Bk(e){const t={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function i(o,s,a){switch(a=a||1,n.calls++,s){case 4:n.triangles+=a*(o/3);break;case 1:n.lines+=a*(o/2);break;case 3:n.lines+=a*(o-1);break;case 2:n.lines+=a*o;break;case 0:n.points+=a*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s);break}}function r(){n.frame++,n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:t,render:n,programs:null,autoReset:!0,reset:r,update:i}}function Fk(e,t){return e[0]-t[0]}function Nk(e,t){return Math.abs(t[1])-Math.abs(e[1])}function zk(e){const t={},n=new Float32Array(8),i=[];for(let o=0;o<8;o++)i[o]=[o,0];function r(o,s,a,c){const l=o.morphTargetInfluences,u=l===void 0?0:l.length;let h=t[s.id];if(h===void 0){h=[];for(let v=0;v<u;v++)h[v]=[v,0];t[s.id]=h}for(let v=0;v<u;v++){const d=h[v];d[0]=v,d[1]=l[v]}h.sort(Nk);for(let v=0;v<8;v++)v<u&&h[v][1]?(i[v][0]=h[v][0],i[v][1]=h[v][1]):(i[v][0]=Number.MAX_SAFE_INTEGER,i[v][1]=0);i.sort(Fk);const f=a.morphTargets&&s.morphAttributes.position,p=a.morphNormals&&s.morphAttributes.normal;let m=0;for(let v=0;v<8;v++){const d=i[v],g=d[0],b=d[1];g!==Number.MAX_SAFE_INTEGER&&b?(f&&s.getAttribute("morphTarget"+v)!==f[g]&&s.setAttribute("morphTarget"+v,f[g]),p&&s.getAttribute("morphNormal"+v)!==p[g]&&s.setAttribute("morphNormal"+v,p[g]),n[v]=b,m+=b):(f&&s.getAttribute("morphTarget"+v)!==void 0&&s.deleteAttribute("morphTarget"+v),p&&s.getAttribute("morphNormal"+v)!==void 0&&s.deleteAttribute("morphNormal"+v),n[v]=0)}const y=s.morphTargetsRelative?1:1-m;c.getUniforms().setValue(e,"morphTargetBaseInfluence",y),c.getUniforms().setValue(e,"morphTargetInfluences",n)}return{update:r}}function Uk(e,t,n,i){let r=new WeakMap;function o(a){const c=i.render.frame,l=a.geometry,u=t.get(a,l);return r.get(u)!==c&&(l.isGeometry&&u.updateFromObject(a),t.update(u),r.set(u,c)),a.isInstancedMesh&&n.update(a.instanceMatrix,34962),u}function s(){r=new WeakMap}return{update:o,dispose:s}}function Ma(e,t,n,i,r,o,s,a,c,l){e=e!==void 0?e:[],t=t!==void 0?t:h_,s=s!==void 0?s:rc,dn.call(this,e,t,n,i,r,o,s,a,c,l),this.flipY=!1}Ma.prototype=Object.create(dn.prototype);Ma.prototype.constructor=Ma;Ma.prototype.isCubeTexture=!0;Object.defineProperty(Ma.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});function Ef(e,t,n,i){dn.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:i||1},this.magFilter=ln,this.minFilter=ln,this.wrapR=Yi,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Ef.prototype=Object.create(dn.prototype);Ef.prototype.constructor=Ef;Ef.prototype.isDataTexture2DArray=!0;function If(e,t,n,i){dn.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:i||1},this.magFilter=ln,this.minFilter=ln,this.wrapR=Yi,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}If.prototype=Object.create(dn.prototype);If.prototype.constructor=If;If.prototype.isDataTexture3D=!0;const BP=new dn,Gk=new Ef,$k=new If,FP=new Ma,Tw=[],Ew=[],Iw=new Float32Array(16),Lw=new Float32Array(9),Rw=new Float32Array(4);function Ou(e,t,n){const i=e[0];if(i<=0||i>0)return e;let r=t*n,o=Tw[r];if(o===void 0&&(o=new Float32Array(r),Tw[r]=o),t!==0){i.toArray(o,0);for(let s=1,a=0;s!==t;++s)a+=n,e[s].toArray(o,a)}return o}function Fr(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function pr(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function NP(e,t){let n=Ew[t];n===void 0&&(n=new Int32Array(t),Ew[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function Vk(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Hk(e,t){const n=this.cache;if(t.x!==void 0)(n[0]!==t.x||n[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Fr(n,t))return;e.uniform2fv(this.addr,t),pr(n,t)}}function jk(e,t){const n=this.cache;if(t.x!==void 0)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(t.r!==void 0)(n[0]!==t.r||n[1]!==t.g||n[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Fr(n,t))return;e.uniform3fv(this.addr,t),pr(n,t)}}function Wk(e,t){const n=this.cache;if(t.x!==void 0)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z||n[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Fr(n,t))return;e.uniform4fv(this.addr,t),pr(n,t)}}function qk(e,t){const n=this.cache,i=t.elements;if(i===void 0){if(Fr(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),pr(n,t)}else{if(Fr(n,i))return;Rw.set(i),e.uniformMatrix2fv(this.addr,!1,Rw),pr(n,i)}}function Xk(e,t){const n=this.cache,i=t.elements;if(i===void 0){if(Fr(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),pr(n,t)}else{if(Fr(n,i))return;Lw.set(i),e.uniformMatrix3fv(this.addr,!1,Lw),pr(n,i)}}function Yk(e,t){const n=this.cache,i=t.elements;if(i===void 0){if(Fr(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),pr(n,t)}else{if(Fr(n,i))return;Iw.set(i),e.uniformMatrix4fv(this.addr,!1,Iw),pr(n,i)}}function Zk(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(t||BP,r)}function Kk(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||Gk,r)}function Qk(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||$k,r)}function Jk(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(t||FP,r)}function eD(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function tD(e,t){const n=this.cache;Fr(n,t)||(e.uniform2iv(this.addr,t),pr(n,t))}function nD(e,t){const n=this.cache;Fr(n,t)||(e.uniform3iv(this.addr,t),pr(n,t))}function iD(e,t){const n=this.cache;Fr(n,t)||(e.uniform4iv(this.addr,t),pr(n,t))}function rD(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function oD(e){switch(e){case 5126:return Vk;case 35664:return Hk;case 35665:return jk;case 35666:return Wk;case 35674:return qk;case 35675:return Xk;case 35676:return Yk;case 5124:case 35670:return eD;case 35667:case 35671:return tD;case 35668:case 35672:return nD;case 35669:case 35673:return iD;case 5125:return rD;case 35678:case 36198:case 36298:case 36306:case 35682:return Zk;case 35679:case 36299:case 36307:return Qk;case 35680:case 36300:case 36308:case 36293:return Jk;case 36289:case 36303:case 36311:case 36292:return Kk}}function sD(e,t){e.uniform1fv(this.addr,t)}function aD(e,t){e.uniform1iv(this.addr,t)}function cD(e,t){e.uniform2iv(this.addr,t)}function lD(e,t){e.uniform3iv(this.addr,t)}function uD(e,t){e.uniform4iv(this.addr,t)}function hD(e,t){const n=Ou(t,this.size,2);e.uniform2fv(this.addr,n)}function fD(e,t){const n=Ou(t,this.size,3);e.uniform3fv(this.addr,n)}function pD(e,t){const n=Ou(t,this.size,4);e.uniform4fv(this.addr,n)}function dD(e,t){const n=Ou(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function mD(e,t){const n=Ou(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function gD(e,t){const n=Ou(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function yD(e,t,n){const i=t.length,r=NP(n,i);e.uniform1iv(this.addr,r);for(let o=0;o!==i;++o)n.safeSetTexture2D(t[o]||BP,r[o])}function vD(e,t,n){const i=t.length,r=NP(n,i);e.uniform1iv(this.addr,r);for(let o=0;o!==i;++o)n.safeSetTextureCube(t[o]||FP,r[o])}function xD(e){switch(e){case 5126:return sD;case 35664:return hD;case 35665:return fD;case 35666:return pD;case 35674:return dD;case 35675:return mD;case 35676:return gD;case 5124:case 35670:return aD;case 35667:case 35671:return cD;case 35668:case 35672:return lD;case 35669:case 35673:return uD;case 35678:case 36198:case 36298:case 36306:case 35682:return yD;case 35680:case 36300:case 36308:case 36293:return vD}}function bD(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=oD(t.type)}function zP(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=xD(t.type)}zP.prototype.updateCache=function(e){let t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),pr(t,e)};function UP(e){this.id=e,this.seq=[],this.map={}}UP.prototype.setValue=function(e,t,n){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const s=i[r];s.setValue(e,t[s.id],n)}};const R1=/([\w\d_]+)(\])?(\[|\.)?/g;function Ow(e,t){e.seq.push(t),e.map[t.id]=t}function _D(e,t,n){const i=e.name,r=i.length;for(R1.lastIndex=0;;){const o=R1.exec(i),s=R1.lastIndex;let a=o[1],c=o[2]==="]",l=o[3];if(c&&(a=a|0),l===void 0||l==="["&&s+2===r){Ow(n,l===void 0?new bD(a,e,t):new zP(a,e,t));break}else{let h=n.map[a];h===void 0&&(h=new UP(a),Ow(n,h)),n=h}}}function ga(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let i=0;i<n;++i){const r=e.getActiveUniform(t,i),o=e.getUniformLocation(t,r.name);_D(r,o,this)}}ga.prototype.setValue=function(e,t,n,i){const r=this.map[t];r!==void 0&&r.setValue(e,n,i)};ga.prototype.setOptional=function(e,t,n){const i=t[n];i!==void 0&&this.setValue(e,n,i)};ga.upload=function(e,t,n,i){for(let r=0,o=t.length;r!==o;++r){const s=t[r],a=n[s.id];a.needsUpdate!==!1&&s.setValue(e,a.value,i)}};ga.seqWithValue=function(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const o=e[i];o.id in t&&n.push(o)}return n};function kw(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}let wD=0;function SD(e){const t=e.split(`
`);for(let n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join(`
`)}function GP(e){switch(e){case Ti:return["Linear","( value )"];case yp:return["sRGB","( value )"];case y_:return["RGBE","( value )"];case TP:return["RGBM","( value, 7.0 )"];case EP:return["RGBM","( value, 16.0 )"];case IP:return["RGBD","( value, 256.0 )"];case g_:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case UR:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function Dw(e,t,n){const i=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();if(i&&r==="")return"";const o=e.getShaderSource(t);return"THREE.WebGLShader: gl.getShaderInfoLog() "+n+`
`+r+SD(o)}function rh(e,t){const n=GP(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function MD(e,t){const n=GP(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function AD(e,t){let n;switch(t){case zL:n="Linear";break;case UL:n="Reinhard";break;case GL:n="OptimizedCineon";break;case $L:n="ACESFilmic";break;case VL:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function CD(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Th).join(`
`)}function PD(e){const t=[];for(const n in e){const i=e[n];i!==!1&&t.push("#define "+n+" "+i)}return t.join(`
`)}function TD(e,t){const n={},i=e.getProgramParameter(t,35721);for(let r=0;r<i;r++){const s=e.getActiveAttrib(t,r).name;n[s]=e.getAttribLocation(t,s)}return n}function Th(e){return e!==""}function Bw(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Fw(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const ED=/^[ \t]*#include +<([\w\d./]+)>/gm;function sx(e){return e.replace(ED,ID)}function ID(e,t){const n=Dt[t];if(n===void 0)throw new Error("Can not resolve #include <"+t+">");return sx(n)}const LD=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,RD=/#pragma unroll_loop_start[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g;function Nw(e){return e.replace(RD,$P).replace(LD,OD)}function OD(e,t,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),$P(e,t,n,i)}function $P(e,t,n,i){let r="";for(let o=parseInt(t);o<parseInt(n);o++)r+=i.replace(/\[ i \]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return r}function zw(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function kD(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===_P?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===yL?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===Ph&&(t="SHADOWMAP_TYPE_VSM"),t}function DD(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case h_:case f_:t="ENVMAP_TYPE_CUBE";break;case gp:case d_:t="ENVMAP_TYPE_CUBE_UV";break;case AP:case p_:t="ENVMAP_TYPE_EQUIREC";break}return t}function BD(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case f_:case p_:t="ENVMAP_MODE_REFRACTION";break}return t}function FD(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case p0:t="ENVMAP_BLENDING_MULTIPLY";break;case FL:t="ENVMAP_BLENDING_MIX";break;case NL:t="ENVMAP_BLENDING_ADD";break}return t}function ND(e,t,n,i){const r=e.getContext(),o=n.defines;let s=n.vertexShader,a=n.fragmentShader;const c=kD(n),l=DD(n),u=BD(n),h=FD(n),f=e.gammaFactor>0?e.gammaFactor:1,p=n.isWebGL2?"":CD(n),m=PD(o),y=r.createProgram();let v,d;if(n.isRawShaderMaterial?(v=[m].filter(Th).join(`
`),v.length>0&&(v+=`
`),d=[p,m].filter(Th).join(`
`),d.length>0&&(d+=`
`)):(v=[zw(n),"#define SHADER_NAME "+n.shaderName,m,n.instancing?"#define USE_INSTANCING":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+f,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Th).join(`
`),d=[p,zw(n),"#define SHADER_NAME "+n.shaderName,m,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Hl?"#define TONE_MAPPING":"",n.toneMapping!==Hl?Dt.tonemapping_pars_fragment:"",n.toneMapping!==Hl?AD("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",Dt.encodings_pars_fragment,n.map?rh("mapTexelToLinear",n.mapEncoding):"",n.matcap?rh("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?rh("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?rh("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?rh("lightMapTexelToLinear",n.lightMapEncoding):"",MD("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(Th).join(`
`)),s=sx(s),s=Bw(s,n),s=Fw(s,n),a=sx(a),a=Bw(a,n),a=Fw(a,n),s=Nw(s),a=Nw(a),n.isWebGL2&&!n.isRawShaderMaterial){let C=!1;const A=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&s.match(A)!==null&&a.match(A)!==null&&(C=!0,s=s.replace(A,""),a=a.replace(A,"")),v=[`#version 300 es
`,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,d=[`#version 300 es
`,"#define varying in",C?"":"out highp vec4 pc_fragColor;",C?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+d}const g=v+s,b=d+a,x=kw(r,35633,g),_=kw(r,35632,b);if(r.attachShader(y,x),r.attachShader(y,_),n.index0AttributeName!==void 0?r.bindAttribLocation(y,0,n.index0AttributeName):n.morphTargets===!0&&r.bindAttribLocation(y,0,"position"),r.linkProgram(y),e.debug.checkShaderErrors){const C=r.getProgramInfoLog(y).trim(),A=r.getShaderInfoLog(x).trim(),k=r.getShaderInfoLog(_).trim();let L=!0,D=!0;if(r.getProgramParameter(y,35714)===!1){L=!1;const F=Dw(r,x,"vertex"),I=Dw(r,_,"fragment");console.error("THREE.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(y,35715),"gl.getProgramInfoLog",C,F,I)}else C!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",C):(A===""||k==="")&&(D=!1);D&&(this.diagnostics={runnable:L,programLog:C,vertexShader:{log:A,prefix:v},fragmentShader:{log:k,prefix:d}})}r.deleteShader(x),r.deleteShader(_);let S;this.getUniforms=function(){return S===void 0&&(S=new ga(r,y)),S};let w;return this.getAttributes=function(){return w===void 0&&(w=TD(r,y)),w},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(y),this.program=void 0},this.name=n.shaderName,this.id=wD++,this.cacheKey=t,this.usedTimes=1,this.program=y,this.vertexShader=x,this.fragmentShader=_,this}function zD(e,t,n,i){const r=[],o=n.isWebGL2,s=n.logarithmicDepthBuffer,a=n.floatVertexTextures,c=n.maxVertexUniforms,l=n.vertexTextures;let u=n.precision;const h={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function p(x,_){let S;if(_){const w=ss[_];S={name:x.name||x.type,uniforms:rg.clone(w.uniforms),vertexShader:w.vertexShader,fragmentShader:w.fragmentShader}}else S={name:x.name||x.type,uniforms:x.uniforms,vertexShader:x.vertexShader,fragmentShader:x.fragmentShader};return S}function m(x){const S=x.skeleton.bones;if(a)return 1024;{const C=Math.floor((c-20)/4),A=Math.min(C,S.length);return A<S.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+S.length+" bones. This GPU supports "+A+"."),0):A}}function y(x){let _;return x?x.isTexture?_=x.encoding:x.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),_=x.texture.encoding):_=Ti,_}function v(x,_,S,w,C,A,k){const L=w.fog,D=x.isMeshStandardMaterial?w.environment:null,F=x.envMap||D,I=h[x.type],P=k.isSkinnedMesh?m(k):0;x.precision!==null&&(u=n.getMaxPrecision(x.precision),u!==x.precision&&console.warn("THREE.WebGLProgram.getParameters:",x.precision,"not supported, using",u,"instead."));const N=p(x,I);x.onBeforeCompile(N,e);const $=e.getRenderTarget();return{isWebGL2:o,shaderID:I,shaderName:N.name,uniforms:N.uniforms,vertexShader:N.vertexShader,fragmentShader:N.fragmentShader,defines:x.defines,isRawShaderMaterial:x.isRawShaderMaterial,isShaderMaterial:x.isShaderMaterial,precision:u,instancing:k.isInstancedMesh===!0,supportsVertexTextures:l,outputEncoding:$!==null?y($.texture):e.outputEncoding,map:!!x.map,mapEncoding:y(x.map),matcap:!!x.matcap,matcapEncoding:y(x.matcap),envMap:!!F,envMapMode:F&&F.mapping,envMapEncoding:y(F),envMapCubeUV:!!F&&(F.mapping===gp||F.mapping===d_),lightMap:!!x.lightMap,lightMapEncoding:y(x.lightMap),aoMap:!!x.aoMap,emissiveMap:!!x.emissiveMap,emissiveMapEncoding:y(x.emissiveMap),bumpMap:!!x.bumpMap,normalMap:!!x.normalMap,objectSpaceNormalMap:x.normalMapType===VR,tangentSpaceNormalMap:x.normalMapType===Lu,clearcoatMap:!!x.clearcoatMap,clearcoatRoughnessMap:!!x.clearcoatRoughnessMap,clearcoatNormalMap:!!x.clearcoatNormalMap,displacementMap:!!x.displacementMap,roughnessMap:!!x.roughnessMap,metalnessMap:!!x.metalnessMap,specularMap:!!x.specularMap,alphaMap:!!x.alphaMap,gradientMap:!!x.gradientMap,sheen:!!x.sheen,combine:x.combine,vertexTangents:x.normalMap&&x.vertexTangents,vertexColors:x.vertexColors,vertexUvs:!!x.map||!!x.bumpMap||!!x.normalMap||!!x.specularMap||!!x.alphaMap||!!x.emissiveMap||!!x.roughnessMap||!!x.metalnessMap||!!x.clearcoatMap||!!x.clearcoatRoughnessMap||!!x.clearcoatNormalMap||!!x.displacementMap,uvsVertexOnly:!(x.map||x.bumpMap||x.normalMap||x.specularMap||x.alphaMap||x.emissiveMap||x.roughnessMap||x.metalnessMap||x.clearcoatNormalMap)&&!!x.displacementMap,fog:!!L,useFog:x.fog,fogExp2:L&&L.isFogExp2,flatShading:x.flatShading,sizeAttenuation:x.sizeAttenuation,logarithmicDepthBuffer:s,skinning:x.skinning&&P>0,maxBones:P,useVertexTexture:a,morphTargets:x.morphTargets,morphNormals:x.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:_.directional.length,numPointLights:_.point.length,numSpotLights:_.spot.length,numRectAreaLights:_.rectArea.length,numHemiLights:_.hemi.length,numDirLightShadows:_.directionalShadowMap.length,numPointLightShadows:_.pointShadowMap.length,numSpotLightShadows:_.spotShadowMap.length,numClippingPlanes:C,numClipIntersection:A,dithering:x.dithering,shadowMapEnabled:e.shadowMap.enabled&&S.length>0,shadowMapType:e.shadowMap.type,toneMapping:x.toneMapped?e.toneMapping:Hl,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:x.premultipliedAlpha,alphaTest:x.alphaTest,doubleSided:x.side===mp,flipSided:x.side===Kn,depthPacking:x.depthPacking!==void 0?x.depthPacking:!1,index0AttributeName:x.index0AttributeName,extensionDerivatives:x.extensions&&x.extensions.derivatives,extensionFragDepth:x.extensions&&x.extensions.fragDepth,extensionDrawBuffers:x.extensions&&x.extensions.drawBuffers,extensionShaderTextureLOD:x.extensions&&x.extensions.shaderTextureLOD,rendererExtensionFragDepth:o||t.get("EXT_frag_depth")!==null,rendererExtensionDrawBuffers:o||t.get("WEBGL_draw_buffers")!==null,rendererExtensionShaderTextureLod:o||t.get("EXT_shader_texture_lod")!==null,customProgramCacheKey:x.customProgramCacheKey()}}function d(x){const _=[];if(x.shaderID?_.push(x.shaderID):(_.push(x.fragmentShader),_.push(x.vertexShader)),x.defines!==void 0)for(const S in x.defines)_.push(S),_.push(x.defines[S]);if(x.isRawShaderMaterial===void 0){for(let S=0;S<f.length;S++)_.push(x[f[S]]);_.push(e.outputEncoding),_.push(e.gammaFactor)}return _.push(x.customProgramCacheKey),_.join()}function g(x,_){let S;for(let w=0,C=r.length;w<C;w++){const A=r[w];if(A.cacheKey===_){S=A,++S.usedTimes;break}}return S===void 0&&(S=new ND(e,_,x,i),r.push(S)),S}function b(x){if(--x.usedTimes===0){const _=r.indexOf(x);r[_]=r[r.length-1],r.pop(),x.destroy()}}return{getParameters:v,getProgramCacheKey:d,acquireProgram:g,releaseProgram:b,programs:r}}function UD(){let e=new WeakMap;function t(o){let s=e.get(o);return s===void 0&&(s={},e.set(o,s)),s}function n(o){e.delete(o)}function i(o,s,a){e.get(o)[s]=a}function r(){e=new WeakMap}return{get:t,remove:n,update:i,dispose:r}}function GD(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function $D(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Uw(){const e=[];let t=0;const n=[],i=[],r={id:-1};function o(){t=0,n.length=0,i.length=0}function s(h,f,p,m,y,v){let d=e[t];return d===void 0?(d={id:h.id,object:h,geometry:f,material:p,program:p.program||r,groupOrder:m,renderOrder:h.renderOrder,z:y,group:v},e[t]=d):(d.id=h.id,d.object=h,d.geometry=f,d.material=p,d.program=p.program||r,d.groupOrder=m,d.renderOrder=h.renderOrder,d.z=y,d.group=v),t++,d}function a(h,f,p,m,y,v){const d=s(h,f,p,m,y,v);(p.transparent===!0?i:n).push(d)}function c(h,f,p,m,y,v){const d=s(h,f,p,m,y,v);(p.transparent===!0?i:n).unshift(d)}function l(h,f){n.length>1&&n.sort(h||GD),i.length>1&&i.sort(f||$D)}function u(){for(let h=t,f=e.length;h<f;h++){const p=e[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.program=null,p.group=null}}return{opaque:n,transparent:i,init:o,push:a,unshift:c,finish:u,sort:l}}function VD(){let e=new WeakMap;function t(r){const o=r.target;o.removeEventListener("dispose",t),e.delete(o)}function n(r,o){const s=e.get(r);let a;return s===void 0?(a=new Uw,e.set(r,new WeakMap),e.get(r).set(o,a),r.addEventListener("dispose",t)):(a=s.get(o),a===void 0&&(a=new Uw,s.set(o,a))),a}function i(){e=new WeakMap}return{get:n,dispose:i}}function HD(){const e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new T,color:new Fe};break;case"SpotLight":n={position:new T,direction:new T,color:new Fe,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new T,color:new Fe,distance:0,decay:0};break;case"HemisphereLight":n={direction:new T,skyColor:new Fe,groundColor:new Fe};break;case"RectAreaLight":n={color:new Fe,position:new T,halfWidth:new T,halfHeight:new T};break}return e[t.id]=n,n}}}function jD(){const e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let n;switch(t.type){case"DirectionalLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ee};break;case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ee};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ee,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=n,n}}}let WD=0;function qD(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function XD(){const e=new HD,t=jD(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let a=0;a<9;a++)n.probe.push(new T);const i=new T,r=new De,o=new De;function s(a,c,l){let u=0,h=0,f=0;for(let w=0;w<9;w++)n.probe[w].set(0,0,0);let p=0,m=0,y=0,v=0,d=0,g=0,b=0,x=0;const _=l.matrixWorldInverse;a.sort(qD);for(let w=0,C=a.length;w<C;w++){const A=a[w],k=A.color,L=A.intensity,D=A.distance,F=A.shadow&&A.shadow.map?A.shadow.map.texture:null;if(A.isAmbientLight)u+=k.r*L,h+=k.g*L,f+=k.b*L;else if(A.isLightProbe)for(let I=0;I<9;I++)n.probe[I].addScaledVector(A.sh.coefficients[I],L);else if(A.isDirectionalLight){const I=e.get(A);if(I.color.copy(A.color).multiplyScalar(A.intensity),I.direction.setFromMatrixPosition(A.matrixWorld),i.setFromMatrixPosition(A.target.matrixWorld),I.direction.sub(i),I.direction.transformDirection(_),A.castShadow){const P=A.shadow,N=t.get(A);N.shadowBias=P.bias,N.shadowNormalBias=P.normalBias,N.shadowRadius=P.radius,N.shadowMapSize=P.mapSize,n.directionalShadow[p]=N,n.directionalShadowMap[p]=F,n.directionalShadowMatrix[p]=A.shadow.matrix,g++}n.directional[p]=I,p++}else if(A.isSpotLight){const I=e.get(A);if(I.position.setFromMatrixPosition(A.matrixWorld),I.position.applyMatrix4(_),I.color.copy(k).multiplyScalar(L),I.distance=D,I.direction.setFromMatrixPosition(A.matrixWorld),i.setFromMatrixPosition(A.target.matrixWorld),I.direction.sub(i),I.direction.transformDirection(_),I.coneCos=Math.cos(A.angle),I.penumbraCos=Math.cos(A.angle*(1-A.penumbra)),I.decay=A.decay,A.castShadow){const P=A.shadow,N=t.get(A);N.shadowBias=P.bias,N.shadowNormalBias=P.normalBias,N.shadowRadius=P.radius,N.shadowMapSize=P.mapSize,n.spotShadow[y]=N,n.spotShadowMap[y]=F,n.spotShadowMatrix[y]=A.shadow.matrix,x++}n.spot[y]=I,y++}else if(A.isRectAreaLight){const I=e.get(A);I.color.copy(k).multiplyScalar(L),I.position.setFromMatrixPosition(A.matrixWorld),I.position.applyMatrix4(_),o.identity(),r.copy(A.matrixWorld),r.premultiply(_),o.extractRotation(r),I.halfWidth.set(A.width*.5,0,0),I.halfHeight.set(0,A.height*.5,0),I.halfWidth.applyMatrix4(o),I.halfHeight.applyMatrix4(o),n.rectArea[v]=I,v++}else if(A.isPointLight){const I=e.get(A);if(I.position.setFromMatrixPosition(A.matrixWorld),I.position.applyMatrix4(_),I.color.copy(A.color).multiplyScalar(A.intensity),I.distance=A.distance,I.decay=A.decay,A.castShadow){const P=A.shadow,N=t.get(A);N.shadowBias=P.bias,N.shadowNormalBias=P.normalBias,N.shadowRadius=P.radius,N.shadowMapSize=P.mapSize,N.shadowCameraNear=P.camera.near,N.shadowCameraFar=P.camera.far,n.pointShadow[m]=N,n.pointShadowMap[m]=F,n.pointShadowMatrix[m]=A.shadow.matrix,b++}n.point[m]=I,m++}else if(A.isHemisphereLight){const I=e.get(A);I.direction.setFromMatrixPosition(A.matrixWorld),I.direction.transformDirection(_),I.direction.normalize(),I.skyColor.copy(A.color).multiplyScalar(L),I.groundColor.copy(A.groundColor).multiplyScalar(L),n.hemi[d]=I,d++}}n.ambient[0]=u,n.ambient[1]=h,n.ambient[2]=f;const S=n.hash;(S.directionalLength!==p||S.pointLength!==m||S.spotLength!==y||S.rectAreaLength!==v||S.hemiLength!==d||S.numDirectionalShadows!==g||S.numPointShadows!==b||S.numSpotShadows!==x)&&(n.directional.length=p,n.spot.length=y,n.rectArea.length=v,n.point.length=m,n.hemi.length=d,n.directionalShadow.length=g,n.directionalShadowMap.length=g,n.pointShadow.length=b,n.pointShadowMap.length=b,n.spotShadow.length=x,n.spotShadowMap.length=x,n.directionalShadowMatrix.length=g,n.pointShadowMatrix.length=b,n.spotShadowMatrix.length=x,S.directionalLength=p,S.pointLength=m,S.spotLength=y,S.rectAreaLength=v,S.hemiLength=d,S.numDirectionalShadows=g,S.numPointShadows=b,S.numSpotShadows=x,n.version=WD++)}return{setup:s,state:n}}function Gw(){const e=new XD,t=[],n=[];function i(){t.length=0,n.length=0}function r(c){t.push(c)}function o(c){n.push(c)}function s(c){e.setup(t,n,c)}return{init:i,state:{lightsArray:t,shadowsArray:n,lights:e},setupLights:s,pushLight:r,pushShadow:o}}function YD(){let e=new WeakMap;function t(r){const o=r.target;o.removeEventListener("dispose",t),e.delete(o)}function n(r,o){let s;return e.has(r)===!1?(s=new Gw,e.set(r,new WeakMap),e.get(r).set(o,s),r.addEventListener("dispose",t)):e.get(r).has(o)===!1?(s=new Gw,e.get(r).set(o,s)):s=e.get(r).get(o),s}function i(){e=new WeakMap}return{get:n,dispose:i}}function vc(e){bt.call(this),this.type="MeshDepthMaterial",this.depthPacking=GR,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}vc.prototype=Object.create(bt.prototype);vc.prototype.constructor=vc;vc.prototype.isMeshDepthMaterial=!0;vc.prototype.copy=function(e){return bt.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this};function xc(e){bt.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new T,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}xc.prototype=Object.create(bt.prototype);xc.prototype.constructor=xc;xc.prototype.isMeshDistanceMaterial=!0;xc.prototype.copy=function(e){return bt.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};var ZD=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
  float mean = 0.0;
  float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );
  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
    #ifdef HORIZONAL_PASS
      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
      mean += distribution.x;
      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
    #else
      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );
      mean += depth;
      squared_mean += depth * depth;
    #endif
  }
  mean = mean * HALF_SAMPLE_RATE;
  squared_mean = squared_mean * HALF_SAMPLE_RATE;
  float std_dev = sqrt( squared_mean - mean * mean );
  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,KD=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function VP(e,t,n){let i=new xp;const r=new Ee,o=new Ee,s=new on,a=[],c=[],l={},u={0:Kn,1:Iu,2:mp},h=new ti({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ee},radius:{value:4}},vertexShader:KD,fragmentShader:ZD}),f=h.clone();f.defines.HORIZONAL_PASS=1;const p=new We;p.setAttribute("position",new rt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new pn(p,h),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=_P,this.render=function(_,S,w){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||_.length===0)return;const C=e.getRenderTarget(),A=e.getActiveCubeFace(),k=e.getActiveMipmapLevel(),L=e.state;L.setBlending(ps),L.buffers.color.setClear(1,1,1,1),L.buffers.depth.setTest(!0),L.setScissorTest(!1);for(let D=0,F=_.length;D<F;D++){const I=_[D],P=I.shadow;if(P.autoUpdate===!1&&P.needsUpdate===!1)continue;if(P===void 0){console.warn("THREE.WebGLShadowMap:",I,"has no shadow.");continue}r.copy(P.mapSize);const N=P.getFrameExtents();if(r.multiply(N),o.copy(P.mapSize),(r.x>n||r.y>n)&&(r.x>n&&(o.x=Math.floor(n/N.x),r.x=o.x*N.x,P.mapSize.x=o.x),r.y>n&&(o.y=Math.floor(n/N.y),r.y=o.y*N.y,P.mapSize.y=o.y)),P.map===null&&!P.isPointLightShadow&&this.type===Ph){const B={minFilter:Xn,magFilter:Xn,format:er};P.map=new zi(r.x,r.y,B),P.map.texture.name=I.name+".shadowMap",P.mapPass=new zi(r.x,r.y,B),P.camera.updateProjectionMatrix()}if(P.map===null){const B={minFilter:ln,magFilter:ln,format:er};P.map=new zi(r.x,r.y,B),P.map.texture.name=I.name+".shadowMap",P.camera.updateProjectionMatrix()}e.setRenderTarget(P.map),e.clear();const $=P.getViewportCount();for(let B=0;B<$;B++){const q=P.getViewport(B);s.set(o.x*q.x,o.y*q.y,o.x*q.z,o.y*q.w),L.viewport(s),P.updateMatrices(I,B),i=P.getFrustum(),x(S,w,P.camera,I,this.type)}!P.isPointLightShadow&&this.type===Ph&&v(P,w),P.needsUpdate=!1}y.needsUpdate=!1,e.setRenderTarget(C,A,k)};function v(_,S){const w=t.update(m);h.uniforms.shadow_pass.value=_.map.texture,h.uniforms.resolution.value=_.mapSize,h.uniforms.radius.value=_.radius,e.setRenderTarget(_.mapPass),e.clear(),e.renderBufferDirect(S,null,w,h,m,null),f.uniforms.shadow_pass.value=_.mapPass.texture,f.uniforms.resolution.value=_.mapSize,f.uniforms.radius.value=_.radius,e.setRenderTarget(_.map),e.clear(),e.renderBufferDirect(S,null,w,f,m,null)}function d(_,S,w){const C=_<<0|S<<1|w<<2;let A=a[C];return A===void 0&&(A=new vc({depthPacking:$R,morphTargets:_,skinning:S}),a[C]=A),A}function g(_,S,w){const C=_<<0|S<<1|w<<2;let A=c[C];return A===void 0&&(A=new xc({morphTargets:_,skinning:S}),c[C]=A),A}function b(_,S,w,C,A,k,L){let D=null,F=d,I=_.customDepthMaterial;if(C.isPointLight===!0&&(F=g,I=_.customDistanceMaterial),I===void 0){let P=!1;w.morphTargets===!0&&(P=S.morphAttributes&&S.morphAttributes.position&&S.morphAttributes.position.length>0);let N=!1;_.isSkinnedMesh===!0&&(w.skinning===!0?N=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",_));const $=_.isInstancedMesh===!0;D=F(P,N,$)}else D=I;if(e.localClippingEnabled&&w.clipShadows===!0&&w.clippingPlanes.length!==0){const P=D.uuid,N=w.uuid;let $=l[P];$===void 0&&($={},l[P]=$);let B=$[N];B===void 0&&(B=D.clone(),$[N]=B),D=B}return D.visible=w.visible,D.wireframe=w.wireframe,L===Ph?D.side=w.shadowSide!==null?w.shadowSide:w.side:D.side=w.shadowSide!==null?w.shadowSide:u[w.side],D.clipShadows=w.clipShadows,D.clippingPlanes=w.clippingPlanes,D.clipIntersection=w.clipIntersection,D.wireframeLinewidth=w.wireframeLinewidth,D.linewidth=w.linewidth,C.isPointLight===!0&&D.isMeshDistanceMaterial===!0&&(D.referencePosition.setFromMatrixPosition(C.matrixWorld),D.nearDistance=A,D.farDistance=k),D}function x(_,S,w,C,A){if(_.visible===!1)return;if(_.layers.test(S.layers)&&(_.isMesh||_.isLine||_.isPoints)&&(_.castShadow||_.receiveShadow&&A===Ph)&&(!_.frustumCulled||i.intersectsObject(_))){_.modelViewMatrix.multiplyMatrices(w.matrixWorldInverse,_.matrixWorld);const D=t.update(_),F=_.material;if(Array.isArray(F)){const I=D.groups;for(let P=0,N=I.length;P<N;P++){const $=I[P],B=F[$.materialIndex];if(B&&B.visible){const q=b(_,D,B,C,w.near,w.far,A);e.renderBufferDirect(w,null,D,q,_,$)}}}else if(F.visible){const I=b(_,D,F,C,w.near,w.far,A);e.renderBufferDirect(w,null,D,I,_,null)}}const L=_.children;for(let D=0,F=L.length;D<F;D++)x(L[D],S,w,C,A)}}function QD(e,t,n){const i=n.isWebGL2;function r(){let ne=!1;const oe=new on;let xe=null;const Ae=new on(0,0,0,0);return{setMask:function(ge){xe!==ge&&!ne&&(e.colorMask(ge,ge,ge,ge),xe=ge)},setLocked:function(ge){ne=ge},setClear:function(ge,Me,be,Oe,Te){Te===!0&&(ge*=Oe,Me*=Oe,be*=Oe),oe.set(ge,Me,be,Oe),Ae.equals(oe)===!1&&(e.clearColor(ge,Me,be,Oe),Ae.copy(oe))},reset:function(){ne=!1,xe=null,Ae.set(-1,0,0,0)}}}function o(){let ne=!1,oe=null,xe=null,Ae=null;return{setTest:function(ge){ge?ee(2929):W(2929)},setMask:function(ge){oe!==ge&&!ne&&(e.depthMask(ge),oe=ge)},setFunc:function(ge){if(xe!==ge){if(ge)switch(ge){case IL:e.depthFunc(512);break;case LL:e.depthFunc(519);break;case RL:e.depthFunc(513);break;case Kv:e.depthFunc(515);break;case OL:e.depthFunc(514);break;case kL:e.depthFunc(518);break;case DL:e.depthFunc(516);break;case BL:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);xe=ge}},setLocked:function(ge){ne=ge},setClear:function(ge){Ae!==ge&&(e.clearDepth(ge),Ae=ge)},reset:function(){ne=!1,oe=null,xe=null,Ae=null}}}function s(){let ne=!1,oe=null,xe=null,Ae=null,ge=null,Me=null,be=null,Oe=null,Te=null;return{setTest:function(Ce){ne||(Ce?ee(2960):W(2960))},setMask:function(Ce){oe!==Ce&&!ne&&(e.stencilMask(Ce),oe=Ce)},setFunc:function(Ce,Ge,at){(xe!==Ce||Ae!==Ge||ge!==at)&&(e.stencilFunc(Ce,Ge,at),xe=Ce,Ae=Ge,ge=at)},setOp:function(Ce,Ge,at){(Me!==Ce||be!==Ge||Oe!==at)&&(e.stencilOp(Ce,Ge,at),Me=Ce,be=Ge,Oe=at)},setLocked:function(Ce){ne=Ce},setClear:function(Ce){Te!==Ce&&(e.clearStencil(Ce),Te=Ce)},reset:function(){ne=!1,oe=null,xe=null,Ae=null,ge=null,Me=null,be=null,Oe=null,Te=null}}}const a=new r,c=new o,l=new s;let u={},h=null,f=null,p=null,m=null,y=null,v=null,d=null,g=null,b=null,x=!1,_=null,S=null,w=null,C=null,A=null;const k=e.getParameter(35661);let L=!1,D=0;const F=e.getParameter(7938);F.indexOf("WebGL")!==-1?(D=parseFloat(/^WebGL\ ([0-9])/.exec(F)[1]),L=D>=1):F.indexOf("OpenGL ES")!==-1&&(D=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(F)[1]),L=D>=2);let I=null,P={};const N=new on,$=new on;function B(ne,oe,xe){const Ae=new Uint8Array(4),ge=e.createTexture();e.bindTexture(ne,ge),e.texParameteri(ne,10241,9728),e.texParameteri(ne,10240,9728);for(let Me=0;Me<xe;Me++)e.texImage2D(oe+Me,0,6408,1,1,0,6408,5121,Ae);return ge}const q={};q[3553]=B(3553,3553,1),q[34067]=B(34067,34069,6),a.setClear(0,0,0,1),c.setClear(1),l.setClear(0),ee(2929),c.setFunc(Kv),ce(!1),se(iw),ee(2884),he(ps);function ee(ne){u[ne]!==!0&&(e.enable(ne),u[ne]=!0)}function W(ne){u[ne]!==!1&&(e.disable(ne),u[ne]=!1)}function Q(ne){return h!==ne?(e.useProgram(ne),h=ne,!0):!1}const Z={[sl]:32774,[xL]:32778,[bL]:32779};if(i)Z[sw]=32775,Z[aw]=32776;else{const ne=t.get("EXT_blend_minmax");ne!==null&&(Z[sw]=ne.MIN_EXT,Z[aw]=ne.MAX_EXT)}const re={[_L]:0,[wL]:1,[SL]:768,[SP]:770,[EL]:776,[PL]:774,[AL]:772,[ML]:769,[MP]:771,[TL]:775,[CL]:773};function he(ne,oe,xe,Ae,ge,Me,be,Oe){if(ne===ps){f&&(W(3042),f=!1);return}if(f||(ee(3042),f=!0),ne!==vL){if(ne!==p||Oe!==x){if((m!==sl||d!==sl)&&(e.blendEquation(32774),m=sl,d=sl),Oe)switch(ne){case ma:e.blendFuncSeparate(1,771,1,771);break;case Zv:e.blendFunc(1,1);break;case rw:e.blendFuncSeparate(0,0,769,771);break;case ow:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",ne);break}else switch(ne){case ma:e.blendFuncSeparate(770,771,1,771);break;case Zv:e.blendFunc(770,1);break;case rw:e.blendFunc(0,769);break;case ow:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",ne);break}y=null,v=null,g=null,b=null,p=ne,x=Oe}return}ge=ge||oe,Me=Me||xe,be=be||Ae,(oe!==m||ge!==d)&&(e.blendEquationSeparate(Z[oe],Z[ge]),m=oe,d=ge),(xe!==y||Ae!==v||Me!==g||be!==b)&&(e.blendFuncSeparate(re[xe],re[Ae],re[Me],re[be]),y=xe,v=Ae,g=Me,b=be),p=ne,x=null}function K(ne,oe){ne.side===mp?W(2884):ee(2884);let xe=ne.side===Kn;oe&&(xe=!xe),ce(xe),ne.blending===ma&&ne.transparent===!1?he(ps):he(ne.blending,ne.blendEquation,ne.blendSrc,ne.blendDst,ne.blendEquationAlpha,ne.blendSrcAlpha,ne.blendDstAlpha,ne.premultipliedAlpha),c.setFunc(ne.depthFunc),c.setTest(ne.depthTest),c.setMask(ne.depthWrite),a.setMask(ne.colorWrite);const Ae=ne.stencilWrite;l.setTest(Ae),Ae&&(l.setMask(ne.stencilWriteMask),l.setFunc(ne.stencilFunc,ne.stencilRef,ne.stencilFuncMask),l.setOp(ne.stencilFail,ne.stencilZFail,ne.stencilZPass)),H(ne.polygonOffset,ne.polygonOffsetFactor,ne.polygonOffsetUnits)}function ce(ne){_!==ne&&(ne?e.frontFace(2304):e.frontFace(2305),_=ne)}function se(ne){ne!==mL?(ee(2884),ne!==S&&(ne===iw?e.cullFace(1029):ne===gL?e.cullFace(1028):e.cullFace(1032))):W(2884),S=ne}function ue(ne){ne!==w&&(L&&e.lineWidth(ne),w=ne)}function H(ne,oe,xe){ne?(ee(32823),(C!==oe||A!==xe)&&(e.polygonOffset(oe,xe),C=oe,A=xe)):W(32823)}function j(ne){ne?ee(3089):W(3089)}function X(ne){ne===void 0&&(ne=33984+k-1),I!==ne&&(e.activeTexture(ne),I=ne)}function ie(ne,oe){I===null&&X();let xe=P[I];xe===void 0&&(xe={type:void 0,texture:void 0},P[I]=xe),(xe.type!==ne||xe.texture!==oe)&&(e.bindTexture(ne,oe||q[ne]),xe.type=ne,xe.texture=oe)}function fe(){const ne=P[I];ne!==void 0&&ne.type!==void 0&&(e.bindTexture(ne.type,null),ne.type=void 0,ne.texture=void 0)}function me(){try{e.compressedTexImage2D.apply(e,arguments)}catch(ne){console.error("THREE.WebGLState:",ne)}}function ve(){try{e.texImage2D.apply(e,arguments)}catch(ne){console.error("THREE.WebGLState:",ne)}}function G(){try{e.texImage3D.apply(e,arguments)}catch(ne){console.error("THREE.WebGLState:",ne)}}function V(ne){N.equals(ne)===!1&&(e.scissor(ne.x,ne.y,ne.z,ne.w),N.copy(ne))}function pe(ne){$.equals(ne)===!1&&(e.viewport(ne.x,ne.y,ne.z,ne.w),$.copy(ne))}function le(){u={},I=null,P={},h=null,p=null,_=null,S=null,a.reset(),c.reset(),l.reset()}return{buffers:{color:a,depth:c,stencil:l},enable:ee,disable:W,useProgram:Q,setBlending:he,setMaterial:K,setFlipSided:ce,setCullFace:se,setLineWidth:ue,setPolygonOffset:H,setScissorTest:j,activeTexture:X,bindTexture:ie,unbindTexture:fe,compressedTexImage2D:me,texImage2D:ve,texImage3D:G,scissor:V,viewport:pe,reset:le}}function JD(e,t,n,i,r,o,s){const a=r.isWebGL2,c=r.maxTextures,l=r.maxCubemapSize,u=r.maxTextureSize,h=r.maxSamples,f=new WeakMap;let p,m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(G,V){return m?new OffscreenCanvas(G,V):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(G,V,pe,le){let ne=1;if((G.width>le||G.height>le)&&(ne=le/Math.max(G.width,G.height)),ne<1||V===!0)if(typeof HTMLImageElement<"u"&&G instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&G instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&G instanceof ImageBitmap){const oe=V?It.floorPowerOfTwo:Math.floor,xe=oe(ne*G.width),Ae=oe(ne*G.height);p===void 0&&(p=y(xe,Ae));const ge=pe?y(xe,Ae):p;return ge.width=xe,ge.height=Ae,ge.getContext("2d").drawImage(G,0,0,xe,Ae),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+G.width+"x"+G.height+") to ("+xe+"x"+Ae+")."),ge}else return"data"in G&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+G.width+"x"+G.height+")."),G;return G}function d(G){return It.isPowerOfTwo(G.width)&&It.isPowerOfTwo(G.height)}function g(G){return a?!1:G.wrapS!==Yi||G.wrapT!==Yi||G.minFilter!==ln&&G.minFilter!==Xn}function b(G,V){return G.generateMipmaps&&V&&G.minFilter!==ln&&G.minFilter!==Xn}function x(G,V,pe,le){e.generateMipmap(G);const ne=i.get(V);ne.__maxMipLevel=Math.log(Math.max(pe,le))*Math.LOG2E}function _(G,V,pe){if(a===!1)return V;if(G!==null){if(e[G]!==void 0)return e[G];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+G+"'")}let le=V;return V===6403&&(pe===5126&&(le=33326),pe===5131&&(le=33325),pe===5121&&(le=33321)),V===6407&&(pe===5126&&(le=34837),pe===5131&&(le=34843),pe===5121&&(le=32849)),V===6408&&(pe===5126&&(le=34836),pe===5131&&(le=34842),pe===5121&&(le=32856)),(le===33325||le===33326||le===34842||le===34836)&&t.get("EXT_color_buffer_float"),le}function S(G){return G===ln||G===Qv||G===Jv?9728:9729}function w(G){const V=G.target;V.removeEventListener("dispose",w),A(V),V.isVideoTexture&&f.delete(V),s.memory.textures--}function C(G){const V=G.target;V.removeEventListener("dispose",C),k(V),s.memory.textures--}function A(G){const V=i.get(G);V.__webglInit!==void 0&&(e.deleteTexture(V.__webglTexture),i.remove(G))}function k(G){const V=i.get(G),pe=i.get(G.texture);if(G){if(pe.__webglTexture!==void 0&&e.deleteTexture(pe.__webglTexture),G.depthTexture&&G.depthTexture.dispose(),G.isWebGLCubeRenderTarget)for(let le=0;le<6;le++)e.deleteFramebuffer(V.__webglFramebuffer[le]),V.__webglDepthbuffer&&e.deleteRenderbuffer(V.__webglDepthbuffer[le]);else e.deleteFramebuffer(V.__webglFramebuffer),V.__webglDepthbuffer&&e.deleteRenderbuffer(V.__webglDepthbuffer),V.__webglMultisampledFramebuffer&&e.deleteFramebuffer(V.__webglMultisampledFramebuffer),V.__webglColorRenderbuffer&&e.deleteRenderbuffer(V.__webglColorRenderbuffer),V.__webglDepthRenderbuffer&&e.deleteRenderbuffer(V.__webglDepthRenderbuffer);i.remove(G.texture),i.remove(G)}}let L=0;function D(){L=0}function F(){const G=L;return G>=c&&console.warn("THREE.WebGLTextures: Trying to use "+G+" texture units while this GPU supports only "+c),L+=1,G}function I(G,V){const pe=i.get(G);if(G.isVideoTexture&&X(G),G.version>0&&pe.__version!==G.version){const le=G.image;if(le===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(le.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Z(pe,G,V);return}}n.activeTexture(33984+V),n.bindTexture(3553,pe.__webglTexture)}function P(G,V){const pe=i.get(G);if(G.version>0&&pe.__version!==G.version){Z(pe,G,V);return}n.activeTexture(33984+V),n.bindTexture(35866,pe.__webglTexture)}function N(G,V){const pe=i.get(G);if(G.version>0&&pe.__version!==G.version){Z(pe,G,V);return}n.activeTexture(33984+V),n.bindTexture(32879,pe.__webglTexture)}function $(G,V){if(G.image.length!==6)return;const pe=i.get(G);if(G.version>0&&pe.__version!==G.version){Q(pe,G),n.activeTexture(33984+V),n.bindTexture(34067,pe.__webglTexture),e.pixelStorei(37440,G.flipY);const le=G&&(G.isCompressedTexture||G.image[0].isCompressedTexture),ne=G.image[0]&&G.image[0].isDataTexture,oe=[];for(let Te=0;Te<6;Te++)!le&&!ne?oe[Te]=v(G.image[Te],!1,!0,l):oe[Te]=ne?G.image[Te].image:G.image[Te];const xe=oe[0],Ae=d(xe)||a,ge=o.convert(G.format),Me=o.convert(G.type),be=_(G.internalFormat,ge,Me);W(34067,G,Ae);let Oe;if(le){for(let Te=0;Te<6;Te++){Oe=oe[Te].mipmaps;for(let Ce=0;Ce<Oe.length;Ce++){const Ge=Oe[Ce];G.format!==er&&G.format!==rc?ge!==null?n.compressedTexImage2D(34069+Te,Ce,be,Ge.width,Ge.height,0,Ge.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+Te,Ce,be,Ge.width,Ge.height,0,ge,Me,Ge.data)}}pe.__maxMipLevel=Oe.length-1}else{Oe=G.mipmaps;for(let Te=0;Te<6;Te++)if(ne){n.texImage2D(34069+Te,0,be,oe[Te].width,oe[Te].height,0,ge,Me,oe[Te].data);for(let Ce=0;Ce<Oe.length;Ce++){const at=Oe[Ce].image[Te].image;n.texImage2D(34069+Te,Ce+1,be,at.width,at.height,0,ge,Me,at.data)}}else{n.texImage2D(34069+Te,0,be,ge,Me,oe[Te]);for(let Ce=0;Ce<Oe.length;Ce++){const Ge=Oe[Ce];n.texImage2D(34069+Te,Ce+1,be,ge,Me,Ge.image[Te])}}pe.__maxMipLevel=Oe.length}b(G,Ae)&&x(34067,G,xe.width,xe.height),pe.__version=G.version,G.onUpdate&&G.onUpdate(G)}else n.activeTexture(33984+V),n.bindTexture(34067,pe.__webglTexture)}function B(G,V){n.activeTexture(33984+V),n.bindTexture(34067,i.get(G).__webglTexture)}const q={[Qm]:10497,[Yi]:33071,[Jm]:33648},ee={[ln]:9728,[Qv]:9984,[Jv]:9986,[Xn]:9729,[CP]:9985,[d0]:9987};function W(G,V,pe){pe?(e.texParameteri(G,10242,q[V.wrapS]),e.texParameteri(G,10243,q[V.wrapT]),(G===32879||G===35866)&&e.texParameteri(G,32882,q[V.wrapR]),e.texParameteri(G,10240,ee[V.magFilter]),e.texParameteri(G,10241,ee[V.minFilter])):(e.texParameteri(G,10242,33071),e.texParameteri(G,10243,33071),(G===32879||G===35866)&&e.texParameteri(G,32882,33071),(V.wrapS!==Yi||V.wrapT!==Yi)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(G,10240,S(V.magFilter)),e.texParameteri(G,10241,S(V.minFilter)),V.minFilter!==ln&&V.minFilter!==Xn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const le=t.get("EXT_texture_filter_anisotropic");if(le){if(V.type===cs&&t.get("OES_texture_float_linear")===null||V.type===tg&&(a||t.get("OES_texture_half_float_linear"))===null)return;(V.anisotropy>1||i.get(V).__currentAnisotropy)&&(e.texParameterf(G,le.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(V.anisotropy,r.getMaxAnisotropy())),i.get(V).__currentAnisotropy=V.anisotropy)}}function Q(G,V){G.__webglInit===void 0&&(G.__webglInit=!0,V.addEventListener("dispose",w),G.__webglTexture=e.createTexture(),s.memory.textures++)}function Z(G,V,pe){let le=3553;V.isDataTexture2DArray&&(le=35866),V.isDataTexture3D&&(le=32879),Q(G,V),n.activeTexture(33984+pe),n.bindTexture(le,G.__webglTexture),e.pixelStorei(37440,V.flipY),e.pixelStorei(37441,V.premultiplyAlpha),e.pixelStorei(3317,V.unpackAlignment);const ne=g(V)&&d(V.image)===!1,oe=v(V.image,ne,!1,u),xe=d(oe)||a,Ae=o.convert(V.format);let ge=o.convert(V.type),Me=_(V.internalFormat,Ae,ge);W(le,V,xe);let be;const Oe=V.mipmaps;if(V.isDepthTexture)Me=6402,a?V.type===cs?Me=36012:V.type===cm?Me=33190:V.type===jh?Me=35056:Me=33189:V.type===cs&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),V.format===jl&&Me===6402&&V.type!==eg&&V.type!==cm&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),V.type=eg,ge=o.convert(V.type)),V.format===wf&&Me===6402&&(Me=34041,V.type!==jh&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),V.type=jh,ge=o.convert(V.type))),n.texImage2D(3553,0,Me,oe.width,oe.height,0,Ae,ge,null);else if(V.isDataTexture)if(Oe.length>0&&xe){for(let Te=0,Ce=Oe.length;Te<Ce;Te++)be=Oe[Te],n.texImage2D(3553,Te,Me,be.width,be.height,0,Ae,ge,be.data);V.generateMipmaps=!1,G.__maxMipLevel=Oe.length-1}else n.texImage2D(3553,0,Me,oe.width,oe.height,0,Ae,ge,oe.data),G.__maxMipLevel=0;else if(V.isCompressedTexture){for(let Te=0,Ce=Oe.length;Te<Ce;Te++)be=Oe[Te],V.format!==er&&V.format!==rc?Ae!==null?n.compressedTexImage2D(3553,Te,Me,be.width,be.height,0,be.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,Te,Me,be.width,be.height,0,Ae,ge,be.data);G.__maxMipLevel=Oe.length-1}else if(V.isDataTexture2DArray)n.texImage3D(35866,0,Me,oe.width,oe.height,oe.depth,0,Ae,ge,oe.data),G.__maxMipLevel=0;else if(V.isDataTexture3D)n.texImage3D(32879,0,Me,oe.width,oe.height,oe.depth,0,Ae,ge,oe.data),G.__maxMipLevel=0;else if(Oe.length>0&&xe){for(let Te=0,Ce=Oe.length;Te<Ce;Te++)be=Oe[Te],n.texImage2D(3553,Te,Me,Ae,ge,be);V.generateMipmaps=!1,G.__maxMipLevel=Oe.length-1}else n.texImage2D(3553,0,Me,Ae,ge,oe),G.__maxMipLevel=0;b(V,xe)&&x(le,V,oe.width,oe.height),G.__version=V.version,V.onUpdate&&V.onUpdate(V)}function re(G,V,pe,le){const ne=o.convert(V.texture.format),oe=o.convert(V.texture.type),xe=_(V.texture.internalFormat,ne,oe);n.texImage2D(le,0,xe,V.width,V.height,0,ne,oe,null),e.bindFramebuffer(36160,G),e.framebufferTexture2D(36160,pe,le,i.get(V.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function he(G,V,pe){if(e.bindRenderbuffer(36161,G),V.depthBuffer&&!V.stencilBuffer){let le=33189;if(pe){const ne=V.depthTexture;ne&&ne.isDepthTexture&&(ne.type===cs?le=36012:ne.type===cm&&(le=33190));const oe=j(V);e.renderbufferStorageMultisample(36161,oe,le,V.width,V.height)}else e.renderbufferStorage(36161,le,V.width,V.height);e.framebufferRenderbuffer(36160,36096,36161,G)}else if(V.depthBuffer&&V.stencilBuffer){if(pe){const le=j(V);e.renderbufferStorageMultisample(36161,le,35056,V.width,V.height)}else e.renderbufferStorage(36161,34041,V.width,V.height);e.framebufferRenderbuffer(36160,33306,36161,G)}else{const le=o.convert(V.texture.format),ne=o.convert(V.texture.type),oe=_(V.texture.internalFormat,le,ne);if(pe){const xe=j(V);e.renderbufferStorageMultisample(36161,xe,oe,V.width,V.height)}else e.renderbufferStorage(36161,oe,V.width,V.height)}e.bindRenderbuffer(36161,null)}function K(G,V){if(V&&V.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,G),!(V.depthTexture&&V.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(V.depthTexture).__webglTexture||V.depthTexture.image.width!==V.width||V.depthTexture.image.height!==V.height)&&(V.depthTexture.image.width=V.width,V.depthTexture.image.height=V.height,V.depthTexture.needsUpdate=!0),I(V.depthTexture,0);const le=i.get(V.depthTexture).__webglTexture;if(V.depthTexture.format===jl)e.framebufferTexture2D(36160,36096,3553,le,0);else if(V.depthTexture.format===wf)e.framebufferTexture2D(36160,33306,3553,le,0);else throw new Error("Unknown depthTexture format")}function ce(G){const V=i.get(G),pe=G.isWebGLCubeRenderTarget===!0;if(G.depthTexture){if(pe)throw new Error("target.depthTexture not supported in Cube render targets");K(V.__webglFramebuffer,G)}else if(pe){V.__webglDepthbuffer=[];for(let le=0;le<6;le++)e.bindFramebuffer(36160,V.__webglFramebuffer[le]),V.__webglDepthbuffer[le]=e.createRenderbuffer(),he(V.__webglDepthbuffer[le],G,!1)}else e.bindFramebuffer(36160,V.__webglFramebuffer),V.__webglDepthbuffer=e.createRenderbuffer(),he(V.__webglDepthbuffer,G,!1);e.bindFramebuffer(36160,null)}function se(G){const V=i.get(G),pe=i.get(G.texture);G.addEventListener("dispose",C),pe.__webglTexture=e.createTexture(),s.memory.textures++;const le=G.isWebGLCubeRenderTarget===!0,ne=G.isWebGLMultisampleRenderTarget===!0,oe=d(G)||a;if(a&&G.texture.format===rc&&(G.texture.type===cs||G.texture.type===tg)&&(G.texture.format=er,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),le){V.__webglFramebuffer=[];for(let xe=0;xe<6;xe++)V.__webglFramebuffer[xe]=e.createFramebuffer()}else if(V.__webglFramebuffer=e.createFramebuffer(),ne)if(a){V.__webglMultisampledFramebuffer=e.createFramebuffer(),V.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,V.__webglColorRenderbuffer);const xe=o.convert(G.texture.format),Ae=o.convert(G.texture.type),ge=_(G.texture.internalFormat,xe,Ae),Me=j(G);e.renderbufferStorageMultisample(36161,Me,ge,G.width,G.height),e.bindFramebuffer(36160,V.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,V.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),G.depthBuffer&&(V.__webglDepthRenderbuffer=e.createRenderbuffer(),he(V.__webglDepthRenderbuffer,G,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(le){n.bindTexture(34067,pe.__webglTexture),W(34067,G.texture,oe);for(let xe=0;xe<6;xe++)re(V.__webglFramebuffer[xe],G,36064,34069+xe);b(G.texture,oe)&&x(34067,G.texture,G.width,G.height),n.bindTexture(34067,null)}else n.bindTexture(3553,pe.__webglTexture),W(3553,G.texture,oe),re(V.__webglFramebuffer,G,36064,3553),b(G.texture,oe)&&x(3553,G.texture,G.width,G.height),n.bindTexture(3553,null);G.depthBuffer&&ce(G)}function ue(G){const V=G.texture,pe=d(G)||a;if(b(V,pe)){const le=G.isWebGLCubeRenderTarget?34067:3553,ne=i.get(V).__webglTexture;n.bindTexture(le,ne),x(le,V,G.width,G.height),n.bindTexture(le,null)}}function H(G){if(G.isWebGLMultisampleRenderTarget)if(a){const V=i.get(G);e.bindFramebuffer(36008,V.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,V.__webglFramebuffer);const pe=G.width,le=G.height;let ne=16384;G.depthBuffer&&(ne|=256),G.stencilBuffer&&(ne|=1024),e.blitFramebuffer(0,0,pe,le,0,0,pe,le,ne,9728),e.bindFramebuffer(36160,V.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function j(G){return a&&G.isWebGLMultisampleRenderTarget?Math.min(h,G.samples):0}function X(G){const V=s.render.frame;f.get(G)!==V&&(f.set(G,V),G.update())}let ie=!1,fe=!1;function me(G,V){G&&G.isWebGLRenderTarget&&(ie===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),ie=!0),G=G.texture),I(G,V)}function ve(G,V){G&&G.isWebGLCubeRenderTarget&&(fe===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),fe=!0),G=G.texture),G&&G.isCubeTexture||Array.isArray(G.image)&&G.image.length===6?$(G,V):B(G,V)}this.allocateTextureUnit=F,this.resetTextureUnits=D,this.setTexture2D=I,this.setTexture2DArray=P,this.setTexture3D=N,this.setTextureCube=$,this.setTextureCubeDynamic=B,this.setupRenderTarget=se,this.updateRenderTargetMipmap=ue,this.updateMultisampleRenderTarget=H,this.safeSetTexture2D=me,this.safeSetTextureCube=ve}function eB(e,t,n){const i=n.isWebGL2;function r(o){let s;if(o===gc)return 5121;if(o===qL)return 32819;if(o===XL)return 32820;if(o===YL)return 33635;if(o===HL)return 5120;if(o===jL)return 5122;if(o===eg)return 5123;if(o===WL)return 5124;if(o===cm)return 5125;if(o===cs)return 5126;if(o===tg)return i?5131:(s=t.get("OES_texture_half_float"),s!==null?s.HALF_FLOAT_OES:null);if(o===ZL)return 6406;if(o===rc)return 6407;if(o===er)return 6408;if(o===KL)return 6409;if(o===QL)return 6410;if(o===jl)return 6402;if(o===wf)return 34041;if(o===eR)return 6403;if(o===tR)return 36244;if(o===nR)return 33319;if(o===iR)return 33320;if(o===rR)return 36248;if(o===oR)return 36249;if(o===cw||o===lw||o===uw||o===hw)if(s=t.get("WEBGL_compressed_texture_s3tc"),s!==null){if(o===cw)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(o===lw)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(o===uw)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(o===hw)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(o===fw||o===pw||o===dw||o===mw)if(s=t.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(o===fw)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(o===pw)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(o===dw)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(o===mw)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(o===sR)return s=t.get("WEBGL_compressed_texture_etc1"),s!==null?s.COMPRESSED_RGB_ETC1_WEBGL:null;if((o===gw||o===yw)&&(s=t.get("WEBGL_compressed_texture_etc"),s!==null)){if(o===gw)return s.COMPRESSED_RGB8_ETC2;if(o===yw)return s.COMPRESSED_RGBA8_ETC2_EAC}if(o===aR||o===cR||o===lR||o===uR||o===hR||o===fR||o===pR||o===dR||o===mR||o===gR||o===yR||o===vR||o===xR||o===bR||o===wR||o===SR||o===MR||o===AR||o===CR||o===PR||o===TR||o===ER||o===IR||o===LR||o===RR||o===OR||o===kR||o===DR)return s=t.get("WEBGL_compressed_texture_astc"),s!==null?o:null;if(o===_R)return s=t.get("EXT_texture_compression_bptc"),s!==null?o:null;if(o===jh)return i?34042:(s=t.get("WEBGL_depth_texture"),s!==null?s.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:r}}function ax(e){jn.call(this),this.cameras=e||[]}ax.prototype=Object.assign(Object.create(jn.prototype),{constructor:ax,isArrayCamera:!0});function nn(){je.call(this),this.type="Group"}nn.prototype=Object.assign(Object.create(je.prototype),{constructor:nn,isGroup:!0});function og(){this._targetRay=null,this._grip=null}Object.assign(og.prototype,{constructor:og,getTargetRaySpace:function(){return this._targetRay===null&&(this._targetRay=new nn,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return this._grip===null&&(this._grip=new nn,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this},update:function(e,t,n){let i=null,r=null;const o=this._targetRay,s=this._grip;return e&&(o!==null&&(i=t.getPose(e.targetRaySpace,n),i!==null&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale))),s!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),r!==null&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale)))),o!==null&&(o.visible=i!==null),s!==null&&(s.visible=r!==null),this}});function HP(e,t){const n=this;let i=null,r=1,o=null,s="local-floor",a=null;const c=[],l=new Map,u=new jn;u.layers.enable(1),u.viewport=new on;const h=new jn;h.layers.enable(2),h.viewport=new on;const f=[u,h],p=new ax;p.layers.enable(1),p.layers.enable(2);let m=null,y=null;this.enabled=!1,this.isPresenting=!1,this.getController=function(L){let D=c[L];return D===void 0&&(D=new og,c[L]=D),D.getTargetRaySpace()},this.getControllerGrip=function(L){let D=c[L];return D===void 0&&(D=new og,c[L]=D),D.getGripSpace()};function v(L){const D=l.get(L.inputSource);D&&D.dispatchEvent({type:L.type})}function d(){l.forEach(function(L,D){L.disconnect(D)}),l.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),k.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function g(L){o=L,k.setContext(i),k.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}this.setFramebufferScaleFactor=function(L){r=L,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(L){s=L,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return i},this.setSession=function(L){if(i=L,i!==null){i.addEventListener("select",v),i.addEventListener("selectstart",v),i.addEventListener("selectend",v),i.addEventListener("squeeze",v),i.addEventListener("squeezestart",v),i.addEventListener("squeezeend",v),i.addEventListener("end",d);const D=t.getContextAttributes();D.xrCompatible!==!0&&t.makeXRCompatible();const F={antialias:D.antialias,alpha:D.alpha,depth:D.depth,stencil:D.stencil,framebufferScaleFactor:r},I=new XRWebGLLayer(i,t,F);i.updateRenderState({baseLayer:I}),i.requestReferenceSpace(s).then(g),i.addEventListener("inputsourceschange",b)}};function b(L){const D=i.inputSources;for(let F=0;F<c.length;F++)l.set(D[F],c[F]);for(let F=0;F<L.removed.length;F++){const I=L.removed[F],P=l.get(I);P&&(P.dispatchEvent({type:"disconnected",data:I}),l.delete(I))}for(let F=0;F<L.added.length;F++){const I=L.added[F],P=l.get(I);P&&P.dispatchEvent({type:"connected",data:I})}}const x=new T,_=new T;function S(L,D,F){x.setFromMatrixPosition(D.matrixWorld),_.setFromMatrixPosition(F.matrixWorld);const I=x.distanceTo(_),P=D.projectionMatrix.elements,N=F.projectionMatrix.elements,$=P[14]/(P[10]-1),B=P[14]/(P[10]+1),q=(P[9]+1)/P[5],ee=(P[9]-1)/P[5],W=(P[8]-1)/P[0],Q=(N[8]+1)/N[0],Z=$*W,re=$*Q,he=I/(-W+Q),K=he*-W;D.matrixWorld.decompose(L.position,L.quaternion,L.scale),L.translateX(K),L.translateZ(he),L.matrixWorld.compose(L.position,L.quaternion,L.scale),L.matrixWorldInverse.getInverse(L.matrixWorld);const ce=$+he,se=B+he,ue=Z-K,H=re+(I-K),j=q*B/se*ce,X=ee*B/se*ce;L.projectionMatrix.makePerspective(ue,H,j,X,ce,se)}function w(L,D){D===null?L.matrixWorld.copy(L.matrix):L.matrixWorld.multiplyMatrices(D.matrixWorld,L.matrix),L.matrixWorldInverse.getInverse(L.matrixWorld)}this.getCamera=function(L){p.near=h.near=u.near=L.near,p.far=h.far=u.far=L.far,(m!==p.near||y!==p.far)&&(i.updateRenderState({depthNear:p.near,depthFar:p.far}),m=p.near,y=p.far);const D=L.parent,F=p.cameras;w(p,D);for(let P=0;P<F.length;P++)w(F[P],D);L.matrixWorld.copy(p.matrixWorld);const I=L.children;for(let P=0,N=I.length;P<N;P++)I[P].updateMatrixWorld(!0);return F.length===2?S(p,u,h):p.projectionMatrix.copy(u.projectionMatrix),p};let C=null;function A(L,D){if(a=D.getViewerPose(o),a!==null){const I=a.views,P=i.renderState.baseLayer;e.setFramebuffer(P.framebuffer);let N=!1;I.length!==p.cameras.length&&(p.cameras.length=0,N=!0);for(let $=0;$<I.length;$++){const B=I[$],q=P.getViewport(B),ee=f[$];ee.matrix.fromArray(B.transform.matrix),ee.projectionMatrix.fromArray(B.projectionMatrix),ee.viewport.set(q.x,q.y,q.width,q.height),$===0&&p.matrix.copy(ee.matrix),N===!0&&p.cameras.push(ee)}}const F=i.inputSources;for(let I=0;I<c.length;I++){const P=c[I],N=F[I];P.update(N,D,o)}C&&C(L,D)}const k=new DP;k.setAnimationLoop(A),this.setAnimationLoop=function(L){C=L},this.dispose=function(){}}Object.assign(HP.prototype,Es.prototype);function tB(e){function t(d,g){d.fogColor.value.copy(g.color),g.isFog?(d.fogNear.value=g.near,d.fogFar.value=g.far):g.isFogExp2&&(d.fogDensity.value=g.density)}function n(d,g,b,x,_){g.isMeshBasicMaterial?i(d,g):g.isMeshLambertMaterial?(i(d,g),c(d,g)):g.isMeshToonMaterial?(i(d,g),u(d,g)):g.isMeshPhongMaterial?(i(d,g),l(d,g)):g.isMeshStandardMaterial?(i(d,g,b),g.isMeshPhysicalMaterial?f(d,g,b):h(d,g,b)):g.isMeshMatcapMaterial?(i(d,g),p(d,g)):g.isMeshDepthMaterial?(i(d,g),m(d,g)):g.isMeshDistanceMaterial?(i(d,g),y(d,g)):g.isMeshNormalMaterial?(i(d,g),v(d,g)):g.isLineBasicMaterial?(r(d,g),g.isLineDashedMaterial&&o(d,g)):g.isPointsMaterial?s(d,g,x,_):g.isSpriteMaterial?a(d,g):g.isShadowMaterial?(d.color.value.copy(g.color),d.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function i(d,g,b){d.opacity.value=g.opacity,g.color&&d.diffuse.value.copy(g.color),g.emissive&&d.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(d.map.value=g.map),g.alphaMap&&(d.alphaMap.value=g.alphaMap),g.specularMap&&(d.specularMap.value=g.specularMap);const x=g.envMap||b;x&&(d.envMap.value=x,d.flipEnvMap.value=x.isCubeTexture?-1:1,d.reflectivity.value=g.reflectivity,d.refractionRatio.value=g.refractionRatio,d.maxMipLevel.value=e.get(x).__maxMipLevel),g.lightMap&&(d.lightMap.value=g.lightMap,d.lightMapIntensity.value=g.lightMapIntensity),g.aoMap&&(d.aoMap.value=g.aoMap,d.aoMapIntensity.value=g.aoMapIntensity);let _;g.map?_=g.map:g.specularMap?_=g.specularMap:g.displacementMap?_=g.displacementMap:g.normalMap?_=g.normalMap:g.bumpMap?_=g.bumpMap:g.roughnessMap?_=g.roughnessMap:g.metalnessMap?_=g.metalnessMap:g.alphaMap?_=g.alphaMap:g.emissiveMap&&(_=g.emissiveMap),_!==void 0&&(_.isWebGLRenderTarget&&(_=_.texture),_.matrixAutoUpdate===!0&&_.updateMatrix(),d.uvTransform.value.copy(_.matrix));let S;g.aoMap?S=g.aoMap:g.lightMap&&(S=g.lightMap),S!==void 0&&(S.isWebGLRenderTarget&&(S=S.texture),S.matrixAutoUpdate===!0&&S.updateMatrix(),d.uv2Transform.value.copy(S.matrix))}function r(d,g){d.diffuse.value.copy(g.color),d.opacity.value=g.opacity}function o(d,g){d.dashSize.value=g.dashSize,d.totalSize.value=g.dashSize+g.gapSize,d.scale.value=g.scale}function s(d,g,b,x){d.diffuse.value.copy(g.color),d.opacity.value=g.opacity,d.size.value=g.size*b,d.scale.value=x*.5,g.map&&(d.map.value=g.map),g.alphaMap&&(d.alphaMap.value=g.alphaMap);let _;g.map?_=g.map:g.alphaMap&&(_=g.alphaMap),_!==void 0&&(_.matrixAutoUpdate===!0&&_.updateMatrix(),d.uvTransform.value.copy(_.matrix))}function a(d,g){d.diffuse.value.copy(g.color),d.opacity.value=g.opacity,d.rotation.value=g.rotation,g.map&&(d.map.value=g.map),g.alphaMap&&(d.alphaMap.value=g.alphaMap);let b;g.map?b=g.map:g.alphaMap&&(b=g.alphaMap),b!==void 0&&(b.matrixAutoUpdate===!0&&b.updateMatrix(),d.uvTransform.value.copy(b.matrix))}function c(d,g){g.emissiveMap&&(d.emissiveMap.value=g.emissiveMap)}function l(d,g){d.specular.value.copy(g.specular),d.shininess.value=Math.max(g.shininess,1e-4),g.emissiveMap&&(d.emissiveMap.value=g.emissiveMap),g.bumpMap&&(d.bumpMap.value=g.bumpMap,d.bumpScale.value=g.bumpScale,g.side===Kn&&(d.bumpScale.value*=-1)),g.normalMap&&(d.normalMap.value=g.normalMap,d.normalScale.value.copy(g.normalScale),g.side===Kn&&d.normalScale.value.negate()),g.displacementMap&&(d.displacementMap.value=g.displacementMap,d.displacementScale.value=g.displacementScale,d.displacementBias.value=g.displacementBias)}function u(d,g){g.gradientMap&&(d.gradientMap.value=g.gradientMap),g.emissiveMap&&(d.emissiveMap.value=g.emissiveMap),g.bumpMap&&(d.bumpMap.value=g.bumpMap,d.bumpScale.value=g.bumpScale,g.side===Kn&&(d.bumpScale.value*=-1)),g.normalMap&&(d.normalMap.value=g.normalMap,d.normalScale.value.copy(g.normalScale),g.side===Kn&&d.normalScale.value.negate()),g.displacementMap&&(d.displacementMap.value=g.displacementMap,d.displacementScale.value=g.displacementScale,d.displacementBias.value=g.displacementBias)}function h(d,g,b){d.roughness.value=g.roughness,d.metalness.value=g.metalness,g.roughnessMap&&(d.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(d.metalnessMap.value=g.metalnessMap),g.emissiveMap&&(d.emissiveMap.value=g.emissiveMap),g.bumpMap&&(d.bumpMap.value=g.bumpMap,d.bumpScale.value=g.bumpScale,g.side===Kn&&(d.bumpScale.value*=-1)),g.normalMap&&(d.normalMap.value=g.normalMap,d.normalScale.value.copy(g.normalScale),g.side===Kn&&d.normalScale.value.negate()),g.displacementMap&&(d.displacementMap.value=g.displacementMap,d.displacementScale.value=g.displacementScale,d.displacementBias.value=g.displacementBias),(g.envMap||b)&&(d.envMapIntensity.value=g.envMapIntensity)}function f(d,g,b){h(d,g,b),d.reflectivity.value=g.reflectivity,d.clearcoat.value=g.clearcoat,d.clearcoatRoughness.value=g.clearcoatRoughness,g.sheen&&d.sheen.value.copy(g.sheen),g.clearcoatMap&&(d.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(d.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(d.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),d.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===Kn&&d.clearcoatNormalScale.value.negate()),d.transparency.value=g.transparency}function p(d,g){g.matcap&&(d.matcap.value=g.matcap),g.bumpMap&&(d.bumpMap.value=g.bumpMap,d.bumpScale.value=g.bumpScale,g.side===Kn&&(d.bumpScale.value*=-1)),g.normalMap&&(d.normalMap.value=g.normalMap,d.normalScale.value.copy(g.normalScale),g.side===Kn&&d.normalScale.value.negate()),g.displacementMap&&(d.displacementMap.value=g.displacementMap,d.displacementScale.value=g.displacementScale,d.displacementBias.value=g.displacementBias)}function m(d,g){g.displacementMap&&(d.displacementMap.value=g.displacementMap,d.displacementScale.value=g.displacementScale,d.displacementBias.value=g.displacementBias)}function y(d,g){g.displacementMap&&(d.displacementMap.value=g.displacementMap,d.displacementScale.value=g.displacementScale,d.displacementBias.value=g.displacementBias),d.referencePosition.value.copy(g.referencePosition),d.nearDistance.value=g.nearDistance,d.farDistance.value=g.farDistance}function v(d,g){g.bumpMap&&(d.bumpMap.value=g.bumpMap,d.bumpScale.value=g.bumpScale,g.side===Kn&&(d.bumpScale.value*=-1)),g.normalMap&&(d.normalMap.value=g.normalMap,d.normalScale.value.copy(g.normalScale),g.side===Kn&&d.normalScale.value.negate()),g.displacementMap&&(d.displacementMap.value=g.displacementMap,d.displacementScale.value=g.displacementScale,d.displacementBias.value=g.displacementBias)}return{refreshFogUniforms:t,refreshMaterialUniforms:n}}function bp(e){e=e||{};const t=e.canvas!==void 0?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=e.context!==void 0?e.context:null,i=e.alpha!==void 0?e.alpha:!1,r=e.depth!==void 0?e.depth:!0,o=e.stencil!==void 0?e.stencil:!0,s=e.antialias!==void 0?e.antialias:!1,a=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,c=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,l=e.powerPreference!==void 0?e.powerPreference:"default",u=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1;let h=null,f=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Ti,this.physicallyCorrectLights=!1,this.toneMapping=Hl,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const p=this;let m=!1,y=null,v=0,d=0,g=null,b=null,x=-1,_=null,S=null;const w=new on,C=new on;let A=null,k=t.width,L=t.height,D=1,F=null,I=null;const P=new on(0,0,k,L),N=new on(0,0,k,L);let $=!1;const B=new xp,q=new Rk;let ee=!1,W=!1;const Q=new De,Z=new T,re={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function he(){return g===null?D:1}let K=n;function ce(Y,Se){for(let ye=0;ye<Y.length;ye++){const M=Y[ye],E=t.getContext(M,Se);if(E!==null)return E}return null}try{const Y={alpha:i,depth:r,stencil:o,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:c,powerPreference:l,failIfMajorPerformanceCaveat:u};if(t.addEventListener("webglcontextlost",Ce,!1),t.addEventListener("webglcontextrestored",Ge,!1),K===null){const Se=["webgl2","webgl","experimental-webgl"];if(p.isWebGL1Renderer===!0&&Se.shift(),K=ce(Se,Y),K===null)throw ce(Se)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}K.getShaderPrecisionFormat===void 0&&(K.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Y){throw console.error("THREE.WebGLRenderer: "+Y.message),Y}let se,ue,H,j,X,ie,fe,me,ve,G,V,pe,le,ne,oe,xe,Ae,ge,Me;function be(){se=new Ok(K),ue=new Lk(K,se,e),ue.isWebGL2===!1&&(se.get("WEBGL_depth_texture"),se.get("OES_texture_float"),se.get("OES_texture_half_float"),se.get("OES_texture_half_float_linear"),se.get("OES_standard_derivatives"),se.get("OES_element_index_uint"),se.get("OES_vertex_array_object"),se.get("ANGLE_instanced_arrays")),se.get("OES_texture_float_linear"),ge=new eB(K,se,ue),H=new QD(K,se,ue),H.scissor(C.copy(N).multiplyScalar(D).floor()),H.viewport(w.copy(P).multiplyScalar(D).floor()),j=new Bk,X=new UD,ie=new JD(K,se,H,X,ue,ge,j),fe=new cO(K,ue),Me=new Ek(K,se,fe,ue),me=new kk(K,fe,j,Me),ve=new Uk(K,me,fe,j),oe=new zk(K),G=new zD(p,se,ue,Me),V=new tB(X),pe=new VD,le=new YD,ne=new Tk(p,H,ve,a),xe=new Ik(K,se,j,ue),Ae=new Dk(K,se,j,ue),j.programs=G.programs,p.capabilities=ue,p.extensions=se,p.properties=X,p.renderLists=pe,p.state=H,p.info=j}be();const Oe=new HP(p,K);this.xr=Oe;const Te=new VP(p,ve,ue.maxTextureSize);this.shadowMap=Te,this.getContext=function(){return K},this.getContextAttributes=function(){return K.getContextAttributes()},this.forceContextLoss=function(){const Y=se.get("WEBGL_lose_context");Y&&Y.loseContext()},this.forceContextRestore=function(){const Y=se.get("WEBGL_lose_context");Y&&Y.restoreContext()},this.getPixelRatio=function(){return D},this.setPixelRatio=function(Y){Y!==void 0&&(D=Y,this.setSize(k,L,!1))},this.getSize=function(Y){return Y===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),Y=new Ee),Y.set(k,L)},this.setSize=function(Y,Se,ye){if(Oe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}k=Y,L=Se,t.width=Math.floor(Y*D),t.height=Math.floor(Se*D),ye!==!1&&(t.style.width=Y+"px",t.style.height=Se+"px"),this.setViewport(0,0,Y,Se)},this.getDrawingBufferSize=function(Y){return Y===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),Y=new Ee),Y.set(k*D,L*D).floor()},this.setDrawingBufferSize=function(Y,Se,ye){k=Y,L=Se,D=ye,t.width=Math.floor(Y*ye),t.height=Math.floor(Se*ye),this.setViewport(0,0,Y,Se)},this.getCurrentViewport=function(Y){return Y===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),Y=new on),Y.copy(w)},this.getViewport=function(Y){return Y.copy(P)},this.setViewport=function(Y,Se,ye,M){Y.isVector4?P.set(Y.x,Y.y,Y.z,Y.w):P.set(Y,Se,ye,M),H.viewport(w.copy(P).multiplyScalar(D).floor())},this.getScissor=function(Y){return Y.copy(N)},this.setScissor=function(Y,Se,ye,M){Y.isVector4?N.set(Y.x,Y.y,Y.z,Y.w):N.set(Y,Se,ye,M),H.scissor(C.copy(N).multiplyScalar(D).floor())},this.getScissorTest=function(){return $},this.setScissorTest=function(Y){H.setScissorTest($=Y)},this.setOpaqueSort=function(Y){F=Y},this.setTransparentSort=function(Y){I=Y},this.getClearColor=function(){return ne.getClearColor()},this.setClearColor=function(){ne.setClearColor.apply(ne,arguments)},this.getClearAlpha=function(){return ne.getClearAlpha()},this.setClearAlpha=function(){ne.setClearAlpha.apply(ne,arguments)},this.clear=function(Y,Se,ye){let M=0;(Y===void 0||Y)&&(M|=16384),(Se===void 0||Se)&&(M|=256),(ye===void 0||ye)&&(M|=1024),K.clear(M)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ce,!1),t.removeEventListener("webglcontextrestored",Ge,!1),pe.dispose(),le.dispose(),X.dispose(),ve.dispose(),Me.dispose(),Oe.dispose(),qe.stop()};function Ce(Y){Y.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function Ge(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1,be()}function at(Y){const Se=Y.target;Se.removeEventListener("dispose",at),it(Se)}function it(Y){et(Y),X.remove(Y)}function et(Y){const Se=X.get(Y).program;Y.program=void 0,Se!==void 0&&G.releaseProgram(Se)}function mt(Y,Se){Y.render(function(ye){p.renderBufferImmediate(ye,Se)})}this.renderBufferImmediate=function(Y,Se){Me.initAttributes();const ye=X.get(Y);Y.hasPositions&&!ye.position&&(ye.position=K.createBuffer()),Y.hasNormals&&!ye.normal&&(ye.normal=K.createBuffer()),Y.hasUvs&&!ye.uv&&(ye.uv=K.createBuffer()),Y.hasColors&&!ye.color&&(ye.color=K.createBuffer());const M=Se.getAttributes();Y.hasPositions&&(K.bindBuffer(34962,ye.position),K.bufferData(34962,Y.positionArray,35048),Me.enableAttribute(M.position),K.vertexAttribPointer(M.position,3,5126,!1,0,0)),Y.hasNormals&&(K.bindBuffer(34962,ye.normal),K.bufferData(34962,Y.normalArray,35048),Me.enableAttribute(M.normal),K.vertexAttribPointer(M.normal,3,5126,!1,0,0)),Y.hasUvs&&(K.bindBuffer(34962,ye.uv),K.bufferData(34962,Y.uvArray,35048),Me.enableAttribute(M.uv),K.vertexAttribPointer(M.uv,2,5126,!1,0,0)),Y.hasColors&&(K.bindBuffer(34962,ye.color),K.bufferData(34962,Y.colorArray,35048),Me.enableAttribute(M.color),K.vertexAttribPointer(M.color,3,5126,!1,0,0)),Me.disableUnusedAttributes(),K.drawArrays(4,0,Y.count),Y.count=0},this.renderBufferDirect=function(Y,Se,ye,M,E,R){Se===null&&(Se=re);const z=E.isMesh&&E.matrixWorld.determinant()<0,U=Be(Y,Se,M,E);H.setMaterial(M,z);let J=ye.index;const te=ye.attributes.position;if(J===null){if(te===void 0||te.count===0)return}else if(J.count===0)return;let ae=1;M.wireframe===!0&&(J=me.getWireframeAttribute(ye),ae=2),(M.morphTargets||M.morphNormals)&&oe.update(E,ye,M,U),Me.setup(E,M,U,ye,J);let we,_e=xe;J!==null&&(we=fe.get(J),_e=Ae,_e.setIndex(we));const Ie=J!==null?J.count:te.count,Ue=ye.drawRange.start*ae,Re=ye.drawRange.count*ae,ke=R!==null?R.start*ae:0,ze=R!==null?R.count*ae:1/0,Ze=Math.max(Ue,ke),nt=Math.min(Ie,Ue+Re,ke+ze)-1,Qe=Math.max(0,nt-Ze+1);if(Qe!==0){if(E.isMesh)M.wireframe===!0?(H.setLineWidth(M.wireframeLinewidth*he()),_e.setMode(1)):_e.setMode(4);else if(E.isLine){let cn=M.linewidth;cn===void 0&&(cn=1),H.setLineWidth(cn*he()),E.isLineSegments?_e.setMode(1):E.isLineLoop?_e.setMode(2):_e.setMode(3)}else E.isPoints?_e.setMode(0):E.isSprite&&_e.setMode(4);if(E.isInstancedMesh)_e.renderInstances(ye,Ze,Qe,E.count);else if(ye.isInstancedBufferGeometry){const cn=Math.min(ye.instanceCount,ye._maxInstanceCount);_e.renderInstances(ye,Ze,Qe,cn)}else _e.render(Ze,Qe)}},this.compile=function(Y,Se){f=le.get(Y,Se),f.init(),Y.traverse(function(M){M.isLight&&(f.pushLight(M),M.castShadow&&f.pushShadow(M))}),f.setupLights(Se);const ye=new WeakMap;Y.traverse(function(M){let E=M.material;if(E)if(Array.isArray(E))for(let R=0;R<E.length;R++){let z=E[R];ye.has(z)===!1&&(Pt(z,Y,M),ye.set(z))}else ye.has(E)===!1&&(Pt(E,Y,M),ye.set(E))})};let vt=null;function lt(Y){Oe.isPresenting||vt&&vt(Y)}const qe=new DP;qe.setAnimationLoop(lt),typeof window<"u"&&qe.setContext(window),this.setAnimationLoop=function(Y){vt=Y,Oe.setAnimationLoop(Y),Y===null?qe.stop():qe.start()},this.render=function(Y,Se){let ye,M;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),ye=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),M=arguments[3]),Se!==void 0&&Se.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(m===!0)return;Me.resetDefaultState(),x=-1,_=null,Y.autoUpdate===!0&&Y.updateMatrixWorld(),Se.parent===null&&Se.updateMatrixWorld(),Oe.enabled===!0&&Oe.isPresenting===!0&&(Se=Oe.getCamera(Se)),Y.isScene===!0&&Y.onBeforeRender(p,Y,Se,ye||g),f=le.get(Y,Se),f.init(),Q.multiplyMatrices(Se.projectionMatrix,Se.matrixWorldInverse),B.setFromProjectionMatrix(Q),W=this.localClippingEnabled,ee=q.init(this.clippingPlanes,W,Se),h=pe.get(Y,Se),h.init(),Ct(Y,Se,0,p.sortObjects),h.finish(),p.sortObjects===!0&&h.sort(F,I),ee===!0&&q.beginShadows();const E=f.state.shadowsArray;Te.render(E,Y,Se),f.setupLights(Se),ee===!0&&q.endShadows(),this.info.autoReset===!0&&this.info.reset(),ye!==void 0&&this.setRenderTarget(ye),ne.render(h,Y,Se,M);const R=h.opaque,z=h.transparent;R.length>0&&tt(R,Y,Se),z.length>0&&tt(z,Y,Se),Y.isScene===!0&&Y.onAfterRender(p,Y,Se),g!==null&&(ie.updateRenderTargetMipmap(g),ie.updateMultisampleRenderTarget(g)),H.buffers.depth.setTest(!0),H.buffers.depth.setMask(!0),H.buffers.color.setMask(!0),H.setPolygonOffset(!1),h=null,f=null};function Ct(Y,Se,ye,M){if(Y.visible===!1)return;if(Y.layers.test(Se.layers)){if(Y.isGroup)ye=Y.renderOrder;else if(Y.isLOD)Y.autoUpdate===!0&&Y.update(Se);else if(Y.isLight)f.pushLight(Y),Y.castShadow&&f.pushShadow(Y);else if(Y.isSprite){if(!Y.frustumCulled||B.intersectsSprite(Y)){M&&Z.setFromMatrixPosition(Y.matrixWorld).applyMatrix4(Q);const z=ve.update(Y),U=Y.material;U.visible&&h.push(Y,z,U,ye,Z.z,null)}}else if(Y.isImmediateRenderObject)M&&Z.setFromMatrixPosition(Y.matrixWorld).applyMatrix4(Q),h.push(Y,null,Y.material,ye,Z.z,null);else if((Y.isMesh||Y.isLine||Y.isPoints)&&(Y.isSkinnedMesh&&Y.skeleton.frame!==j.render.frame&&(Y.skeleton.update(),Y.skeleton.frame=j.render.frame),!Y.frustumCulled||B.intersectsObject(Y))){M&&Z.setFromMatrixPosition(Y.matrixWorld).applyMatrix4(Q);const z=ve.update(Y),U=Y.material;if(Array.isArray(U)){const J=z.groups;for(let te=0,ae=J.length;te<ae;te++){const we=J[te],_e=U[we.materialIndex];_e&&_e.visible&&h.push(Y,z,_e,ye,Z.z,we)}}else U.visible&&h.push(Y,z,U,ye,Z.z,null)}}const R=Y.children;for(let z=0,U=R.length;z<U;z++)Ct(R[z],Se,ye,M)}function tt(Y,Se,ye){const M=Se.isScene===!0?Se.overrideMaterial:null;for(let E=0,R=Y.length;E<R;E++){const z=Y[E],U=z.object,J=z.geometry,te=M===null?z.material:M,ae=z.group;if(ye.isArrayCamera){S=ye;const we=ye.cameras;for(let _e=0,Ie=we.length;_e<Ie;_e++){const Ue=we[_e];U.layers.test(Ue.layers)&&(H.viewport(w.copy(Ue.viewport)),f.setupLights(Ue),Ve(U,Se,Ue,J,te,ae))}}else S=null,Ve(U,Se,ye,J,te,ae)}}function Ve(Y,Se,ye,M,E,R){if(Y.onBeforeRender(p,Se,ye,M,E,R),f=le.get(Se,S||ye),Y.modelViewMatrix.multiplyMatrices(ye.matrixWorldInverse,Y.matrixWorld),Y.normalMatrix.getNormalMatrix(Y.modelViewMatrix),Y.isImmediateRenderObject){const z=Be(ye,Se,E,Y);H.setMaterial(E),Me.reset(),mt(Y,z)}else p.renderBufferDirect(ye,Se,M,E,Y,R);Y.onAfterRender(p,Se,ye,M,E,R),f=le.get(Se,S||ye)}function Pt(Y,Se,ye){Se.isScene!==!0&&(Se=re);const M=X.get(Y),E=f.state.lights,R=f.state.shadowsArray,z=E.state.version,U=G.getParameters(Y,E.state,R,Se,q.numPlanes,q.numIntersection,ye),J=G.getProgramCacheKey(U);let te=M.program,ae=!0;if(te===void 0)Y.addEventListener("dispose",at);else if(te.cacheKey!==J)et(Y);else if(M.lightsStateVersion!==z)M.lightsStateVersion=z,ae=!1;else{if(U.shaderID!==void 0)return;ae=!1}ae&&(te=G.acquireProgram(U,J),M.program=te,M.uniforms=U.uniforms,M.outputEncoding=U.outputEncoding,Y.program=te);const we=te.getAttributes();if(Y.morphTargets){Y.numSupportedMorphTargets=0;for(let Re=0;Re<p.maxMorphTargets;Re++)we["morphTarget"+Re]>=0&&Y.numSupportedMorphTargets++}if(Y.morphNormals){Y.numSupportedMorphNormals=0;for(let Re=0;Re<p.maxMorphNormals;Re++)we["morphNormal"+Re]>=0&&Y.numSupportedMorphNormals++}const _e=M.uniforms;(!Y.isShaderMaterial&&!Y.isRawShaderMaterial||Y.clipping===!0)&&(M.numClippingPlanes=q.numPlanes,M.numIntersection=q.numIntersection,_e.clippingPlanes=q.uniform),M.environment=Y.isMeshStandardMaterial?Se.environment:null,M.fog=Se.fog,M.needsLights=Je(Y),M.lightsStateVersion=z,M.needsLights&&(_e.ambientLightColor.value=E.state.ambient,_e.lightProbe.value=E.state.probe,_e.directionalLights.value=E.state.directional,_e.directionalLightShadows.value=E.state.directionalShadow,_e.spotLights.value=E.state.spot,_e.spotLightShadows.value=E.state.spotShadow,_e.rectAreaLights.value=E.state.rectArea,_e.pointLights.value=E.state.point,_e.pointLightShadows.value=E.state.pointShadow,_e.hemisphereLights.value=E.state.hemi,_e.directionalShadowMap.value=E.state.directionalShadowMap,_e.directionalShadowMatrix.value=E.state.directionalShadowMatrix,_e.spotShadowMap.value=E.state.spotShadowMap,_e.spotShadowMatrix.value=E.state.spotShadowMatrix,_e.pointShadowMap.value=E.state.pointShadowMap,_e.pointShadowMatrix.value=E.state.pointShadowMatrix);const Ie=M.program.getUniforms(),Ue=ga.seqWithValue(Ie.seq,_e);M.uniformsList=Ue}function Be(Y,Se,ye,M){Se.isScene!==!0&&(Se=re),ie.resetTextureUnits();const E=Se.fog,R=ye.isMeshStandardMaterial?Se.environment:null,z=g===null?p.outputEncoding:g.texture.encoding,U=X.get(ye),J=f.state.lights;if(ee===!0&&(W===!0||Y!==_)){const Re=Y===_&&ye.id===x;q.setState(ye.clippingPlanes,ye.clipIntersection,ye.clipShadows,Y,U,Re)}ye.version===U.__version?(U.program===void 0||ye.fog&&U.fog!==E||U.environment!==R||U.needsLights&&U.lightsStateVersion!==J.state.version||U.numClippingPlanes!==void 0&&(U.numClippingPlanes!==q.numPlanes||U.numIntersection!==q.numIntersection)||U.outputEncoding!==z)&&Pt(ye,Se,M):(Pt(ye,Se,M),U.__version=ye.version);let te=!1,ae=!1,we=!1;const _e=U.program,Ie=_e.getUniforms(),Ue=U.uniforms;if(H.useProgram(_e.program)&&(te=!0,ae=!0,we=!0),ye.id!==x&&(x=ye.id,ae=!0),te||_!==Y){if(Ie.setValue(K,"projectionMatrix",Y.projectionMatrix),ue.logarithmicDepthBuffer&&Ie.setValue(K,"logDepthBufFC",2/(Math.log(Y.far+1)/Math.LN2)),_!==Y&&(_=Y,ae=!0,we=!0),ye.isShaderMaterial||ye.isMeshPhongMaterial||ye.isMeshToonMaterial||ye.isMeshStandardMaterial||ye.envMap){const Re=Ie.map.cameraPosition;Re!==void 0&&Re.setValue(K,Z.setFromMatrixPosition(Y.matrixWorld))}(ye.isMeshPhongMaterial||ye.isMeshToonMaterial||ye.isMeshLambertMaterial||ye.isMeshBasicMaterial||ye.isMeshStandardMaterial||ye.isShaderMaterial)&&Ie.setValue(K,"isOrthographic",Y.isOrthographicCamera===!0),(ye.isMeshPhongMaterial||ye.isMeshToonMaterial||ye.isMeshLambertMaterial||ye.isMeshBasicMaterial||ye.isMeshStandardMaterial||ye.isShaderMaterial||ye.isShadowMaterial||ye.skinning)&&Ie.setValue(K,"viewMatrix",Y.matrixWorldInverse)}if(ye.skinning){Ie.setOptional(K,M,"bindMatrix"),Ie.setOptional(K,M,"bindMatrixInverse");const Re=M.skeleton;if(Re){const ke=Re.bones;if(ue.floatVertexTextures){if(Re.boneTexture===void 0){let ze=Math.sqrt(ke.length*4);ze=It.ceilPowerOfTwo(ze),ze=Math.max(ze,4);const Ze=new Float32Array(ze*ze*4);Ze.set(Re.boneMatrices);const nt=new xs(Ze,ze,ze,er,cs);Re.boneMatrices=Ze,Re.boneTexture=nt,Re.boneTextureSize=ze}Ie.setValue(K,"boneTexture",Re.boneTexture,ie),Ie.setValue(K,"boneTextureSize",Re.boneTextureSize)}else Ie.setOptional(K,Re,"boneMatrices")}}return(ae||U.receiveShadow!==M.receiveShadow)&&(U.receiveShadow=M.receiveShadow,Ie.setValue(K,"receiveShadow",M.receiveShadow)),ae&&(Ie.setValue(K,"toneMappingExposure",p.toneMappingExposure),U.needsLights&&$e(Ue,we),E&&ye.fog&&V.refreshFogUniforms(Ue,E),V.refreshMaterialUniforms(Ue,ye,R,D,L),Ue.ltc_1!==void 0&&(Ue.ltc_1.value=He.LTC_1),Ue.ltc_2!==void 0&&(Ue.ltc_2.value=He.LTC_2),ga.upload(K,U.uniformsList,Ue,ie)),ye.isShaderMaterial&&ye.uniformsNeedUpdate===!0&&(ga.upload(K,U.uniformsList,Ue,ie),ye.uniformsNeedUpdate=!1),ye.isSpriteMaterial&&Ie.setValue(K,"center",M.center),Ie.setValue(K,"modelViewMatrix",M.modelViewMatrix),Ie.setValue(K,"normalMatrix",M.normalMatrix),Ie.setValue(K,"modelMatrix",M.matrixWorld),_e}function $e(Y,Se){Y.ambientLightColor.needsUpdate=Se,Y.lightProbe.needsUpdate=Se,Y.directionalLights.needsUpdate=Se,Y.directionalLightShadows.needsUpdate=Se,Y.pointLights.needsUpdate=Se,Y.pointLightShadows.needsUpdate=Se,Y.spotLights.needsUpdate=Se,Y.spotLightShadows.needsUpdate=Se,Y.rectAreaLights.needsUpdate=Se,Y.hemisphereLights.needsUpdate=Se}function Je(Y){return Y.isMeshLambertMaterial||Y.isMeshToonMaterial||Y.isMeshPhongMaterial||Y.isMeshStandardMaterial||Y.isShadowMaterial||Y.isShaderMaterial&&Y.lights===!0}this.setFramebuffer=function(Y){y!==Y&&g===null&&K.bindFramebuffer(36160,Y),y=Y},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return d},this.getRenderTarget=function(){return g},this.setRenderTarget=function(Y,Se,ye){g=Y,v=Se,d=ye,Y&&X.get(Y).__webglFramebuffer===void 0&&ie.setupRenderTarget(Y);let M=y,E=!1;if(Y){const R=X.get(Y).__webglFramebuffer;Y.isWebGLCubeRenderTarget?(M=R[Se||0],E=!0):Y.isWebGLMultisampleRenderTarget?M=X.get(Y).__webglMultisampledFramebuffer:M=R,w.copy(Y.viewport),C.copy(Y.scissor),A=Y.scissorTest}else w.copy(P).multiplyScalar(D).floor(),C.copy(N).multiplyScalar(D).floor(),A=$;if(b!==M&&(K.bindFramebuffer(36160,M),b=M),H.viewport(w),H.scissor(C),H.setScissorTest(A),E){const R=X.get(Y.texture);K.framebufferTexture2D(36160,36064,34069+(Se||0),R.__webglTexture,ye||0)}},this.readRenderTargetPixels=function(Y,Se,ye,M,E,R,z){if(!(Y&&Y.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let U=X.get(Y).__webglFramebuffer;if(Y.isWebGLCubeRenderTarget&&z!==void 0&&(U=U[z]),U){let J=!1;U!==b&&(K.bindFramebuffer(36160,U),J=!0);try{const te=Y.texture,ae=te.format,we=te.type;if(ae!==er&&ge.convert(ae)!==K.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(we!==gc&&ge.convert(we)!==K.getParameter(35738)&&!(we===cs&&(ue.isWebGL2||se.get("OES_texture_float")||se.get("WEBGL_color_buffer_float")))&&!(we===tg&&(ue.isWebGL2?se.get("EXT_color_buffer_float"):se.get("EXT_color_buffer_half_float")))){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}K.checkFramebufferStatus(36160)===36053?Se>=0&&Se<=Y.width-M&&ye>=0&&ye<=Y.height-E&&K.readPixels(Se,ye,M,E,ge.convert(ae),ge.convert(we),R):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{J&&K.bindFramebuffer(36160,b)}}},this.copyFramebufferToTexture=function(Y,Se,ye){ye===void 0&&(ye=0);const M=Math.pow(2,-ye),E=Math.floor(Se.image.width*M),R=Math.floor(Se.image.height*M),z=ge.convert(Se.format);ie.setTexture2D(Se,0),K.copyTexImage2D(3553,ye,z,Y.x,Y.y,E,R,0),H.unbindTexture()},this.copyTextureToTexture=function(Y,Se,ye,M){M===void 0&&(M=0);const E=Se.image.width,R=Se.image.height,z=ge.convert(ye.format),U=ge.convert(ye.type);ie.setTexture2D(ye,0),K.pixelStorei(37440,ye.flipY),K.pixelStorei(37441,ye.premultiplyAlpha),K.pixelStorei(3317,ye.unpackAlignment),Se.isDataTexture?K.texSubImage2D(3553,M,Y.x,Y.y,E,R,z,U,Se.image.data):Se.isCompressedTexture?K.compressedTexSubImage2D(3553,M,Y.x,Y.y,Se.mipmaps[0].width,Se.mipmaps[0].height,z,Se.mipmaps[0].data):K.texSubImage2D(3553,M,Y.x,Y.y,z,U,Se.image),M===0&&ye.generateMipmaps&&K.generateMipmap(3553),H.unbindTexture()},this.initTexture=function(Y){ie.setTexture2D(Y,0),H.unbindTexture()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function $w(e){bp.call(this,e)}$w.prototype=Object.assign(Object.create(bp.prototype),{constructor:$w,isWebGL1Renderer:!0});function cx(e,t){this.name="",this.color=new Fe(e),this.density=t!==void 0?t:25e-5}Object.assign(cx.prototype,{isFogExp2:!0,clone:function(){return new cx(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}});function sg(e,t,n){this.name="",this.color=new Fe(e),this.near=t!==void 0?t:1,this.far=n!==void 0?n:1e3}Object.assign(sg.prototype,{isFog:!0,clone:function(){return new sg(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}});function Rr(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=m0,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=It.generateUUID()}Object.defineProperty(Rr.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}});Object.assign(Rr.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this},set:function(e,t){return t===void 0&&(t=0),this.array.set(e,t),this},clone:function(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=It.generateUUID()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new Rr(t,this.stride);return n.setUsage(this.usage),n},onUpload:function(e){return this.onUploadCallback=e,this},toJSON:function(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=It.generateUUID()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const $a=new T;function bc(e,t,n,i){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i===!0}Object.defineProperties(bc.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}});Object.assign(bc.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(let t=0,n=this.data.count;t<n;t++)$a.x=this.getX(t),$a.y=this.getY(t),$a.z=this.getZ(t),$a.applyMatrix4(e),this.setXYZ(t,$a.x,$a.y,$a.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this},clone:function(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return new rt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new bc(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}});function _c(e){bt.call(this),this.type="SpriteMaterial",this.color=new Fe(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}_c.prototype=Object.create(bt.prototype);_c.prototype.constructor=_c;_c.prototype.isSpriteMaterial=!0;_c.prototype.copy=function(e){return bt.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};let Xc;const oh=new T,Yc=new T,Zc=new T,Kc=new Ee,sh=new Ee,jP=new De,od=new T,ah=new T,sd=new T,Vw=new Ee,O1=new Ee,Hw=new Ee;function lx(e){if(je.call(this),this.type="Sprite",Xc===void 0){Xc=new We;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new Rr(t,5);Xc.setIndex([0,1,2,0,2,3]),Xc.setAttribute("position",new bc(n,3,0,!1)),Xc.setAttribute("uv",new bc(n,2,3,!1))}this.geometry=Xc,this.material=e!==void 0?e:new _c,this.center=new Ee(.5,.5)}lx.prototype=Object.assign(Object.create(je.prototype),{constructor:lx,isSprite:!0,raycast:function(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Yc.setFromMatrixScale(this.matrixWorld),jP.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Zc.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Yc.multiplyScalar(-Zc.z);const n=this.material.rotation;let i,r;n!==0&&(r=Math.cos(n),i=Math.sin(n));const o=this.center;ad(od.set(-.5,-.5,0),Zc,o,Yc,i,r),ad(ah.set(.5,-.5,0),Zc,o,Yc,i,r),ad(sd.set(.5,.5,0),Zc,o,Yc,i,r),Vw.set(0,0),O1.set(1,0),Hw.set(1,1);let s=e.ray.intersectTriangle(od,ah,sd,!1,oh);if(s===null&&(ad(ah.set(-.5,.5,0),Zc,o,Yc,i,r),O1.set(0,1),s=e.ray.intersectTriangle(od,sd,ah,!1,oh),s===null))return;const a=e.ray.origin.distanceTo(oh);a<e.near||a>e.far||t.push({distance:a,point:oh.clone(),uv:pi.getUV(oh,od,ah,sd,Vw,O1,Hw,new Ee),face:null,object:this})},copy:function(e){return je.prototype.copy.call(this,e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}});function ad(e,t,n,i,r,o){Kc.subVectors(e,n).addScalar(.5).multiply(i),r!==void 0?(sh.x=o*Kc.x-r*Kc.y,sh.y=r*Kc.x+o*Kc.y):sh.copy(Kc),e.copy(t),e.x+=sh.x,e.y+=sh.y,e.applyMatrix4(jP)}const cd=new T,jw=new T;function ag(){je.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}ag.prototype=Object.assign(Object.create(je.prototype),{constructor:ag,isLOD:!0,copy:function(e){je.prototype.copy.call(this,e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const r=t[n];this.addLevel(r.object.clone(),r.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){t===void 0&&(t=0),t=Math.abs(t);const n=this.levels;let i;for(i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object}return null},raycast:function(e,t){if(this.levels.length>0){cd.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(cd);this.getObjectForDistance(i).raycast(e,t)}},update:function(e){const t=this.levels;if(t.length>1){cd.setFromMatrixPosition(e.matrixWorld),jw.setFromMatrixPosition(this.matrixWorld);const n=cd.distanceTo(jw)/e.zoom;t[0].object.visible=!0;let i,r;for(i=1,r=t.length;i<r&&n>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}},toJSON:function(e){const t=je.prototype.toJSON.call(this,e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const o=n[i];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}});function ux(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),pn.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new De,this.bindMatrixInverse=new De}ux.prototype=Object.assign(Object.create(pn.prototype),{constructor:ux,isSkinnedMesh:!0,copy:function(e){return pn.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},bind:function(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const e=new on,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){pn.prototype.updateMatrixWorld.call(this,e),this.bindMode==="attached"?this.bindMatrixInverse.getInverse(this.matrixWorld):this.bindMode==="detached"?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(){const e=new T,t=new on,n=new on,i=new T,r=new De;return function(o,s){const a=this.skeleton,c=this.geometry;t.fromBufferAttribute(c.attributes.skinIndex,o),n.fromBufferAttribute(c.attributes.skinWeight,o),e.fromBufferAttribute(c.attributes.position,o).applyMatrix4(this.bindMatrix),s.set(0,0,0);for(let l=0;l<4;l++){const u=n.getComponent(l);if(u!==0){const h=t.getComponent(l);r.multiplyMatrices(a.bones[h].matrixWorld,a.boneInverses[h]),s.addScaledVector(i.copy(e).applyMatrix4(r),u)}}return s.applyMatrix4(this.bindMatrixInverse)}}()});const Ww=new De,nB=new De;function hx(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(this.bones.length*16),this.frame=-1,t===void 0)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(let n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new De)}}Object.assign(hx.prototype,{calculateInverses:function(){this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++){const n=new De;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},pose:function(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.getInverse(this.boneInverses[e])}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.getInverse(n.parent.matrixWorld),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}},update:function(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const s=e[r]?e[r].matrixWorld:nB;Ww.multiplyMatrices(s,t[r]),Ww.toArray(n,r*16)}i!==void 0&&(i.needsUpdate=!0)},clone:function(){return new hx(this.bones,this.boneInverses)},getBoneByName:function(e){for(let t=0,n=this.bones.length;t<n;t++){const i=this.bones[t];if(i.name===e)return i}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}});function qw(){je.call(this),this.type="Bone"}qw.prototype=Object.assign(Object.create(je.prototype),{constructor:qw,isBone:!0});const Xw=new De,Yw=new De,ld=[],ch=new pn;function fx(e,t,n){pn.call(this,e,t),this.instanceMatrix=new rt(new Float32Array(n*16),16),this.count=n,this.frustumCulled=!1}fx.prototype=Object.assign(Object.create(pn.prototype),{constructor:fx,isInstancedMesh:!0,copy:function(e){return pn.prototype.copy.call(this,e),this.instanceMatrix.copy(e.instanceMatrix),this.count=e.count,this},getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,e*16)},raycast:function(e,t){const n=this.matrixWorld,i=this.count;if(ch.geometry=this.geometry,ch.material=this.material,ch.material!==void 0)for(let r=0;r<i;r++){this.getMatrixAt(r,Xw),Yw.multiplyMatrices(n,Xw),ch.matrixWorld=Yw,ch.raycast(e,ld);for(let o=0,s=ld.length;o<s;o++){const a=ld[o];a.instanceId=r,a.object=this,t.push(a)}ld.length=0}},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,e*16)},updateMorphTargets:function(){}});function $n(e){bt.call(this),this.type="LineBasicMaterial",this.color=new Fe(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}$n.prototype=Object.create(bt.prototype);$n.prototype.constructor=$n;$n.prototype.isLineBasicMaterial=!0;$n.prototype.copy=function(e){return bt.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this};const Zw=new T,Kw=new T,Qw=new De,ud=new Ru,hd=new Is;function Nr(e,t,n){n===1&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),je.call(this),this.type="Line",this.geometry=e!==void 0?e:new We,this.material=t!==void 0?t:new $n,this.updateMorphTargets()}Nr.prototype=Object.assign(Object.create(je.prototype),{constructor:Nr,isLine:!0,copy:function(e){return je.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,n=[0];for(let i=1,r=t.count;i<r;i++)Zw.fromBufferAttribute(t,i-1),Kw.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=Zw.distanceTo(Kw);e.setAttribute("lineDistance",new Xe(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){const t=e.vertices,n=e.lineDistances;n[0]=0;for(let i=1,r=t.length;i<r;i++)n[i]=n[i-1],n[i]+=t[i-1].distanceTo(t[i])}return this},raycast:function(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold;if(n.boundingSphere===null&&n.computeBoundingSphere(),hd.copy(n.boundingSphere),hd.applyMatrix4(i),hd.radius+=r,e.ray.intersectsSphere(hd)===!1)return;Qw.getInverse(i),ud.copy(e.ray).applyMatrix4(Qw);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,a=new T,c=new T,l=new T,u=new T,h=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){const f=n.index,m=n.attributes.position.array;if(f!==null){const y=f.array;for(let v=0,d=y.length-1;v<d;v+=h){const g=y[v],b=y[v+1];if(a.fromArray(m,g*3),c.fromArray(m,b*3),ud.distanceSqToSegment(a,c,u,l)>s)continue;u.applyMatrix4(this.matrixWorld);const _=e.ray.origin.distanceTo(u);_<e.near||_>e.far||t.push({distance:_,point:l.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else for(let y=0,v=m.length/3-1;y<v;y+=h){if(a.fromArray(m,3*y),c.fromArray(m,3*y+3),ud.distanceSqToSegment(a,c,u,l)>s)continue;u.applyMatrix4(this.matrixWorld);const g=e.ray.origin.distanceTo(u);g<e.near||g>e.far||t.push({distance:g,point:l.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else if(n.isGeometry){const f=n.vertices,p=f.length;for(let m=0;m<p-1;m+=h){if(ud.distanceSqToSegment(f[m],f[m+1],u,l)>s)continue;u.applyMatrix4(this.matrixWorld);const v=e.ray.origin.distanceTo(u);v<e.near||v>e.far||t.push({distance:v,point:l.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const fd=new T,pd=new T;function On(e,t){Nr.call(this,e,t),this.type="LineSegments"}On.prototype=Object.assign(Object.create(Nr.prototype),{constructor:On,isLineSegments:!0,computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const t=e.attributes.position,n=[];for(let i=0,r=t.count;i<r;i+=2)fd.fromBufferAttribute(t,i),pd.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+fd.distanceTo(pd);e.setAttribute("lineDistance",new Xe(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){const t=e.vertices,n=e.lineDistances;for(let i=0,r=t.length;i<r;i+=2)fd.copy(t[i]),pd.copy(t[i+1]),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+fd.distanceTo(pd)}return this}});function px(e,t){Nr.call(this,e,t),this.type="LineLoop"}px.prototype=Object.assign(Object.create(Nr.prototype),{constructor:px,isLineLoop:!0});function wc(e){bt.call(this),this.type="PointsMaterial",this.color=new Fe(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}wc.prototype=Object.create(bt.prototype);wc.prototype.constructor=wc;wc.prototype.isPointsMaterial=!0;wc.prototype.copy=function(e){return bt.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};const Jw=new De,dx=new Ru,dd=new Is,md=new T;function Lf(e,t){je.call(this),this.type="Points",this.geometry=e!==void 0?e:new We,this.material=t!==void 0?t:new wc,this.updateMorphTargets()}Lf.prototype=Object.assign(Object.create(je.prototype),{constructor:Lf,isPoints:!0,copy:function(e){return je.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},raycast:function(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold;if(n.boundingSphere===null&&n.computeBoundingSphere(),dd.copy(n.boundingSphere),dd.applyMatrix4(i),dd.radius+=r,e.ray.intersectsSphere(dd)===!1)return;Jw.getInverse(i),dx.copy(e.ray).applyMatrix4(Jw);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(n.isBufferGeometry){const a=n.index,l=n.attributes.position.array;if(a!==null){const u=a.array;for(let h=0,f=u.length;h<f;h++){const p=u[h];md.fromArray(l,p*3),k1(md,p,s,i,e,t,this)}}else for(let u=0,h=l.length/3;u<h;u++)md.fromArray(l,u*3),k1(md,u,s,i,e,t,this)}else{const a=n.vertices;for(let c=0,l=a.length;c<l;c++)k1(a[c],c,s,i,e,t,this)}},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}else{const t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});function k1(e,t,n,i,r,o,s){const a=dx.distanceSqToPoint(e);if(a<n){const c=new T;dx.closestPointToPoint(e,c),c.applyMatrix4(i);const l=r.ray.origin.distanceTo(c);if(l<r.near||l>r.far)return;o.push({distance:l,distanceToRay:Math.sqrt(a),point:c,index:t,face:null,object:s})}}function e3(e,t,n,i,r,o,s,a,c){dn.call(this,e,t,n,i,r,o,s,a,c),this.format=s!==void 0?s:rc,this.minFilter=o!==void 0?o:Xn,this.magFilter=r!==void 0?r:Xn,this.generateMipmaps=!1}e3.prototype=Object.assign(Object.create(dn.prototype),{constructor:e3,isVideoTexture:!0,update:function(){const e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});function Rf(e,t,n,i,r,o,s,a,c,l,u,h){dn.call(this,null,o,s,a,c,l,i,r,u,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}Rf.prototype=Object.create(dn.prototype);Rf.prototype.constructor=Rf;Rf.prototype.isCompressedTexture=!0;function Of(e,t,n,i,r,o,s,a,c){dn.call(this,e,t,n,i,r,o,s,a,c),this.needsUpdate=!0}Of.prototype=Object.create(dn.prototype);Of.prototype.constructor=Of;Of.prototype.isCanvasTexture=!0;function cg(e,t,n,i,r,o,s,a,c,l){if(l=l!==void 0?l:jl,l!==jl&&l!==wf)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&l===jl&&(n=eg),n===void 0&&l===wf&&(n=jh),dn.call(this,null,i,r,o,s,a,l,n,c),this.image={width:e,height:t},this.magFilter=s!==void 0?s:ln,this.minFilter=a!==void 0?a:ln,this.flipY=!1,this.generateMipmaps=!1}cg.prototype=Object.create(dn.prototype);cg.prototype.constructor=cg;cg.prototype.isDepthTexture=!0;function lg(e){We.call(this),this.type="WireframeGeometry";const t=[],n=[0,0],i={},r=["a","b","c"];if(e&&e.isGeometry){const o=e.faces;for(let s=0,a=o.length;s<a;s++){const c=o[s];for(let l=0;l<3;l++){const u=c[r[l]],h=c[r[(l+1)%3]];n[0]=Math.min(u,h),n[1]=Math.max(u,h);const f=n[0]+","+n[1];i[f]===void 0&&(i[f]={index1:n[0],index2:n[1]})}}for(const s in i){const a=i[s];let c=e.vertices[a.index1];t.push(c.x,c.y,c.z),c=e.vertices[a.index2],t.push(c.x,c.y,c.z)}}else if(e&&e.isBufferGeometry){let o=new T;if(e.index!==null){const s=e.attributes.position,a=e.index;let c=e.groups;c.length===0&&(c=[{start:0,count:a.count,materialIndex:0}]);for(let l=0,u=c.length;l<u;++l){const h=c[l],f=h.start,p=h.count;for(let m=f,y=f+p;m<y;m+=3)for(let v=0;v<3;v++){const d=a.getX(m+v),g=a.getX(m+(v+1)%3);n[0]=Math.min(d,g),n[1]=Math.max(d,g);const b=n[0]+","+n[1];i[b]===void 0&&(i[b]={index1:n[0],index2:n[1]})}}for(const l in i){const u=i[l];o.fromBufferAttribute(s,u.index1),t.push(o.x,o.y,o.z),o.fromBufferAttribute(s,u.index2),t.push(o.x,o.y,o.z)}}else{const s=e.attributes.position;for(let a=0,c=s.count/3;a<c;a++)for(let l=0;l<3;l++){const u=3*a+l;o.fromBufferAttribute(s,u),t.push(o.x,o.y,o.z);const h=3*a+(l+1)%3;o.fromBufferAttribute(s,h),t.push(o.x,o.y,o.z)}}}this.setAttribute("position",new Xe(t,3))}lg.prototype=Object.create(We.prototype);lg.prototype.constructor=lg;function ug(e,t,n){dt.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new kf(e,t,n)),this.mergeVertices()}ug.prototype=Object.create(dt.prototype);ug.prototype.constructor=ug;function kf(e,t,n){We.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};const i=[],r=[],o=[],s=[],a=1e-5,c=new T,l=new T,u=new T,h=new T,f=new T;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=t+1;for(let m=0;m<=n;m++){const y=m/n;for(let v=0;v<=t;v++){const d=v/t;e(d,y,l),r.push(l.x,l.y,l.z),d-a>=0?(e(d-a,y,u),h.subVectors(l,u)):(e(d+a,y,u),h.subVectors(u,l)),y-a>=0?(e(d,y-a,u),f.subVectors(l,u)):(e(d,y+a,u),f.subVectors(u,l)),c.crossVectors(h,f).normalize(),o.push(c.x,c.y,c.z),s.push(d,y)}}for(let m=0;m<n;m++)for(let y=0;y<t;y++){const v=m*p+y,d=m*p+y+1,g=(m+1)*p+y+1,b=(m+1)*p+y;i.push(v,d,b),i.push(d,g,b)}this.setIndex(i),this.setAttribute("position",new Xe(r,3)),this.setAttribute("normal",new Xe(o,3)),this.setAttribute("uv",new Xe(s,2))}kf.prototype=Object.create(We.prototype);kf.prototype.constructor=kf;function hg(e,t,n,i){dt.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i},this.fromBufferGeometry(new dr(e,t,n,i)),this.mergeVertices()}hg.prototype=Object.create(dt.prototype);hg.prototype.constructor=hg;function dr(e,t,n,i){We.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i},n=n||1,i=i||0;const r=[],o=[];s(i),c(n),l(),this.setAttribute("position",new Xe(r,3)),this.setAttribute("normal",new Xe(r.slice(),3)),this.setAttribute("uv",new Xe(o,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function s(d){const g=new T,b=new T,x=new T;for(let _=0;_<t.length;_+=3)f(t[_+0],g),f(t[_+1],b),f(t[_+2],x),a(g,b,x,d)}function a(d,g,b,x){const _=Math.pow(2,x),S=[];for(let w=0;w<=_;w++){S[w]=[];const C=d.clone().lerp(b,w/_),A=g.clone().lerp(b,w/_),k=_-w;for(let L=0;L<=k;L++)L===0&&w===_?S[w][L]=C:S[w][L]=C.clone().lerp(A,L/k)}for(let w=0;w<_;w++)for(let C=0;C<2*(_-w)-1;C++){const A=Math.floor(C/2);C%2===0?(h(S[w][A+1]),h(S[w+1][A]),h(S[w][A])):(h(S[w][A+1]),h(S[w+1][A+1]),h(S[w+1][A]))}}function c(d){const g=new T;for(let b=0;b<r.length;b+=3)g.x=r[b+0],g.y=r[b+1],g.z=r[b+2],g.normalize().multiplyScalar(d),r[b+0]=g.x,r[b+1]=g.y,r[b+2]=g.z}function l(){const d=new T;for(let g=0;g<r.length;g+=3){d.x=r[g+0],d.y=r[g+1],d.z=r[g+2];const b=y(d)/2/Math.PI+.5,x=v(d)/Math.PI+.5;o.push(b,1-x)}p(),u()}function u(){for(let d=0;d<o.length;d+=6){const g=o[d+0],b=o[d+2],x=o[d+4],_=Math.max(g,b,x),S=Math.min(g,b,x);_>.9&&S<.1&&(g<.2&&(o[d+0]+=1),b<.2&&(o[d+2]+=1),x<.2&&(o[d+4]+=1))}}function h(d){r.push(d.x,d.y,d.z)}function f(d,g){const b=d*3;g.x=e[b+0],g.y=e[b+1],g.z=e[b+2]}function p(){const d=new T,g=new T,b=new T,x=new T,_=new Ee,S=new Ee,w=new Ee;for(let C=0,A=0;C<r.length;C+=9,A+=6){d.set(r[C+0],r[C+1],r[C+2]),g.set(r[C+3],r[C+4],r[C+5]),b.set(r[C+6],r[C+7],r[C+8]),_.set(o[A+0],o[A+1]),S.set(o[A+2],o[A+3]),w.set(o[A+4],o[A+5]),x.copy(d).add(g).add(b).divideScalar(3);const k=y(x);m(_,A+0,d,k),m(S,A+2,g,k),m(w,A+4,b,k)}}function m(d,g,b,x){x<0&&d.x===1&&(o[g]=d.x-1),b.x===0&&b.z===0&&(o[g]=x/2/Math.PI+.5)}function y(d){return Math.atan2(d.z,-d.x)}function v(d){return Math.atan2(-d.y,Math.sqrt(d.x*d.x+d.z*d.z))}}dr.prototype=Object.create(We.prototype);dr.prototype.constructor=dr;function fg(e,t){dt.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new au(e,t)),this.mergeVertices()}fg.prototype=Object.create(dt.prototype);fg.prototype.constructor=fg;function au(e,t){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];dr.call(this,n,i,e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}au.prototype=Object.create(dr.prototype);au.prototype.constructor=au;function pg(e,t){dt.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Sc(e,t)),this.mergeVertices()}pg.prototype=Object.create(dt.prototype);pg.prototype.constructor=pg;function Sc(e,t){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];dr.call(this,n,i,e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}Sc.prototype=Object.create(dr.prototype);Sc.prototype.constructor=Sc;function dg(e,t){dt.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Mc(e,t)),this.mergeVertices()}dg.prototype=Object.create(dt.prototype);dg.prototype.constructor=dg;function Mc(e,t){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];dr.call(this,i,r,e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}Mc.prototype=Object.create(dr.prototype);Mc.prototype.constructor=Mc;function mg(e,t){dt.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Df(e,t)),this.mergeVertices()}mg.prototype=Object.create(dt.prototype);mg.prototype.constructor=mg;function Df(e,t){const n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];dr.call(this,r,o,e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}Df.prototype=Object.create(dr.prototype);Df.prototype.constructor=Df;function gg(e,t,n,i,r,o){dt.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r},o!==void 0&&console.warn("THREE.TubeGeometry: taper has been removed.");const s=new cu(e,t,n,i,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals,this.fromBufferGeometry(s),this.mergeVertices()}gg.prototype=Object.create(dt.prototype);gg.prototype.constructor=gg;function cu(e,t,n,i,r){We.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r},t=t||64,n=n||1,i=i||8,r=r||!1;const o=e.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const s=new T,a=new T,c=new Ee;let l=new T;const u=[],h=[],f=[],p=[];m(),this.setIndex(p),this.setAttribute("position",new Xe(u,3)),this.setAttribute("normal",new Xe(h,3)),this.setAttribute("uv",new Xe(f,2));function m(){for(let g=0;g<t;g++)y(g);y(r===!1?t:0),d(),v()}function y(g){l=e.getPointAt(g/t,l);const b=o.normals[g],x=o.binormals[g];for(let _=0;_<=i;_++){const S=_/i*Math.PI*2,w=Math.sin(S),C=-Math.cos(S);a.x=C*b.x+w*x.x,a.y=C*b.y+w*x.y,a.z=C*b.z+w*x.z,a.normalize(),h.push(a.x,a.y,a.z),s.x=l.x+n*a.x,s.y=l.y+n*a.y,s.z=l.z+n*a.z,u.push(s.x,s.y,s.z)}}function v(){for(let g=1;g<=t;g++)for(let b=1;b<=i;b++){const x=(i+1)*(g-1)+(b-1),_=(i+1)*g+(b-1),S=(i+1)*g+b,w=(i+1)*(g-1)+b;p.push(x,_,w),p.push(_,S,w)}}function d(){for(let g=0;g<=t;g++)for(let b=0;b<=i;b++)c.x=g/t,c.y=b/i,f.push(c.x,c.y)}}cu.prototype=Object.create(We.prototype);cu.prototype.constructor=cu;cu.prototype.toJSON=function(){const e=We.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e};function yg(e,t,n,i,r,o,s){dt.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:o},s!==void 0&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Bf(e,t,n,i,r,o)),this.mergeVertices()}yg.prototype=Object.create(dt.prototype);yg.prototype.constructor=yg;function Bf(e,t,n,i,r,o){We.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:o},e=e||1,t=t||.4,n=Math.floor(n)||64,i=Math.floor(i)||8,r=r||2,o=o||3;const s=[],a=[],c=[],l=[],u=new T,h=new T,f=new T,p=new T,m=new T,y=new T,v=new T;for(let g=0;g<=n;++g){const b=g/n*r*Math.PI*2;d(b,r,o,e,f),d(b+.01,r,o,e,p),y.subVectors(p,f),v.addVectors(p,f),m.crossVectors(y,v),v.crossVectors(m,y),m.normalize(),v.normalize();for(let x=0;x<=i;++x){const _=x/i*Math.PI*2,S=-t*Math.cos(_),w=t*Math.sin(_);u.x=f.x+(S*v.x+w*m.x),u.y=f.y+(S*v.y+w*m.y),u.z=f.z+(S*v.z+w*m.z),a.push(u.x,u.y,u.z),h.subVectors(u,f).normalize(),c.push(h.x,h.y,h.z),l.push(g/n),l.push(x/i)}}for(let g=1;g<=n;g++)for(let b=1;b<=i;b++){const x=(i+1)*(g-1)+(b-1),_=(i+1)*g+(b-1),S=(i+1)*g+b,w=(i+1)*(g-1)+b;s.push(x,_,w),s.push(_,S,w)}this.setIndex(s),this.setAttribute("position",new Xe(a,3)),this.setAttribute("normal",new Xe(c,3)),this.setAttribute("uv",new Xe(l,2));function d(g,b,x,_,S){const w=Math.cos(g),C=Math.sin(g),A=x/b*g,k=Math.cos(A);S.x=_*(2+k)*.5*w,S.y=_*(2+k)*C*.5,S.z=_*Math.sin(A)*.5}}Bf.prototype=Object.create(We.prototype);Bf.prototype.constructor=Bf;function vg(e,t,n,i,r){dt.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},this.fromBufferGeometry(new lu(e,t,n,i,r)),this.mergeVertices()}vg.prototype=Object.create(dt.prototype);vg.prototype.constructor=vg;function lu(e,t,n,i,r){We.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},e=e||1,t=t||.4,n=Math.floor(n)||8,i=Math.floor(i)||6,r=r||Math.PI*2;const o=[],s=[],a=[],c=[],l=new T,u=new T,h=new T;for(let f=0;f<=n;f++)for(let p=0;p<=i;p++){const m=p/i*r,y=f/n*Math.PI*2;u.x=(e+t*Math.cos(y))*Math.cos(m),u.y=(e+t*Math.cos(y))*Math.sin(m),u.z=t*Math.sin(y),s.push(u.x,u.y,u.z),l.x=e*Math.cos(m),l.y=e*Math.sin(m),h.subVectors(u,l).normalize(),a.push(h.x,h.y,h.z),c.push(p/i),c.push(f/n)}for(let f=1;f<=n;f++)for(let p=1;p<=i;p++){const m=(i+1)*f+p-1,y=(i+1)*(f-1)+p-1,v=(i+1)*(f-1)+p,d=(i+1)*f+p;o.push(m,y,d),o.push(y,v,d)}this.setIndex(o),this.setAttribute("position",new Xe(s,3)),this.setAttribute("normal",new Xe(a,3)),this.setAttribute("uv",new Xe(c,2))}lu.prototype=Object.create(We.prototype);lu.prototype.constructor=lu;const iB={triangulate:function(e,t,n){n=n||2;let i=t&&t.length,r=i?t[0]*n:e.length,o=WP(e,0,r,n,!0),s=[];if(!o||o.next===o.prev)return s;let a,c,l,u,h,f,p;if(i&&(o=cB(e,t,o,n)),e.length>80*n){a=l=e[0],c=u=e[1];for(let m=n;m<r;m+=n)h=e[m],f=e[m+1],h<a&&(a=h),f<c&&(c=f),h>l&&(l=h),f>u&&(u=f);p=Math.max(l-a,u-c),p=p!==0?1/p:0}return Ff(o,s,n,a,c,p),s}};function WP(e,t,n,i,r){let o,s;if(r===xB(e,t,n,i)>0)for(o=t;o<n;o+=i)s=t3(o,e[o],e[o+1],s);else for(o=n-i;o>=t;o-=i)s=t3(o,e[o],e[o+1],s);return s&&g0(s,s.next)&&(zf(s),s=s.next),s}function Aa(e,t){if(!e)return e;t||(t=e);let n=e,i;do if(i=!1,!n.steiner&&(g0(n,n.next)||En(n.prev,n,n.next)===0)){if(zf(n),n=t=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==t);return t}function Ff(e,t,n,i,r,o,s){if(!e)return;!s&&o&&pB(e,i,r,o);let a=e,c,l;for(;e.prev!==e.next;){if(c=e.prev,l=e.next,o?oB(e,i,r,o):rB(e)){t.push(c.i/n),t.push(e.i/n),t.push(l.i/n),zf(e),e=l.next,a=l.next;continue}if(e=l,e===a){s?s===1?(e=sB(Aa(e),t,n),Ff(e,t,n,i,r,o,2)):s===2&&aB(e,t,n,i,r,o):Ff(Aa(e),t,n,i,r,o,1);break}}}function rB(e){let t=e.prev,n=e,i=e.next;if(En(t,n,i)>=0)return!1;let r=e.next.next;for(;r!==e.prev;){if(Ol(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&En(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function oB(e,t,n,i){let r=e.prev,o=e,s=e.next;if(En(r,o,s)>=0)return!1;let a=r.x<o.x?r.x<s.x?r.x:s.x:o.x<s.x?o.x:s.x,c=r.y<o.y?r.y<s.y?r.y:s.y:o.y<s.y?o.y:s.y,l=r.x>o.x?r.x>s.x?r.x:s.x:o.x>s.x?o.x:s.x,u=r.y>o.y?r.y>s.y?r.y:s.y:o.y>s.y?o.y:s.y,h=mx(a,c,t,n,i),f=mx(l,u,t,n,i),p=e.prevZ,m=e.nextZ;for(;p&&p.z>=h&&m&&m.z<=f;){if(p!==e.prev&&p!==e.next&&Ol(r.x,r.y,o.x,o.y,s.x,s.y,p.x,p.y)&&En(p.prev,p,p.next)>=0||(p=p.prevZ,m!==e.prev&&m!==e.next&&Ol(r.x,r.y,o.x,o.y,s.x,s.y,m.x,m.y)&&En(m.prev,m,m.next)>=0))return!1;m=m.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&Ol(r.x,r.y,o.x,o.y,s.x,s.y,p.x,p.y)&&En(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=f;){if(m!==e.prev&&m!==e.next&&Ol(r.x,r.y,o.x,o.y,s.x,s.y,m.x,m.y)&&En(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function sB(e,t,n){let i=e;do{let r=i.prev,o=i.next.next;!g0(r,o)&&qP(r,i,i.next,o)&&Nf(r,o)&&Nf(o,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(o.i/n),zf(i),zf(i.next),i=e=o),i=i.next}while(i!==e);return Aa(i)}function aB(e,t,n,i,r,o){let s=e;do{let a=s.next.next;for(;a!==s.prev;){if(s.i!==a.i&&gB(s,a)){let c=XP(s,a);s=Aa(s,s.next),c=Aa(c,c.next),Ff(s,t,n,i,r,o),Ff(c,t,n,i,r,o);return}a=a.next}s=s.next}while(s!==e)}function cB(e,t,n,i){let r=[],o,s,a,c,l;for(o=0,s=t.length;o<s;o++)a=t[o]*i,c=o<s-1?t[o+1]*i:e.length,l=WP(e,a,c,i,!1),l===l.next&&(l.steiner=!0),r.push(mB(l));for(r.sort(lB),o=0;o<r.length;o++)uB(r[o],n),n=Aa(n,n.next);return n}function lB(e,t){return e.x-t.x}function uB(e,t){if(t=hB(e,t),t){const n=XP(t,e);Aa(t,t.next),Aa(n,n.next)}}function hB(e,t){let n=t,i=e.x,r=e.y,o=-1/0,s;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){let f=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(f<=i&&f>o){if(o=f,f===i){if(r===n.y)return n;if(r===n.next.y)return n.next}s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!s)return null;if(i===o)return s;let a=s,c=s.x,l=s.y,u=1/0,h;n=s;do i>=n.x&&n.x>=c&&i!==n.x&&Ol(r<l?i:o,r,c,l,r<l?o:i,r,n.x,n.y)&&(h=Math.abs(r-n.y)/(i-n.x),Nf(n,e)&&(h<u||h===u&&(n.x>s.x||n.x===s.x&&fB(s,n)))&&(s=n,u=h)),n=n.next;while(n!==a);return s}function fB(e,t){return En(e.prev,e,t.prev)<0&&En(t.next,e,e.next)<0}function pB(e,t,n,i){let r=e;do r.z===null&&(r.z=mx(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,dB(r)}function dB(e){let t,n,i,r,o,s,a,c,l=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,i=n,a=0,t=0;t<l&&(a++,i=i.nextZ,!!i);t++);for(c=l;a>0||c>0&&i;)a!==0&&(c===0||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,c--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,l*=2}while(s>1);return e}function mx(e,t,n,i,r){return e=32767*(e-n)*r,t=32767*(t-i)*r,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function mB(e){let t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function Ol(e,t,n,i,r,o,s,a){return(r-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(i-a)-(n-s)*(t-a)>=0&&(n-s)*(o-a)-(r-s)*(i-a)>=0}function gB(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!yB(e,t)&&(Nf(e,t)&&Nf(t,e)&&vB(e,t)&&(En(e.prev,e,t.prev)||En(e,t.prev,t))||g0(e,t)&&En(e.prev,e,e.next)>0&&En(t.prev,t,t.next)>0)}function En(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function g0(e,t){return e.x===t.x&&e.y===t.y}function qP(e,t,n,i){const r=yd(En(e,t,n)),o=yd(En(e,t,i)),s=yd(En(n,i,e)),a=yd(En(n,i,t));return!!(r!==o&&s!==a||r===0&&gd(e,n,t)||o===0&&gd(e,i,t)||s===0&&gd(n,e,i)||a===0&&gd(n,t,i))}function gd(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function yd(e){return e>0?1:e<0?-1:0}function yB(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&qP(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function Nf(e,t){return En(e.prev,e,e.next)<0?En(e,t,e.next)>=0&&En(e,e.prev,t)>=0:En(e,t,e.prev)<0||En(e,e.next,t)<0}function vB(e,t){let n=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==e);return i}function XP(e,t){let n=new gx(e.i,e.x,e.y),i=new gx(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function t3(e,t,n,i){const r=new gx(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function zf(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function gx(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xB(e,t,n,i){let r=0;for(let o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}const ya={area:function(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return n*.5},isClockWise:function(e){return ya.area(e)<0},triangulateShape:function(e,t){const n=[],i=[],r=[];n3(e),i3(n,e);let o=e.length;t.forEach(n3);for(let a=0;a<t.length;a++)i.push(o),o+=t[a].length,i3(n,t[a]);const s=iB.triangulate(n,i);for(let a=0;a<s.length;a+=3)r.push(s.slice(a,a+3));return r}};function n3(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function i3(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}function uu(e,t){dt.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new bs(e,t)),this.mergeVertices()}uu.prototype=Object.create(dt.prototype);uu.prototype.constructor=uu;uu.prototype.toJSON=function(){const e=dt.prototype.toJSON.call(this),t=this.parameters.shapes,n=this.parameters.options;return YP(t,n,e)};function bs(e,t){We.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let s=0,a=e.length;s<a;s++){const c=e[s];o(c)}this.setAttribute("position",new Xe(i,3)),this.setAttribute("uv",new Xe(r,2)),this.computeVertexNormals();function o(s){const a=[],c=t.curveSegments!==void 0?t.curveSegments:12,l=t.steps!==void 0?t.steps:1;let u=t.depth!==void 0?t.depth:100,h=t.bevelEnabled!==void 0?t.bevelEnabled:!0,f=t.bevelThickness!==void 0?t.bevelThickness:6,p=t.bevelSize!==void 0?t.bevelSize:f-2,m=t.bevelOffset!==void 0?t.bevelOffset:0,y=t.bevelSegments!==void 0?t.bevelSegments:3;const v=t.extrudePath,d=t.UVGenerator!==void 0?t.UVGenerator:bB;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=t.amount);let g,b=!1,x,_,S,w;v&&(g=v.getSpacedPoints(l),b=!0,h=!1,x=v.computeFrenetFrames(l,!1),_=new T,S=new T,w=new T),h||(y=0,f=0,p=0,m=0);const C=s.extractPoints(c);let A=C.shape;const k=C.holes;if(!ya.isClockWise(A)){A=A.reverse();for(let j=0,X=k.length;j<X;j++){const ie=k[j];ya.isClockWise(ie)&&(k[j]=ie.reverse())}}const D=ya.triangulateShape(A,k),F=A;for(let j=0,X=k.length;j<X;j++){const ie=k[j];A=A.concat(ie)}function I(j,X,ie){return X||console.error("THREE.ExtrudeGeometry: vec does not exist"),X.clone().multiplyScalar(ie).add(j)}const P=A.length,N=D.length;function $(j,X,ie){let fe,me,ve;const G=j.x-X.x,V=j.y-X.y,pe=ie.x-j.x,le=ie.y-j.y,ne=G*G+V*V,oe=G*le-V*pe;if(Math.abs(oe)>Number.EPSILON){const xe=Math.sqrt(ne),Ae=Math.sqrt(pe*pe+le*le),ge=X.x-V/xe,Me=X.y+G/xe,be=ie.x-le/Ae,Oe=ie.y+pe/Ae,Te=((be-ge)*le-(Oe-Me)*pe)/(G*le-V*pe);fe=ge+G*Te-j.x,me=Me+V*Te-j.y;const Ce=fe*fe+me*me;if(Ce<=2)return new Ee(fe,me);ve=Math.sqrt(Ce/2)}else{let xe=!1;G>Number.EPSILON?pe>Number.EPSILON&&(xe=!0):G<-Number.EPSILON?pe<-Number.EPSILON&&(xe=!0):Math.sign(V)===Math.sign(le)&&(xe=!0),xe?(fe=-V,me=G,ve=Math.sqrt(ne)):(fe=G,me=V,ve=Math.sqrt(ne/2))}return new Ee(fe/ve,me/ve)}const B=[];for(let j=0,X=F.length,ie=X-1,fe=j+1;j<X;j++,ie++,fe++)ie===X&&(ie=0),fe===X&&(fe=0),B[j]=$(F[j],F[ie],F[fe]);const q=[];let ee,W=B.concat();for(let j=0,X=k.length;j<X;j++){const ie=k[j];ee=[];for(let fe=0,me=ie.length,ve=me-1,G=fe+1;fe<me;fe++,ve++,G++)ve===me&&(ve=0),G===me&&(G=0),ee[fe]=$(ie[fe],ie[ve],ie[G]);q.push(ee),W=W.concat(ee)}for(let j=0;j<y;j++){const X=j/y,ie=f*Math.cos(X*Math.PI/2),fe=p*Math.sin(X*Math.PI/2)+m;for(let me=0,ve=F.length;me<ve;me++){const G=I(F[me],B[me],fe);K(G.x,G.y,-ie)}for(let me=0,ve=k.length;me<ve;me++){const G=k[me];ee=q[me];for(let V=0,pe=G.length;V<pe;V++){const le=I(G[V],ee[V],fe);K(le.x,le.y,-ie)}}}const Q=p+m;for(let j=0;j<P;j++){const X=h?I(A[j],W[j],Q):A[j];b?(S.copy(x.normals[0]).multiplyScalar(X.x),_.copy(x.binormals[0]).multiplyScalar(X.y),w.copy(g[0]).add(S).add(_),K(w.x,w.y,w.z)):K(X.x,X.y,0)}for(let j=1;j<=l;j++)for(let X=0;X<P;X++){const ie=h?I(A[X],W[X],Q):A[X];b?(S.copy(x.normals[j]).multiplyScalar(ie.x),_.copy(x.binormals[j]).multiplyScalar(ie.y),w.copy(g[j]).add(S).add(_),K(w.x,w.y,w.z)):K(ie.x,ie.y,u/l*j)}for(let j=y-1;j>=0;j--){const X=j/y,ie=f*Math.cos(X*Math.PI/2),fe=p*Math.sin(X*Math.PI/2)+m;for(let me=0,ve=F.length;me<ve;me++){const G=I(F[me],B[me],fe);K(G.x,G.y,u+ie)}for(let me=0,ve=k.length;me<ve;me++){const G=k[me];ee=q[me];for(let V=0,pe=G.length;V<pe;V++){const le=I(G[V],ee[V],fe);b?K(le.x,le.y+g[l-1].y,g[l-1].x+ie):K(le.x,le.y,u+ie)}}}Z(),re();function Z(){const j=i.length/3;if(h){let X=0,ie=P*X;for(let fe=0;fe<N;fe++){const me=D[fe];ce(me[2]+ie,me[1]+ie,me[0]+ie)}X=l+y*2,ie=P*X;for(let fe=0;fe<N;fe++){const me=D[fe];ce(me[0]+ie,me[1]+ie,me[2]+ie)}}else{for(let X=0;X<N;X++){const ie=D[X];ce(ie[2],ie[1],ie[0])}for(let X=0;X<N;X++){const ie=D[X];ce(ie[0]+P*l,ie[1]+P*l,ie[2]+P*l)}}n.addGroup(j,i.length/3-j,0)}function re(){const j=i.length/3;let X=0;he(F,X),X+=F.length;for(let ie=0,fe=k.length;ie<fe;ie++){const me=k[ie];he(me,X),X+=me.length}n.addGroup(j,i.length/3-j,1)}function he(j,X){let ie=j.length;for(;--ie>=0;){const fe=ie;let me=ie-1;me<0&&(me=j.length-1);for(let ve=0,G=l+y*2;ve<G;ve++){const V=P*ve,pe=P*(ve+1),le=X+fe+V,ne=X+me+V,oe=X+me+pe,xe=X+fe+pe;se(le,ne,oe,xe)}}}function K(j,X,ie){a.push(j),a.push(X),a.push(ie)}function ce(j,X,ie){ue(j),ue(X),ue(ie);const fe=i.length/3,me=d.generateTopUV(n,i,fe-3,fe-2,fe-1);H(me[0]),H(me[1]),H(me[2])}function se(j,X,ie,fe){ue(j),ue(X),ue(fe),ue(X),ue(ie),ue(fe);const me=i.length/3,ve=d.generateSideWallUV(n,i,me-6,me-3,me-2,me-1);H(ve[0]),H(ve[1]),H(ve[3]),H(ve[1]),H(ve[2]),H(ve[3])}function ue(j){i.push(a[j*3+0]),i.push(a[j*3+1]),i.push(a[j*3+2])}function H(j){r.push(j.x),r.push(j.y)}}}bs.prototype=Object.create(We.prototype);bs.prototype.constructor=bs;bs.prototype.toJSON=function(){const e=We.prototype.toJSON.call(this),t=this.parameters.shapes,n=this.parameters.options;return YP(t,n,e)};const bB={generateTopUV:function(e,t,n,i,r){const o=t[n*3],s=t[n*3+1],a=t[i*3],c=t[i*3+1],l=t[r*3],u=t[r*3+1];return[new Ee(o,s),new Ee(a,c),new Ee(l,u)]},generateSideWallUV:function(e,t,n,i,r,o){const s=t[n*3],a=t[n*3+1],c=t[n*3+2],l=t[i*3],u=t[i*3+1],h=t[i*3+2],f=t[r*3],p=t[r*3+1],m=t[r*3+2],y=t[o*3],v=t[o*3+1],d=t[o*3+2];return Math.abs(a-u)<.01?[new Ee(s,1-c),new Ee(l,1-h),new Ee(f,1-m),new Ee(y,1-d)]:[new Ee(a,1-c),new Ee(u,1-h),new Ee(p,1-m),new Ee(v,1-d)]}};function YP(e,t,n){if(n.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const o=e[i];n.shapes.push(o.uuid)}else n.shapes.push(e.uuid);return t.extrudePath!==void 0&&(n.options.extrudePath=t.extrudePath.toJSON()),n}function xg(e,t){dt.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Uf(e,t)),this.mergeVertices()}xg.prototype=Object.create(dt.prototype);xg.prototype.constructor=xg;function Uf(e,t){t=t||{};const n=t.font;if(!(n&&n.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new dt;const i=n.generateShapes(e,t.size);t.depth=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),bs.call(this,i,t),this.type="TextBufferGeometry"}Uf.prototype=Object.create(bs.prototype);Uf.prototype.constructor=Uf;function bg(e,t,n,i,r,o,s){dt.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new hu(e,t,n,i,r,o,s)),this.mergeVertices()}bg.prototype=Object.create(dt.prototype);bg.prototype.constructor=bg;function hu(e,t,n,i,r,o,s){We.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:s},e=e||1,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),i=i!==void 0?i:0,r=r!==void 0?r:Math.PI*2,o=o!==void 0?o:0,s=s!==void 0?s:Math.PI;const a=Math.min(o+s,Math.PI);let c=0;const l=[],u=new T,h=new T,f=[],p=[],m=[],y=[];for(let v=0;v<=n;v++){const d=[],g=v/n;let b=0;v==0&&o==0?b=.5/t:v==n&&a==Math.PI&&(b=-.5/t);for(let x=0;x<=t;x++){const _=x/t;u.x=-e*Math.cos(i+_*r)*Math.sin(o+g*s),u.y=e*Math.cos(o+g*s),u.z=e*Math.sin(i+_*r)*Math.sin(o+g*s),p.push(u.x,u.y,u.z),h.copy(u).normalize(),m.push(h.x,h.y,h.z),y.push(_+b,1-g),d.push(c++)}l.push(d)}for(let v=0;v<n;v++)for(let d=0;d<t;d++){const g=l[v][d+1],b=l[v][d],x=l[v+1][d],_=l[v+1][d+1];(v!==0||o>0)&&f.push(g,b,_),(v!==n-1||a<Math.PI)&&f.push(b,x,_)}this.setIndex(f),this.setAttribute("position",new Xe(p,3)),this.setAttribute("normal",new Xe(m,3)),this.setAttribute("uv",new Xe(y,2))}hu.prototype=Object.create(We.prototype);hu.prototype.constructor=hu;function _g(e,t,n,i,r,o){dt.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},this.fromBufferGeometry(new Gf(e,t,n,i,r,o)),this.mergeVertices()}_g.prototype=Object.create(dt.prototype);_g.prototype.constructor=_g;function Gf(e,t,n,i,r,o){We.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},e=e||.5,t=t||1,r=r!==void 0?r:0,o=o!==void 0?o:Math.PI*2,n=n!==void 0?Math.max(3,n):8,i=i!==void 0?Math.max(1,i):1;const s=[],a=[],c=[],l=[];let u=e;const h=(t-e)/i,f=new T,p=new Ee;for(let m=0;m<=i;m++){for(let y=0;y<=n;y++){const v=r+y/n*o;f.x=u*Math.cos(v),f.y=u*Math.sin(v),a.push(f.x,f.y,f.z),c.push(0,0,1),p.x=(f.x/t+1)/2,p.y=(f.y/t+1)/2,l.push(p.x,p.y)}u+=h}for(let m=0;m<i;m++){const y=m*(n+1);for(let v=0;v<n;v++){const d=v+y,g=d,b=d+n+1,x=d+n+2,_=d+1;s.push(g,b,_),s.push(b,x,_)}}this.setIndex(s),this.setAttribute("position",new Xe(a,3)),this.setAttribute("normal",new Xe(c,3)),this.setAttribute("uv",new Xe(l,2))}Gf.prototype=Object.create(We.prototype);Gf.prototype.constructor=Gf;function wg(e,t,n,i){dt.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},this.fromBufferGeometry(new $f(e,t,n,i)),this.mergeVertices()}wg.prototype=Object.create(dt.prototype);wg.prototype.constructor=wg;function $f(e,t,n,i){We.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t)||12,n=n||0,i=i||Math.PI*2,i=It.clamp(i,0,Math.PI*2);const r=[],o=[],s=[],a=1/t,c=new T,l=new Ee;for(let u=0;u<=t;u++){const h=n+u*a*i,f=Math.sin(h),p=Math.cos(h);for(let m=0;m<=e.length-1;m++)c.x=e[m].x*f,c.y=e[m].y,c.z=e[m].x*p,o.push(c.x,c.y,c.z),l.x=u/t,l.y=m/(e.length-1),s.push(l.x,l.y)}for(let u=0;u<t;u++)for(let h=0;h<e.length-1;h++){const f=h+u*e.length,p=f,m=f+e.length,y=f+e.length+1,v=f+1;r.push(p,m,v),r.push(m,y,v)}if(this.setIndex(r),this.setAttribute("position",new Xe(o,3)),this.setAttribute("uv",new Xe(s,2)),this.computeVertexNormals(),i===Math.PI*2){const u=this.attributes.normal.array,h=new T,f=new T,p=new T,m=t*e.length*3;for(let y=0,v=0;y<e.length;y++,v+=3)h.x=u[v+0],h.y=u[v+1],h.z=u[v+2],f.x=u[m+v+0],f.y=u[m+v+1],f.z=u[m+v+2],p.addVectors(h,f).normalize(),u[v+0]=u[m+v+0]=p.x,u[v+1]=u[m+v+1]=p.y,u[v+2]=u[m+v+2]=p.z}}$f.prototype=Object.create(We.prototype);$f.prototype.constructor=$f;function fu(e,t){dt.call(this),this.type="ShapeGeometry",typeof t=="object"&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new pu(e,t)),this.mergeVertices()}fu.prototype=Object.create(dt.prototype);fu.prototype.constructor=fu;fu.prototype.toJSON=function(){const e=dt.prototype.toJSON.call(this),t=this.parameters.shapes;return ZP(t,e)};function pu(e,t){We.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;const n=[],i=[],r=[],o=[];let s=0,a=0;if(Array.isArray(e)===!1)c(e);else for(let l=0;l<e.length;l++)c(e[l]),this.addGroup(s,a,l),s+=a,a=0;this.setIndex(n),this.setAttribute("position",new Xe(i,3)),this.setAttribute("normal",new Xe(r,3)),this.setAttribute("uv",new Xe(o,2));function c(l){const u=i.length/3,h=l.extractPoints(t);let f=h.shape;const p=h.holes;ya.isClockWise(f)===!1&&(f=f.reverse());for(let y=0,v=p.length;y<v;y++){const d=p[y];ya.isClockWise(d)===!0&&(p[y]=d.reverse())}const m=ya.triangulateShape(f,p);for(let y=0,v=p.length;y<v;y++){const d=p[y];f=f.concat(d)}for(let y=0,v=f.length;y<v;y++){const d=f[y];i.push(d.x,d.y,0),r.push(0,0,1),o.push(d.x,d.y)}for(let y=0,v=m.length;y<v;y++){const d=m[y],g=d[0]+u,b=d[1]+u,x=d[2]+u;n.push(g,b,x),a+=3}}}pu.prototype=Object.create(We.prototype);pu.prototype.constructor=pu;pu.prototype.toJSON=function(){const e=We.prototype.toJSON.call(this),t=this.parameters.shapes;return ZP(t,e)};function ZP(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}function Sg(e,t){We.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=t!==void 0?t:1;const n=[],i=Math.cos(It.DEG2RAD*t),r=[0,0],o={};let s,a,c;const l=["a","b","c"];let u;e.isBufferGeometry?(u=new dt,u.fromBufferGeometry(e)):u=e.clone(),u.mergeVertices(),u.computeFaceNormals();const h=u.vertices,f=u.faces;for(let p=0,m=f.length;p<m;p++){const y=f[p];for(let v=0;v<3;v++)s=y[l[v]],a=y[l[(v+1)%3]],r[0]=Math.min(s,a),r[1]=Math.max(s,a),c=r[0]+","+r[1],o[c]===void 0?o[c]={index1:r[0],index2:r[1],face1:p,face2:void 0}:o[c].face2=p}for(c in o){const p=o[c];if(p.face2===void 0||f[p.face1].normal.dot(f[p.face2].normal)<=i){let m=h[p.index1];n.push(m.x,m.y,m.z),m=h[p.index2],n.push(m.x,m.y,m.z)}}this.setAttribute("position",new Xe(n,3))}Sg.prototype=Object.create(We.prototype);Sg.prototype.constructor=Sg;function du(e,t,n,i,r,o,s,a){dt.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new _s(e,t,n,i,r,o,s,a)),this.mergeVertices()}du.prototype=Object.create(dt.prototype);du.prototype.constructor=du;function _s(e,t,n,i,r,o,s,a){We.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:s,thetaLength:a};const c=this;e=e!==void 0?e:1,t=t!==void 0?t:1,n=n||1,i=Math.floor(i)||8,r=Math.floor(r)||1,o=o!==void 0?o:!1,s=s!==void 0?s:0,a=a!==void 0?a:Math.PI*2;const l=[],u=[],h=[],f=[];let p=0;const m=[],y=n/2;let v=0;d(),o===!1&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(l),this.setAttribute("position",new Xe(u,3)),this.setAttribute("normal",new Xe(h,3)),this.setAttribute("uv",new Xe(f,2));function d(){const b=new T,x=new T;let _=0;const S=(t-e)/n;for(let w=0;w<=r;w++){const C=[],A=w/r,k=A*(t-e)+e;for(let L=0;L<=i;L++){const D=L/i,F=D*a+s,I=Math.sin(F),P=Math.cos(F);x.x=k*I,x.y=-A*n+y,x.z=k*P,u.push(x.x,x.y,x.z),b.set(I,S,P).normalize(),h.push(b.x,b.y,b.z),f.push(D,1-A),C.push(p++)}m.push(C)}for(let w=0;w<i;w++)for(let C=0;C<r;C++){const A=m[C][w],k=m[C+1][w],L=m[C+1][w+1],D=m[C][w+1];l.push(A,k,D),l.push(k,L,D),_+=6}c.addGroup(v,_,0),v+=_}function g(b){let x,_;const S=new Ee,w=new T;let C=0;const A=b===!0?e:t,k=b===!0?1:-1;x=p;for(let L=1;L<=i;L++)u.push(0,y*k,0),h.push(0,k,0),f.push(.5,.5),p++;_=p;for(let L=0;L<=i;L++){const F=L/i*a+s,I=Math.cos(F),P=Math.sin(F);w.x=A*P,w.y=y*k,w.z=A*I,u.push(w.x,w.y,w.z),h.push(0,k,0),S.x=I*.5+.5,S.y=P*.5*k+.5,f.push(S.x,S.y),p++}for(let L=0;L<i;L++){const D=x+L,F=_+L;b===!0?l.push(F,F+1,D):l.push(F+1,F,D),C+=3}c.addGroup(v,C,b===!0?1:2),v+=C}}_s.prototype=Object.create(We.prototype);_s.prototype.constructor=_s;function Mg(e,t,n,i,r,o,s){du.call(this,0,e,t,n,i,r,o,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:s}}Mg.prototype=Object.create(du.prototype);Mg.prototype.constructor=Mg;function Vf(e,t,n,i,r,o,s){_s.call(this,0,e,t,n,i,r,o,s),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:s}}Vf.prototype=Object.create(_s.prototype);Vf.prototype.constructor=Vf;function Ag(e,t,n,i){dt.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},this.fromBufferGeometry(new Hf(e,t,n,i)),this.mergeVertices()}Ag.prototype=Object.create(dt.prototype);Ag.prototype.constructor=Ag;function Hf(e,t,n,i){We.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},e=e||1,t=t!==void 0?Math.max(3,t):8,n=n!==void 0?n:0,i=i!==void 0?i:Math.PI*2;const r=[],o=[],s=[],a=[],c=new T,l=new Ee;o.push(0,0,0),s.push(0,0,1),a.push(.5,.5);for(let u=0,h=3;u<=t;u++,h+=3){const f=n+u/t*i;c.x=e*Math.cos(f),c.y=e*Math.sin(f),o.push(c.x,c.y,c.z),s.push(0,0,1),l.x=(o[h]/e+1)/2,l.y=(o[h+1]/e+1)/2,a.push(l.x,l.y)}for(let u=1;u<=t;u++)r.push(u,u+1,0);this.setIndex(r),this.setAttribute("position",new Xe(o,3)),this.setAttribute("normal",new Xe(s,3)),this.setAttribute("uv",new Xe(a,2))}Hf.prototype=Object.create(We.prototype);Hf.prototype.constructor=Hf;var Li=Object.freeze({__proto__:null,WireframeGeometry:lg,ParametricGeometry:ug,ParametricBufferGeometry:kf,TetrahedronGeometry:fg,TetrahedronBufferGeometry:au,OctahedronGeometry:pg,OctahedronBufferGeometry:Sc,IcosahedronGeometry:dg,IcosahedronBufferGeometry:Mc,DodecahedronGeometry:mg,DodecahedronBufferGeometry:Df,PolyhedronGeometry:hg,PolyhedronBufferGeometry:dr,TubeGeometry:gg,TubeBufferGeometry:cu,TorusKnotGeometry:yg,TorusKnotBufferGeometry:Bf,TorusGeometry:vg,TorusBufferGeometry:lu,TextGeometry:xg,TextBufferGeometry:Uf,SphereGeometry:bg,SphereBufferGeometry:hu,RingGeometry:_g,RingBufferGeometry:Gf,PlaneGeometry:Tf,PlaneBufferGeometry:su,LatheGeometry:wg,LatheBufferGeometry:$f,ShapeGeometry:fu,ShapeBufferGeometry:pu,ExtrudeGeometry:uu,ExtrudeBufferGeometry:bs,EdgesGeometry:Sg,ConeGeometry:Mg,ConeBufferGeometry:Vf,CylinderGeometry:du,CylinderBufferGeometry:_s,CircleGeometry:Ag,CircleBufferGeometry:Hf,BoxGeometry:oO,BoxBufferGeometry:vp});function mu(e){bt.call(this),this.type="ShadowMaterial",this.color=new Fe(0),this.transparent=!0,this.setValues(e)}mu.prototype=Object.create(bt.prototype);mu.prototype.constructor=mu;mu.prototype.isShadowMaterial=!0;mu.prototype.copy=function(e){return bt.prototype.copy.call(this,e),this.color.copy(e.color),this};function Ca(e){ti.call(this,e),this.type="RawShaderMaterial"}Ca.prototype=Object.create(ti.prototype);Ca.prototype.constructor=Ca;Ca.prototype.isRawShaderMaterial=!0;function ws(e){bt.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Fe(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lu,this.normalScale=new Ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}ws.prototype=Object.create(bt.prototype);ws.prototype.constructor=ws;ws.prototype.isMeshStandardMaterial=!0;ws.prototype.copy=function(e){return bt.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this};function gu(e){ws.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ee(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transparency=0,this.setValues(e)}gu.prototype=Object.create(ws.prototype);gu.prototype.constructor=gu;gu.prototype.isMeshPhysicalMaterial=!0;gu.prototype.copy=function(e){return ws.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Fe).copy(e.sheen):this.sheen=null,this.transparency=e.transparency,this};function Ac(e){bt.call(this),this.type="MeshPhongMaterial",this.color=new Fe(16777215),this.specular=new Fe(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lu,this.normalScale=new Ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=p0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}Ac.prototype=Object.create(bt.prototype);Ac.prototype.constructor=Ac;Ac.prototype.isMeshPhongMaterial=!0;Ac.prototype.copy=function(e){return bt.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function yu(e){bt.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Fe(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lu,this.normalScale=new Ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}yu.prototype=Object.create(bt.prototype);yu.prototype.constructor=yu;yu.prototype.isMeshToonMaterial=!0;yu.prototype.copy=function(e){return bt.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function vu(e){bt.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lu,this.normalScale=new Ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}vu.prototype=Object.create(bt.prototype);vu.prototype.constructor=vu;vu.prototype.isMeshNormalMaterial=!0;vu.prototype.copy=function(e){return bt.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function xu(e){bt.call(this),this.type="MeshLambertMaterial",this.color=new Fe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=p0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}xu.prototype=Object.create(bt.prototype);xu.prototype.constructor=xu;xu.prototype.isMeshLambertMaterial=!0;xu.prototype.copy=function(e){return bt.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function bu(e){bt.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Fe(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lu,this.normalScale=new Ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}bu.prototype=Object.create(bt.prototype);bu.prototype.constructor=bu;bu.prototype.isMeshMatcapMaterial=!0;bu.prototype.copy=function(e){return bt.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function _u(e){$n.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}_u.prototype=Object.create($n.prototype);_u.prototype.constructor=_u;_u.prototype.isLineDashedMaterial=!0;_u.prototype.copy=function(e){return $n.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var _B=Object.freeze({__proto__:null,ShadowMaterial:mu,SpriteMaterial:_c,RawShaderMaterial:Ca,ShaderMaterial:ti,PointsMaterial:wc,MeshPhysicalMaterial:gu,MeshStandardMaterial:ws,MeshPhongMaterial:Ac,MeshToonMaterial:yu,MeshNormalMaterial:vu,MeshLambertMaterial:xu,MeshDepthMaterial:vc,MeshDistanceMaterial:xc,MeshBasicMaterial:lo,MeshMatcapMaterial:bu,LineDashedMaterial:_u,LineBasicMaterial:$n,Material:bt});const An={arraySlice:function(e,t,n){return An.isTypedArray(e)?new e.constructor(e.subarray(t,n!==void 0?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){function t(r,o){return e[r]-e[o]}const n=e.length,i=new Array(n);for(let r=0;r!==n;++r)i[r]=r;return i.sort(t),i},sortedArray:function(e,t,n){const i=e.length,r=new e.constructor(i);for(let o=0,s=0;s!==i;++o){const a=n[o]*t;for(let c=0;c!==t;++c)r[s++]=e[a+c]}return r},flattenJSON:function(e,t,n,i){let r=1,o=e[0];for(;o!==void 0&&o[i]===void 0;)o=e[r++];if(o===void 0)return;let s=o[i];if(s!==void 0)if(Array.isArray(s))do s=o[i],s!==void 0&&(t.push(o.time),n.push.apply(n,s)),o=e[r++];while(o!==void 0);else if(s.toArray!==void 0)do s=o[i],s!==void 0&&(t.push(o.time),s.toArray(n,n.length)),o=e[r++];while(o!==void 0);else do s=o[i],s!==void 0&&(t.push(o.time),n.push(s)),o=e[r++];while(o!==void 0)},subclip:function(e,t,n,i,r){r=r||30;const o=e.clone();o.name=t;const s=[];for(let c=0;c<o.tracks.length;++c){const l=o.tracks[c],u=l.getValueSize(),h=[],f=[];for(let p=0;p<l.times.length;++p){const m=l.times[p]*r;if(!(m<n||m>=i)){h.push(l.times[p]);for(let y=0;y<u;++y)f.push(l.values[p*u+y])}}h.length!==0&&(l.times=An.convertArray(h,l.times.constructor),l.values=An.convertArray(f,l.values.constructor),s.push(l))}o.tracks=s;let a=1/0;for(let c=0;c<o.tracks.length;++c)a>o.tracks[c].times[0]&&(a=o.tracks[c].times[0]);for(let c=0;c<o.tracks.length;++c)o.tracks[c].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(e,t,n,i){t===void 0&&(t=0),n===void 0&&(n=e),(i===void 0||i<=0)&&(i=30);const r=e.tracks.length,o=t/i;for(let s=0;s<r;++s){const a=n.tracks[s],c=a.ValueTypeName;if(c==="bool"||c==="string")continue;const l=e.tracks.find(function(m){return m.name===a.name&&m.ValueTypeName===c});if(l===void 0)continue;const u=a.getValueSize(),h=a.times.length-1;let f;if(o<=a.times[0])f=An.arraySlice(a.values,0,a.valueSize);else if(o>=a.times[h]){const m=h*u;f=An.arraySlice(a.values,m)}else{const m=a.createInterpolant();m.evaluate(o),f=m.resultBuffer}c==="quaternion"&&new un(f[0],f[1],f[2],f[3]).normalize().conjugate().toArray(f);const p=l.times.length;for(let m=0;m<p;++m){const y=m*u;if(c==="quaternion")un.multiplyQuaternionsFlat(l.values,y,f,0,l.values,y);else for(let v=0;v<u;++v)l.values[y+v]-=f[v]}}return e.blendMode=PP,e}};function kr(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n}Object.assign(kr.prototype,{evaluate:function(e){let t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let o;n:{i:if(!(e<i)){for(let s=n+2;;){if(i===void 0){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===s)break;if(r=i,i=t[++n],e<i)break t}o=t.length;break n}if(!(e>=r)){const s=t[1];e<s&&(n=2,r=s);for(let a=n-2;;){if(r===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===a)break;if(i=r,r=t[--n-1],e>=r)break t}o=n,n=0;break n}break e}for(;n<o;){const s=n+o>>>1;e<t[s]?o=s:n=s+1}if(i=t[n],r=t[n-1],r===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(i===void 0)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let o=0;o!==i;++o)t[o]=n[r+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}});Object.assign(kr.prototype,{beforeStart_:kr.prototype.copySampleValue_,afterEnd_:kr.prototype.copySampleValue_});function yx(e,t,n,i){kr.call(this,e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}yx.prototype=Object.assign(Object.create(kr.prototype),{constructor:yx,DefaultSettings_:{endingStart:iu,endingEnd:iu},intervalChanged_:function(e,t,n){let i=this.parameterPositions,r=e-2,o=e+1,s=i[r],a=i[o];if(s===void 0)switch(this.getSettings_().endingStart){case El:r=e,s=2*t-n;break;case ig:r=i.length-2,s=t+i[r]-i[r+1];break;default:r=e,s=n}if(a===void 0)switch(this.getSettings_().endingEnd){case El:o=e,a=2*n-t;break;case ig:o=1,a=n+i[1]-i[0];break;default:o=e-1,a=t}const c=(n-t)*.5,l=this.valueSize;this._weightPrev=c/(t-s),this._weightNext=c/(a-n),this._offsetPrev=r*l,this._offsetNext=o*l},interpolate_:function(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,c=a-s,l=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,f=this._weightNext,p=(n-t)/(i-t),m=p*p,y=m*p,v=-h*y+2*h*m-h*p,d=(1+h)*y+(-1.5-2*h)*m+(-.5+h)*p+1,g=(-1-f)*y+(1.5+f)*m+.5*p,b=f*y-f*m;for(let x=0;x!==s;++x)r[x]=v*o[l+x]+d*o[c+x]+g*o[a+x]+b*o[u+x];return r}});function Cg(e,t,n,i){kr.call(this,e,t,n,i)}Cg.prototype=Object.assign(Object.create(kr.prototype),{constructor:Cg,interpolate_:function(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,c=a-s,l=(n-t)/(i-t),u=1-l;for(let h=0;h!==s;++h)r[h]=o[c+h]*u+o[a+h]*l;return r}});function vx(e,t,n,i){kr.call(this,e,t,n,i)}vx.prototype=Object.assign(Object.create(kr.prototype),{constructor:vx,interpolate_:function(e){return this.copySampleValue_(e-1)}});function Ei(e,t,n,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=An.convertArray(t,this.TimeBufferType),this.values=An.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}Object.assign(Ei,{toJSON:function(e){const t=e.constructor;let n;if(t.toJSON!==void 0)n=t.toJSON(e);else{n={name:e.name,times:An.convertArray(e.times,Array),values:An.convertArray(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(n.interpolation=i)}return n.type=e.ValueTypeName,n}});Object.assign(Ei.prototype,{constructor:Ei,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:lm,InterpolantFactoryMethodDiscrete:function(e){return new vx(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Cg(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new yx(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){let t;switch(e){case ng:t=this.InterpolantFactoryMethodDiscrete;break;case lm:t=this.InterpolantFactoryMethodLinear;break;case u1:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ng;case this.InterpolantFactoryMethodLinear:return lm;case this.InterpolantFactoryMethodSmooth:return u1}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(e!==0){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this},scale:function(e){if(e!==1){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this},trim:function(e,t){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<e;)++r;for(;o!==-1&&n[o]>t;)--o;if(++o,r!==0||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const s=this.getValueSize();this.times=An.arraySlice(n,r,o),this.values=An.arraySlice(this.values,r*s,o*s)}return this},validate:function(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let s=0;s!==r;s++){const a=n[s];if(typeof a=="number"&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,a),e=!1;break}if(o!==null&&o>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,a,o),e=!1;break}o=a}if(i!==void 0&&An.isTypedArray(i))for(let s=0,a=i.length;s!==a;++s){const c=i[s];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,c),e=!1;break}}return e},optimize:function(){const e=An.arraySlice(this.times),t=An.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===u1,r=e.length-1;let o=1;for(let s=1;s<r;++s){let a=!1;const c=e[s],l=e[s+1];if(c!==l&&(s!==1||c!==c[0]))if(i)a=!0;else{const u=s*n,h=u-n,f=u+n;for(let p=0;p!==n;++p){const m=t[u+p];if(m!==t[h+p]||m!==t[f+p]){a=!0;break}}}if(a){if(s!==o){e[o]=e[s];const u=s*n,h=o*n;for(let f=0;f!==n;++f)t[h+f]=t[u+f]}++o}}if(r>0){e[o]=e[r];for(let s=r*n,a=o*n,c=0;c!==n;++c)t[a+c]=t[s+c];++o}return o!==e.length?(this.times=An.arraySlice(e,0,o),this.values=An.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this},clone:function(){const e=An.arraySlice(this.times,0),t=An.arraySlice(this.values,0),n=this.constructor,i=new n(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}});function xx(e,t,n){Ei.call(this,e,t,n)}xx.prototype=Object.assign(Object.create(Ei.prototype),{constructor:xx,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:ng,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function bx(e,t,n,i){Ei.call(this,e,t,n,i)}bx.prototype=Object.assign(Object.create(Ei.prototype),{constructor:bx,ValueTypeName:"color"});function jf(e,t,n,i){Ei.call(this,e,t,n,i)}jf.prototype=Object.assign(Object.create(Ei.prototype),{constructor:jf,ValueTypeName:"number"});function _x(e,t,n,i){kr.call(this,e,t,n,i)}_x.prototype=Object.assign(Object.create(kr.prototype),{constructor:_x,interpolate_:function(e,t,n,i){const r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-t)/(i-t);let c=e*s;for(let l=c+s;c!==l;c+=4)un.slerpFlat(r,0,o,c-s,o,c,a);return r}});function Pg(e,t,n,i){Ei.call(this,e,t,n,i)}Pg.prototype=Object.assign(Object.create(Ei.prototype),{constructor:Pg,ValueTypeName:"quaternion",DefaultInterpolation:lm,InterpolantFactoryMethodLinear:function(e){return new _x(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0});function wx(e,t,n,i){Ei.call(this,e,t,n,i)}wx.prototype=Object.assign(Object.create(Ei.prototype),{constructor:wx,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:ng,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function Wf(e,t,n,i){Ei.call(this,e,t,n,i)}Wf.prototype=Object.assign(Object.create(Ei.prototype),{constructor:Wf,ValueTypeName:"vector"});function no(e,t,n,i){this.name=e,this.tracks=n,this.duration=t!==void 0?t:-1,this.blendMode=i!==void 0?i:m_,this.uuid=It.generateUUID(),this.duration<0&&this.resetDuration()}function wB(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return jf;case"vector":case"vector2":case"vector3":case"vector4":return Wf;case"color":return bx;case"quaternion":return Pg;case"bool":case"boolean":return xx;case"string":return wx}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function SB(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=wB(e.type);if(e.times===void 0){const n=[],i=[];An.flattenJSON(e.keys,n,i,"value"),e.times=n,e.values=i}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(no,{parse:function(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let r=0,o=n.length;r!==o;++r)t.push(SB(n[r]).scale(i));return new no(e.name,e.duration,t,e.blendMode)},toJSON:function(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=n.length;r!==o;++r)t.push(Ei.toJSON(n[r]));return i},CreateFromMorphTargetSequence:function(e,t,n,i){const r=t.length,o=[];for(let s=0;s<r;s++){let a=[],c=[];a.push((s+r-1)%r,s,(s+1)%r),c.push(0,1,0);const l=An.getKeyframeOrder(a);a=An.sortedArray(a,1,l),c=An.sortedArray(c,1,l),!i&&a[0]===0&&(a.push(r),c.push(c[0])),o.push(new jf(".morphTargetInfluences["+t[s].name+"]",a,c).scale(1/n))}return new no(e,-1,o)},findByName:function(e,t){let n=e;if(!Array.isArray(e)){const i=e;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let s=0,a=e.length;s<a;s++){const c=e[s],l=c.name.match(r);if(l&&l.length>1){const u=l[1];let h=i[u];h||(i[u]=h=[]),h.push(c)}}const o=[];for(const s in i)o.push(no.CreateFromMorphTargetSequence(s,i[s],t,n));return o},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(u,h,f,p,m){if(f.length!==0){const y=[],v=[];An.flattenJSON(f,y,v,p),y.length!==0&&m.push(new u(h,y,v))}},i=[],r=e.name||"default",o=e.fps||30,s=e.blendMode;let a=e.length||-1;const c=e.hierarchy||[];for(let u=0;u<c.length;u++){const h=c[u].keys;if(!(!h||h.length===0))if(h[0].morphTargets){const f={};let p;for(p=0;p<h.length;p++)if(h[p].morphTargets)for(let m=0;m<h[p].morphTargets.length;m++)f[h[p].morphTargets[m]]=-1;for(const m in f){const y=[],v=[];for(let d=0;d!==h[p].morphTargets.length;++d){const g=h[p];y.push(g.time),v.push(g.morphTarget===m?1:0)}i.push(new jf(".morphTargetInfluence["+m+"]",y,v))}a=f.length*(o||1)}else{const f=".bones["+t[u].name+"]";n(Wf,f+".position",h,"pos",i),n(Pg,f+".quaternion",h,"rot",i),n(Wf,f+".scale",h,"scl",i)}}return i.length===0?null:new no(r,a,i,s)}});Object.assign(no.prototype,{resetDuration:function(){const e=this.tracks;let t=0;for(let n=0,i=e.length;n!==i;++n){const r=this.tracks[n];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this},trim:function(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new no(this.name,this.duration,e,this.blendMode)}});const wu={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function KP(e,t,n){const i=this;let r=!1,o=0,s=0,a;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(l){s++,r===!1&&i.onStart!==void 0&&i.onStart(l,o,s),r=!0},this.itemEnd=function(l){o++,i.onProgress!==void 0&&i.onProgress(l,o,s),o===s&&(r=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(l){i.onError!==void 0&&i.onError(l)},this.resolveURL=function(l){return a?a(l):l},this.setURLModifier=function(l){return a=l,this},this.addHandler=function(l,u){return c.push(l,u),this},this.removeHandler=function(l){const u=c.indexOf(l);return u!==-1&&c.splice(u,2),this},this.getHandler=function(l){for(let u=0,h=c.length;u<h;u+=2){const f=c[u],p=c[u+1];if(f.global&&(f.lastIndex=0),f.test(l))return p}return null}}const MB=new KP;function an(e){this.manager=e!==void 0?e:MB,this.crossOrigin="anonymous",this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(an.prototype,{load:function(){},loadAsync:function(e,t){const n=this;return new Promise(function(i,r){n.load(e,i,t,r)})},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});const jr={};function zo(e){an.call(this,e)}zo.prototype=Object.assign(Object.create(an.prototype),{constructor:zo,load:function(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=wu.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;if(jr[e]!==void 0){jr[e].push({onLoad:t,onProgress:n,onError:i});return}const s=/^data:(.*?)(;base64)?,(.*)$/,a=e.match(s);let c;if(a){const l=a[1],u=!!a[2];let h=a[3];h=decodeURIComponent(h),u&&(h=atob(h));try{let f;const p=(this.responseType||"").toLowerCase();switch(p){case"arraybuffer":case"blob":const m=new Uint8Array(h.length);for(let v=0;v<h.length;v++)m[v]=h.charCodeAt(v);p==="blob"?f=new Blob([m.buffer],{type:l}):f=m.buffer;break;case"document":f=new DOMParser().parseFromString(h,l);break;case"json":f=JSON.parse(h);break;default:f=h;break}setTimeout(function(){t&&t(f),r.manager.itemEnd(e)},0)}catch(f){setTimeout(function(){i&&i(f),r.manager.itemError(e),r.manager.itemEnd(e)},0)}}else{jr[e]=[],jr[e].push({onLoad:t,onProgress:n,onError:i}),c=new XMLHttpRequest,c.open("GET",e,!0),c.addEventListener("load",function(l){const u=this.response,h=jr[e];if(delete jr[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),wu.add(e,u);for(let f=0,p=h.length;f<p;f++){const m=h[f];m.onLoad&&m.onLoad(u)}r.manager.itemEnd(e)}else{for(let f=0,p=h.length;f<p;f++){const m=h[f];m.onError&&m.onError(l)}r.manager.itemError(e),r.manager.itemEnd(e)}},!1),c.addEventListener("progress",function(l){const u=jr[e];for(let h=0,f=u.length;h<f;h++){const p=u[h];p.onProgress&&p.onProgress(l)}},!1),c.addEventListener("error",function(l){const u=jr[e];delete jr[e];for(let h=0,f=u.length;h<f;h++){const p=u[h];p.onError&&p.onError(l)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),c.addEventListener("abort",function(l){const u=jr[e];delete jr[e];for(let h=0,f=u.length;h<f;h++){const p=u[h];p.onError&&p.onError(l)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),this.responseType!==void 0&&(c.responseType=this.responseType),this.withCredentials!==void 0&&(c.withCredentials=this.withCredentials),c.overrideMimeType&&c.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(const l in this.requestHeader)c.setRequestHeader(l,this.requestHeader[l]);c.send(null)}return r.manager.itemStart(e),c},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this}});function r3(e){an.call(this,e)}r3.prototype=Object.assign(Object.create(an.prototype),{constructor:r3,load:function(e,t,n,i){const r=this,o=new zo(r.manager);o.setPath(r.path),o.load(e,function(s){try{t(r.parse(JSON.parse(s)))}catch(a){i?i(a):console.error(a),r.manager.itemError(e)}},n,i)},parse:function(e){const t=[];for(let n=0;n<e.length;n++){const i=no.parse(e[n]);t.push(i)}return t}});function o3(e){an.call(this,e)}o3.prototype=Object.assign(Object.create(an.prototype),{constructor:o3,load:function(e,t,n,i){const r=this,o=[],s=new Rf;s.image=o;const a=new zo(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer");let c=0;function l(u){a.load(e[u],function(h){const f=r.parse(h,!0);o[u]={width:f.width,height:f.height,format:f.format,mipmaps:f.mipmaps},c+=1,c===6&&(f.mipmapCount===1&&(s.minFilter=Xn),s.format=f.format,s.needsUpdate=!0,t&&t(s))},n,i)}if(Array.isArray(e))for(let u=0,h=e.length;u<h;++u)l(u);else a.load(e,function(u){const h=r.parse(u,!0);if(h.isCubemap){const f=h.mipmaps.length/h.mipmapCount;for(let p=0;p<f;p++){o[p]={mipmaps:[]};for(let m=0;m<h.mipmapCount;m++)o[p].mipmaps.push(h.mipmaps[p*h.mipmapCount+m]),o[p].format=h.format,o[p].width=h.width,o[p].height=h.height}}else s.image.width=h.width,s.image.height=h.height,s.mipmaps=h.mipmaps;h.mipmapCount===1&&(s.minFilter=Xn),s.format=h.format,s.needsUpdate=!0,t&&t(s)},n,i);return s}});function s3(e){an.call(this,e)}s3.prototype=Object.assign(Object.create(an.prototype),{constructor:s3,load:function(e,t,n,i){const r=this,o=new xs,s=new zo(this.manager);return s.setResponseType("arraybuffer"),s.setPath(this.path),s.load(e,function(a){const c=r.parse(a);c&&(c.image!==void 0?o.image=c.image:c.data!==void 0&&(o.image.width=c.width,o.image.height=c.height,o.image.data=c.data),o.wrapS=c.wrapS!==void 0?c.wrapS:Yi,o.wrapT=c.wrapT!==void 0?c.wrapT:Yi,o.magFilter=c.magFilter!==void 0?c.magFilter:Xn,o.minFilter=c.minFilter!==void 0?c.minFilter:Xn,o.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.format!==void 0&&(o.format=c.format),c.type!==void 0&&(o.type=c.type),c.mipmaps!==void 0&&(o.mipmaps=c.mipmaps,o.minFilter=d0),c.mipmapCount===1&&(o.minFilter=Xn),o.needsUpdate=!0,t&&t(o,c))},n,i),o}});function qf(e){an.call(this,e)}qf.prototype=Object.assign(Object.create(an.prototype),{constructor:qf,load:function(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=wu.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const s=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){s.removeEventListener("load",a,!1),s.removeEventListener("error",c,!1),wu.add(e,this),t&&t(this),r.manager.itemEnd(e)}function c(l){s.removeEventListener("load",a,!1),s.removeEventListener("error",c,!1),i&&i(l),r.manager.itemError(e),r.manager.itemEnd(e)}return s.addEventListener("load",a,!1),s.addEventListener("error",c,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(e),s.src=e,s}});function Sx(e){an.call(this,e)}Sx.prototype=Object.assign(Object.create(an.prototype),{constructor:Sx,load:function(e,t,n,i){const r=new Ma,o=new qf(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;function a(c){o.load(e[c],function(l){r.images[c]=l,s++,s===6&&(r.needsUpdate=!0,t&&t(r))},void 0,i)}for(let c=0;c<e.length;++c)a(c);return r}});function Mx(e){an.call(this,e)}Mx.prototype=Object.assign(Object.create(an.prototype),{constructor:Mx,load:function(e,t,n,i){const r=new dn,o=new qf(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(s){r.image=s;const a=e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0;r.format=a?rc:er,r.needsUpdate=!0,t!==void 0&&t(r)},n,i),r}});function ct(){this.type="Curve",this.arcLengthDivisions=200}Object.assign(ct.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e){e===void 0&&(e=5);const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e){e===void 0&&(e=5);const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){const e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(e===void 0&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){const n=this.getLengths();let i=0,r=n.length,o;t?o=t:o=e*n[r-1];let s=0,a=r-1,c;for(;s<=a;)if(i=Math.floor(s+(a-s)/2),c=n[i]-o,c<0)s=i+1;else if(c>0)a=i-1;else{a=i;break}if(i=a,n[i]===o)return i/(r-1);const l=n[i],h=n[i+1]-l,f=(o-l)/h;return(i+f)/(r-1)},getTangent:function(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);const o=this.getPoint(i),s=this.getPoint(r),a=t||(o.isVector2?new Ee:new T);return a.copy(s).sub(o).normalize(),a},getTangentAt:function(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)},computeFrenetFrames:function(e,t){const n=new T,i=[],r=[],o=[],s=new T,a=new De;for(let f=0;f<=e;f++){const p=f/e;i[f]=this.getTangentAt(p,new T),i[f].normalize()}r[0]=new T,o[0]=new T;let c=Number.MAX_VALUE;const l=Math.abs(i[0].x),u=Math.abs(i[0].y),h=Math.abs(i[0].z);l<=c&&(c=l,n.set(1,0,0)),u<=c&&(c=u,n.set(0,1,0)),h<=c&&n.set(0,0,1),s.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],s),o[0].crossVectors(i[0],r[0]);for(let f=1;f<=e;f++){if(r[f]=r[f-1].clone(),o[f]=o[f-1].clone(),s.crossVectors(i[f-1],i[f]),s.length()>Number.EPSILON){s.normalize();const p=Math.acos(It.clamp(i[f-1].dot(i[f]),-1,1));r[f].applyMatrix4(a.makeRotationAxis(s,p))}o[f].crossVectors(i[f],r[f])}if(t===!0){let f=Math.acos(It.clamp(r[0].dot(r[e]),-1,1));f/=e,i[0].dot(s.crossVectors(r[0],r[e]))>0&&(f=-f);for(let p=1;p<=e;p++)r[p].applyMatrix4(a.makeRotationAxis(i[p],f*p)),o[p].crossVectors(i[p],r[p])}return{tangents:i,normals:r,binormals:o}},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}});function zr(e,t,n,i,r,o,s,a){ct.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=i||1,this.aStartAngle=r||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=s||!1,this.aRotation=a||0}zr.prototype=Object.create(ct.prototype);zr.prototype.constructor=zr;zr.prototype.isEllipseCurve=!0;zr.prototype.getPoint=function(e,t){const n=t||new Ee,i=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(o?r=0:r=i),this.aClockwise===!0&&!o&&(r===i?r=-i:r=r-i);const s=this.aStartAngle+e*r;let a=this.aX+this.xRadius*Math.cos(s),c=this.aY+this.yRadius*Math.sin(s);if(this.aRotation!==0){const l=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=a-this.aX,f=c-this.aY;a=h*l-f*u+this.aX,c=h*u+f*l+this.aY}return n.set(a,c)};zr.prototype.copy=function(e){return ct.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this};zr.prototype.toJSON=function(){const e=ct.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e};zr.prototype.fromJSON=function(e){return ct.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this};function Xf(e,t,n,i,r,o){zr.call(this,e,t,n,n,i,r,o),this.type="ArcCurve"}Xf.prototype=Object.create(zr.prototype);Xf.prototype.constructor=Xf;Xf.prototype.isArcCurve=!0;function x_(){let e=0,t=0,n=0,i=0;function r(o,s,a,c){e=o,t=a,n=-3*o+3*s-2*a-c,i=2*o-2*s+a+c}return{initCatmullRom:function(o,s,a,c,l){r(s,a,l*(a-o),l*(c-s))},initNonuniformCatmullRom:function(o,s,a,c,l,u,h){let f=(s-o)/l-(a-o)/(l+u)+(a-s)/u,p=(a-s)/u-(c-s)/(u+h)+(c-a)/h;f*=u,p*=u,r(s,a,f,p)},calc:function(o){const s=o*o,a=s*o;return e+t*o+n*s+i*a}}}const vd=new T,D1=new x_,B1=new x_,F1=new x_;function mr(e,t,n,i){ct.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=n||"centripetal",this.tension=i||.5}mr.prototype=Object.create(ct.prototype);mr.prototype.constructor=mr;mr.prototype.isCatmullRomCurve3=!0;mr.prototype.getPoint=function(e,t){const n=t||new T,i=this.points,r=i.length,o=(r-(this.closed?0:1))*e;let s=Math.floor(o),a=o-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/r)+1)*r:a===0&&s===r-1&&(s=r-2,a=1);let c,l,u,h;if(this.closed||s>0?c=i[(s-1)%r]:(vd.subVectors(i[0],i[1]).add(i[0]),c=vd),l=i[s%r],u=i[(s+1)%r],this.closed||s+2<r?h=i[(s+2)%r]:(vd.subVectors(i[r-1],i[r-2]).add(i[r-1]),h=vd),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let p=Math.pow(c.distanceToSquared(l),f),m=Math.pow(l.distanceToSquared(u),f),y=Math.pow(u.distanceToSquared(h),f);m<1e-4&&(m=1),p<1e-4&&(p=m),y<1e-4&&(y=m),D1.initNonuniformCatmullRom(c.x,l.x,u.x,h.x,p,m,y),B1.initNonuniformCatmullRom(c.y,l.y,u.y,h.y,p,m,y),F1.initNonuniformCatmullRom(c.z,l.z,u.z,h.z,p,m,y)}else this.curveType==="catmullrom"&&(D1.initCatmullRom(c.x,l.x,u.x,h.x,this.tension),B1.initCatmullRom(c.y,l.y,u.y,h.y,this.tension),F1.initCatmullRom(c.z,l.z,u.z,h.z,this.tension));return n.set(D1.calc(a),B1.calc(a),F1.calc(a)),n};mr.prototype.copy=function(e){ct.prototype.copy.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this};mr.prototype.toJSON=function(){const e=ct.prototype.toJSON.call(this);e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e};mr.prototype.fromJSON=function(e){ct.prototype.fromJSON.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new T().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this};function a3(e,t,n,i,r){const o=(i-t)*.5,s=(r-n)*.5,a=e*e,c=e*a;return(2*n-2*i+o+s)*c+(-3*n+3*i-2*o-s)*a+o*e+n}function AB(e,t){const n=1-e;return n*n*t}function CB(e,t){return 2*(1-e)*e*t}function PB(e,t){return e*e*t}function qh(e,t,n,i){return AB(e,t)+CB(e,n)+PB(e,i)}function TB(e,t){const n=1-e;return n*n*n*t}function EB(e,t){const n=1-e;return 3*n*n*e*t}function IB(e,t){return 3*(1-e)*e*e*t}function LB(e,t){return e*e*e*t}function Xh(e,t,n,i,r){return TB(e,t)+EB(e,n)+IB(e,i)+LB(e,r)}function Uo(e,t,n,i){ct.call(this),this.type="CubicBezierCurve",this.v0=e||new Ee,this.v1=t||new Ee,this.v2=n||new Ee,this.v3=i||new Ee}Uo.prototype=Object.create(ct.prototype);Uo.prototype.constructor=Uo;Uo.prototype.isCubicBezierCurve=!0;Uo.prototype.getPoint=function(e,t){const n=t||new Ee,i=this.v0,r=this.v1,o=this.v2,s=this.v3;return n.set(Xh(e,i.x,r.x,o.x,s.x),Xh(e,i.y,r.y,o.y,s.y)),n};Uo.prototype.copy=function(e){return ct.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this};Uo.prototype.toJSON=function(){const e=ct.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e};Uo.prototype.fromJSON=function(e){return ct.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this};function Ss(e,t,n,i){ct.call(this),this.type="CubicBezierCurve3",this.v0=e||new T,this.v1=t||new T,this.v2=n||new T,this.v3=i||new T}Ss.prototype=Object.create(ct.prototype);Ss.prototype.constructor=Ss;Ss.prototype.isCubicBezierCurve3=!0;Ss.prototype.getPoint=function(e,t){const n=t||new T,i=this.v0,r=this.v1,o=this.v2,s=this.v3;return n.set(Xh(e,i.x,r.x,o.x,s.x),Xh(e,i.y,r.y,o.y,s.y),Xh(e,i.z,r.z,o.z,s.z)),n};Ss.prototype.copy=function(e){return ct.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this};Ss.prototype.toJSON=function(){const e=ct.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e};Ss.prototype.fromJSON=function(e){return ct.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this};function gr(e,t){ct.call(this),this.type="LineCurve",this.v1=e||new Ee,this.v2=t||new Ee}gr.prototype=Object.create(ct.prototype);gr.prototype.constructor=gr;gr.prototype.isLineCurve=!0;gr.prototype.getPoint=function(e,t){const n=t||new Ee;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n};gr.prototype.getPointAt=function(e,t){return this.getPoint(e,t)};gr.prototype.getTangent=function(e,t){const n=t||new Ee;return n.copy(this.v2).sub(this.v1).normalize(),n};gr.prototype.copy=function(e){return ct.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this};gr.prototype.toJSON=function(){const e=ct.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e};gr.prototype.fromJSON=function(e){return ct.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function Go(e,t){ct.call(this),this.type="LineCurve3",this.v1=e||new T,this.v2=t||new T}Go.prototype=Object.create(ct.prototype);Go.prototype.constructor=Go;Go.prototype.isLineCurve3=!0;Go.prototype.getPoint=function(e,t){const n=t||new T;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n};Go.prototype.getPointAt=function(e,t){return this.getPoint(e,t)};Go.prototype.copy=function(e){return ct.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this};Go.prototype.toJSON=function(){const e=ct.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e};Go.prototype.fromJSON=function(e){return ct.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function $o(e,t,n){ct.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Ee,this.v1=t||new Ee,this.v2=n||new Ee}$o.prototype=Object.create(ct.prototype);$o.prototype.constructor=$o;$o.prototype.isQuadraticBezierCurve=!0;$o.prototype.getPoint=function(e,t){const n=t||new Ee,i=this.v0,r=this.v1,o=this.v2;return n.set(qh(e,i.x,r.x,o.x),qh(e,i.y,r.y,o.y)),n};$o.prototype.copy=function(e){return ct.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this};$o.prototype.toJSON=function(){const e=ct.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e};$o.prototype.fromJSON=function(e){return ct.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function Ms(e,t,n){ct.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new T,this.v1=t||new T,this.v2=n||new T}Ms.prototype=Object.create(ct.prototype);Ms.prototype.constructor=Ms;Ms.prototype.isQuadraticBezierCurve3=!0;Ms.prototype.getPoint=function(e,t){const n=t||new T,i=this.v0,r=this.v1,o=this.v2;return n.set(qh(e,i.x,r.x,o.x),qh(e,i.y,r.y,o.y),qh(e,i.z,r.z,o.z)),n};Ms.prototype.copy=function(e){return ct.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this};Ms.prototype.toJSON=function(){const e=ct.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e};Ms.prototype.fromJSON=function(e){return ct.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function Vo(e){ct.call(this),this.type="SplineCurve",this.points=e||[]}Vo.prototype=Object.create(ct.prototype);Vo.prototype.constructor=Vo;Vo.prototype.isSplineCurve=!0;Vo.prototype.getPoint=function(e,t){const n=t||new Ee,i=this.points,r=(i.length-1)*e,o=Math.floor(r),s=r-o,a=i[o===0?o:o-1],c=i[o],l=i[o>i.length-2?i.length-1:o+1],u=i[o>i.length-3?i.length-1:o+2];return n.set(a3(s,a.x,c.x,l.x,u.x),a3(s,a.y,c.y,l.y,u.y)),n};Vo.prototype.copy=function(e){ct.prototype.copy.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this};Vo.prototype.toJSON=function(){const e=ct.prototype.toJSON.call(this);e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e};Vo.prototype.fromJSON=function(e){ct.prototype.fromJSON.call(this,e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new Ee().fromArray(i))}return this};var Ax=Object.freeze({__proto__:null,ArcCurve:Xf,CatmullRomCurve3:mr,CubicBezierCurve:Uo,CubicBezierCurve3:Ss,EllipseCurve:zr,LineCurve:gr,LineCurve3:Go,QuadraticBezierCurve:$o,QuadraticBezierCurve3:Ms,SplineCurve:Vo});function sa(){ct.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}sa.prototype=Object.assign(Object.create(ct.prototype),{constructor:sa,add:function(e){this.curves.push(e)},closePath:function(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new gr(t,e))},getPoint:function(e){const t=e*this.getLength(),n=this.getCurveLengths();let i=0;for(;i<n.length;){if(n[i]>=t){const r=n[i]-t,o=this.curves[i],s=o.getLength(),a=s===0?0:1-r/s;return o.getPointAt(a)}i++}return null},getLength:function(){const e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){e===void 0&&(e=40);const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const o=r[i],s=o&&o.isEllipseCurve?e*2:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s);for(let c=0;c<a.length;c++){const l=a[c];n&&n.equals(l)||(t.push(l),n=l)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t},copy:function(e){ct.prototype.copy.call(this,e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){const e=ct.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e},fromJSON:function(e){ct.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(new Ax[i.type]().fromJSON(i))}return this}});function Ro(e){sa.call(this),this.type="Path",this.currentPoint=new Ee,e&&this.setFromPoints(e)}Ro.prototype=Object.assign(Object.create(sa.prototype),{constructor:Ro,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){const n=new gr(this.currentPoint.clone(),new Ee(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,n,i){const r=new $o(this.currentPoint.clone(),new Ee(e,t),new Ee(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this},bezierCurveTo:function(e,t,n,i,r,o){const s=new Uo(this.currentPoint.clone(),new Ee(e,t),new Ee(n,i),new Ee(r,o));return this.curves.push(s),this.currentPoint.set(r,o),this},splineThru:function(e){const t=[this.currentPoint.clone()].concat(e),n=new Vo(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,n,i,r,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+s,t+a,n,i,r,o),this},absarc:function(e,t,n,i,r,o){return this.absellipse(e,t,n,n,i,r,o),this},ellipse:function(e,t,n,i,r,o,s,a){const c=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(e+c,t+l,n,i,r,o,s,a),this},absellipse:function(e,t,n,i,r,o,s,a){const c=new zr(e,t,n,i,r,o,s,a);if(this.curves.length>0){const u=c.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(c);const l=c.getPoint(1);return this.currentPoint.copy(l),this},copy:function(e){return sa.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){const e=sa.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return sa.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}});function sc(e){Ro.call(this,e),this.uuid=It.generateUUID(),this.type="Shape",this.holes=[]}sc.prototype=Object.assign(Object.create(Ro.prototype),{constructor:sc,getPointsHoles:function(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Ro.prototype.copy.call(this,e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(i.clone())}return this},toJSON:function(){const e=Ro.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e},fromJSON:function(e){Ro.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(new Ro().fromJSON(i))}return this}});function _n(e,t){je.call(this),this.type="Light",this.color=new Fe(e),this.intensity=t!==void 0?t:1,this.receiveShadow=void 0}_n.prototype=Object.assign(Object.create(je.prototype),{constructor:_n,isLight:!0,copy:function(e){return je.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){const t=je.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}});function Cx(e,t,n){_n.call(this,e,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(je.DefaultUp),this.updateMatrix(),this.groundColor=new Fe(t)}Cx.prototype=Object.assign(Object.create(_n.prototype),{constructor:Cx,isHemisphereLight:!0,copy:function(e){return _n.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}});function As(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Ee(512,512),this.map=null,this.mapPass=null,this.matrix=new De,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new xp,this._frameExtents=new Ee(1,1),this._viewportCount=1,this._viewports=[new on(0,0,1,1)]}Object.assign(As.prototype,{_projScreenMatrix:new De,_lightPositionWorld:new T,_lookTarget:new T,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){const t=this.camera,n=this.matrix,i=this._projScreenMatrix,r=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(e.matrixWorld),t.position.copy(o),r.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(r),t.updateMatrixWorld(),i.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(i),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}});function Px(){As.call(this,new jn(50,1,.5,500))}Px.prototype=Object.assign(Object.create(As.prototype),{constructor:Px,isSpotLightShadow:!0,updateMatrices:function(e){const t=this.camera,n=It.RAD2DEG*2*e.angle,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(n!==t.fov||i!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),As.prototype.updateMatrices.call(this,e)}});function Tg(e,t,n,i,r,o){_n.call(this,e,t),this.type="SpotLight",this.position.copy(je.DefaultUp),this.updateMatrix(),this.target=new je,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(s){this.intensity=s/Math.PI}}),this.distance=n!==void 0?n:0,this.angle=i!==void 0?i:Math.PI/3,this.penumbra=r!==void 0?r:0,this.decay=o!==void 0?o:1,this.shadow=new Px}Tg.prototype=Object.assign(Object.create(_n.prototype),{constructor:Tg,isSpotLight:!0,copy:function(e){return _n.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}});function Tx(){As.call(this,new jn(90,1,.5,500)),this._frameExtents=new Ee(4,2),this._viewportCount=6,this._viewports=[new on(2,1,1,1),new on(0,1,1,1),new on(3,1,1,1),new on(1,1,1,1),new on(3,0,1,1),new on(1,0,1,1)],this._cubeDirections=[new T(1,0,0),new T(-1,0,0),new T(0,0,1),new T(0,0,-1),new T(0,1,0),new T(0,-1,0)],this._cubeUps=[new T(0,1,0),new T(0,1,0),new T(0,1,0),new T(0,1,0),new T(0,0,1),new T(0,0,-1)]}Tx.prototype=Object.assign(Object.create(As.prototype),{constructor:Tx,isPointLightShadow:!0,updateMatrices:function(e,t){t===void 0&&(t=0);const n=this.camera,i=this.matrix,r=this._lightPositionWorld,o=this._lookTarget,s=this._projScreenMatrix;r.setFromMatrixPosition(e.matrixWorld),n.position.copy(r),o.copy(n.position),o.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(o),n.updateMatrixWorld(),i.makeTranslation(-r.x,-r.y,-r.z),s.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(s)}});function Ex(e,t,n,i){_n.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return this.intensity*4*Math.PI},set:function(r){this.intensity=r/(4*Math.PI)}}),this.distance=n!==void 0?n:0,this.decay=i!==void 0?i:1,this.shadow=new Tx}Ex.prototype=Object.assign(Object.create(_n.prototype),{constructor:Ex,isPointLight:!0,copy:function(e){return _n.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}});function Pa(e,t,n,i,r,o){vs.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e!==void 0?e:-1,this.right=t!==void 0?t:1,this.top=n!==void 0?n:1,this.bottom=i!==void 0?i:-1,this.near=r!==void 0?r:.1,this.far=o!==void 0?o:2e3,this.updateProjectionMatrix()}Pa.prototype=Object.assign(Object.create(vs.prototype),{constructor:Pa,isOrthographicCamera:!0,copy:function(e,t){return vs.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,i,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,o=n+e,s=i+t,a=i-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,l=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,s-=l*this.view.offsetY,a=s-l*this.view.height}this.projectionMatrix.makeOrthographic(r,o,s,a,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){const t=je.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}});function Ix(){As.call(this,new Pa(-5,5,5,-5,.5,500))}Ix.prototype=Object.assign(Object.create(As.prototype),{constructor:Ix,isDirectionalLightShadow:!0,updateMatrices:function(e){As.prototype.updateMatrices.call(this,e)}});function Lx(e,t){_n.call(this,e,t),this.type="DirectionalLight",this.position.copy(je.DefaultUp),this.updateMatrix(),this.target=new je,this.shadow=new Ix}Lx.prototype=Object.assign(Object.create(_n.prototype),{constructor:Lx,isDirectionalLight:!0,copy:function(e){return _n.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}});function Eg(e,t){_n.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}Eg.prototype=Object.assign(Object.create(_n.prototype),{constructor:Eg,isAmbientLight:!0});function Rx(e,t,n,i){_n.call(this,e,t),this.type="RectAreaLight",this.width=n!==void 0?n:10,this.height=i!==void 0?i:10}Rx.prototype=Object.assign(Object.create(_n.prototype),{constructor:Rx,isRectAreaLight:!0,copy:function(e){return _n.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){const t=_n.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});function b_(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new T)}Object.assign(b_.prototype,{isSphericalHarmonics3:!0,set:function(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*i),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*i)),t.addScaledVector(o[5],1.092548*(i*r)),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],1.092548*(n*r)),t.addScaledVector(o[8],.546274*(n*n-i*i)),t},getIrradianceAt:function(e,t){const n=e.x,i=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*i),t.addScaledVector(o[2],2*.511664*r),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*i),t.addScaledVector(o[5],2*.429043*i*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],2*.429043*n*r),t.addScaledVector(o[8],.429043*(n*n-i*i)),t},add:function(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},addScaledSH:function(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this},scale:function(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this},equals:function(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return new this.constructor().copy(this)},fromArray:function(e,t){t===void 0&&(t=0);const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+i*3);return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+i*3);return e}});Object.assign(b_,{getBasisAt:function(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}});function so(e,t){_n.call(this,void 0,t),this.type="LightProbe",this.sh=e!==void 0?e:new b_}so.prototype=Object.assign(Object.create(_n.prototype),{constructor:so,isLightProbe:!0,copy:function(e){return _n.prototype.copy.call(this,e),this.sh.copy(e.sh),this},fromJSON:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},toJSON:function(e){const t=_n.prototype.toJSON.call(this,e);return t.object.sh=this.sh.toArray(),t}});function Ox(e){an.call(this,e),this.textures={}}Ox.prototype=Object.assign(Object.create(an.prototype),{constructor:Ox,load:function(e,t,n,i){const r=this,o=new zo(r.manager);o.setPath(r.path),o.load(e,function(s){try{t(r.parse(JSON.parse(s)))}catch(a){i?i(a):console.error(a),r.manager.itemError(e)}},n,i)},parse:function(e){const t=this.textures;function n(r){return t[r]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",r),t[r]}const i=new _B[e.type];if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=new Fe().setHex(e.sheen)),e.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular.setHex(e.specular),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==1&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.skinning!==void 0&&(i.skinning=e.skinning),e.morphTargets!==void 0&&(i.morphTargets=e.morphTargets),e.morphNormals!==void 0&&(i.morphNormals=e.morphNormals),e.dithering!==void 0&&(i.dithering=e.dithering),e.vertexTangents!==void 0&&(i.vertexTangents=e.vertexTangents),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const r in e.uniforms){const o=e.uniforms[r];switch(i.uniforms[r]={},o.type){case"t":i.uniforms[r].value=n(o.value);break;case"c":i.uniforms[r].value=new Fe().setHex(o.value);break;case"v2":i.uniforms[r].value=new Ee().fromArray(o.value);break;case"v3":i.uniforms[r].value=new T().fromArray(o.value);break;case"v4":i.uniforms[r].value=new on().fromArray(o.value);break;case"m3":i.uniforms[r].value=new di().fromArray(o.value);case"m4":i.uniforms[r].value=new De().fromArray(o.value);break;default:i.uniforms[r].value=o.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.extensions!==void 0)for(const r in e.extensions)i.extensions[r]=e.extensions[r];if(e.shading!==void 0&&(i.flatShading=e.shading===1),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=n(e.map)),e.matcap!==void 0&&(i.matcap=n(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(i.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){let r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),i.normalScale=new Ee().fromArray(r)}return e.displacementMap!==void 0&&(i.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=n(e.specularMap)),e.envMap!==void 0&&(i.envMap=n(e.envMap)),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(i.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new Ee().fromArray(e.clearcoatNormalScale)),i},setTextures:function(e){return this.textures=e,this}});const QP={decodeText:function(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}},extractUrlBase:function(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}};function Ig(){We.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}Ig.prototype=Object.assign(Object.create(We.prototype),{constructor:Ig,isInstancedBufferGeometry:!0,copy:function(e){return We.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){const e=We.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}});function kx(e,t,n,i){typeof n=="number"&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),rt.call(this,e,t,n),this.meshPerAttribute=i||1}kx.prototype=Object.assign(Object.create(rt.prototype),{constructor:kx,isInstancedBufferAttribute:!0,copy:function(e){return rt.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){const e=rt.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}});function Dx(e){an.call(this,e)}Dx.prototype=Object.assign(Object.create(an.prototype),{constructor:Dx,load:function(e,t,n,i){const r=this,o=new zo(r.manager);o.setPath(r.path),o.load(e,function(s){try{t(r.parse(JSON.parse(s)))}catch(a){i?i(a):console.error(a),r.manager.itemError(e)}},n,i)},parse:function(e){const t={},n={};function i(f,p){if(t[p]!==void 0)return t[p];const y=f.interleavedBuffers[p],v=r(f,y.buffer),d=new xd[y.type](v),g=new Rr(d,y.stride);return g.uuid=y.uuid,t[p]=g,g}function r(f,p){if(n[p]!==void 0)return n[p];const y=f.arrayBuffers[p],v=new Uint32Array(y).buffer;return n[p]=v,v}const o=e.isInstancedBufferGeometry?new Ig:new We,s=e.data.index;if(s!==void 0){const f=new xd[s.type](s.array);o.setIndex(new rt(f,1))}const a=e.data.attributes;for(const f in a){const p=a[f];let m;if(p.isInterleavedBufferAttribute){const y=i(e.data,p.data);m=new bc(y,p.itemSize,p.offset,p.normalized)}else{const y=new xd[p.type](p.array),v=p.isInstancedBufferAttribute?kx:rt;m=new v(y,p.itemSize,p.normalized)}p.name!==void 0&&(m.name=p.name),o.setAttribute(f,m)}const c=e.data.morphAttributes;if(c)for(const f in c){const p=c[f],m=[];for(let y=0,v=p.length;y<v;y++){const d=p[y];let g;if(d.isInterleavedBufferAttribute){const b=i(e.data,d.data);g=new bc(b,d.itemSize,d.offset,d.normalized)}else{const b=new xd[d.type](d.array);g=new rt(b,d.itemSize,d.normalized)}d.name!==void 0&&(g.name=d.name),m.push(g)}o.morphAttributes[f]=m}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const u=e.data.groups||e.data.drawcalls||e.data.offsets;if(u!==void 0)for(let f=0,p=u.length;f!==p;++f){const m=u[f];o.addGroup(m.start,m.count,m.materialIndex)}const h=e.data.boundingSphere;if(h!==void 0){const f=new T;h.center!==void 0&&f.fromArray(h.center),o.boundingSphere=new Is(f,h.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}});const xd={Int8Array,Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray<"u"?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Bx(e){an.call(this,e)}Bx.prototype=Object.assign(Object.create(an.prototype),{constructor:Bx,load:function(e,t,n,i){const r=this,o=this.path===""?QP.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const s=new zo(r.manager);s.setPath(this.path),s.load(e,function(a){let c=null;try{c=JSON.parse(a)}catch(u){i!==void 0&&i(u),console.error("THREE:ObjectLoader: Can't parse "+e+".",u.message);return}const l=c.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+e);return}r.parse(c,t)},n,i)},parse:function(e,t){const n=this.parseShape(e.shapes),i=this.parseGeometries(e.geometries,n),r=this.parseImages(e.images,function(){t!==void 0&&t(a)}),o=this.parseTextures(e.textures,r),s=this.parseMaterials(e.materials,o),a=this.parseObject(e.object,i,s);return e.animations&&(a.animations=this.parseAnimations(e.animations)),(e.images===void 0||e.images.length===0)&&t!==void 0&&t(a),a},parseShape:function(e){const t={};if(e!==void 0)for(let n=0,i=e.length;n<i;n++){const r=new sc().fromJSON(e[n]);t[r.uuid]=r}return t},parseGeometries:function(e,t){const n={};let i;if(e!==void 0){const r=new Dx;for(let o=0,s=e.length;o<s;o++){let a;const c=e[o];switch(c.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Li[c.type](c.width,c.height,c.widthSegments,c.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Li[c.type](c.width,c.height,c.depth,c.widthSegments,c.heightSegments,c.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Li[c.type](c.radius,c.segments,c.thetaStart,c.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Li[c.type](c.radiusTop,c.radiusBottom,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Li[c.type](c.radius,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Li[c.type](c.radius,c.widthSegments,c.heightSegments,c.phiStart,c.phiLength,c.thetaStart,c.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new Li[c.type](c.radius,c.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Li[c.type](c.innerRadius,c.outerRadius,c.thetaSegments,c.phiSegments,c.thetaStart,c.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Li[c.type](c.radius,c.tube,c.radialSegments,c.tubularSegments,c.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Li[c.type](c.radius,c.tube,c.tubularSegments,c.radialSegments,c.p,c.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new Li[c.type](new Ax[c.path.type]().fromJSON(c.path),c.tubularSegments,c.radius,c.radialSegments,c.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Li[c.type](c.points,c.segments,c.phiStart,c.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new Li[c.type](c.vertices,c.indices,c.radius,c.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":i=[];for(let u=0,h=c.shapes.length;u<h;u++){const f=t[c.shapes[u]];i.push(f)}a=new Li[c.type](i,c.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":i=[];for(let u=0,h=c.shapes.length;u<h;u++){const f=t[c.shapes[u]];i.push(f)}const l=c.options.extrudePath;l!==void 0&&(c.options.extrudePath=new Ax[l.type]().fromJSON(l)),a=new Li[c.type](i,c.options);break;case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(c);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+c.type+'"');continue}a.uuid=c.uuid,c.name!==void 0&&(a.name=c.name),a.isBufferGeometry===!0&&c.userData!==void 0&&(a.userData=c.userData),n[c.uuid]=a}}return n},parseMaterials:function(e,t){const n={},i={};if(e!==void 0){const r=new Ox;r.setTextures(t);for(let o=0,s=e.length;o<s;o++){const a=e[o];if(a.type==="MultiMaterial"){const c=[];for(let l=0;l<a.materials.length;l++){const u=a.materials[l];n[u.uuid]===void 0&&(n[u.uuid]=r.parse(u)),c.push(n[u.uuid])}i[a.uuid]=c}else n[a.uuid]===void 0&&(n[a.uuid]=r.parse(a)),i[a.uuid]=n[a.uuid]}}return i},parseAnimations:function(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n],r=no.parse(i);i.uuid!==void 0&&(r.uuid=i.uuid),t.push(r)}return t},parseImages:function(e,t){const n=this,i={};let r;function o(s){return n.manager.itemStart(s),r.load(s,function(){n.manager.itemEnd(s)},void 0,function(){n.manager.itemError(s),n.manager.itemEnd(s)})}if(e!==void 0&&e.length>0){const s=new KP(t);r=new qf(s),r.setCrossOrigin(this.crossOrigin);for(let a=0,c=e.length;a<c;a++){const l=e[a],u=l.url;if(Array.isArray(u)){i[l.uuid]=[];for(let h=0,f=u.length;h<f;h++){const p=u[h],m=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(p)?p:n.resourcePath+p;i[l.uuid].push(o(m))}}else{const h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:n.resourcePath+l.url;i[l.uuid]=o(h)}}}return i},parseTextures:function(e,t){function n(r,o){return typeof r=="number"?r:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",r),o[r])}const i={};if(e!==void 0)for(let r=0,o=e.length;r<o;r++){const s=e[r];s.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),t[s.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",s.image);let a;Array.isArray(t[s.image])?a=new Ma(t[s.image]):a=new dn(t[s.image]),a.needsUpdate=!0,a.uuid=s.uuid,s.name!==void 0&&(a.name=s.name),s.mapping!==void 0&&(a.mapping=n(s.mapping,RB)),s.offset!==void 0&&a.offset.fromArray(s.offset),s.repeat!==void 0&&a.repeat.fromArray(s.repeat),s.center!==void 0&&a.center.fromArray(s.center),s.rotation!==void 0&&(a.rotation=s.rotation),s.wrap!==void 0&&(a.wrapS=n(s.wrap[0],c3),a.wrapT=n(s.wrap[1],c3)),s.format!==void 0&&(a.format=s.format),s.type!==void 0&&(a.type=s.type),s.encoding!==void 0&&(a.encoding=s.encoding),s.minFilter!==void 0&&(a.minFilter=n(s.minFilter,l3)),s.magFilter!==void 0&&(a.magFilter=n(s.magFilter,l3)),s.anisotropy!==void 0&&(a.anisotropy=s.anisotropy),s.flipY!==void 0&&(a.flipY=s.flipY),s.premultiplyAlpha!==void 0&&(a.premultiplyAlpha=s.premultiplyAlpha),s.unpackAlignment!==void 0&&(a.unpackAlignment=s.unpackAlignment),i[s.uuid]=a}return i},parseObject:function(e,t,n){let i;function r(c){return t[c]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",c),t[c]}function o(c){if(c!==void 0){if(Array.isArray(c)){const l=[];for(let u=0,h=c.length;u<h;u++){const f=c[u];n[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",f),l.push(n[f])}return l}return n[c]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",c),n[c]}}let s,a;switch(e.type){case"Scene":i=new ru,e.background!==void 0&&Number.isInteger(e.background)&&(i.background=new Fe(e.background)),e.fog!==void 0&&(e.fog.type==="Fog"?i.fog=new sg(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(i.fog=new cx(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":i=new jn(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(i.focus=e.focus),e.zoom!==void 0&&(i.zoom=e.zoom),e.filmGauge!==void 0&&(i.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(i.filmOffset=e.filmOffset),e.view!==void 0&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new Pa(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(i.zoom=e.zoom),e.view!==void 0&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new Eg(e.color,e.intensity);break;case"DirectionalLight":i=new Lx(e.color,e.intensity);break;case"PointLight":i=new Ex(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new Rx(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new Tg(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new Cx(e.color,e.groundColor,e.intensity);break;case"LightProbe":i=new so().fromJSON(e);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":s=r(e.geometry),a=o(e.material),i=new pn(s,a);break;case"InstancedMesh":s=r(e.geometry),a=o(e.material);const c=e.count,l=e.instanceMatrix;i=new fx(s,a,c),i.instanceMatrix=new rt(new Float32Array(l.array),16);break;case"LOD":i=new ag;break;case"Line":i=new Nr(r(e.geometry),o(e.material),e.mode);break;case"LineLoop":i=new px(r(e.geometry),o(e.material));break;case"LineSegments":i=new On(r(e.geometry),o(e.material));break;case"PointCloud":case"Points":i=new Lf(r(e.geometry),o(e.material));break;case"Sprite":i=new lx(o(e.material));break;case"Group":i=new nn;break;default:i=new je}if(i.uuid=e.uuid,e.name!==void 0&&(i.name=e.name),e.matrix!==void 0?(i.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(e.position!==void 0&&i.position.fromArray(e.position),e.rotation!==void 0&&i.rotation.fromArray(e.rotation),e.quaternion!==void 0&&i.quaternion.fromArray(e.quaternion),e.scale!==void 0&&i.scale.fromArray(e.scale)),e.castShadow!==void 0&&(i.castShadow=e.castShadow),e.receiveShadow!==void 0&&(i.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(i.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(i.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(i.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&i.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(i.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(i.visible=e.visible),e.frustumCulled!==void 0&&(i.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(i.renderOrder=e.renderOrder),e.userData!==void 0&&(i.userData=e.userData),e.layers!==void 0&&(i.layers.mask=e.layers),e.children!==void 0){const c=e.children;for(let l=0;l<c.length;l++)i.add(this.parseObject(c[l],t,n))}if(e.type==="LOD"){e.autoUpdate!==void 0&&(i.autoUpdate=e.autoUpdate);const c=e.levels;for(let l=0;l<c.length;l++){const u=c[l],h=i.getObjectByProperty("uuid",u.object);h!==void 0&&i.addLevel(h,u.distance)}}return i}});const RB={UVMapping:u_,CubeReflectionMapping:h_,CubeRefractionMapping:f_,EquirectangularReflectionMapping:AP,EquirectangularRefractionMapping:p_,CubeUVReflectionMapping:gp,CubeUVRefractionMapping:d_},c3={RepeatWrapping:Qm,ClampToEdgeWrapping:Yi,MirroredRepeatWrapping:Jm},l3={NearestFilter:ln,NearestMipmapNearestFilter:Qv,NearestMipmapLinearFilter:Jv,LinearFilter:Xn,LinearMipmapNearestFilter:CP,LinearMipmapLinearFilter:d0};function u3(e){typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),an.call(this,e),this.options={premultiplyAlpha:"none"}}u3.prototype=Object.assign(Object.create(an.prototype),{constructor:u3,isImageBitmapLoader:!0,setOptions:function(t){return this.options=t,this},load:function(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=wu.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;fetch(e).then(function(s){return s.blob()}).then(function(s){return createImageBitmap(s,r.options)}).then(function(s){wu.add(e,s),t&&t(s),r.manager.itemEnd(e)}).catch(function(s){i&&i(s),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}});function JP(){this.type="ShapePath",this.color=new Fe,this.subPaths=[],this.currentPath=null}Object.assign(JP.prototype,{moveTo:function(e,t){return this.currentPath=new Ro,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this},bezierCurveTo:function(e,t,n,i,r,o){return this.currentPath.bezierCurveTo(e,t,n,i,r,o),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function n(d){const g=[];for(let b=0,x=d.length;b<x;b++){const _=d[b],S=new sc;S.curves=_.curves,g.push(S)}return g}function i(d,g){const b=g.length;let x=!1;for(let _=b-1,S=0;S<b;_=S++){let w=g[_],C=g[S],A=C.x-w.x,k=C.y-w.y;if(Math.abs(k)>Number.EPSILON){if(k<0&&(w=g[S],A=-A,C=g[_],k=-k),d.y<w.y||d.y>C.y)continue;if(d.y===w.y){if(d.x===w.x)return!0}else{const L=k*(d.x-w.x)-A*(d.y-w.y);if(L===0)return!0;if(L<0)continue;x=!x}}else{if(d.y!==w.y)continue;if(C.x<=d.x&&d.x<=w.x||w.x<=d.x&&d.x<=C.x)return!0}}return x}const r=ya.isClockWise,o=this.subPaths;if(o.length===0)return[];if(t===!0)return n(o);let s,a,c,l=[];if(o.length===1)return a=o[0],c=new sc,c.curves=a.curves,l.push(c),l;let u=!r(o[0].getPoints());u=e?!u:u;const h=[],f=[];let p=[],m=0,y;f[m]=void 0,p[m]=[];for(let d=0,g=o.length;d<g;d++)a=o[d],y=a.getPoints(),s=r(y),s=e?!s:s,s?(!u&&f[m]&&m++,f[m]={s:new sc,p:y},f[m].s.curves=a.curves,u&&m++,p[m]=[]):p[m].push({h:a,p:y[0]});if(!f[0])return n(o);if(f.length>1){let d=!1;const g=[];for(let b=0,x=f.length;b<x;b++)h[b]=[];for(let b=0,x=f.length;b<x;b++){const _=p[b];for(let S=0;S<_.length;S++){const w=_[S];let C=!0;for(let A=0;A<f.length;A++)i(w.p,f[A].p)&&(b!==A&&g.push({froms:b,tos:A,hole:S}),C?(C=!1,h[A].push(w)):d=!0);C&&h[b].push(w)}}g.length>0&&(d||(p=h))}let v;for(let d=0,g=f.length;d<g;d++){c=f[d].s,l.push(c),v=p[d];for(let b=0,x=v.length;b<x;b++)c.holes.push(v[b].h)}return l}});function eT(e){this.type="Font",this.data=e}Object.assign(eT.prototype,{isFont:!0,generateShapes:function(e,t){t===void 0&&(t=100);const n=[],i=OB(e,t,this.data);for(let r=0,o=i.length;r<o;r++)Array.prototype.push.apply(n,i[r].toShapes());return n}});function OB(e,t,n){const i=Array.from?Array.from(e):String(e).split(""),r=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,s=[];let a=0,c=0;for(let l=0;l<i.length;l++){const u=i[l];if(u===`
`)a=0,c-=o;else{const h=kB(u,r,a,c,n);a+=h.offsetX,s.push(h.path)}}return s}function kB(e,t,n,i,r){const o=r.glyphs[e]||r.glyphs["?"];if(!o){console.error('THREE.Font: character "'+e+'" does not exists in font family '+r.familyName+".");return}const s=new JP;let a,c,l,u,h,f,p,m;if(o.o){const y=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let v=0,d=y.length;v<d;)switch(y[v++]){case"m":a=y[v++]*t+n,c=y[v++]*t+i,s.moveTo(a,c);break;case"l":a=y[v++]*t+n,c=y[v++]*t+i,s.lineTo(a,c);break;case"q":l=y[v++]*t+n,u=y[v++]*t+i,h=y[v++]*t+n,f=y[v++]*t+i,s.quadraticCurveTo(h,f,l,u);break;case"b":l=y[v++]*t+n,u=y[v++]*t+i,h=y[v++]*t+n,f=y[v++]*t+i,p=y[v++]*t+n,m=y[v++]*t+i,s.bezierCurveTo(h,f,p,m,l,u);break}}return{offsetX:o.ha*t,path:s}}function h3(e){an.call(this,e)}h3.prototype=Object.assign(Object.create(an.prototype),{constructor:h3,load:function(e,t,n,i){const r=this,o=new zo(this.manager);o.setPath(this.path),o.load(e,function(s){let a;try{a=JSON.parse(s)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),a=JSON.parse(s.substring(65,s.length-2))}const c=r.parse(a);t&&t(c)},n,i)},parse:function(e){return new eT(e)}});let bd;const tT={getContext:function(){return bd===void 0&&(bd=new(window.AudioContext||window.webkitAudioContext)),bd},setContext:function(e){bd=e}};function Fx(e){an.call(this,e)}Fx.prototype=Object.assign(Object.create(an.prototype),{constructor:Fx,load:function(e,t,n,i){const r=this,o=new zo(r.manager);o.setResponseType("arraybuffer"),o.setPath(r.path),o.load(e,function(s){try{const a=s.slice(0);tT.getContext().decodeAudioData(a,function(l){t(l)})}catch(a){i?i(a):console.error(a),r.manager.itemError(e)}},n,i)}});function f3(e,t,n){so.call(this,void 0,n);const i=new Fe().set(e),r=new Fe().set(t),o=new T(i.r,i.g,i.b),s=new T(r.r,r.g,r.b),a=Math.sqrt(Math.PI),c=a*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(s).multiplyScalar(a),this.sh.coefficients[1].copy(o).sub(s).multiplyScalar(c)}f3.prototype=Object.assign(Object.create(so.prototype),{constructor:f3,isHemisphereLightProbe:!0,copy:function(e){return so.prototype.copy.call(this,e),this},toJSON:function(e){return so.prototype.toJSON.call(this,e)}});function p3(e,t){so.call(this,void 0,t);const n=new Fe().set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}p3.prototype=Object.assign(Object.create(so.prototype),{constructor:p3,isAmbientLightProbe:!0,copy:function(e){return so.prototype.copy.call(this,e),this},toJSON:function(e){return so.prototype.toJSON.call(this,e)}});const d3=new De,m3=new De;function nT(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new jn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new jn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(nT.prototype,{update:function(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const i=e.projectionMatrix.clone(),r=t.eyeSep/2,o=r*t.near/t.focus,s=t.near*Math.tan(It.DEG2RAD*t.fov*.5)/t.zoom;let a,c;m3.elements[12]=-r,d3.elements[12]=r,a=-s*t.aspect+o,c=s*t.aspect+o,i.elements[0]=2*t.near/(c-a),i.elements[8]=(c+a)/(c-a),this.cameraL.projectionMatrix.copy(i),a=-s*t.aspect-o,c=s*t.aspect-o,i.elements[0]=2*t.near/(c-a),i.elements[8]=(c+a)/(c-a),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(m3),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(d3)}});function iT(e){this.autoStart=e!==void 0?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(iT.prototype,{start:function(){this.startTime=(typeof performance>"u"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=(typeof performance>"u"?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});const Va=new T,g3=new un,DB=new T,Ha=new T;function y3(){je.call(this),this.type="AudioListener",this.context=tT.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new iT}y3.prototype=Object.assign(Object.create(je.prototype),{constructor:y3,getInput:function(){return this.gain},removeFilter:function(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){je.prototype.updateMatrixWorld.call(this,e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Va,g3,DB),Ha.set(0,0,-1).applyQuaternion(g3),t.positionX){const i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Va.x,i),t.positionY.linearRampToValueAtTime(Va.y,i),t.positionZ.linearRampToValueAtTime(Va.z,i),t.forwardX.linearRampToValueAtTime(Ha.x,i),t.forwardY.linearRampToValueAtTime(Ha.y,i),t.forwardZ.linearRampToValueAtTime(Ha.z,i),t.upX.linearRampToValueAtTime(n.x,i),t.upY.linearRampToValueAtTime(n.y,i),t.upZ.linearRampToValueAtTime(n.z,i)}else t.setPosition(Va.x,Va.y,Va.z),t.setOrientation(Ha.x,Ha.y,Ha.z,n.x,n.y,n.z)}});function Yf(e){je.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._progress=0,this.filters=[]}Yf.prototype=Object.assign(Object.create(je.prototype),{constructor:Yf,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(e===void 0&&(e=0),this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()},pause:function(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this},stop:function(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),this.isPlaying===!0?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});const ja=new T,v3=new un,BB=new T,Wa=new T;function x3(e){Yf.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}x3.prototype=Object.assign(Object.create(Yf.prototype),{constructor:x3,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(e){if(je.prototype.updateMatrixWorld.call(this,e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(ja,v3,BB),Wa.set(0,0,1).applyQuaternion(v3);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(ja.x,n),t.positionY.linearRampToValueAtTime(ja.y,n),t.positionZ.linearRampToValueAtTime(ja.z,n),t.orientationX.linearRampToValueAtTime(Wa.x,n),t.orientationY.linearRampToValueAtTime(Wa.y,n),t.orientationZ.linearRampToValueAtTime(Wa.z,n)}else t.setPosition(ja.x,ja.y,ja.z),t.setOrientation(Wa.x,Wa.y,Wa.z)}});function rT(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t!==void 0?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}Object.assign(rT.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}});function oT(e,t,n){this.binding=e,this.valueSize=n;let i,r,o;switch(t){case"quaternion":i=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:i=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(oT.prototype,{accumulate:function(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let o=this.cumulativeWeight;if(o===0){for(let s=0;s!==i;++s)n[r+s]=n[s];o=t}else{o+=t;const s=t/o;this._mixBufferRegion(n,r,0,s,i)}this.cumulativeWeight=o},accumulateAdditive:function(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e},apply:function(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const a=t*this._origIndex;this._mixBufferRegion(n,i,a,1-r,t)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let a=t,c=t+t;a!==c;++a)if(n[a]!==n[a+t]){s.setValue(n,i);break}},saveOriginalState:function(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let r=n,o=i;r!==o;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)},_setAdditiveIdentityNumeric:function(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*4+3]=1},_setAdditiveIdentityOther:function(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]},_select:function(e,t,n,i,r){if(i>=.5)for(let o=0;o!==r;++o)e[t+o]=e[n+o]},_slerp:function(e,t,n,i){un.slerpFlat(e,t,e,t,e,n,i)},_slerpAdditive:function(e,t,n,i,r){const o=this._workIndex*r;un.multiplyQuaternionsFlat(e,o,e,t,e,n),un.slerpFlat(e,t,e,t,e,o,i)},_lerp:function(e,t,n,i,r){const o=1-i;for(let s=0;s!==r;++s){const a=t+s;e[a]=e[a]*o+e[n+s]*i}},_lerpAdditive:function(e,t,n,i,r){for(let o=0;o!==r;++o){const s=t+o;e[s]=e[s]+e[n+o]*i}}});const __="\\[\\]\\.:\\/",FB=new RegExp("["+__+"]","g"),w_="[^"+__+"]",NB="[^"+__.replace("\\.","")+"]",zB=/((?:WC+[\/:])*)/.source.replace("WC",w_),UB=/(WCOD+)?/.source.replace("WCOD",NB),GB=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",w_),$B=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",w_),VB=new RegExp("^"+zB+UB+GB+$B+"$"),HB=["material","materials","bones"];function sT(e,t,n){const i=n||Ui.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}Object.assign(sT.prototype,{getValue:function(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(e,t)},setValue:function(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)},bind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}});function Ui(e,t,n){this.path=t,this.parsedPath=n||Ui.parseTrackName(t),this.node=Ui.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}Object.assign(Ui,{Composite:sT,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new Ui.Composite(e,t,n):new Ui(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(FB,"")},parseTrackName:function(e){const t=VB.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const r=n.nodeName.substring(i+1);HB.indexOf(r)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,t){if(!t||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(r){for(let o=0;o<r.length;o++){const s=r[o];if(s.name===t||s.uuid===t)return s;const a=n(s.children);if(a)return a}return null},i=n(e.children);if(i)return i}return null}});Object.assign(Ui.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,n){t[n]=this.node[this.propertyName]},function(t,n){const i=this.resolvedProperty;for(let r=0,o=i.length;r!==o;++r)t[n++]=i[r]},function(t,n){t[n]=this.resolvedProperty[this.propertyIndex]},function(t,n){this.resolvedProperty.toArray(t,n)}],SetterByBindingTypeAndVersioning:[[function(t,n){this.targetObject[this.propertyName]=t[n]},function(t,n){this.targetObject[this.propertyName]=t[n],this.targetObject.needsUpdate=!0},function(t,n){this.targetObject[this.propertyName]=t[n],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,n){const i=this.resolvedProperty;for(let r=0,o=i.length;r!==o;++r)i[r]=t[n++]},function(t,n){const i=this.resolvedProperty;for(let r=0,o=i.length;r!==o;++r)i[r]=t[n++];this.targetObject.needsUpdate=!0},function(t,n){const i=this.resolvedProperty;for(let r=0,o=i.length;r!==o;++r)i[r]=t[n++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,n){this.resolvedProperty[this.propertyIndex]=t[n]},function(t,n){this.resolvedProperty[this.propertyIndex]=t[n],this.targetObject.needsUpdate=!0},function(t,n){this.resolvedProperty[this.propertyIndex]=t[n],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,n){this.resolvedProperty.fromArray(t,n)},function(t,n){this.resolvedProperty.fromArray(t,n),this.targetObject.needsUpdate=!0},function(t,n){this.resolvedProperty.fromArray(t,n),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,n){this.bind(),this.getValue(t,n)},setValue:function(t,n){this.bind(),this.setValue(t,n)},bind:function(){let e=this.node,t=this.parsedPath,n=t.objectName,i=t.propertyName,r=t.propertyIndex;if(e||(e=Ui.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){let c=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let l=0;l<e.length;l++)if(e[l].name===c){c=l;break}break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[i];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",e);return}let s=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?s=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(r!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}});Object.assign(Ui.prototype,{_getValue_unbound:Ui.prototype.getValue,_setValue_unbound:Ui.prototype.setValue});function jB(){this.uuid=It.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}Object.assign(jB.prototype,{isAnimationObjectGroup:!0,add:function(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,o=r.length;let s,a=e.length,c=this.nCachedObjects_;for(let l=0,u=arguments.length;l!==u;++l){const h=arguments[l],f=h.uuid;let p=t[f];if(p===void 0){p=a++,t[f]=p,e.push(h);for(let m=0,y=o;m!==y;++m)r[m].push(new Ui(h,n[m],i[m]))}else if(p<c){s=e[p];const m=--c,y=e[m];t[y.uuid]=p,e[p]=y,t[f]=m,e[m]=h;for(let v=0,d=o;v!==d;++v){const g=r[v],b=g[m];let x=g[p];g[p]=b,x===void 0&&(x=new Ui(h,n[v],i[v])),g[m]=x}}else e[p]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c},remove:function(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let o=0,s=arguments.length;o!==s;++o){const a=arguments[o],c=a.uuid,l=t[c];if(l!==void 0&&l>=r){const u=r++,h=e[u];t[h.uuid]=l,e[l]=h,t[c]=u,e[u]=a;for(let f=0,p=i;f!==p;++f){const m=n[f],y=m[u],v=m[l];m[l]=y,m[u]=v}}}this.nCachedObjects_=r},uncache:function(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,o=e.length;for(let s=0,a=arguments.length;s!==a;++s){const c=arguments[s],l=c.uuid,u=t[l];if(u!==void 0)if(delete t[l],u<r){const h=--r,f=e[h],p=--o,m=e[p];t[f.uuid]=u,e[u]=f,t[m.uuid]=h,e[h]=m,e.pop();for(let y=0,v=i;y!==v;++y){const d=n[y],g=d[h],b=d[p];d[u]=g,d[h]=b,d.pop()}}else{const h=--o,f=e[h];t[f.uuid]=u,e[u]=f,e.pop();for(let p=0,m=i;p!==m;++p){const y=n[p];y[u]=y[h],y.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){let n=this._bindingsIndicesByPath,i=n[e],r=this._bindings;if(i!==void 0)return r[i];const o=this._paths,s=this._parsedPaths,a=this._objects,c=a.length,l=this.nCachedObjects_,u=new Array(c);i=r.length,n[e]=i,o.push(e),s.push(t),r.push(u);for(let h=l,f=a.length;h!==f;++h){const p=a[h];u[h]=new Ui(p,e,t)}return u},unsubscribe_:function(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const i=this._paths,r=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s],c=e[s];t[c]=n,o[n]=a,o.pop(),r[n]=r[s],r.pop(),i[n]=i[s],i.pop()}}});function aT(e,t,n,i){this._mixer=e,this._clip=t,this._localRoot=n||null,this.blendMode=i||t.blendMode;const r=t.tracks,o=r.length,s=new Array(o),a={endingStart:iu,endingEnd:iu};for(let c=0;c!==o;++c){const l=r[c].createInterpolant(null);s[c]=l,l.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=FR,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}Object.assign(aT.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const i=this._clip.duration,r=e._clip.duration,o=r/i,s=i/r;e.warp(1,o,t),this.warp(s,1,t)}return this},crossFadeTo:function(e,t,n){return e.crossFadeFrom(this,t,n)},stopFading:function(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,n){const i=this._mixer,r=i.time,o=this.timeScale;let s=this._timeScaleInterpolant;s===null&&(s=i._lendControlInterpolant(),this._timeScaleInterpolant=s);const a=s.parameterPositions,c=s.sampleValues;return a[0]=r,a[1]=r+n,c[0]=e/o,c[1]=t/o,this},stopWarping:function(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,n,i){if(!this.enabled){this._updateWeight(e);return}const r=this._startTime;if(r!==null){const a=(e-r)*n;if(a<0||n===0)return;this._startTime=null,t=n*a}t*=this._updateTimeScale(e);const o=this._updateTime(t),s=this._updateWeight(e);if(s>0){const a=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case PP:for(let l=0,u=a.length;l!==u;++l)a[l].evaluate(o),c[l].accumulateAdditive(s);break;case m_:default:for(let l=0,u=a.length;l!==u;++l)a[l].evaluate(o),c[l].accumulate(i,s)}}},_updateWeight:function(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t},_updateTime:function(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const o=n===NR;if(e===0)return r===-1?i:o&&(r&1)===1?t-i:i;if(n===BR){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),i>=t||i<0){const s=Math.floor(i/t);i-=t*s,r+=Math.abs(s);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(a===1){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}else this.time=i;if(o&&(r&1)===1)return t-i}return i},_setEndings:function(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=El,i.endingEnd=El):(e?i.endingStart=this.zeroSlopeAtStart?El:iu:i.endingStart=ig,t?i.endingEnd=this.zeroSlopeAtEnd?El:iu:i.endingEnd=ig)},_scheduleFading:function(e,t,n){const i=this._mixer,r=i.time;let o=this._weightInterpolant;o===null&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const s=o.parameterPositions,a=o.sampleValues;return s[0]=r,a[0]=t,s[1]=r+e,a[1]=n,this}});function b3(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}b3.prototype=Object.assign(Object.create(Es.prototype),{constructor:b3,_bindAction:function(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,o=e._propertyBindings,s=e._interpolants,a=n.uuid,c=this._bindingsByRootAndName;let l=c[a];l===void 0&&(l={},c[a]=l);for(let u=0;u!==r;++u){const h=i[u],f=h.name;let p=l[f];if(p!==void 0)o[u]=p;else{if(p=o[u],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,a,f));continue}const m=t&&t._propertyBindings[u].binding.parsedPath;p=new oT(Ui.create(n,f,m),h.ValueTypeName,h.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,a,f),o[u]=p}s[u].resultBuffer=p.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,n)}const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const r=t[n];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const r=t[n];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){const i=this._actions,r=this._actionsByClip;let o=r[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const s=o.knownActions;e._byClipCacheIndex=s.length,s.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[n]=e},_removeInactiveAction:function(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,s=o[r],a=s.knownActions,c=a[a.length-1],l=e._byClipCacheIndex;c._byClipCacheIndex=l,a[l]=c,a.pop(),e._byClipCacheIndex=null;const u=s.actionByRoot,h=(e._localRoot||this._root).uuid;delete u[h],a.length===0&&delete o[r],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const r=t[n];--r.referenceCount===0&&this._removeInactiveBinding(r)}},_lendAction:function(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_takeBackAction:function(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_addInactiveBinding:function(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let o=i[t];o===void 0&&(o={},i[t]=o),o[n]=e,e._cacheIndex=r.length,r.push(e)},_removeInactiveBinding:function(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,s=o[i],a=t[t.length-1],c=e._cacheIndex;a._cacheIndex=c,t[c]=a,t.pop(),delete s[r],Object.keys(s).length===0&&delete o[i]},_lendBinding:function(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_takeBackBinding:function(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_lendControlInterpolant:function(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new Cg(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t,n){const i=t||this._root,r=i.uuid;let o=typeof e=="string"?no.findByName(i,e):e;const s=o!==null?o.uuid:e;let a=this._actionsByClip[s],c=null;if(n===void 0&&(o!==null?n=o.blendMode:n=m_),a!==void 0){const u=a.actionByRoot[r];if(u!==void 0&&u.blendMode===n)return u;c=a.knownActions[0],o===null&&(o=c._clip)}if(o===null)return null;const l=new aT(this,o,t,n);return this._bindAction(l,c),this._addInactiveAction(l,s,r),l},existingAction:function(e,t){const n=t||this._root,i=n.uuid,r=typeof e=="string"?no.findByName(n,e):e,o=r?r.uuid:e,s=this._actionsByClip[o];return s!==void 0&&s.actionByRoot[i]||null},stopAllAction:function(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this},update:function(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let c=0;c!==n;++c)t[c]._update(i,e,r,o);const s=this._bindings,a=this._nActiveBindings;for(let c=0;c!==a;++c)s[c].apply(o);return this},setTime:function(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(r!==void 0){const o=r.knownActions;for(let s=0,a=o.length;s!==a;++s){const c=o[s];this._deactivateAction(c);const l=c._cacheIndex,u=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,u._cacheIndex=l,t[l]=u,t.pop(),this._removeInactiveBindingsForAction(c)}delete i[n]}},uncacheRoot:function(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const s=n[o].actionByRoot,a=s[t];a!==void 0&&(this._deactivateAction(a),this._removeInactiveAction(a))}const i=this._bindingsByRootAndName,r=i[t];if(r!==void 0)for(const o in r){const s=r[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}});function Zf(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}Zf.prototype.clone=function(){return new Zf(this.value.clone===void 0?this.value:this.value.clone())};function _3(e,t,n){Rr.call(this,e,t),this.meshPerAttribute=n||1}_3.prototype=Object.assign(Object.create(Rr.prototype),{constructor:_3,isInstancedInterleavedBuffer:!0,copy:function(e){return Rr.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},clone:function(e){const t=Rr.prototype.clone.call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(e){const t=Rr.prototype.toJSON.call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}});function cT(e,t,n,i){this.ray=new Ru(e,t),this.near=n||0,this.far=i||1/0,this.camera=null,this.layers=new v_,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function w3(e,t){return e.distance-t.distance}function Nx(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),i===!0){const r=e.children;for(let o=0,s=r.length;o<s;o++)Nx(r[o],t,n,!0)}}Object.assign(cT.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,n){const i=n||[];return Nx(e,this,i,t),i.sort(w3),i},intersectObjects:function(e,t,n){const i=n||[];if(Array.isArray(e)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(let r=0,o=e.length;r<o;r++)Nx(e[r],this,i,t);return i.sort(w3),i}});function WB(e,t,n){return this.radius=e!==void 0?e:1,this.phi=t!==void 0?t:0,this.theta=n!==void 0?n:0,this}Object.assign(WB.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(It.clamp(t/this.radius,-1,1))),this}});function qB(e,t,n){return this.radius=e!==void 0?e:1,this.theta=t!==void 0?t:0,this.y=n!==void 0?n:0,this}Object.assign(qB.prototype,{set:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}});const S3=new Ee;function lT(e,t){this.min=e!==void 0?e:new Ee(1/0,1/0),this.max=t!==void 0?t:new Ee(-1/0,-1/0)}Object.assign(lT.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){const n=S3.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return e===void 0&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Ee),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return e===void 0&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Ee),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return t===void 0&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Ee),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return t===void 0&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Ee),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return S3.copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});const M3=new T,_d=new T;function uT(e,t){this.start=e!==void 0?e:new T,this.end=t!==void 0?t:new T}Object.assign(uT.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return e===void 0&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new T),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return e===void 0&&(console.warn("THREE.Line3: .delta() target is now required"),e=new T),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return t===void 0&&(console.warn("THREE.Line3: .at() target is now required"),t=new T),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){M3.subVectors(e,this.start),_d.subVectors(this.end,this.start);const n=_d.dot(_d);let r=_d.dot(M3)/n;return t&&(r=It.clamp(r,0,1)),r},closestPointToPoint:function(e,t,n){const i=this.closestPointToPointParameter(e,t);return n===void 0&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new T),this.delta(n).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}});function Lg(e){je.call(this),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}Lg.prototype=Object.create(je.prototype);Lg.prototype.constructor=Lg;Lg.prototype.isImmediateRenderObject=!0;const A3=new T;function Kf(e,t){je.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new We,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,s=1,a=32;o<a;o++,s++){const c=o/a*Math.PI*2,l=s/a*Math.PI*2;i.push(Math.cos(c),Math.sin(c),1,Math.cos(l),Math.sin(l),1)}n.setAttribute("position",new Xe(i,3));const r=new $n({fog:!1,toneMapped:!1});this.cone=new On(n,r),this.add(this.cone),this.update()}Kf.prototype=Object.create(je.prototype);Kf.prototype.constructor=Kf;Kf.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()};Kf.prototype.update=function(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),A3.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(A3),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};const js=new T,wd=new De,N1=new De;function hT(e){const t=[];e&&e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,hT(e.children[n]));return t}function Su(e){const t=hT(e),n=new We,i=[],r=[],o=new Fe(0,0,1),s=new Fe(0,1,0);for(let c=0;c<t.length;c++){const l=t[c];l.parent&&l.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(o.r,o.g,o.b),r.push(s.r,s.g,s.b))}n.setAttribute("position",new Xe(i,3)),n.setAttribute("color",new Xe(r,3));const a=new $n({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});On.call(this,n,a),this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}Su.prototype=Object.create(On.prototype);Su.prototype.constructor=Su;Su.prototype.isSkeletonHelper=!0;Su.prototype.updateMatrixWorld=function(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");N1.getInverse(this.root.matrixWorld);for(let r=0,o=0;r<t.length;r++){const s=t[r];s.parent&&s.parent.isBone&&(wd.multiplyMatrices(N1,s.matrixWorld),js.setFromMatrixPosition(wd),i.setXYZ(o,js.x,js.y,js.z),wd.multiplyMatrices(N1,s.parent.matrixWorld),js.setFromMatrixPosition(wd),i.setXYZ(o+1,js.x,js.y,js.z),o+=2)}n.getAttribute("position").needsUpdate=!0,je.prototype.updateMatrixWorld.call(this,e)};function Qf(e,t,n){this.light=e,this.light.updateMatrixWorld(),this.color=n;const i=new hu(t,4,2),r=new lo({wireframe:!0,fog:!1,toneMapped:!1});pn.call(this,i,r),this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}Qf.prototype=Object.create(pn.prototype);Qf.prototype.constructor=Qf;Qf.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()};Qf.prototype.update=function(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)};const XB=new T,C3=new Fe,P3=new Fe;function Jf(e,t,n){je.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const i=new Sc(t);i.rotateY(Math.PI*.5),this.material=new lo({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),o=new Float32Array(r.count*3);i.setAttribute("color",new rt(o,3)),this.add(new pn(i,this.material)),this.update()}Jf.prototype=Object.create(je.prototype);Jf.prototype.constructor=Jf;Jf.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()};Jf.prototype.update=function(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");C3.copy(this.light.color),P3.copy(this.light.groundColor);for(let n=0,i=t.count;n<i;n++){const r=n<i/2?C3:P3;t.setXYZ(n,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(XB.setFromMatrixPosition(this.light.matrixWorld).negate())};function zx(e,t,n,i){e=e||10,t=t||10,n=new Fe(n!==void 0?n:4473924),i=new Fe(i!==void 0?i:8947848);const r=t/2,o=e/t,s=e/2,a=[],c=[];for(let h=0,f=0,p=-s;h<=t;h++,p+=o){a.push(-s,0,p,s,0,p),a.push(p,0,-s,p,0,s);const m=h===r?n:i;m.toArray(c,f),f+=3,m.toArray(c,f),f+=3,m.toArray(c,f),f+=3,m.toArray(c,f),f+=3}const l=new We;l.setAttribute("position",new Xe(a,3)),l.setAttribute("color",new Xe(c,3));const u=new $n({vertexColors:!0,toneMapped:!1});On.call(this,l,u),this.type="GridHelper"}zx.prototype=Object.assign(Object.create(On.prototype),{constructor:zx,copy:function(e){return On.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return new this.constructor().copy(this)}});function Ux(e,t,n,i,r,o){e=e||10,t=t||16,n=n||8,i=i||64,r=new Fe(r!==void 0?r:4473924),o=new Fe(o!==void 0?o:8947848);const s=[],a=[];for(let u=0;u<=t;u++){const h=u/t*(Math.PI*2),f=Math.sin(h)*e,p=Math.cos(h)*e;s.push(0,0,0),s.push(f,0,p);const m=u&1?r:o;a.push(m.r,m.g,m.b),a.push(m.r,m.g,m.b)}for(let u=0;u<=n;u++){const h=u&1?r:o,f=e-e/n*u;for(let p=0;p<i;p++){let m=p/i*(Math.PI*2),y=Math.sin(m)*f,v=Math.cos(m)*f;s.push(y,0,v),a.push(h.r,h.g,h.b),m=(p+1)/i*(Math.PI*2),y=Math.sin(m)*f,v=Math.cos(m)*f,s.push(y,0,v),a.push(h.r,h.g,h.b)}}const c=new We;c.setAttribute("position",new Xe(s,3)),c.setAttribute("color",new Xe(a,3));const l=new $n({vertexColors:!0,toneMapped:!1});On.call(this,c,l),this.type="PolarGridHelper"}Ux.prototype=Object.create(On.prototype);Ux.prototype.constructor=Ux;const T3=new T,Sd=new T,E3=new T;function ep(e,t,n){je.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,t===void 0&&(t=1);let i=new We;i.setAttribute("position",new Xe([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new $n({fog:!1,toneMapped:!1});this.lightPlane=new Nr(i,r),this.add(this.lightPlane),i=new We,i.setAttribute("position",new Xe([0,0,0,0,0,1],3)),this.targetLine=new Nr(i,r),this.add(this.targetLine),this.update()}ep.prototype=Object.create(je.prototype);ep.prototype.constructor=ep;ep.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()};ep.prototype.update=function(){T3.setFromMatrixPosition(this.light.matrixWorld),Sd.setFromMatrixPosition(this.light.target.matrixWorld),E3.subVectors(Sd,T3),this.lightPlane.lookAt(Sd),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Sd),this.targetLine.scale.z=E3.length()};const Md=new T,kn=new vs;function Rg(e){const t=new We,n=new $n({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],o={},s=new Fe(16755200),a=new Fe(16711680),c=new Fe(43775),l=new Fe(16777215),u=new Fe(3355443);h("n1","n2",s),h("n2","n4",s),h("n4","n3",s),h("n3","n1",s),h("f1","f2",s),h("f2","f4",s),h("f4","f3",s),h("f3","f1",s),h("n1","f1",s),h("n2","f2",s),h("n3","f3",s),h("n4","f4",s),h("p","n1",a),h("p","n2",a),h("p","n3",a),h("p","n4",a),h("u1","u2",c),h("u2","u3",c),h("u3","u1",c),h("c","t",l),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u);function h(p,m,y){f(p,y),f(m,y)}function f(p,m){i.push(0,0,0),r.push(m.r,m.g,m.b),o[p]===void 0&&(o[p]=[]),o[p].push(i.length/3-1)}t.setAttribute("position",new Xe(i,3)),t.setAttribute("color",new Xe(r,3)),On.call(this,t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}Rg.prototype=Object.create(On.prototype);Rg.prototype.constructor=Rg;Rg.prototype.update=function(){const e=this.geometry,t=this.pointMap,n=1,i=1;kn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Fn("c",t,e,kn,0,0,-1),Fn("t",t,e,kn,0,0,1),Fn("n1",t,e,kn,-n,-i,-1),Fn("n2",t,e,kn,n,-i,-1),Fn("n3",t,e,kn,-n,i,-1),Fn("n4",t,e,kn,n,i,-1),Fn("f1",t,e,kn,-n,-i,1),Fn("f2",t,e,kn,n,-i,1),Fn("f3",t,e,kn,-n,i,1),Fn("f4",t,e,kn,n,i,1),Fn("u1",t,e,kn,n*.7,i*1.1,-1),Fn("u2",t,e,kn,-n*.7,i*1.1,-1),Fn("u3",t,e,kn,0,i*2,-1),Fn("cf1",t,e,kn,-n,0,1),Fn("cf2",t,e,kn,n,0,1),Fn("cf3",t,e,kn,0,-i,1),Fn("cf4",t,e,kn,0,i,1),Fn("cn1",t,e,kn,-n,0,-1),Fn("cn2",t,e,kn,n,0,-1),Fn("cn3",t,e,kn,0,-i,-1),Fn("cn4",t,e,kn,0,i,-1),e.getAttribute("position").needsUpdate=!0};function Fn(e,t,n,i,r,o,s){Md.set(r,o,s).unproject(i);const a=t[e];if(a!==void 0){const c=n.getAttribute("position");for(let l=0,u=a.length;l<u;l++)c.setXYZ(a[l],Md.x,Md.y,Md.z)}}const Ad=new hn;function Cc(e,t){this.object=e,t===void 0&&(t=16776960);const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(8*3),r=new We;r.setIndex(new rt(n,1)),r.setAttribute("position",new rt(i,3)),On.call(this,r,new $n({color:t,toneMapped:!1})),this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}Cc.prototype=Object.create(On.prototype);Cc.prototype.constructor=Cc;Cc.prototype.update=function(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Ad.setFromObject(this.object),Ad.isEmpty())return;const t=Ad.min,n=Ad.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()};Cc.prototype.setFromObject=function(e){return this.object=e,this.update(),this};Cc.prototype.copy=function(e){return On.prototype.copy.call(this,e),this.object=e.object,this};Cc.prototype.clone=function(){return new this.constructor().copy(this)};function Og(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new We;r.setIndex(new rt(n,1)),r.setAttribute("position",new Xe(i,3)),On.call(this,r,new $n({color:t,toneMapped:!1})),this.type="Box3Helper",this.geometry.computeBoundingSphere()}Og.prototype=Object.create(On.prototype);Og.prototype.constructor=Og;Og.prototype.updateMatrixWorld=function(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),je.prototype.updateMatrixWorld.call(this,e))};function kg(e,t,n){this.plane=e,this.size=t===void 0?1:t;const i=n!==void 0?n:16776960,r=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],o=new We;o.setAttribute("position",new Xe(r,3)),o.computeBoundingSphere(),Nr.call(this,o,new $n({color:i,toneMapped:!1})),this.type="PlaneHelper";const s=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],a=new We;a.setAttribute("position",new Xe(s,3)),a.computeBoundingSphere(),this.add(new pn(a,new lo({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}kg.prototype=Object.create(Nr.prototype);kg.prototype.constructor=kg;kg.prototype.updateMatrixWorld=function(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?Kn:Iu,this.lookAt(this.plane.normal),je.prototype.updateMatrixWorld.call(this,e)};const I3=new T;let Cd,z1;function Ta(e,t,n,i,r,o){je.call(this),this.type="ArrowHelper",e===void 0&&(e=new T(0,0,1)),t===void 0&&(t=new T(0,0,0)),n===void 0&&(n=1),i===void 0&&(i=16776960),r===void 0&&(r=.2*n),o===void 0&&(o=.2*r),Cd===void 0&&(Cd=new We,Cd.setAttribute("position",new Xe([0,0,0,0,1,0],3)),z1=new _s(0,.5,1,5,1),z1.translate(0,-.5,0)),this.position.copy(t),this.line=new Nr(Cd,new $n({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new pn(z1,new lo({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,o)}Ta.prototype=Object.create(je.prototype);Ta.prototype.constructor=Ta;Ta.prototype.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{I3.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(I3,t)}};Ta.prototype.setLength=function(e,t,n){t===void 0&&(t=.2*e),n===void 0&&(n=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()};Ta.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)};Ta.prototype.copy=function(e){return je.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this};Ta.prototype.clone=function(){return new this.constructor().copy(this)};function Gx(e){e=e||1;const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new We;i.setAttribute("position",new Xe(t,3)),i.setAttribute("color",new Xe(n,3));const r=new $n({vertexColors:!0,toneMapped:!1});On.call(this,i,r),this.type="AxesHelper"}Gx.prototype=Object.create(On.prototype);Gx.prototype.constructor=Gx;const Wl=4,va=8,To=Math.pow(2,va),fT=[.125,.215,.35,.446,.526,.582],pT=va-Wl+1+fT.length,al=20,Oo={[Ti]:0,[yp]:1,[y_]:2,[TP]:3,[EP]:4,[IP]:5,[g_]:6},U1=new Pa,{_lodPlanes:lh,_sizeLods:L3,_sigmas:Pd}=ZB();let G1=null;const Za=(1+Math.sqrt(5))/2,Qc=1/Za,R3=[new T(1,1,1),new T(-1,1,1),new T(1,1,-1),new T(-1,1,-1),new T(0,Za,Qc),new T(0,Za,-Qc),new T(Qc,0,Za),new T(-Qc,0,Za),new T(Za,Qc,0),new T(-Za,Qc,0)];function O3(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=KB(al),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}O3.prototype={constructor:O3,fromScene:function(e,t=0,n=.1,i=100){G1=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r},fromEquirectangular:function(e){return this._fromTexture(e)},fromCubemap:function(e){return this._fromTexture(e)},compileCubemapShader:function(){this._cubemapShader===null&&(this._cubemapShader=B3(),this._compileMaterial(this._cubemapShader))},compileEquirectangularShader:function(){this._equirectShader===null&&(this._equirectShader=D3(),this._compileMaterial(this._equirectShader))},dispose:function(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let e=0;e<lh.length;e++)lh[e].dispose()},_cleanup:function(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(G1),e.scissorTest=!1,Td(e,0,0,e.width,e.height)},_fromTexture:function(e){G1=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t},_allocateTargets:function(e){const t={magFilter:ln,minFilter:ln,generateMipmaps:!1,type:gc,format:JL,encoding:YB(e)?e.encoding:y_,depthBuffer:!1,stencilBuffer:!1},n=k3(t);return n.depthBuffer=!e,this._pingPongRenderTarget=k3(t),n},_compileMaterial:function(e){const t=new pn(lh[0],e);this._renderer.compile(t,U1)},_sceneToCubeUV:function(e,t,n,i){const s=new jn(90,1,t,n),a=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],l=this._renderer,u=l.outputEncoding,h=l.toneMapping,f=l.getClearColor(),p=l.getClearAlpha();l.toneMapping=Hl,l.outputEncoding=Ti;let m=e.background;if(m&&m.isColor){m.convertSRGBToLinear();const y=Math.max(m.r,m.g,m.b),v=Math.min(Math.max(Math.ceil(Math.log2(y)),-128),127);m=m.multiplyScalar(Math.pow(2,-v));const d=(v+128)/255;l.setClearColor(m,d),e.background=null}for(let y=0;y<6;y++){const v=y%3;v==0?(s.up.set(0,a[y],0),s.lookAt(c[y],0,0)):v==1?(s.up.set(0,0,a[y]),s.lookAt(0,c[y],0)):(s.up.set(0,a[y],0),s.lookAt(0,0,c[y])),Td(i,v*To,y>2?To:0,To,To),l.setRenderTarget(i),l.render(e,s)}l.toneMapping=h,l.outputEncoding=u,l.setClearColor(f,p)},_textureToCubeUV:function(e,t){const n=this._renderer;e.isCubeTexture?this._cubemapShader==null&&(this._cubemapShader=B3()):this._equirectShader==null&&(this._equirectShader=D3());const i=e.isCubeTexture?this._cubemapShader:this._equirectShader,r=new pn(lh[0],i),o=i.uniforms;o.envMap.value=e,e.isCubeTexture||o.texelSize.value.set(1/e.image.width,1/e.image.height),o.inputEncoding.value=Oo[e.encoding],o.outputEncoding.value=Oo[t.texture.encoding],Td(t,0,0,3*To,2*To),n.setRenderTarget(t),n.render(r,U1)},_applyPMREM:function(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let i=1;i<pT;i++){const r=Math.sqrt(Pd[i]*Pd[i]-Pd[i-1]*Pd[i-1]),o=R3[(i-1)%R3.length];this._blur(e,i-1,i,r,o)}t.autoClear=n},_blur:function(e,t,n,i,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,"latitudinal",r),this._halfBlur(o,e,n,n,i,"longitudinal",r)},_halfBlur:function(e,t,n,i,r,o,s){const a=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const l=3,u=new pn(lh[i],c),h=c.uniforms,f=L3[n]-1,p=isFinite(r)?Math.PI/(2*f):2*Math.PI/(2*al-1),m=r/p,y=isFinite(r)?1+Math.floor(l*m):al;y>al&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${al}`);const v=[];let d=0;for(let _=0;_<al;++_){const S=_/m,w=Math.exp(-S*S/2);v.push(w),_==0?d+=w:_<y&&(d+=2*w)}for(let _=0;_<v.length;_++)v[_]=v[_]/d;h.envMap.value=e.texture,h.samples.value=y,h.weights.value=v,h.latitudinal.value=o==="latitudinal",s&&(h.poleAxis.value=s),h.dTheta.value=p,h.mipInt.value=va-n,h.inputEncoding.value=Oo[e.texture.encoding],h.outputEncoding.value=Oo[e.texture.encoding];const g=L3[i],b=3*Math.max(0,To-2*g),x=(i===0?0:2*To)+2*g*(i>va-Wl?i-va+Wl:0);Td(t,b,x,3*g,2*g),a.setRenderTarget(t),a.render(u,U1)}};function YB(e){return e===void 0||e.type!==gc?!1:e.encoding===Ti||e.encoding===yp||e.encoding===g_}function ZB(){const e=[],t=[],n=[];let i=va;for(let r=0;r<pT;r++){const o=Math.pow(2,i);t.push(o);let s=1/o;r>va-Wl?s=fT[r-va+Wl-1]:r==0&&(s=0),n.push(s);const a=1/(o-1),c=-a/2,l=1+a/2,u=[c,c,l,c,l,l,c,c,l,l,c,l],h=6,f=6,p=3,m=2,y=1,v=new Float32Array(p*f*h),d=new Float32Array(m*f*h),g=new Float32Array(y*f*h);for(let x=0;x<h;x++){const _=x%3*2/3-1,S=x>2?0:-1,w=[_,S,0,_+2/3,S,0,_+2/3,S+1,0,_,S,0,_+2/3,S+1,0,_,S+1,0];v.set(w,p*f*x),d.set(u,m*f*x);const C=[x,x,x,x,x,x];g.set(C,y*f*x)}const b=new We;b.setAttribute("position",new rt(v,p)),b.setAttribute("uv",new rt(d,m)),b.setAttribute("faceIndex",new rt(g,y)),e.push(b),i>Wl&&i--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}function k3(e){const t=new zi(3*To,3*To,e);return t.texture.mapping=gp,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function Td(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function KB(e){const t=new Float32Array(e),n=new T(0,1,0);return new Ca({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:Oo[Ti]},outputEncoding:{value:Oo[Ti]}},vertexShader:S_(),fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform int samples;
uniform float weights[n];
uniform bool latitudinal;
uniform float dTheta;
uniform float mipInt;
uniform vec3 poleAxis;

${M_()}

#define ENVMAP_TYPE_CUBE_UV
#include <cube_uv_reflection_fragment>

vec3 getSample(float theta, vec3 axis) {
	float cosTheta = cos(theta);
	// Rodrigues' axis-angle rotation
	vec3 sampleDirection = vOutputDirection * cosTheta
		+ cross(axis, vOutputDirection) * sin(theta)
		+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);
	return bilinearCubeUV(envMap, sampleDirection, mipInt);
}

void main() {
	vec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);
	if (all(equal(axis, vec3(0.0))))
		axis = vec3(vOutputDirection.z, 0.0, - vOutputDirection.x);
	axis = normalize(axis);
	gl_FragColor = vec4(0.0);
	gl_FragColor.rgb += weights[0] * getSample(0.0, axis);
	for (int i = 1; i < n; i++) {
		if (i >= samples)
			break;
		float theta = dTheta * float(i);
		gl_FragColor.rgb += weights[i] * getSample(-1.0 * theta, axis);
		gl_FragColor.rgb += weights[i] * getSample(theta, axis);
	}
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:ps,depthTest:!1,depthWrite:!1})}function D3(){const e=new Ee(1,1);return new Ca({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:Oo[Ti]},outputEncoding:{value:Oo[Ti]}},vertexShader:S_(),fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform vec2 texelSize;

${M_()}

#include <common>

void main() {
	gl_FragColor = vec4(0.0);
	vec3 outputDirection = normalize(vOutputDirection);
	vec2 uv = equirectUv( outputDirection );
	vec2 f = fract(uv / texelSize - 0.5);
	uv -= f * texelSize;
	vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.x += texelSize.x;
	vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.y += texelSize.y;
	vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.x -= texelSize.x;
	vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	vec3 tm = mix(tl, tr, f.x);
	vec3 bm = mix(bl, br, f.x);
	gl_FragColor.rgb = mix(tm, bm, f.y);
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:ps,depthTest:!1,depthWrite:!1})}function B3(){return new Ca({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Oo[Ti]},outputEncoding:{value:Oo[Ti]}},vertexShader:S_(),fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform samplerCube envMap;

${M_()}

void main() {
	gl_FragColor = vec4(0.0);
	gl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:ps,depthTest:!1,depthWrite:!1})}function S_(){return`
precision mediump float;
precision mediump int;
attribute vec3 position;
attribute vec2 uv;
attribute float faceIndex;
varying vec3 vOutputDirection;

// RH coordinate system; PMREM face-indexing convention
vec3 getDirection(vec2 uv, float face) {
	uv = 2.0 * uv - 1.0;
	vec3 direction = vec3(uv, 1.0);
	if (face == 0.0) {
		direction = direction.zyx; // ( 1, v, u ) pos x
	} else if (face == 1.0) {
		direction = direction.xzy;
		direction.xz *= -1.0; // ( -u, 1, -v ) pos y
	} else if (face == 2.0) {
		direction.x *= -1.0; // ( -u, v, 1 ) pos z
	} else if (face == 3.0) {
		direction = direction.zyx;
		direction.xz *= -1.0; // ( -1, v, -u ) neg x
	} else if (face == 4.0) {
		direction = direction.xzy;
		direction.xy *= -1.0; // ( -u, -1, v ) neg y
	} else if (face == 5.0) {
		direction.z *= -1.0; // ( u, v, -1 ) neg z
	}
	return direction;
}

void main() {
	vOutputDirection = getDirection(uv, faceIndex);
	gl_Position = vec4( position, 1.0 );
}
	`}function M_(){return`
uniform int inputEncoding;
uniform int outputEncoding;

#include <encodings_pars_fragment>

vec4 inputTexelToLinear(vec4 value){
	if(inputEncoding == 0){
		return value;
	}else if(inputEncoding == 1){
		return sRGBToLinear(value);
	}else if(inputEncoding == 2){
		return RGBEToLinear(value);
	}else if(inputEncoding == 3){
		return RGBMToLinear(value, 7.0);
	}else if(inputEncoding == 4){
		return RGBMToLinear(value, 16.0);
	}else if(inputEncoding == 5){
		return RGBDToLinear(value, 256.0);
	}else{
		return GammaToLinear(value, 2.2);
	}
}

vec4 linearToOutputTexel(vec4 value){
	if(outputEncoding == 0){
		return value;
	}else if(outputEncoding == 1){
		return LinearTosRGB(value);
	}else if(outputEncoding == 2){
		return LinearToRGBE(value);
	}else if(outputEncoding == 3){
		return LinearToRGBM(value, 7.0);
	}else if(outputEncoding == 4){
		return LinearToRGBM(value, 16.0);
	}else if(outputEncoding == 5){
		return LinearToRGBD(value, 256.0);
	}else{
		return LinearToGamma(value, 2.2);
	}
}

vec4 envMapTexelToLinear(vec4 color) {
	return inputTexelToLinear(color);
}
	`}ct.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(ct.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e};Object.assign(sa.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=new dt;for(let n=0,i=e.length;n<i;n++){const r=e[n];t.vertices.push(new T(r.x,r.y,r.z||0))}return t}});Object.assign(Ro.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}});Object.create(mr.prototype);Object.create(mr.prototype);function dT(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),mr.call(this,e),this.type="catmullrom"}dT.prototype=Object.create(mr.prototype);Object.assign(dT.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}});zx.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};Su.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Object.assign(an.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),QP.extractUrlBase(e)}});an.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};Object.assign(Bx.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}});Object.assign(lT.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}});Object.assign(hn.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}});Object.assign(Is.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}});xp.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)};uT.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)};Object.assign(It,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),It.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),It.ceilPowerOfTwo(e)}});Object.assign(di.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}});Object.assign(De.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new T().setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,i,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,n,r,o)}});Io.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)};un.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)};Object.assign(Ru.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}});Object.assign(pi.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}});Object.assign(pi,{barycoordFromPoint:function(e,t,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),pi.getBarycoord(e,t,n,i,r)},normal:function(e,t,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),pi.getNormal(e,t,n,i)}});Object.assign(sc.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new uu(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new fu(this,e)}});Object.assign(Ee.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(T.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(on.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}});Object.assign(dt.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}});Object.assign(je.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}});Object.defineProperties(je.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.assign(pn.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}});Object.defineProperties(pn.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),zR},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});Object.defineProperties(ag.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}});Object.defineProperty(hx.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}});ux.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};Object.defineProperty(ct.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}});jn.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),t!==void 0&&(this.filmGauge=t),this.setFocalLength(e)};Object.defineProperties(_n.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}});Object.defineProperties(rt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Sf},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Sf)}}});Object.assign(rt.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(e===!0?Sf:m0),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}});Object.assign(We.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(t&&t.isBufferAttribute)&&!(t&&t.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new rt(arguments[1],arguments[2]))):e==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t)},addDrawCall:function(e,t,n){n!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}});Object.defineProperties(We.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});Object.defineProperties(Ig.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(e){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=e}}});Object.defineProperties(cT.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}});Object.defineProperties(Rr.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Sf},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}});Object.assign(Rr.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(e===!0?Sf:m0),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}});Object.assign(bs.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}});Object.defineProperties(Zf.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}});Object.defineProperties(bt.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Fe}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===wP}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}});Object.defineProperties(Ac.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(ti.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}});Object.assign(bp.prototype,{clearTarget:function(e,t,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,i)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}});Object.defineProperties(bp.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=e===!0?yp:Ti}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(VP.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(zi.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}});Object.defineProperties(Yf.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return new Fx().load(e,function(i){t.setBuffer(i)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}});rT.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};Cf.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};yc.crossOrigin=void 0;yc.loadTexture=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new Mx;r.setCrossOrigin(this.crossOrigin);const o=r.load(e,n,void 0,i);return t&&(o.mapping=t),o};yc.loadTextureCube=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new Sx;r.setCrossOrigin(this.crossOrigin);const o=r.load(e,n,void 0,i);return t&&(o.mapping=t),o};yc.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};yc.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:dL}}));var Dg={},QB={get exports(){return Dg},set exports(e){Dg=e}};(function(e,t){/**
 * @license
 *
 * chroma.js - JavaScript library for color conversions
 * 
 * Copyright (c) 2011-2017, Gregor Aisch
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 * 
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */(function(){var n,i,r,o,s,a,c,l,u,h,f,p,m,y,v,d,g,b,x,_,S,w,C,A,k,L,D,F,I,P,N,$,B,q,ee,W,Q,Z,re,he,K,ce,se,ue,H,j,X,ie,fe,me,ve,G,V,pe,le,ne,oe,xe,Ae,ge,Me,be,Oe,Te,Ce,Ge,at,it,et,mt,vt,lt,qe,Ct,tt,Ve,Pt,Be,$e,Je,Y,Se,ye=[].slice;Be=function(){var M,E,R,z,U;for(M={},U="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),z=0,E=U.length;z<E;z++)R=U[z],M["[object "+R+"]"]=R.toLowerCase();return function(J){var te;return te=Object.prototype.toString.call(J),M[te]||"object"}}(),X=function(M,E,R){return E==null&&(E=0),R==null&&(R=1),M<E&&(M=E),M>R&&(M=R),M},$e=function(M){return M.length>=3?Array.prototype.slice.call(M):M[0]},S=function(M){var E,R;for(M._clipped=!1,M._unclipped=M.slice(0),E=R=0;R<3;E=++R)E<3?((M[E]<0||M[E]>255)&&(M._clipped=!0),M[E]<0&&(M[E]=0),M[E]>255&&(M[E]=255)):E===3&&(M[E]<0&&(M[E]=0),M[E]>1&&(M[E]=1));return M._clipped||delete M._unclipped,M},o=Math.PI,qe=Math.round,C=Math.cos,F=Math.floor,ne=Math.pow,ie=Math.log,tt=Math.sin,Ve=Math.sqrt,y=Math.atan2,ve=Math.max,m=Math.abs,c=o*2,s=o/3,i=o/180,a=180/o,_=function(){return arguments[0]instanceof n?arguments[0]:function(M,E,R){R.prototype=M.prototype;var z=new R,U=M.apply(z,E);return Object(U)===U?U:z}(n,arguments,function(){})},_.default=_,p=[],e!==null&&e.exports!=null&&(e.exports=_),lt=t!==null?t:this,lt.chroma=_,_.version="1.4.1",f={},u=[],h=!1,n=function(){function M(){var E,R,z,U,J,te,ae,we,_e;for(te=this,R=[],we=0,U=arguments.length;we<U;we++)E=arguments[we],E!=null&&R.push(E);if(R.length>1&&(ae=R[R.length-1]),f[ae]!=null)te._rgb=S(f[ae]($e(R.slice(0,-1))));else{for(h||(u=u.sort(function(Ie,Ue){return Ue.p-Ie.p}),h=!0),_e=0,J=u.length;_e<J&&(z=u[_e],ae=z.test.apply(z,R),!ae);_e++);ae&&(te._rgb=S(f[ae].apply(f,R)))}te._rgb==null&&console.warn("unknown format: "+R),te._rgb==null&&(te._rgb=[0,0,0]),te._rgb.length===3&&te._rgb.push(1)}return M.prototype.toString=function(){return this.hex()},M}(),_._input=f;/**
	ColorBrewer colors for chroma.js

	Copyright (c) 2002 Cynthia Brewer, Mark Harrower, and The 
	Pennsylvania State University.

	Licensed under the Apache License, Version 2.0 (the "License"); 
	you may not use this file except in compliance with the License.
	You may obtain a copy of the License at	
	http://www.apache.org/licenses/LICENSE-2.0

	Unless required by applicable law or agreed to in writing, software distributed
	under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
	CONDITIONS OF ANY KIND, either express or implied. See the License for the
	specific language governing permissions and limitations under the License.

    @preserve
 */_.brewer=b={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var M,E;E=[];for(M in b)E.push(b[M.toLowerCase()]=b[M]);return E}(),Je={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},_.colors=Je,ce=function(){var M,E,R,z,U,J,te,ae,we;return E=$e(arguments),U=E[0],M=E[1],R=E[2],ae=(U+16)/116,te=isNaN(M)?ae:ae+M/500,we=isNaN(R)?ae:ae-R/200,ae=r.Yn*se(ae),te=r.Xn*se(te),we=r.Zn*se(we),J=Se(3.2404542*te-1.5371385*ae-.4985314*we),z=Se(-.969266*te+1.8760108*ae+.041556*we),R=Se(.0556434*te-.2040259*ae+1.0572252*we),[J,z,R,E.length>3?E[3]:1]},Se=function(M){return 255*(M<=.00304?12.92*M:1.055*ne(M,1/2.4)-.055)},se=function(M){return M>r.t1?M*M*M:r.t2*(M-r.t0)},r={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},Te=function(){var M,E,R,z,U,J,te,ae;return z=$e(arguments),R=z[0],E=z[1],M=z[2],U=et(R,E,M),J=U[0],te=U[1],ae=U[2],[116*te-16,500*(J-te),200*(te-ae)]},mt=function(M){return(M/=255)<=.04045?M/12.92:ne((M+.055)/1.055,2.4)},Y=function(M){return M>r.t3?ne(M,1/3):M/r.t2+r.t0},et=function(){var M,E,R,z,U,J,te;return z=$e(arguments),R=z[0],E=z[1],M=z[2],R=mt(R),E=mt(E),M=mt(M),U=Y((.4124564*R+.3575761*E+.1804375*M)/r.Xn),J=Y((.2126729*R+.7151522*E+.072175*M)/r.Yn),te=Y((.0193339*R+.119192*E+.9503041*M)/r.Zn),[U,J,te]},_.lab=function(){return function(M,E,R){R.prototype=M.prototype;var z=new R,U=M.apply(z,E);return Object(U)===U?U:z}(n,ye.call(arguments).concat(["lab"]),function(){})},f.lab=ce,n.prototype.lab=function(){return Te(this._rgb)},v=function(M){var E,R,z,U,J,te,ae,we,_e,Ie,Ue;return M=function(){var Re,ke,ze;for(ze=[],ke=0,Re=M.length;ke<Re;ke++)U=M[ke],ze.push(_(U));return ze}(),M.length===2?(_e=function(){var Re,ke,ze;for(ze=[],ke=0,Re=M.length;ke<Re;ke++)U=M[ke],ze.push(U.lab());return ze}(),J=_e[0],te=_e[1],E=function(Re){var ke,ze;return ze=function(){var Ze,nt;for(nt=[],ke=Ze=0;Ze<=2;ke=++Ze)nt.push(J[ke]+Re*(te[ke]-J[ke]));return nt}(),_.lab.apply(_,ze)}):M.length===3?(Ie=function(){var Re,ke,ze;for(ze=[],ke=0,Re=M.length;ke<Re;ke++)U=M[ke],ze.push(U.lab());return ze}(),J=Ie[0],te=Ie[1],ae=Ie[2],E=function(Re){var ke,ze;return ze=function(){var Ze,nt;for(nt=[],ke=Ze=0;Ze<=2;ke=++Ze)nt.push((1-Re)*(1-Re)*J[ke]+2*(1-Re)*Re*te[ke]+Re*Re*ae[ke]);return nt}(),_.lab.apply(_,ze)}):M.length===4?(Ue=function(){var Re,ke,ze;for(ze=[],ke=0,Re=M.length;ke<Re;ke++)U=M[ke],ze.push(U.lab());return ze}(),J=Ue[0],te=Ue[1],ae=Ue[2],we=Ue[3],E=function(Re){var ke,ze;return ze=function(){var Ze,nt;for(nt=[],ke=Ze=0;Ze<=2;ke=++Ze)nt.push((1-Re)*(1-Re)*(1-Re)*J[ke]+3*(1-Re)*(1-Re)*Re*te[ke]+3*(1-Re)*Re*Re*ae[ke]+Re*Re*Re*we[ke]);return nt}(),_.lab.apply(_,ze)}):M.length===5&&(R=v(M.slice(0,3)),z=v(M.slice(2,5)),E=function(Re){return Re<.5?R(Re*2):z((Re-.5)*2)}),E},_.bezier=function(M){var E;return E=v(M),E.scale=function(){return _.scale(E)},E},_.cubehelix=function(M,E,R,z,U){var J,te,ae;return M==null&&(M=300),E==null&&(E=-1.5),R==null&&(R=1),z==null&&(z=1),U==null&&(U=[0,1]),J=0,Be(U)==="array"?te=U[1]-U[0]:(te=0,U=[U,U]),ae=function(we){var _e,Ie,Ue,Re,ke,ze,Ze,nt,Qe;return _e=c*((M+120)/360+E*we),Ze=ne(U[0]+te*we,z),ze=J!==0?R[0]+we*J:R,Ie=ze*Ze*(1-Ze)/2,Re=C(_e),Qe=tt(_e),nt=Ze+Ie*(-.14861*Re+1.78277*Qe),ke=Ze+Ie*(-.29227*Re-.90649*Qe),Ue=Ze+Ie*(1.97294*Re),_(S([nt*255,ke*255,Ue*255,1]))},ae.start=function(we){return we==null?M:(M=we,ae)},ae.rotations=function(we){return we==null?E:(E=we,ae)},ae.gamma=function(we){return we==null?z:(z=we,ae)},ae.hue=function(we){return we==null?R:(R=we,Be(R)==="array"?(J=R[1]-R[0],J===0&&(R=R[1])):J=0,ae)},ae.lightness=function(we){return we==null?U:(Be(we)==="array"?(U=we,te=we[1]-we[0]):(U=[we,we],te=0),ae)},ae.scale=function(){return _.scale(ae)},ae.hue(R),ae},_.random=function(){var M,E,R;for(E="0123456789abcdef",M="#",R=0;R<6;++R)M+=E.charAt(F(Math.random()*16));return new n(M)},p=[],ee=function(M,E,R,z){var U,J,te,ae;for(R==null&&(R=.5),z==null&&(z="rgb"),Be(M)!=="object"&&(M=_(M)),Be(E)!=="object"&&(E=_(E)),te=0,J=p.length;te<J;te++)if(U=p[te],z===U[0]){ae=U[1](M,E,R,z);break}if(ae==null)throw"color mode "+z+" is not supported";return ae.alpha(M.alpha()+R*(E.alpha()-M.alpha()))},_.interpolate=ee,n.prototype.interpolate=function(M,E,R){return ee(this,M,E,R)},_.mix=ee,n.prototype.mix=n.prototype.interpolate,f.rgb=function(){var M,E,R,z;E=$e(arguments),R=[];for(M in E)z=E[M],R.push(z);return R},_.rgb=function(){return function(M,E,R){R.prototype=M.prototype;var z=new R,U=M.apply(z,E);return Object(U)===U?U:z}(n,ye.call(arguments).concat(["rgb"]),function(){})},n.prototype.rgb=function(M){return M==null&&(M=!0),M?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},n.prototype.rgba=function(M){return M==null&&(M=!0),M?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},u.push({p:3,test:function(M){var E;if(E=$e(arguments),Be(E)==="array"&&E.length===3||E.length===4&&Be(E[3])==="number"&&E[3]>=0&&E[3]<=1)return"rgb"}}),f.lrgb=f.rgb,Z=function(M,E,R,z){var U,J;return U=M._rgb,J=E._rgb,new n(Ve(ne(U[0],2)*(1-R)+ne(J[0],2)*R),Ve(ne(U[1],2)*(1-R)+ne(J[1],2)*R),Ve(ne(U[2],2)*(1-R)+ne(J[2],2)*R),z)},l=function(M){var E,R,z,U,J,te;for(R=1/M.length,te=[0,0,0,0],U=0,z=M.length;U<z;U++)E=M[U],J=E._rgb,te[0]+=ne(J[0],2)*R,te[1]+=ne(J[1],2)*R,te[2]+=ne(J[2],2)*R,te[3]+=J[3]*R;return te[0]=Ve(te[0]),te[1]=Ve(te[1]),te[2]=Ve(te[2]),te[3]>1&&(te[3]=1),new n(S(te))},p.push(["lrgb",Z]),_.average=function(M,E){var R,z,U,J,te,ae,we,_e,Ie,Ue,Re,ke,ze;if(E==null&&(E="rgb"),Ie=M.length,M=M.map(function(Ze){return _(Ze)}),we=M.splice(0,1)[0],E==="lrgb")return l(M);ke=we.get(E),J=[],te=0,ae=0;for(_e in ke)ke[_e]=ke[_e]||0,J.push(isNaN(ke[_e])?0:1),E.charAt(_e)==="h"&&!isNaN(ke[_e])&&(R=ke[_e]/180*o,te+=C(R),ae+=tt(R));for(z=we.alpha(),Re=0,Ue=M.length;Re<Ue;Re++){U=M[Re],ze=U.get(E),z+=U.alpha();for(_e in ke)isNaN(ze[_e])||(J[_e]+=1,E.charAt(_e)==="h"?(R=ze[_e]/180*o,te+=C(R),ae+=tt(R)):ke[_e]+=ze[_e])}for(_e in ke)if(E.charAt(_e)==="h"){for(R=y(ae/J[_e],te/J[_e])/o*180;R<0;)R+=360;for(;R>=360;)R-=360;ke[_e]=R}else ke[_e]=ke[_e]/J[_e];return _(ke,E).alpha(z/Ie)},P=function(M){var E,R,z,U,J,te;if(M.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(M.length===4||M.length===7)&&(M=M.substr(1)),M.length===3&&(M=M.split(""),M=M[0]+M[0]+M[1]+M[1]+M[2]+M[2]),te=parseInt(M,16),U=te>>16,z=te>>8&255,R=te&255,[U,z,R,1];if(M.match(/^#?([A-Fa-f0-9]{8})$/))return M.length===9&&(M=M.substr(1)),te=parseInt(M,16),U=te>>24&255,z=te>>16&255,R=te>>8&255,E=qe((te&255)/255*100)/100,[U,z,R,E];if(f.css!=null&&(J=f.css(M)))return J;throw"unknown color: "+M},ge=function(M,E){var R,z,U,J,te,ae,we;return E==null&&(E="auto"),te=M[0],U=M[1],z=M[2],R=M[3],E==="auto"&&(E=R<1?"rgba":"rgb"),te=Math.round(te),U=Math.round(U),z=Math.round(z),we=te<<16|U<<8|z,ae="000000"+we.toString(16),ae=ae.substr(ae.length-6),J="0"+qe(R*255).toString(16),J=J.substr(J.length-2),"#"+function(){switch(E.toLowerCase()){case"rgba":return ae+J;case"argb":return J+ae;default:return ae}}()},f.hex=function(M){return P(M)},_.hex=function(){return function(M,E,R){R.prototype=M.prototype;var z=new R,U=M.apply(z,E);return Object(U)===U?U:z}(n,ye.call(arguments).concat(["hex"]),function(){})},n.prototype.hex=function(M){return M==null&&(M="auto"),ge(this._rgb,M)},u.push({p:4,test:function(M){if(arguments.length===1&&Be(M)==="string")return"hex"}}),B=function(){var M,E,R,z,U,J,te,ae,we,_e,Ie,Ue,Re,ke;if(M=$e(arguments),U=M[0],Ie=M[1],te=M[2],Ie===0)we=z=E=te*255;else{for(ke=[0,0,0],R=[0,0,0],Re=te<.5?te*(1+Ie):te+Ie-te*Ie,Ue=2*te-Re,U/=360,ke[0]=U+1/3,ke[1]=U,ke[2]=U-1/3,J=ae=0;ae<=2;J=++ae)ke[J]<0&&(ke[J]+=1),ke[J]>1&&(ke[J]-=1),6*ke[J]<1?R[J]=Ue+(Re-Ue)*6*ke[J]:2*ke[J]<1?R[J]=Re:3*ke[J]<2?R[J]=Ue+(Re-Ue)*(2/3-ke[J])*6:R[J]=Ue;_e=[qe(R[0]*255),qe(R[1]*255),qe(R[2]*255)],we=_e[0],z=_e[1],E=_e[2]}return M.length>3?[we,z,E,M[3]]:[we,z,E]},be=function(M,E,R){var z,U,J,te,ae;return M!==void 0&&M.length>=3&&(te=M,M=te[0],E=te[1],R=te[2]),M/=255,E/=255,R/=255,J=Math.min(M,E,R),ve=Math.max(M,E,R),U=(ve+J)/2,ve===J?(ae=0,z=Number.NaN):ae=U<.5?(ve-J)/(ve+J):(ve-J)/(2-ve-J),M===ve?z=(E-R)/(ve-J):E===ve?z=2+(R-M)/(ve-J):R===ve&&(z=4+(M-E)/(ve-J)),z*=60,z<0&&(z+=360),[z,ae,U]},_.hsl=function(){return function(M,E,R){R.prototype=M.prototype;var z=new R,U=M.apply(z,E);return Object(U)===U?U:z}(n,ye.call(arguments).concat(["hsl"]),function(){})},f.hsl=B,n.prototype.hsl=function(){return be(this._rgb)},q=function(){var M,E,R,z,U,J,te,ae,we,_e,Ie,Ue,Re,ke,ze,Ze,nt,Qe;if(M=$e(arguments),U=M[0],Ze=M[1],Qe=M[2],Qe*=255,Ze===0)we=z=E=Qe;else switch(U===360&&(U=0),U>360&&(U-=360),U<0&&(U+=360),U/=60,J=F(U),R=U-J,te=Qe*(1-Ze),ae=Qe*(1-Ze*R),nt=Qe*(1-Ze*(1-R)),J){case 0:_e=[Qe,nt,te],we=_e[0],z=_e[1],E=_e[2];break;case 1:Ie=[ae,Qe,te],we=Ie[0],z=Ie[1],E=Ie[2];break;case 2:Ue=[te,Qe,nt],we=Ue[0],z=Ue[1],E=Ue[2];break;case 3:Re=[te,ae,Qe],we=Re[0],z=Re[1],E=Re[2];break;case 4:ke=[nt,te,Qe],we=ke[0],z=ke[1],E=ke[2];break;case 5:ze=[Qe,te,ae],we=ze[0],z=ze[1],E=ze[2]}return[we,z,E,M.length>3?M[3]:1]},Oe=function(){var M,E,R,z,U,J,te,ae,we;return te=$e(arguments),J=te[0],R=te[1],M=te[2],U=Math.min(J,R,M),ve=Math.max(J,R,M),E=ve-U,we=ve/255,ve===0?(z=Number.NaN,ae=0):(ae=E/ve,J===ve&&(z=(R-M)/E),R===ve&&(z=2+(M-J)/E),M===ve&&(z=4+(J-R)/E),z*=60,z<0&&(z+=360)),[z,ae,we]},_.hsv=function(){return function(M,E,R){R.prototype=M.prototype;var z=new R,U=M.apply(z,E);return Object(U)===U?U:z}(n,ye.call(arguments).concat(["hsv"]),function(){})},f.hsv=q,n.prototype.hsv=function(){return Oe(this._rgb)},pe=function(M){var E,R,z;return Be(M)==="number"&&M>=0&&M<=16777215?(z=M>>16,R=M>>8&255,E=M&255,[z,R,E,1]):(console.warn("unknown num color: "+M),[0,0,0,1])},at=function(){var M,E,R,z;return z=$e(arguments),R=z[0],E=z[1],M=z[2],(R<<16)+(E<<8)+M},_.num=function(M){return new n(M,"num")},n.prototype.num=function(M){return M==null&&(M="rgb"),at(this._rgb,M)},f.num=pe,u.push({p:1,test:function(M){if(arguments.length===1&&Be(M)==="number"&&M>=0&&M<=16777215)return"num"}}),I=function(){var M,E,R,z,U,J,te,ae,we,_e,Ie,Ue,Re,ke,ze,Ze,nt,Qe,cn,zt;if(R=$e(arguments),ae=R[0],U=R[1],E=R[2],U=U/100,te=te/100*255,M=U*255,U===0)Ue=te=z=E;else switch(ae===360&&(ae=0),ae>360&&(ae-=360),ae<0&&(ae+=360),ae/=60,we=F(ae),J=ae-we,_e=E*(1-U),Ie=_e+M*(1-J),cn=_e+M*J,zt=_e+M,we){case 0:Re=[zt,cn,_e],Ue=Re[0],te=Re[1],z=Re[2];break;case 1:ke=[Ie,zt,_e],Ue=ke[0],te=ke[1],z=ke[2];break;case 2:ze=[_e,zt,cn],Ue=ze[0],te=ze[1],z=ze[2];break;case 3:Ze=[_e,Ie,zt],Ue=Ze[0],te=Ze[1],z=Ze[2];break;case 4:nt=[cn,_e,zt],Ue=nt[0],te=nt[1],z=nt[2];break;case 5:Qe=[zt,_e,Ie],Ue=Qe[0],te=Qe[1],z=Qe[2]}return[Ue,te,z,R.length>3?R[3]:1]},Ae=function(){var M,E,R,z,U,J,te,ae,we;return we=$e(arguments),ae=we[0],U=we[1],E=we[2],te=Math.min(ae,U,E),ve=Math.max(ae,U,E),z=ve-te,R=z*100/255,M=te/(255-z)*100,z===0?J=Number.NaN:(ae===ve&&(J=(U-E)/z),U===ve&&(J=2+(E-ae)/z),E===ve&&(J=4+(ae-U)/z),J*=60,J<0&&(J+=360)),[J,R,M]},_.hcg=function(){return function(M,E,R){R.prototype=M.prototype;var z=new R,U=M.apply(z,E);return Object(U)===U?U:z}(n,ye.call(arguments).concat(["hcg"]),function(){})},f.hcg=I,n.prototype.hcg=function(){return Ae(this._rgb)},A=function(M){var E,R,z,U,J,te,ae,we;if(M=M.toLowerCase(),_.colors!=null&&_.colors[M])return P(_.colors[M]);if(J=M.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(ae=J.slice(1,4),U=te=0;te<=2;U=++te)ae[U]=+ae[U];ae[3]=1}else if(J=M.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(ae=J.slice(1,5),U=we=0;we<=3;U=++we)ae[U]=+ae[U];else if(J=M.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(ae=J.slice(1,4),U=E=0;E<=2;U=++E)ae[U]=qe(ae[U]*2.55);ae[3]=1}else if(J=M.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(ae=J.slice(1,5),U=R=0;R<=2;U=++R)ae[U]=qe(ae[U]*2.55);ae[3]=+ae[3]}else(J=M.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(z=J.slice(1,4),z[1]*=.01,z[2]*=.01,ae=B(z),ae[3]=1):(J=M.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(z=J.slice(1,4),z[1]*=.01,z[2]*=.01,ae=B(z),ae[3]=+J[4]);return ae},xe=function(M){var E;if(E=M[3]<1?"rgba":"rgb",E==="rgb")return E+"("+M.slice(0,3).map(qe).join(",")+")";if(E==="rgba")return E+"("+M.slice(0,3).map(qe).join(",")+","+M[3]+")"},vt=function(M){return qe(M*100)/100},$=function(M,E){var R;return R=E<1?"hsla":"hsl",M[0]=vt(M[0]||0),M[1]=vt(M[1]*100)+"%",M[2]=vt(M[2]*100)+"%",R==="hsla"&&(M[3]=E),R+"("+M.join(",")+")"},f.css=function(M){return A(M)},_.css=function(){return function(M,E,R){R.prototype=M.prototype;var z=new R,U=M.apply(z,E);return Object(U)===U?U:z}(n,ye.call(arguments).concat(["css"]),function(){})},n.prototype.css=function(M){if(M==null&&(M="rgb"),M.slice(0,3)==="rgb")return xe(this._rgb);if(M.slice(0,3)==="hsl")return $(this.hsl(),this.alpha())},f.named=function(M){return P(Je[M])},u.push({p:5,test:function(M){if(arguments.length===1&&Je[M]!=null)return"named"}}),n.prototype.name=function(M){var E,R;arguments.length&&(Je[M]&&(this._rgb=P(Je[M])),this._rgb[3]=1),E=this.hex("rgb");for(R in Je)if(E===Je[R])return R;return E},ue=function(){var M,E,R,z;return z=$e(arguments),R=z[0],M=z[1],E=z[2],E=E*i,[R,C(E)*M,tt(E)*M]},H=function(){var M,E,R,z,U,J,te,ae,we,_e,Ie;return R=$e(arguments),ae=R[0],U=R[1],te=R[2],_e=ue(ae,U,te),M=_e[0],E=_e[1],z=_e[2],Ie=ce(M,E,z),we=Ie[0],J=Ie[1],z=Ie[2],[we,J,z,R.length>3?R[3]:1]},K=function(){var M,E,R,z,U,J;return J=$e(arguments),U=J[0],M=J[1],E=J[2],R=Ve(M*M+E*E),z=(y(E,M)*a+360)%360,qe(R*1e4)===0&&(z=Number.NaN),[U,R,z]},Ce=function(){var M,E,R,z,U,J,te;return J=$e(arguments),U=J[0],R=J[1],E=J[2],te=Te(U,R,E),z=te[0],M=te[1],E=te[2],K(z,M,E)},_.lch=function(){var M;return M=$e(arguments),new n(M,"lch")},_.hcl=function(){var M;return M=$e(arguments),new n(M,"hcl")},f.lch=H,f.hcl=function(){var M,E,R,z;return z=$e(arguments),E=z[0],M=z[1],R=z[2],H([R,M,E])},n.prototype.lch=function(){return Ce(this._rgb)},n.prototype.hcl=function(){return Ce(this._rgb).reverse()},oe=function(M){var E,R,z,U,J,te,ae,we,_e;return M==null&&(M="rgb"),we=$e(arguments),ae=we[0],U=we[1],E=we[2],ae=ae/255,U=U/255,E=E/255,J=1-Math.max(ae,Math.max(U,E)),z=J<1?1/(1-J):0,R=(1-ae-J)*z,te=(1-U-J)*z,_e=(1-E-J)*z,[R,te,_e,J]},w=function(){var M,E,R,z,U,J,te,ae,we;return E=$e(arguments),z=E[0],te=E[1],we=E[2],J=E[3],M=E.length>4?E[4]:1,J===1?[0,0,0,M]:(ae=z>=1?0:255*(1-z)*(1-J),U=te>=1?0:255*(1-te)*(1-J),R=we>=1?0:255*(1-we)*(1-J),[ae,U,R,M])},f.cmyk=function(){return w($e(arguments))},_.cmyk=function(){return function(M,E,R){R.prototype=M.prototype;var z=new R,U=M.apply(z,E);return Object(U)===U?U:z}(n,ye.call(arguments).concat(["cmyk"]),function(){})},n.prototype.cmyk=function(){return oe(this._rgb)},f.gl=function(){var M,E,R,z,U;for(z=function(){var J,te;J=$e(arguments),te=[];for(E in J)U=J[E],te.push(U);return te}.apply(this,arguments),M=R=0;R<=2;M=++R)z[M]*=255;return z},_.gl=function(){return function(M,E,R){R.prototype=M.prototype;var z=new R,U=M.apply(z,E);return Object(U)===U?U:z}(n,ye.call(arguments).concat(["gl"]),function(){})},n.prototype.gl=function(){var M;return M=this._rgb,[M[0]/255,M[1]/255,M[2]/255,M[3]]},Ge=function(M,E,R){var z;return z=$e(arguments),M=z[0],E=z[1],R=z[2],M=fe(M),E=fe(E),R=fe(R),.2126*M+.7152*E+.0722*R},fe=function(M){return M/=255,M<=.03928?M/12.92:ne((M+.055)/1.055,2.4)},he=function(M,E,R,z){var U,J;return U=M._rgb,J=E._rgb,new n(U[0]+R*(J[0]-U[0]),U[1]+R*(J[1]-U[1]),U[2]+R*(J[2]-U[2]),z)},p.push(["rgb",he]),n.prototype.luminance=function(M,E){var R,z,U,J,te;return E==null&&(E="rgb"),arguments.length?(J=this._rgb,M===0?J=[0,0,0,this._rgb[3]]:M===1?J=[255,255,255,this[3]]:(R=Ge(this._rgb),z=1e-7,U=20,te=function(ae,we){var _e,Ie;return Ie=ae.interpolate(we,.5,E),_e=Ie.luminance(),Math.abs(M-_e)<z||!U--?Ie:_e>M?te(ae,Ie):te(Ie,we)},R>M?J=te(_("black"),this).rgba():J=te(this,_("white")).rgba()),_(J).alpha(this.alpha())):Ge(this._rgb)},Pt=function(M){var E,R,z,U;return U=M/100,U<66?(z=255,R=-155.25485562709179-.44596950469579133*(R=U-2)+104.49216199393888*ie(R),E=U<20?0:-254.76935184120902+.8274096064007395*(E=U-10)+115.67994401066147*ie(E)):(z=351.97690566805693+.114206453784165*(z=U-55)-40.25366309332127*ie(z),R=325.4494125711974+.07943456536662342*(R=U-50)-28.0852963507957*ie(R),E=255),[z,R,E]},it=function(){var M,E,R,z,U,J,te,ae;for(J=$e(arguments),U=J[0],J[1],M=J[2],z=1e3,R=4e4,E=.4;R-z>E;)ae=(R+z)*.5,te=Pt(ae),te[2]/te[0]>=M/U?R=ae:z=ae;return qe(ae)},_.temperature=_.kelvin=function(){return function(M,E,R){R.prototype=M.prototype;var z=new R,U=M.apply(z,E);return Object(U)===U?U:z}(n,ye.call(arguments).concat(["temperature"]),function(){})},f.temperature=f.kelvin=f.K=Pt,n.prototype.temperature=function(){return it(this._rgb)},n.prototype.kelvin=n.prototype.temperature,_.contrast=function(M,E){var R,z,U,J;return((U=Be(M))==="string"||U==="number")&&(M=new n(M)),((J=Be(E))==="string"||J==="number")&&(E=new n(E)),R=M.luminance(),z=E.luminance(),R>z?(R+.05)/(z+.05):(z+.05)/(R+.05)},_.distance=function(M,E,R){var z,U,J,te,ae,we,_e;R==null&&(R="lab"),((ae=Be(M))==="string"||ae==="number")&&(M=new n(M)),((we=Be(E))==="string"||we==="number")&&(E=new n(E)),J=M.get(R),te=E.get(R),_e=0;for(U in J)z=(J[U]||0)-(te[U]||0),_e+=z*z;return Math.sqrt(_e)},_.deltaE=function(M,E,R,z){var U,J,te,ae,we,_e,Ie,Ue,Re,ke,ze,Ze,nt,Qe,cn,zt,Ii,nr,wt,Le,Ye,St,Ot,pt,kt,Lt,Zt;for(R==null&&(R=1),z==null&&(z=1),((Ii=Be(M))==="string"||Ii==="number")&&(M=new n(M)),((nr=Be(E))==="string"||nr==="number")&&(E=new n(E)),wt=M.lab(),U=wt[0],te=wt[1],we=wt[2],Le=E.lab(),J=Le[0],ae=Le[1],_e=Le[2],Ie=Ve(te*te+we*we),Ue=Ve(ae*ae+_e*_e),Ot=U<16?.511:.040975*U/(1+.01765*U),Ye=.0638*Ie/(1+.0131*Ie)+.638,zt=Ie<1e-6?0:y(we,te)*180/o;zt<0;)zt+=360;for(;zt>=360;)zt-=360;return pt=zt>=164&&zt<=345?.56+m(.2*C(o*(zt+168)/180)):.36+m(.4*C(o*(zt+35)/180)),Re=Ie*Ie*Ie*Ie,cn=Ve(Re/(Re+1900)),St=Ye*(cn*pt+1-cn),Qe=U-J,nt=Ie-Ue,ze=te-ae,Ze=we-_e,ke=ze*ze+Ze*Ze-nt*nt,kt=Qe/(R*Ot),Lt=nt/(z*Ye),Zt=St,Ve(kt*kt+Lt*Lt+ke/(Zt*Zt))},n.prototype.get=function(M){var E,R,z,U,J,te;return z=this,J=M.split("."),U=J[0],E=J[1],te=z[U](),E?(R=U.indexOf(E),R>-1?te[R]:console.warn("unknown channel "+E+" in mode "+U)):te},n.prototype.set=function(M,E){var R,z,U,J,te,ae;if(U=this,te=M.split("."),J=te[0],R=te[1],R)if(ae=U[J](),z=J.indexOf(R),z>-1)if(Be(E)==="string")switch(E.charAt(0)){case"+":ae[z]+=+E;break;case"-":ae[z]+=+E;break;case"*":ae[z]*=+E.substr(1);break;case"/":ae[z]/=+E.substr(1);break;default:ae[z]=+E}else ae[z]=E;else console.warn("unknown channel "+R+" in mode "+J);else ae=E;return _(ae,J).alpha(U.alpha())},n.prototype.clipped=function(){return this._rgb._clipped||!1},n.prototype.alpha=function(M){return arguments.length?_.rgb([this._rgb[0],this._rgb[1],this._rgb[2],M]):this._rgb[3]},n.prototype.darken=function(M){var E,R;return M==null&&(M=1),R=this,E=R.lab(),E[0]-=r.Kn*M,_.lab(E).alpha(R.alpha())},n.prototype.brighten=function(M){return M==null&&(M=1),this.darken(-M)},n.prototype.darker=n.prototype.darken,n.prototype.brighter=n.prototype.brighten,n.prototype.saturate=function(M){var E,R;return M==null&&(M=1),R=this,E=R.lch(),E[1]+=M*r.Kn,E[1]<0&&(E[1]=0),_.lch(E).alpha(R.alpha())},n.prototype.desaturate=function(M){return M==null&&(M=1),this.saturate(-M)},n.prototype.premultiply=function(){var M,E;return E=this.rgb(),M=this.alpha(),_(E[0]*M,E[1]*M,E[2]*M,M)},d=function(M,E,R){if(!d[R])throw"unknown blend mode "+R;return d[R](M,E)},g=function(M){return function(E,R){var z,U;return z=_(R).rgb(),U=_(E).rgb(),_(M(z,U),"rgb")}},D=function(M){return function(E,R){var z,U,J;for(J=[],z=U=0;U<=3;z=++U)J[z]=M(E[z],R[z]);return J}},V=function(M,E){return M},G=function(M,E){return M*E/255},k=function(M,E){return M>E?E:M},j=function(M,E){return M>E?M:E},Ct=function(M,E){return 255*(1-(1-M/255)*(1-E/255))},le=function(M,E){return E<128?2*M*E/255:255*(1-2*(1-M/255)*(1-E/255))},x=function(M,E){return 255*(1-(1-E/255)/(M/255))},L=function(M,E){return M===255||(M=255*(E/255)/(1-M/255),M>255)?255:M},d.normal=g(D(V)),d.multiply=g(D(G)),d.screen=g(D(Ct)),d.overlay=g(D(le)),d.darken=g(D(k)),d.lighten=g(D(j)),d.dodge=g(D(L)),d.burn=g(D(x)),_.blend=d,_.analyze=function(M){var E,R,z,U;for(z={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},R=0,E=M.length;R<E;R++)U=M[R],U!=null&&!isNaN(U)&&(z.values.push(U),z.sum+=U,U<z.min&&(z.min=U),U>z.max&&(z.max=U),z.count+=1);return z.domain=[z.min,z.max],z.limits=function(J,te){return _.limits(z,J,te)},z},_.scale=function(M,E){var R,z,U,J,te,ae,we,_e,Ie,Ue,Re,ke,ze,Ze,nt,Qe,cn,zt,Ii,nr,wt;return Ie="rgb",Ue=_("#ccc"),Ze=0,te=[0,1],ze=[],ke=[0,0],R=!1,U=[],Re=!1,_e=0,we=1,J=!1,z={},nt=!0,ae=1,nr=function(Le){var Ye,St,Ot,pt,kt,Lt;if(Le==null&&(Le=["#fff","#000"]),Le!=null&&Be(Le)==="string"&&_.brewer!=null&&(Le=_.brewer[Le]||_.brewer[Le.toLowerCase()]||Le),Be(Le)==="array"){for(Le.length===1&&(Le=[Le[0],Le[0]]),Le=Le.slice(0),Ye=Ot=0,pt=Le.length-1;0<=pt?Ot<=pt:Ot>=pt;Ye=0<=pt?++Ot:--Ot)St=Le[Ye],Be(St)==="string"&&(Le[Ye]=_(St));for(ze.length=0,Ye=Lt=0,kt=Le.length-1;0<=kt?Lt<=kt:Lt>=kt;Ye=0<=kt?++Lt:--Lt)ze.push(Ye/(Le.length-1))}return Ii(),U=Le},cn=function(Le){var Ye,St;if(R!=null){for(St=R.length-1,Ye=0;Ye<St&&Le>=R[Ye];)Ye++;return Ye-1}return 0},wt=function(Le){return Le},zt=function(Le,Ye){var St,Ot,pt,kt,Lt,Zt,Vn,Tt;if(Ye==null&&(Ye=!1),isNaN(Le)||Le===null)return Ue;if(Ye?Tt=Le:R&&R.length>2?(St=cn(Le),Tt=St/(R.length-2)):we!==_e?Tt=(Le-_e)/(we-_e):Tt=1,Ye||(Tt=wt(Tt)),ae!==1&&(Tt=ne(Tt,ae)),Tt=ke[0]+Tt*(1-ke[0]-ke[1]),Tt=Math.min(1,Math.max(0,Tt)),kt=Math.floor(Tt*1e4),nt&&z[kt])Ot=z[kt];else{if(Be(U)==="array")for(pt=Lt=0,Vn=ze.length-1;0<=Vn?Lt<=Vn:Lt>=Vn;pt=0<=Vn?++Lt:--Lt){if(Zt=ze[pt],Tt<=Zt){Ot=U[pt];break}if(Tt>=Zt&&pt===ze.length-1){Ot=U[pt];break}if(Tt>Zt&&Tt<ze[pt+1]){Tt=(Tt-Zt)/(ze[pt+1]-Zt),Ot=_.interpolate(U[pt],U[pt+1],Tt,Ie);break}}else Be(U)==="function"&&(Ot=U(Tt));nt&&(z[kt]=Ot)}return Ot},Ii=function(){return z={}},nr(M),Qe=function(Le){var Ye;return Ye=_(zt(Le)),Re&&Ye[Re]?Ye[Re]():Ye},Qe.classes=function(Le){var Ye;return Le!=null?(Be(Le)==="array"?(R=Le,te=[Le[0],Le[Le.length-1]]):(Ye=_.analyze(te),Le===0?R=[Ye.min,Ye.max]:R=_.limits(Ye,"e",Le)),Qe):R},Qe.domain=function(Le){var Ye,St,Ot,pt,kt,Lt,Zt;if(!arguments.length)return te;if(_e=Le[0],we=Le[Le.length-1],ze=[],Ot=U.length,Le.length===Ot&&_e!==we)for(kt=0,pt=Le.length;kt<pt;kt++)St=Le[kt],ze.push((St-_e)/(we-_e));else for(Ye=Zt=0,Lt=Ot-1;0<=Lt?Zt<=Lt:Zt>=Lt;Ye=0<=Lt?++Zt:--Zt)ze.push(Ye/(Ot-1));return te=[_e,we],Qe},Qe.mode=function(Le){return arguments.length?(Ie=Le,Ii(),Qe):Ie},Qe.range=function(Le,Ye){return nr(Le,Ye),Qe},Qe.out=function(Le){return Re=Le,Qe},Qe.spread=function(Le){return arguments.length?(Ze=Le,Qe):Ze},Qe.correctLightness=function(Le){return Le==null&&(Le=!0),J=Le,Ii(),J?wt=function(Ye){var St,Ot,pt,kt,Lt,Zt,Vn,Tt,fn;for(St=zt(0,!0).lab()[0],Ot=zt(1,!0).lab()[0],Vn=St>Ot,pt=zt(Ye,!0).lab()[0],Lt=St+(Ot-St)*Ye,kt=pt-Lt,Tt=0,fn=1,Zt=20;Math.abs(kt)>.01&&Zt-- >0;)(function(){return Vn&&(kt*=-1),kt<0?(Tt=Ye,Ye+=(fn-Ye)*.5):(fn=Ye,Ye+=(Tt-Ye)*.5),pt=zt(Ye,!0).lab()[0],kt=pt-Lt})();return Ye}:wt=function(Ye){return Ye},Qe},Qe.padding=function(Le){return Le!=null?(Be(Le)==="number"&&(Le=[Le,Le]),ke=Le,Qe):ke},Qe.colors=function(Le,Ye){var St,Ot,pt,kt,Lt,Zt,Vn,Tt;if(arguments.length<2&&(Ye="hex"),Lt=[],arguments.length===0)Lt=U.slice(0);else if(Le===1)Lt=[Qe(.5)];else if(Le>1)Ot=te[0],St=te[1]-Ot,Lt=function(){Zt=[];for(var fn=0;0<=Le?fn<Le:fn>Le;0<=Le?fn++:fn--)Zt.push(fn);return Zt}.apply(this).map(function(fn){return Qe(Ot+fn/(Le-1)*St)});else{if(M=[],Vn=[],R&&R.length>2)for(pt=Tt=1,kt=R.length;1<=kt?Tt<kt:Tt>kt;pt=1<=kt?++Tt:--Tt)Vn.push((R[pt-1]+R[pt])*.5);else Vn=te;Lt=Vn.map(function(fn){return Qe(fn)})}return _[Ye]&&(Lt=Lt.map(function(fn){return fn[Ye]()})),Lt},Qe.cache=function(Le){return Le!=null?(nt=Le,Qe):nt},Qe.gamma=function(Le){return Le!=null?(ae=Le,Qe):ae},Qe.nodata=function(Le){return Le!=null?(Ue=_(Le),Qe):Ue},Qe},_.scales==null&&(_.scales={}),_.scales.cool=function(){return _.scale([_.hsl(180,1,.9),_.hsl(250,.7,.4)])},_.scales.hot=function(){return _.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},_.analyze=function(M,E,R){var z,U,J,te,ae,we,_e;if(ae={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},R==null&&(R=function(){return!0}),z=function(Ie){Ie!=null&&!isNaN(Ie)&&(ae.values.push(Ie),ae.sum+=Ie,Ie<ae.min&&(ae.min=Ie),Ie>ae.max&&(ae.max=Ie),ae.count+=1)},_e=function(Ie,Ue){if(R(Ie,Ue))return E!=null&&Be(E)==="function"?z(E(Ie)):E!=null&&Be(E)==="string"||Be(E)==="number"?z(Ie[E]):z(Ie)},Be(M)==="array")for(te=0,J=M.length;te<J;te++)we=M[te],_e(we);else for(U in M)we=M[U],_e(we,U);return ae.domain=[ae.min,ae.max],ae.limits=function(Ie,Ue){return _.limits(ae,Ie,Ue)},ae},_.limits=function(M,E,R){var z,U,J,te,ae,we,_e,Ie,Ue,Re,ke,ze,Ze,nt,Qe,cn,zt,Ii,nr,wt,Le,Ye,St,Ot,pt,kt,Lt,Zt,Vn,Tt,fn,Wo,Gr,Os,uo,ho,fo,po,ks,Ds,Uu,Da,Ba,Fa,Na,mo,Gu,$u,Vu,Hu,Bs,Cp,q_,go,ju;if(E==null&&(E="equal"),R==null&&(R=7),Be(M)==="array"&&(M=_.analyze(M)),pt=M.min,ve=M.max,M.sum,go=M.values.sort(function(B0,F0){return B0-F0}),R===1)return[pt,ve];if(St=[],E.substr(0,1)==="c"&&(St.push(pt),St.push(ve)),E.substr(0,1)==="e"){for(St.push(pt),wt=fn=1,uo=R-1;1<=uo?fn<=uo:fn>=uo;wt=1<=uo?++fn:--fn)St.push(pt+wt/R*(ve-pt));St.push(ve)}else if(E.substr(0,1)==="l"){if(pt<=0)throw"Logarithmic scales are only possible for values > 0";for(kt=Math.LOG10E*ie(pt),Ot=Math.LOG10E*ie(ve),St.push(pt),wt=ju=1,ho=R-1;1<=ho?ju<=ho:ju>=ho;wt=1<=ho?++ju:--ju)St.push(ne(10,kt+wt/R*(Ot-kt)));St.push(ve)}else if(E.substr(0,1)==="q"){for(St.push(pt),wt=z=1,Da=R-1;1<=Da?z<=Da:z>=Da;wt=1<=Da?++z:--z)Wo=(go.length-1)*wt/R,Gr=F(Wo),Gr===Wo?St.push(go[Gr]):(Os=Wo-Gr,St.push(go[Gr]*(1-Os)+go[Gr+1]*Os));St.push(ve)}else if(E.substr(0,1)==="k"){for(Zt=go.length,nt=new Array(Zt),Ii=new Array(R),Hu=!0,Vn=0,cn=null,cn=[],cn.push(pt),wt=U=1,Ba=R-1;1<=Ba?U<=Ba:U>=Ba;wt=1<=Ba?++U:--U)cn.push(pt+wt/R*(ve-pt));for(cn.push(ve);Hu;){for(Le=J=0,Fa=R-1;0<=Fa?J<=Fa:J>=Fa;Le=0<=Fa?++J:--J)Ii[Le]=0;for(wt=te=0,Na=Zt-1;0<=Na?te<=Na:te>=Na;wt=0<=Na?++te:--te){for(q_=go[wt],Lt=Number.MAX_VALUE,Le=ae=0,mo=R-1;0<=mo?ae<=mo:ae>=mo;Le=0<=mo?++ae:--ae)nr=m(cn[Le]-q_),nr<Lt&&(Lt=nr,Qe=Le);Ii[Qe]++,nt[wt]=Qe}for(Tt=new Array(R),Le=we=0,Gu=R-1;0<=Gu?we<=Gu:we>=Gu;Le=0<=Gu?++we:--we)Tt[Le]=null;for(wt=_e=0,$u=Zt-1;0<=$u?_e<=$u:_e>=$u;wt=0<=$u?++_e:--_e)zt=nt[wt],Tt[zt]===null?Tt[zt]=go[wt]:Tt[zt]+=go[wt];for(Le=Ie=0,Vu=R-1;0<=Vu?Ie<=Vu:Ie>=Vu;Le=0<=Vu?++Ie:--Ie)Tt[Le]*=1/Ii[Le];for(Hu=!1,Le=Ue=0,fo=R-1;0<=fo?Ue<=fo:Ue>=fo;Le=0<=fo?++Ue:--Ue)if(Tt[Le]!==cn[wt]){Hu=!0;break}cn=Tt,Vn++,Vn>200&&(Hu=!1)}for(Ye={},Le=Re=0,po=R-1;0<=po?Re<=po:Re>=po;Le=0<=po?++Re:--Re)Ye[Le]=[];for(wt=ke=0,ks=Zt-1;0<=ks?ke<=ks:ke>=ks;wt=0<=ks?++ke:--ke)zt=nt[wt],Ye[zt].push(go[wt]);for(Bs=[],Le=ze=0,Ds=R-1;0<=Ds?ze<=Ds:ze>=Ds;Le=0<=Ds?++ze:--ze)Bs.push(Ye[Le][0]),Bs.push(Ye[Le][Ye[Le].length-1]);for(Bs=Bs.sort(function(B0,F0){return B0-F0}),St.push(Bs[0]),wt=Ze=1,Uu=Bs.length-1;Ze<=Uu;wt=Ze+=2)Cp=Bs[wt],!isNaN(Cp)&&St.indexOf(Cp)===-1&&St.push(Cp)}return St},N=function(M,E,R){var z,U,J,te;return z=$e(arguments),M=z[0],E=z[1],R=z[2],isNaN(M)&&(M=0),M/=360,M<1/3?(U=(1-E)/3,te=(1+E*C(c*M)/C(s-c*M))/3,J=1-(U+te)):M<2/3?(M-=1/3,te=(1-E)/3,J=(1+E*C(c*M)/C(s-c*M))/3,U=1-(te+J)):(M-=2/3,J=(1-E)/3,U=(1+E*C(c*M)/C(s-c*M))/3,te=1-(J+U)),te=X(R*te*3),J=X(R*J*3),U=X(R*U*3),[te*255,J*255,U*255,z.length>3?z[3]:1]},Me=function(){var M,E,R,z,U,J,te,ae;return te=$e(arguments),J=te[0],E=te[1],M=te[2],c=Math.PI*2,J/=255,E/=255,M/=255,U=Math.min(J,E,M),z=(J+E+M)/3,ae=1-U/z,ae===0?R=0:(R=(J-E+(J-M))/2,R/=Math.sqrt((J-E)*(J-E)+(J-M)*(E-M)),R=Math.acos(R),M>E&&(R=c-R),R/=c),[R*360,ae,z]},_.hsi=function(){return function(M,E,R){R.prototype=M.prototype;var z=new R,U=M.apply(z,E);return Object(U)===U?U:z}(n,ye.call(arguments).concat(["hsi"]),function(){})},f.hsi=N,n.prototype.hsi=function(){return Me(this._rgb)},W=function(M,E,R,z){var U,J,te,ae,we,_e,Ie,Ue,Re,ke,ze,Ze;return z==="hsl"?(ze=M.hsl(),Ze=E.hsl()):z==="hsv"?(ze=M.hsv(),Ze=E.hsv()):z==="hcg"?(ze=M.hcg(),Ze=E.hcg()):z==="hsi"?(ze=M.hsi(),Ze=E.hsi()):(z==="lch"||z==="hcl")&&(z="hcl",ze=M.hcl(),Ze=E.hcl()),z.substr(0,1)==="h"&&(te=ze[0],Re=ze[1],_e=ze[2],ae=Ze[0],ke=Ze[1],Ie=Ze[2]),!isNaN(te)&&!isNaN(ae)?(ae>te&&ae-te>180?U=ae-(te+360):ae<te&&te-ae>180?U=ae+360-te:U=ae-te,J=te+R*U):isNaN(te)?isNaN(ae)?J=Number.NaN:(J=ae,(_e===1||_e===0)&&z!=="hsv"&&(Ue=ke)):(J=te,(Ie===1||Ie===0)&&z!=="hsv"&&(Ue=Re)),Ue==null&&(Ue=Re+R*(ke-Re)),we=_e+R*(Ie-_e),_[z](J,Ue,we)},p=p.concat(function(){var M,E,R,z;for(R=["hsv","hsl","hsi","hcl","lch","hcg"],z=[],E=0,M=R.length;E<M;E++)me=R[E],z.push([me,W]);return z}()),re=function(M,E,R,z){var U,J;return U=M.num(),J=E.num(),_.num(U+(J-U)*R,"num")},p.push(["num",re]),Q=function(M,E,R,z){var U,J;return U=M.lab(),J=E.lab(),new n(U[0]+R*(J[0]-U[0]),U[1]+R*(J[1]-U[1]),U[2]+R*(J[2]-U[2]),z)},p.push(["lab",Q])}).call(cA)})(QB,Dg);var yt={},JB={get exports(){return yt},set exports(e){yt=e}};(function(e){/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */(function(t){function n(s,a,c,l,u){this._listener=a,this._isOnce=c,this.context=l,this._signal=s,this._priority=u||0}n.prototype={active:!0,params:null,execute:function(s){var a,c;return this.active&&this._listener&&(c=this.params?this.params.concat(s):s,a=this._listener.apply(this.context,c),this._isOnce&&this.detach()),a},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};function i(s,a){if(typeof s!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",a))}function r(){this._bindings=[],this._prevParams=null;var s=this;this.dispatch=function(){r.prototype.dispatch.apply(s,arguments)}}r.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(s,a,c,l){var u=this._indexOfListener(s,c),h;if(u!==-1){if(h=this._bindings[u],h.isOnce()!==a)throw new Error("You cannot add"+(a?"":"Once")+"() then add"+(a?"Once":"")+"() the same listener without removing the relationship first.")}else h=new n(this,s,a,c,l),this._addBinding(h);return this.memorize&&this._prevParams&&h.execute(this._prevParams),h},_addBinding:function(s){var a=this._bindings.length;do--a;while(this._bindings[a]&&s._priority<=this._bindings[a]._priority);this._bindings.splice(a+1,0,s)},_indexOfListener:function(s,a){for(var c=this._bindings.length,l;c--;)if(l=this._bindings[c],l._listener===s&&l.context===a)return c;return-1},has:function(s,a){return this._indexOfListener(s,a)!==-1},add:function(s,a,c){return i(s,"add"),this._registerListener(s,!1,a,c)},addOnce:function(s,a,c){return i(s,"addOnce"),this._registerListener(s,!0,a,c)},remove:function(s,a){i(s,"remove");var c=this._indexOfListener(s,a);return c!==-1&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),s},removeAll:function(){for(var s=this._bindings.length;s--;)this._bindings[s]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(s){if(this.active){var a=Array.prototype.slice.call(arguments),c=this._bindings.length,l;if(this.memorize&&(this._prevParams=a),!!c){l=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(l[c]&&this._shouldPropagate&&l[c].execute(a)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var o=r;o.Signal=r,e.exports?e.exports=o:t.signals=o})(cA)})(JB);var Bi={};(function(e){(function(){var t={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function n(a){return r(s(a),arguments)}function i(a,c){return n.apply(null,[a].concat(c||[]))}function r(a,c){var l=1,u=a.length,h,f="",p,m,y,v,d,g,b,x;for(p=0;p<u;p++)if(typeof a[p]=="string")f+=a[p];else if(typeof a[p]=="object"){if(y=a[p],y.keys)for(h=c[l],m=0;m<y.keys.length;m++){if(h==null)throw new Error(n('[sprintf] Cannot access property "%s" of undefined value "%s"',y.keys[m],y.keys[m-1]));h=h[y.keys[m]]}else y.param_no?h=c[y.param_no]:h=c[l++];if(t.not_type.test(y.type)&&t.not_primitive.test(y.type)&&h instanceof Function&&(h=h()),t.numeric_arg.test(y.type)&&typeof h!="number"&&isNaN(h))throw new TypeError(n("[sprintf] expecting number but found %T",h));switch(t.number.test(y.type)&&(b=h>=0),y.type){case"b":h=parseInt(h,10).toString(2);break;case"c":h=String.fromCharCode(parseInt(h,10));break;case"d":case"i":h=parseInt(h,10);break;case"j":h=JSON.stringify(h,null,y.width?parseInt(y.width):0);break;case"e":h=y.precision?parseFloat(h).toExponential(y.precision):parseFloat(h).toExponential();break;case"f":h=y.precision?parseFloat(h).toFixed(y.precision):parseFloat(h);break;case"g":h=y.precision?String(Number(h.toPrecision(y.precision))):parseFloat(h);break;case"o":h=(parseInt(h,10)>>>0).toString(8);break;case"s":h=String(h),h=y.precision?h.substring(0,y.precision):h;break;case"t":h=String(!!h),h=y.precision?h.substring(0,y.precision):h;break;case"T":h=Object.prototype.toString.call(h).slice(8,-1).toLowerCase(),h=y.precision?h.substring(0,y.precision):h;break;case"u":h=parseInt(h,10)>>>0;break;case"v":h=h.valueOf(),h=y.precision?h.substring(0,y.precision):h;break;case"x":h=(parseInt(h,10)>>>0).toString(16);break;case"X":h=(parseInt(h,10)>>>0).toString(16).toUpperCase();break}t.json.test(y.type)?f+=h:(t.number.test(y.type)&&(!b||y.sign)?(x=b?"+":"-",h=h.toString().replace(t.sign,"")):x="",d=y.pad_char?y.pad_char==="0"?"0":y.pad_char.charAt(1):" ",g=y.width-(x+h).length,v=y.width&&g>0?d.repeat(g):"",f+=y.align?x+h+v:d==="0"?x+v+h:v+x+h)}return f}var o=Object.create(null);function s(a){if(o[a])return o[a];for(var c=a,l,u=[],h=0;c;){if((l=t.text.exec(c))!==null)u.push(l[0]);else if((l=t.modulo.exec(c))!==null)u.push("%");else if((l=t.placeholder.exec(c))!==null){if(l[2]){h|=1;var f=[],p=l[2],m=[];if((m=t.key.exec(p))!==null)for(f.push(m[1]);(p=p.substring(m[0].length))!=="";)if((m=t.key_access.exec(p))!==null)f.push(m[1]);else if((m=t.index_access.exec(p))!==null)f.push(m[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");l[2]=f}else h|=2;if(h===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");u.push({placeholder:l[0],param_no:l[1],keys:l[2],sign:l[3],pad_char:l[4],align:l[5],width:l[6],precision:l[7],type:l[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");c=c.substring(l[0].length)}return o[a]=u}e.sprintf=n,e.vsprintf=i,typeof window<"u"&&(window.sprintf=n,window.vsprintf=i)})()})(Bi);var F3,$1,N3,z3,U3;function eF(e){if(typeof window<"u"){var t=new RegExp(e+"=([^&#=]*)").exec(window.location.search);return t?decodeURIComponent(t[1]):void 0}}function O(e,t){return e!==void 0?e:t}function br(e,t){var n=Object.assign({},e);for(var i in t)e[i]===void 0&&(n[i]=t[i]);return n}function mT(e,t){for(var n in t){var i=t[n];i!==void 0&&(e[n]=i)}return e}function A_(){var e=window.location.protocol;return e.match(/http(s)?:/gi)===null?"http:":e}function gT(){if(typeof window>"u")return!1;var e=window.navigator.userAgent;return/Opera|OPR/.test(e)?"Opera":/Chrome/i.test(e)?"Chrome":/Firefox/i.test(e)?"Firefox":/Mobile(\/.*)? Safari/i.test(e)?"Mobile Safari":/MSIE/i.test(e)?"Internet Explorer":!!/Safari/i.test(e)&&"Safari"}function G3(e){window.open(e,"_blank")||(window.location.href=e)}function tF(e,t){if(t===void 0&&(t="download"),e){var n=gT()==="Safari",i=/CriOS\/[\d]+/.test(window.navigator.userAgent),r=document.createElement("a");if(typeof navigator<"u"&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else if((n||i)&&FileReader)if(e instanceof Blob){var o=new FileReader;o.onloadend=function(){a(o.result)},o.readAsDataURL(e)}else a(e);else{var s=!1;e instanceof Blob&&(e=URL.createObjectURL(e),s=!0),"download"in r?(r.style.display="hidden",document.body.appendChild(r),r.href=e,r.download=t,r.target="_blank",r.click(),document.body.removeChild(r)):G3(e),s&&window.URL.revokeObjectURL(e)}}function a(c){G3(i?c:c.replace(/^data:[^;]*;/,"data:attachment/file;"))}}function nF(e,t){return e<t?-1:e>t?1:0}function Ka(e,t,n){n===void 0&&(n=nF);for(var i=0,r=e.length-1;i<=r;){var o=i+r>>1,s=n(t,e[o]);if(s>0)i=o+1;else{if(!(s<0))return o;r=o-1}}return-i-1}function C_(e,t,n){var i=function(o,s){var a=o.length-1;if(o[a]<s)return-1;for(var c=0;c<=a;){var l=c+a>>1;o[l]>=s?a=l-1:c=l+1}return a+1}(e,t),r=function(o,s){if(o[0]>s)return-1;for(var a=0,c=o.length-1;a<=c;){var l=a+c>>1;o[l]>s?c=l-1:a=l+1}return a-1}(e,n);return i===-1||r===-1||i>r?0:r-i+1}function P_(e){return e.sort().filter(function(t,n,i){return n===0||t!==i[n-1]})}function Bg(e){var t=28672;if(e.length>t){for(var n=[],i=0;i<e.length;i+=t)n.push(String.fromCharCode.apply(null,e.subarray(i,i+t)));return n.join("")}return String.fromCharCode.apply(null,e)}function yT(e,t){switch(e){case"int8":return new Int8Array(t);case"int16":return new Int16Array(t);case"int32":return new Int32Array(t);case"uint8":return new Uint8Array(t);case"uint16":return new Uint16Array(t);case"uint32":return new Uint32Array(t);case"float32":return new Float32Array(t);default:throw new Error("arrayType unknown: "+e)}}function Ho(e,t){return new(t>65535?Uint32Array:Uint16Array)(e)}function ku(e){return e.buffer&&e.buffer instanceof ArrayBuffer?e.buffer:e}function y0(e,t){return e===void 0?e=new t:Array.isArray(e)&&(e=new t().fromArray(e)),e}function ac(e){return y0(e,T)}function Eh(e){return y0(e,De)}function $x(e){return y0(e,un)}function V1(e){return t=e,n=Float32Array,t instanceof n?t:new n(t);var t,n}function $3(e){return O(e,"").toString().toLowerCase()}typeof window<"u"&&function(){window.console=window.console||{};for(var e,t,n=window.console,i={},r=function(){},o="memory".split(","),s="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");e=o.pop();)n[e]||(n[e]=i);for(;t=s.pop();)n[t]||(n[t]=r)}(),typeof window>"u"||window.HTMLCanvasElement===void 0||window.HTMLCanvasElement.prototype.toBlob||Object.defineProperty(window.HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,n){for(var i=window.atob(this.toDataURL(t,n).split(",")[1]),r=i.length,o=r>>2,s=new Uint8Array(r),a=new Uint32Array(s.buffer,0,o),c=0,l=0;c<o;c++)a[c]=i.charCodeAt(l++)|i.charCodeAt(l++)<<8|i.charCodeAt(l++)<<16|i.charCodeAt(l++)<<24;for(var u=3&r;u--;)s[l]=i.charCodeAt(l++);e(new window.Blob([s],{type:t||"image/png"}))}}),Math.cbrt=Math.cbrt||function(e){var t=Math.pow(Math.abs(e),.3333333333333333);return e<0?-t:t},Math.sign||(Math.sign=function(e){return(e=+e)==0||isNaN(e)?Number(e):e>0?1:-1}),Number.isInteger||(Number.isInteger=function(e){return typeof e=="number"&&isFinite(e)&&e>-9007199254740992&&e<9007199254740992&&Math.floor(e)===e}),Number.isNaN||(Number.isNaN=function(e){return e!=e}),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=arguments;if(e==null)throw new TypeError("Cannot convert first argument to object");for(var n,i=Object(e),r=!1,o=1;o<arguments.length;o++){var s=t[o];if(s!=null){for(var a=Object.keys(Object(s)),c=0,l=a.length;c<l;c++){var u=a[c];try{var h=Object.getOwnPropertyDescriptor(s,u);h!==void 0&&h.enumerable&&(i[u]=s[u])}catch(f){r||(r=!0,n=f)}}if(r)throw n}}return i}}),String.prototype.startsWith||function(){var e=function(){var i;try{var r={},o=Object.defineProperty;i=o(r,r,r)&&o}catch{}return i}(),t={}.toString,n=function(i){if(this===null)throw TypeError();var r=String(this);if(i&&t.call(i)==="[object RegExp]")throw TypeError();var o=r.length,s=String(i),a=s.length,c=arguments.length>1?arguments[1]:void 0,l=c?Number(c):0;Number.isNaN(l)&&(l=0);var u=Math.min(Math.max(l,0),o);if(a+u>o)return!1;for(var h=-1;++h<a;)if(r.charCodeAt(u+h)!==s.charCodeAt(h))return!1;return!0};e?e(String.prototype,"startsWith",{value:n,configurable:!0,writable:!0}):String.prototype.startsWith=n}(),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var n=this.toString();(typeof t!="number"||!isFinite(t)||Math.floor(t)!==t||t>n.length)&&(t=n.length),t-=e.length;var i=n.indexOf(e,t);return i!==-1&&i===t}),String.prototype.repeat||(String.prototype.repeat=function(e){if(this===null)throw new TypeError("can't convert "+this+" to object");var t=""+this;if(e=+e,Number.isNaN(e)&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e===1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),t.length===0||e===0)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var n="";(1&e)==1&&(n+=t),(e>>>=1)!==0;)t+=t;return n}),String.prototype.includes||(String.prototype.includes=function(e,t){return typeof t!="number"&&(t=0),!(t+e.length>this.length)&&this.indexOf(e,t)!==-1}),Array.prototype.includes||(Array.prototype.includes=function(e){if(this==null)throw new TypeError("Array.prototype.includes called on null or undefined");var t=Object(this),n=parseInt(t.length,10)||0;if(n===0)return!1;var i,r,o=parseInt(arguments[1],10)||0;for(o>=0?i=o:(i=n+o)<0&&(i=0);i<n;){if(e===(r=t[i])||Number.isNaN(e)&&Number.isNaN(r))return!0;i++}return!1}),Array.from||(Array.from=(F3=Object.prototype.toString,$1=function(e){return typeof e=="function"||F3.call(e)==="[object Function]"},N3=Math.pow(2,53)-1,z3=function(e){var t=function(n){var i=Number(n);return isNaN(i)?0:i!==0&&isFinite(i)?(i>0?1:-1)*Math.floor(Math.abs(i)):i}(e);return Math.min(Math.max(t,0),N3)},function(e){var t=this,n=Object(e);if(e==null)throw new TypeError("Array.from requires an array-like object - not null or undefined");var i,r=arguments.length>1?arguments[1]:void 0;if(r!==void 0){if(!$1(r))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(i=arguments[2])}for(var o,s=z3(n.length),a=$1(t)?Object(new t(s)):new Array(s),c=0;c<s;)o=n[c],a[c]=r?i===void 0?r(o,c):r.call(i,o,c):o,c+=1;return a.length=s,a})),typeof window<"u"&&function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(i){var r=new Date().getTime(),o=Math.max(0,16-(r-e)),s=window.setTimeout(function(){i(r+o)},o);return e=r+o,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(i){clearTimeout(i)})}(),Function.prototype.name===void 0&&Object.defineProperty!==void 0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}}),typeof window<"u"&&(window.performance===void 0&&(self.performance={}),window.performance.now===void 0&&(U3=Date.now(),window.performance.now=function(){return Date.now()-U3})),Object.defineProperty!==void 0&&(Number.MAX_SAFE_INTEGER===void 0&&Object.defineProperty(Number,"MAX_SAFE_INTEGER",{enumerable:!1,configurable:!1,writable:!1,value:Math.pow(2,53)-1}),Number.MIN_SAFE_INTEGER===void 0&&Object.defineProperty(Number,"MIN_SAFE_INTEGER",{enumerable:!1,configurable:!1,writable:!1,value:-(Math.pow(2,53)-1)}));var ao=function(e){this.name=e,this._dict={}},V3={names:{configurable:!0}};function Tn(e){return .01745*e}ao.prototype.add=function(e,t){this._dict[$3(e)]=t},ao.prototype.get=function(e){return this._dict[$3(e)]},V3.names.get=function(){return Object.keys(this._dict)},Object.defineProperties(ao.prototype,V3);var iF="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),Ed=new Array(36);function T_(){for(var e,t=0,n=0;n<36;n++)n===8||n===13||n===18||n===23?Ed[n]="-":n===14?Ed[n]="4":(t<=2&&(t=33554432+16777216*Math.random()|0),e=15&t,t>>=4,Ed[n]=iF[n===19?3&e|8:e]);return Ed.join("")}function Vx(e,t,n){return Math.max(t,Math.min(n,e))}function Tr(e,t,n){return e+(t-e)*n}function as(e,t,n,i,r,o){var s=(n-e)*o,a=(i-t)*o,c=r*r;return(2*t-2*n+s+a)*(r*c)+(-3*t+3*n-2*s-a)*c+s*r+t}function _p(e,t,n){var i;return i=function(r,o,s){return(r-o)/(s-o)}(n,e,t),(n=Vx(i,0,1))*n*(3-2*n)}var vT="sRGB",rF={scale:"uniform",mode:"hcl",domain:[0,1],value:16777215,reverse:!1},um=new Fe;function Kt(e,t,n){var i=n.value;return n.value=function(r,o){var s=i.bind(this,r,o)();return vT=="linear"?(um.set(s),um.convertSRGBToLinear(),um.getHex()):s},n}var st,Ft=function(e){e===void 0&&(e={}),this.parameters=br(e,rF),typeof this.parameters.value=="string"&&(this.parameters.value=um.set(this.parameters.value).getHex()),this.parameters.structure&&(this.atomProxy=this.parameters.structure.getAtomProxy())};Ft.prototype.getScale=function(e){e===void 0&&(e={});var t=br(e,this.parameters);return t.scale==="rainbow"?t.scale=["red","orange","yellow","green","blue"]:t.scale==="rwb"&&(t.scale=["red","white","blue"]),t.reverse&&(t.domain=t.domain.slice().reverse()),Dg.scale(t.scale).mode(t.mode).domain(t.domain).out("num")},Ft.prototype.colorToArray=function(e,t,n){return t===void 0&&(t=[]),n===void 0&&(n=0),t[n]=(e>>16&255)/255,t[n+1]=(e>>8&255)/255,t[n+2]=(255&e)/255,t},Ft.prototype.atomColorToArray=function(e,t,n){return this.colorToArray(this.atomColor?this.atomColor(e):0,t,n)},Ft.prototype.bondColor=function(e,t){return this.atomProxy&&this.atomColor?(this.atomProxy.index=t?e.atomIndex1:e.atomIndex2,this.atomColor(this.atomProxy)):0},Ft.prototype.bondColorToArray=function(e,t,n,i){return this.colorToArray(this.bondColor(e,t),n,i)},Ft.prototype.volumeColorToArray=function(e,t,n){return this.colorToArray(this.volumeColor?this.volumeColor(e):0,t,n)},Ft.prototype.positionColorToArray=function(e,t,n){return this.colorToArray(this.positionColor?this.positionColor(e):0,t,n)},function(e){e[e.PROTEIN=1]="PROTEIN",e[e.NUCLEIC=2]="NUCLEIC",e[e.RNA=3]="RNA",e[e.DNA=4]="DNA",e[e.POLYMER=5]="POLYMER",e[e.WATER=6]="WATER",e[e.HELIX=7]="HELIX",e[e.SHEET=8]="SHEET",e[e.TURN=9]="TURN",e[e.BACKBONE=10]="BACKBONE",e[e.SIDECHAIN=11]="SIDECHAIN",e[e.ALL=12]="ALL",e[e.HETERO=13]="HETERO",e[e.ION=14]="ION",e[e.SACCHARIDE=15]="SACCHARIDE",e[e.SUGAR=15]="SUGAR",e[e.BONDED=16]="BONDED",e[e.RING=17]="RING",e[e.AROMATICRING=18]="AROMATICRING",e[e.METAL=19]="METAL",e[e.POLARH=20]="POLARH",e[e.NONE=21]="NONE"}(st||(st={}));var H3=["*","","ALL"],oF=["NONE"],E_=[st.BACKBONE,st.SIDECHAIN,st.BONDED,st.RING,st.AROMATICRING,st.METAL,st.POLARH],xT=[st.POLYMER,st.WATER],sF=["ALA","GLY","SER"],aF=["CYS","SER","THR"],cF=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],lF=["PHE","TRP","TYR","HIS"],uF=["ASN","GLN"],hF=["ASP","GLU"],fF=["ARG","HIS","LYS"],pF=["ARG","ASP","GLU","HIS","LYS"],dF=["ASN","ARG","ASP","CYS","GLY","GLN","GLU","HIS","LYS","SER","THR","TYR"],mF=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],gF=["HIS","PHE","PRO","TRP","TYR"],yF=["ALA","GLY","ILE","LEU","VAL"];function vF(e,t){if(t.atomname===void 0&&t.element===void 0&&t.altloc===void 0&&t.atomindex===void 0&&t.keyword===void 0&&t.inscode===void 0&&t.resname===void 0&&t.sstruc===void 0&&t.resno===void 0&&t.chainname===void 0&&t.model===void 0)return-1;if(t.keyword!==void 0&&(t.keyword===st.BACKBONE&&!e.isBackbone()||t.keyword===st.SIDECHAIN&&!e.isSidechain()||t.keyword===st.BONDED&&!e.isBonded()||t.keyword===st.RING&&!e.isRing()||t.keyword===st.AROMATICRING&&!e.isAromatic()||t.keyword===st.HETERO&&!e.isHetero()||t.keyword===st.PROTEIN&&!e.isProtein()||t.keyword===st.NUCLEIC&&!e.isNucleic()||t.keyword===st.RNA&&!e.isRna()||t.keyword===st.DNA&&!e.isDna()||t.keyword===st.POLYMER&&!e.isPolymer()||t.keyword===st.WATER&&!e.isWater()||t.keyword===st.HELIX&&!e.isHelix()||t.keyword===st.SHEET&&!e.isSheet()||t.keyword===st.TURN&&!e.isTurn()||t.keyword===st.ION&&!e.isIon()||t.keyword===st.SACCHARIDE&&!e.isSaccharide()||t.keyword===st.METAL&&!e.isMetal()||t.keyword===st.POLARH&&!e.isPolarHydrogen())||t.atomname!==void 0&&t.atomname!==e.atomname||t.element!==void 0&&t.element!==e.element||t.altloc!==void 0&&t.altloc!==e.altloc||t.atomindex!==void 0&&Ka(t.atomindex,e.index)<0)return!1;if(t.resname!==void 0){if(Array.isArray(t.resname)){if(!t.resname.includes(e.resname))return!1}else if(t.resname!==e.resname)return!1}if(t.sstruc!==void 0&&t.sstruc!==e.sstruc)return!1;if(t.resno!==void 0){if(Array.isArray(t.resno)&&t.resno.length===2){if(t.resno[0]>e.resno||t.resno[1]<e.resno)return!1}else if(t.resno!==e.resno)return!1}return(t.inscode===void 0||t.inscode===e.inscode)&&(t.chainname===void 0||t.chainname===e.chainname)&&(t.model===void 0||t.model===e.modelIndex)}function xF(e,t){if(t.resname===void 0&&t.resno===void 0&&t.inscode===void 0&&t.sstruc===void 0&&t.model===void 0&&t.chainname===void 0&&t.atomindex===void 0&&(t.keyword===void 0||E_.includes(t.keyword)))return-1;if(t.keyword!==void 0&&(t.keyword===st.HETERO&&!e.isHetero()||t.keyword===st.PROTEIN&&!e.isProtein()||t.keyword===st.NUCLEIC&&!e.isNucleic()||t.keyword===st.RNA&&!e.isRna()||t.keyword===st.DNA&&!e.isDna()||t.keyword===st.POLYMER&&!e.isPolymer()||t.keyword===st.WATER&&!e.isWater()||t.keyword===st.HELIX&&!e.isHelix()||t.keyword===st.SHEET&&!e.isSheet()||t.keyword===st.TURN&&!e.isTurn()||t.keyword===st.ION&&!e.isIon()||t.keyword===st.SACCHARIDE&&!e.isSaccharide())||t.atomindex!==void 0&&C_(t.atomindex,e.atomOffset,e.atomEnd)===0)return!1;if(t.resname!==void 0){if(Array.isArray(t.resname)){if(!t.resname.includes(e.resname))return!1}else if(t.resname!==e.resname)return!1}if(t.sstruc!==void 0&&t.sstruc!==e.sstruc)return!1;if(t.resno!==void 0){if(Array.isArray(t.resno)&&t.resno.length===2){if(t.resno[0]>e.resno||t.resno[1]<e.resno)return!1}else if(t.resno!==e.resno)return!1}return(t.inscode===void 0||t.inscode===e.inscode)&&(t.chainname===void 0||t.chainname===e.chainname)&&(t.model===void 0||t.model===e.modelIndex)}function bF(e,t){return t.chainname!==void 0||t.model!==void 0||t.atomindex!==void 0||t.keyword!==void 0&&xT.includes(t.keyword)&&e.entity?t.keyword!==void 0&&(t.keyword===st.POLYMER&&!e.entity.isPolymer()||t.keyword===st.WATER&&!e.entity.isWater())?!1:(t.atomindex===void 0||C_(t.atomindex,e.atomOffset,e.atomEnd)!==0)&&(t.chainname===void 0||t.chainname===e.chainname)&&(t.model===void 0||t.model===e.modelIndex):-1}function _F(e,t){return t.model===void 0&&t.atomindex===void 0?-1:(t.atomindex===void 0||C_(t.atomindex,e.atomOffset,e.atomEnd)!==0)&&(t.model===void 0||t.model===e.index)}function wp(e,t){if(e===null||e.error||!e.rules||e.rules.length===0)return!1;for(var n=e.rules.length,i=!e.negate,r=!!e.negate,o=[],s=0;s<n;++s){var a=e.rules[s];a.hasOwnProperty("operator")&&(o[s]=wp(a,t))}return function(c){for(var l=e.operator==="AND",u=!1,h=0;h<n;++h){var f=e.rules[h],p=void 0;if(f.hasOwnProperty("operator")){var m=o[h];if((p=m!==!1?m(c):-1)===-1){u=!0;continue}if(p===!0){if(l)continue;return i}if(l)return r}else{if(f.keyword===st.ALL){if(l)continue;return i}if(f.keyword===st.NONE){if(l)continue;return r}if((p=t(c,f))!==-1){if(p===!0){if(l)continue;return i}if(l)return r}else u=!0}}return u?-1:l?i:r}}function Sp(e,t){if(e.error||!e.rules||e.rules.length===0)return e;var n=e.rules.length,i={operator:e.operator,rules:[]};e.hasOwnProperty("negate")&&(i.negate=e.negate);for(var r=0;r<n;++r){var o=e.rules[r];if(o.hasOwnProperty("operator")){var s=Sp(o,t);s!==null&&i.rules.push(s)}else t(o)||i.rules.push(o)}return i.rules.length>0?e:null}function j3(e,t){t===void 0&&(t=!1);var n=e;return t&&(n=Sp(e,function(i){return i.keyword!==void 0&&!E_.includes(i.keyword)||i.model!==void 0||i.chainname!==void 0||i.resname!==void 0||i.resno!==void 0||i.sstruc!==void 0})),wp(n,vF)}function W3(e,t){t===void 0&&(t=!1);var n=e;return t&&(n=Sp(e,function(i){return!(i.keyword===void 0||!E_.includes(i.keyword))||i.model!==void 0||i.chainname!==void 0||i.atomname!==void 0||i.element!==void 0||i.altloc!==void 0})),wp(n,xF)}function q3(e,t){t===void 0&&(t=!1);var n=e;return t&&(n=Sp(e,function(i){return i.keyword!==void 0&&!xT.includes(i.keyword)||i.resname!==void 0||i.resno!==void 0||i.atomname!==void 0||i.element!==void 0||i.altloc!==void 0||i.sstruc!==void 0||i.inscode!==void 0})),wp(n,bF)}function X3(e,t){t===void 0&&(t=!1);var n=e;return t&&(n=Sp(e,function(i){return i.keyword!==void 0||i.chainname!==void 0||i.resname!==void 0||i.resno!==void 0||i.atomname!==void 0||i.element!==void 0||i.altloc!==void 0||i.sstruc!==void 0||i.inscode!==void 0})),wp(n,_F)}var Jt=function(e){this.signals={stringChanged:new yt.Signal},this.setString(e)},Y3={type:{configurable:!0}};Y3.type.get=function(){return"selection"},Jt.prototype.setString=function(e,t){if(e===void 0&&(e=this.string||""),e!==this.string){try{this.selection=function(i){var r={operator:void 0,rules:[]};if(!i)return r;var o,s,a=r,c=[];(i=i.replace(/\(/g," ( ").replace(/\)/g," ) ").trim()).charAt(0)==="("&&i.substr(-1)===")"&&(i=i.slice(1,-1).trim());for(var l=i.split(/\s+/),u=function($){o={operator:$,rules:[]},a===void 0?(a=o,r=o):(a.rules.push(o),c.push(a),a=o)},h=function($){s=a,(a=c.pop())===void 0&&(u($),f(s))},f=function($){a.rules.push($)},p=!1,m=0;m<l.length;++m){var y=l[m],v=y.toUpperCase();if(y!=="(")if(y!==")"){if(p>0)if(v==="NOT")p=1;else if(p===1)p=2;else{if(p!==2)throw new Error("something went wrong with 'not'");p=!1,h()}if(v!=="AND")if(v!=="OR")if(y.toUpperCase()!=="NOT"){if(+v!=+v){var d=st[v];if(d!==void 0){f({keyword:d});continue}}if(v!=="HYDROGEN")if(v!=="SMALL")if(v!=="NUCLEOPHILIC")if(v!=="HYDROPHOBIC")if(v!=="AROMATIC")if(v!=="AMIDE")if(v!=="ACIDIC")if(v!=="BASIC")if(v!=="CHARGED")if(v!=="POLAR")if(v!=="NONPOLAR")if(v!=="CYCLIC")if(v!=="ALIPHATIC")if(v!=="SIDECHAINATTACHED")if(v!=="APOLARH")if(v!=="LIGAND")if(H3.indexOf(v)===-1)if(y.charAt(0)!=="@")if(y.charAt(0)!=="#")if(y.charAt(0)!=="_")if(y[0]!=="["||y[y.length-1]!=="]")if(y.length>=1&&y.length<=4&&y[0]!=="^"&&y[0]!==":"&&y[0]!=="."&&y[0]!=="%"&&y[0]!=="/"&&isNaN(parseInt(y)))f({resname:v});else{var g={operator:"AND",rules:[]},b=y.split("/");if(b.length>1&&b[1]){if(isNaN(parseInt(b[1])))throw new Error("model must be an integer");g.rules.push({model:parseInt(b[1])})}var x=b[0].split("%");x.length>1&&g.rules.push({altloc:x[1]});var _=x[0].split(".");if(_.length>1&&_[1]){if(_[1].length>4)throw new Error("atomname must be one to four characters");g.rules.push({atomname:_[1].substring(0,4).toUpperCase()})}var S=_[0].split(":");S.length>1&&S[1]&&g.rules.push({chainname:S[1]});var w=S[0].split("^");if(w.length>1&&g.rules.push({inscode:w[1]}),w[0]){var C=void 0,A=void 0;w[0][0]==="-"&&(w[0]=w[0].substr(1),C=!0),w[0].includes("--")&&(w[0]=w[0].replace("--","-"),A=!0);var k=w[0].split("-");if(k.length===1){var L=parseInt(k[0]);if(isNaN(L))throw new Error("resi must be an integer");C&&(L*=-1),g.rules.push({resno:L})}else{if(k.length!==2)throw new Error("resi range must contain one '-'");var D=k.map(function($){return parseInt($)});C&&(D[0]*=-1),A&&(D[1]*=-1),g.rules.push({resno:[D[0],D[1]]})}}if(g.rules.length===1)f(g.rules[0]);else{if(!(g.rules.length>1))throw new Error("empty selection chunk");f(g)}}else{var F=v.substr(1,y.length-2).split(","),I=F.length>1?F:F[0];f({resname:I})}else f({element:v.substr(1)});else console.error("# for element selection deprecated, use _"),f({element:v.substr(1)});else{var P=y.substr(1).split(",").map(function($){return parseInt($)});P.sort(function($,B){return $-B}),f({atomindex:P})}else f({keyword:st.ALL});else f({operator:"AND",rules:[{operator:"OR",rules:[{operator:"AND",rules:[{keyword:st.HETERO},{negate:!0,operator:void 0,rules:[{keyword:st.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{keyword:st.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{operator:"OR",rules:[{keyword:st.WATER},{keyword:st.ION}]}]}]});else f({operator:"AND",negate:!1,rules:[{element:"H"},{negate:!0,operator:void 0,rules:[{keyword:st.POLARH}]}]});else f({operator:"OR",rules:[{keyword:st.SIDECHAIN},{operator:"AND",negate:!1,rules:[{keyword:st.PROTEIN},{operator:"OR",negate:!1,rules:[{atomname:"CA"},{atomname:"BB"}]}]},{operator:"AND",negate:!1,rules:[{resname:"PRO"},{atomname:"N"}]},{operator:"AND",negate:!1,rules:[{keyword:st.NUCLEIC},{operator:"OR",negate:!0,rules:[{atomname:"P"},{atomname:"OP1"},{atomname:"OP2"},{atomname:"O3'"},{atomname:"O3*"},{atomname:"HO3'"},{atomname:"O5'"},{atomname:"O5*"},{atomname:"HO5'"},{atomname:"C5'"},{atomname:"C5*"},{atomname:"H5'"},{atomname:"H5''"}]}]}]});else f({resname:yF});else f({resname:gF});else f({resname:mF});else f({resname:dF});else f({resname:pF});else f({resname:fF});else f({resname:hF});else f({resname:uF});else f({resname:lF});else f({resname:cF});else f({resname:aF});else f({resname:sF});else f({operator:"OR",rules:[{element:"H"},{element:"D"}]})}else p=1,u(),a.negate=!0;else a.operator==="AND"?h("OR"):a.operator="OR";else if(a.operator==="OR"){var N=a.rules.pop();u("AND"),f(N)}else a.operator="AND"}else h(),a.negate&&h();else p=!1,u()}return r.operator===void 0&&r.rules.length===1&&r.rules[0].hasOwnProperty("operator")&&(r=r.rules[0]),r}(e)}catch(i){this.selection={error:i.message}}var n=this.selection;this.string=e,this.test=j3(n),this.residueTest=W3(n),this.chainTest=q3(n),this.modelTest=X3(n),this.atomOnlyTest=j3(n,!0),this.residueOnlyTest=W3(n,!0),this.chainOnlyTest=q3(n,!0),this.modelOnlyTest=X3(n,!0),t||this.signals.stringChanged.dispatch(this.string)}},Jt.prototype.isAllSelection=function(){return H3.includes(this.string.toUpperCase())},Jt.prototype.isNoneSelection=function(){return oF.includes(this.string.toUpperCase())},Object.defineProperties(Jt.prototype,Y3);var wF=function(e){function t(n){var i=this;e.call(this,n),this.colormakerList=[],this.selectionList=[],(n.dataList||[]).forEach(function(r){var o=r[0],s=r[1],a=r[2];a===void 0&&(a={}),Rt.hasScheme(o)?Object.assign(a,{scheme:o,structure:i.parameters.structure}):Object.assign(a,{scheme:"uniform",value:new Fe(o).getHex()}),i.colormakerList.push(Rt.getScheme(a)),i.selectionList.push(new Jt(s))})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){for(var i=0,r=this.selectionList.length;i<r;++i){var o=this.selectionList[i].test;if(o&&o(n))return this.colormakerList[i].atomColor(n)}return 16777215},t}(Ft),SF={"":"",OrRd:"[S] Orange-Red",PuBu:"[S] Purple-Blue",BuPu:"[S] Blue-Purple",Oranges:"[S] Oranges",BuGn:"[S] Blue-Green",YlOrBr:"[S] Yellow-Orange-Brown",YlGn:"[S] Yellow-Green",Reds:"[S] Reds",RdPu:"[S] Red-Purple",Greens:"[S] Greens",YlGnBu:"[S] Yellow-Green-Blue",Purples:"[S] Purples",GnBu:"[S] Green-Blue",Greys:"[S] Greys",YlOrRd:"[S] Yellow-Orange-Red",PuRd:"[S] Purple-Red",Blues:"[S] Blues",PuBuGn:"[S] Purple-Blue-Green",Viridis:"[D] Viridis",Spectral:"[D] Spectral",RdYlGn:"[D] Red-Yellow-Green",RdBu:"[D] Red-Blue",PiYG:"[D] Pink-Yellowgreen",PRGn:"[D] Purplered-Green",RdYlBu:"[D] Red-Yellow-Blue",BrBG:"[D] Brown-Bluegreen",RdGy:"[D] Red-Grey",PuOr:"[D] Purple-Orange",Set1:"[Q] Set1",Set2:"[Q] Set2",Set3:"[Q] Set3",Dark2:"[Q] Dark2",Paired:"[Q] Paired",Pastel1:"[Q] Pastel1",Pastel2:"[Q] Pastel2",Accent:"[Q] Accent",rainbow:"[?] Rainbow",rwb:"[?] Red-White-Blue"},MF={"":"",rgb:"Red Green Blue",hsv:"Hue Saturation Value",hsl:"Hue Saturation Lightness",hsi:"Hue Saturation Intensity",lab:"CIE L*a*b*",hcl:"Hue Chroma Lightness"},Mr=function(){this.schemes={},this.userSchemes={}};Mr.prototype.getScheme=function(e){var t=((e||{}).scheme||"").toLowerCase();return new(t in this.schemes?this.schemes[t]:t in this.userSchemes?this.userSchemes[t]:Ft)(e)},Mr.prototype.getSchemes=function(){var e={};return Object.keys(this.schemes).forEach(function(t){e[t]=t}),Object.keys(this.userSchemes).forEach(function(t){e[t]=t.split("|")[1]}),e},Mr.prototype.getScales=function(){return SF},Mr.prototype.getModes=function(){return MF},Mr.prototype.add=function(e,t){e=e.toLowerCase(),this.schemes[e]=t},Mr.prototype.addScheme=function(e,t){return e instanceof Ft||(e=this._createScheme(e)),this._addUserScheme(e,t)},Mr.prototype._addUserScheme=function(e,t){t=t||"";var n=(T_()+"|"+t).toLowerCase();return this.userSchemes[n]=e,n},Mr.prototype.removeScheme=function(e){e=e.toLowerCase(),delete this.userSchemes[e]},Mr.prototype._createScheme=function(e){var t=function(n){Ft.call(this,n),e.call(this,n)};return(t.prototype=Ft.prototype).constructor=Ft,t},Mr.prototype.addSelectionScheme=function(e,t){var n=function(i){function r(o){i.call(this,Object.assign({dataList:e},o))}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r}(wF);return this._addUserScheme(n,t)},Mr.prototype.hasScheme=function(e){return(e=e.toLowerCase())in this.schemes||e in this.userSchemes};var AF=function(e){function t(){e.call(this,"parser")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.__hasObjName=function(n,i){var r=this.get(n);return r&&r.prototype.__objName===i},t.prototype.isTrajectory=function(n){return this.__hasObjName(n,"frames")},t.prototype.isStructure=function(n){return this.__hasObjName(n,"structure")},t.prototype.isVolume=function(n){return this.__hasObjName(n,"volume")},t.prototype.isSurface=function(n){return this.__hasObjName(n,"surface")},t.prototype.isBinary=function(n){var i=this.get(n);return i&&i.prototype.isBinary},t.prototype.isXml=function(n){var i=this.get(n);return i&&i.prototype.isXml},t.prototype.isJson=function(n){var i=this.get(n);return i&&i.prototype.isJson},t.prototype.getTrajectoryExtensions=function(){var n=this;return this.names.filter(function(i){return n.isTrajectory(i)})},t.prototype.getStructureExtensions=function(){var n=this;return this.names.filter(function(i){return n.isStructure(i)})},t.prototype.getVolumeExtensions=function(){var n=this;return this.names.filter(function(i){return n.isVolume(i)})},t.prototype.getSurfaceExtensions=function(){var n=this;return this.names.filter(function(i){return n.isSurface(i)})},t}(ao);function bT(e){var t=e;return e.forEach(function(n){n.__deps&&Array.prototype.push.apply(t,bT(n.__deps))}),t}function CF(e){return P_(bT(e)).map(function(t){return t.toString()}).join(`


`)}function PF(e){var t=e.data.__name,n=e.data.__postId;t===void 0?console.error("message __name undefined"):self.func===void 0?console.error("worker func undefined",t):self.func(e,function(i,r){i=i||{},n!==void 0&&(i.__postId=n);try{self.postMessage(i,r)}catch(o){console.error("self.postMessage:",o),self.postMessage(i)}})}function TF(e,t){var n=`'use strict';

`+CF(t);return n+=`


self.func = `+e.toString()+";",n+=`


self.onmessage = `+PF.toString()+";",new Blob([n],{type:"application/javascript"})}var Hx=function(){this.activeWorkerCount=0,this._funcDict={},this._depsDict={},this._blobDict={}};Hx.prototype.add=function(e,t,n){this._funcDict[e]=t,this._depsDict[e]=n},Hx.prototype.get=function(e){return this._blobDict[e]||(this._blobDict[e]=TF(this._funcDict[e],this._depsDict[e])),this._blobDict[e]};var _T=gT(),wT=!1;try{var EF=Object.defineProperty({},"passive",{get:function(){wT=!0}});window.addEventListener("test",function(e){},EF)}catch{}var ST=typeof window<"u"&&window.orientation!==void 0,ea=!1;function Z3(e){ea=e}var Fo=!1;function K3(e){Fo=e}var de={log:Function.prototype.bind.call(console.log,console),info:Function.prototype.bind.call(console.info,console),warn:Function.prototype.bind.call(console.warn,console),error:Function.prototype.bind.call(console.error,console),time:Function.prototype.bind.call(console.time,console),timeEnd:Function.prototype.bind.call(console.timeEnd,console)},uh={color:"green",labelColor:8421504,labelAttachment:"bottom-center",labelSize:.7,labelZOffset:.5,labelYOffset:.1,labelBorder:!0,labelBorderColor:13882323,labelBorderWidth:.25,lineOpacity:.8,linewidth:5,opacity:.6,labelUnit:"angstrom",arcVisible:!0,planeVisible:!1},H1,Pe=!!(H1=eF("debug"))&&(typeof H1!="string"||/^1|true|t|yes|y$/i.test(H1)),j1,IF=["ngl","js"],tp=new Hx,Rt=new Mr,cc=new ao("datasource"),yn=new ao("representatation"),ft=new AF,jt=new ao("shader"),I_=new ao("decompressor"),Mu=new ao("component"),_r=new ao("buffer"),Ar=new ao("picker"),Ri=function(e,t){t===void 0&&(t={}),this.chunkSize=10485760,this.newline=`
`,this.__pointer=0,this.__partialLine="",this.compressed=O(t.compressed,!1),this.binary=O(t.binary,!1),this.json=O(t.json,!1),this.xml=O(t.xml,!1),this.src=e};Ri.prototype.isBinary=function(){return this.binary||this.compressed},Ri.prototype.read=function(){var e=this;return this._read().then(function(t){var n=e.compressed?I_.get(e.compressed):void 0;return e.compressed&&n?e.data=n(t):((e.binary||e.compressed)&&t instanceof ArrayBuffer&&(t=new Uint8Array(t)),e.data=t),e.data})},Ri.prototype._chunk=function(e,t){return t=Math.min(this.data.length,t),e===0&&this.data.length===t?this.data:this.isBinary()?this.data.subarray(e,t):this.data.substring(e,t)},Ri.prototype.chunk=function(e){var t=e+this.chunkSize;return this._chunk(e,t)},Ri.prototype.peekLines=function(e){var t,n=this.data,i=n.length,r=this.isBinary()?this.newline.charCodeAt(0):this.newline,o=0;for(t=0;t<i&&(n[t]===r&&++o,o!==e);++t);var s=this._chunk(0,t+1);return this.chunkToLines(s,"",t>i).lines},Ri.prototype.chunkCount=function(){return Math.floor(this.data.length/this.chunkSize)+1},Ri.prototype.asText=function(){return this.isBinary()?Bg(this.data):this.data},Ri.prototype.chunkToLines=function(e,t,n){var i=this.newline;if(!this.isBinary()&&e.length===this.data.length)return{lines:e.split(i),partialLine:""};var r=[],o=this.isBinary()?Bg(e):e,s=o.lastIndexOf(i);if(s===-1)t+=o;else{var a=t+o.substr(0,s);r=r.concat(a.split(i)),t=s===o.length-i.length?"":o.substr(s+i.length)}return n&&t!==""&&r.push(t),{lines:r,partialLine:t}},Ri.prototype.nextChunk=function(){var e=this.__pointer;if(!(e>this.data.length))return this.__pointer+=this.chunkSize,this.chunk(e)},Ri.prototype.nextChunkOfLines=function(){var e=this.nextChunk();if(e!==void 0){var t=this.__pointer>this.data.length,n=this.chunkToLines(e,this.__partialLine,t);return this.__partialLine=n.partialLine,n.lines}},Ri.prototype.eachChunk=function(e){for(var t=this.chunkSize,n=this.data.length,i=this.chunkCount(),r=0;r<n;r+=t)e(this.chunk(r),Math.round(r/t),i)},Ri.prototype.eachChunkOfLines=function(e){var t=this;this.eachChunk(function(n,i,r){var o=i===r+1,s=t.chunkToLines(n,t.__partialLine,o);t.__partialLine=s.partialLine,e(s.lines,i,r)})},Ri.prototype.dispose=function(){delete this.src};var LF=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._read=function(){var n=this;return new Promise(function(i,r){var o=n.src,s=new FileReader;s.onload=function(a){a.target&&i(a.target.result)},s.onerror=function(a){return r(a)},n.binary||n.compressed?s.readAsArrayBuffer(o):s.readAsText(o)})},t}(Ri),RF=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._read=function(){var n=this;return new Promise(function(i,r){var o=n.src,s=new XMLHttpRequest;s.open("GET",o,!0),s.addEventListener("load",function(){if(s.status===200||s.status===304||s.status===0)try{i(s.response)}catch(a){r(a)}else r(s.statusText)},!1),s.addEventListener("error",function(a){return r("network error")},!1),n.isBinary()?s.responseType="arraybuffer":n.json?s.responseType="json":n.xml?s.responseType="document":s.responseType="text",s.send()})},t}(Ri),MT=function(e,t){t===void 0&&(t={}),this.parameters=br(t,{ext:"",compressed:!1,binary:ft.isBinary(t.ext||""),name:"",dir:"",path:"",protocol:""});var n={compressed:this.parameters.compressed,binary:this.parameters.binary,json:ft.isJson(this.parameters.ext),xml:ft.isXml(this.parameters.ext)};typeof File<"u"&&e instanceof File||typeof Blob<"u"&&e instanceof Blob?this.streamer=new LF(e,n):this.streamer=new RF(e,n)},OF=function(e){function t(n,i){i===void 0&&(i={}),e.call(this,n,i),this.parserParams={voxelSize:i.voxelSize,firstModelOnly:i.firstModelOnly,asTrajectory:i.asTrajectory,cAlphaOnly:i.cAlphaOnly,delimiter:i.delimiter,comment:i.comment,columnNames:i.columnNames,name:this.parameters.name,path:this.parameters.path}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(){return new(ft.get(this.parameters.ext))(this.streamer,this.parserParams).parse()},t}(MT),AT=function(e,t,n){this.name=t,this.path=n,this.signals={elementAdded:new yt.Signal,elementRemoved:new yt.Signal,nameChanged:new yt.Signal},this.type="Script",this.dir=n.substring(0,n.lastIndexOf("/")+1);try{this.fn=new Function("stage","__name","__path","__dir",e)}catch(i){de.error("Script compilation failed",i),this.fn=function(){}}};AT.prototype.run=function(e){var t=this;return new Promise(function(n,i){try{t.fn.apply(null,[e,t.name,t.path,t.dir]),n()}catch(r){de.error("Script.fn",r),i(r)}})};var kF=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(){var n=this;return this.streamer.read().then(function(){return new AT(n.streamer.asText(),n.parameters.name,n.parameters.path)})},t}(MT);function Jn(e){var t,n,i=I_.names,r="",o=(t=e instanceof File?e.name:e instanceof Blob?"":e).lastIndexOf("?"),s=o!==-1?t.substring(o):"",a=(t=t.substring(0,o===-1?t.length:o)).replace(/^.*[\\/]/,""),c=a.substring(0,a.lastIndexOf(".")),l=a.split("."),u=l.length>1?(l.pop()||"").toLowerCase():"",h=t.match(/^(.+):\/\/(.+)$/);h&&(r=h[1].toLowerCase(),t=h[2]||"");var f=t.substring(0,t.lastIndexOf("/")+1);if(i.includes(u)){n=u;var p=t.length-u.length-1;u=(t.substr(0,p).split(".").pop()||"").toLowerCase();var m=c.length-u.length-1;c=c.substr(0,m)}else n=!1;return{path:t,name:a,ext:u,base:c,dir:f,compressed:n,protocol:r,query:s,src:e}}function DF(e){var t=Jn(e),n=cc.get(t.protocol);return n&&!(t=Jn(n.getUrl(t.src))).ext&&n.getExt&&(t.ext=n.getExt(e)),t}function jx(e,t){t===void 0&&(t={});var n,i=Object.assign(DF(e),t);return ft.names.includes(i.ext)?n=new OF(i.src,i):IF.includes(i.ext)&&(n=new kF(i.src,i)),n?n.load():Promise.reject(new Error("autoLoad: ext '"+i.ext+"' unknown"))}var np=function(){};np.prototype.getBlob=function(){return new Blob([this.getData()],{type:this.mimeType})},np.prototype.download=function(e,t){e=O(e,this.defaultName),t=O(t,this.defaultExt),tF(this.getBlob(),e+"."+t)};(function(e){function t(n,i){e.call(this),this.mimeType="text/plain",this.defaultName="structure",this.defaultExt="pdb";var r=Object.assign({},i);this.renumberSerial=O(r.renumberSerial,!0),this.remarks=function(o){return Array.isArray(o)?o:[o]}(O(r.remarks,[])),this.structure=n,this._records=[]}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._writeRecords=function(){this._records.length=0,this._writeTitle(),this._writeRemarks(),this._writeAtoms()},t.prototype._writeTitle=function(){this._records.push(Bi.sprintf("TITLE %-74s",this.structure.name))},t.prototype._writeRemarks=function(){var n=this;this.remarks.forEach(function(i){n._records.push(Bi.sprintf("REMARK %-73s",i))}),this.structure.trajectory&&(this._records.push(Bi.sprintf("REMARK %-73s","Trajectory '"+this.structure.trajectory.name+"'")),this._records.push(Bi.sprintf("REMARK %-73s","Frame "+this.structure.trajectory.frame)))},t.prototype._writeAtoms=function(){var n=this,i=1,r=1,o=" ",s=" ";this.structure.eachModel(function(a){n._records.push(Bi.sprintf("MODEL %-74d",r++)),a.eachAtom(function(c){var l=c.hetero?"HETATM%5d %-4s %3s %1s%4d    %8.3f%8.3f%8.3f%6.2f%6.2f      %4s%2s%1s%1s":"ATOM  %5d %-4s %3s %1s%4d    %8.3f%8.3f%8.3f%6.2f%6.2f      %4s%2s%1s%1s",u=n.renumberSerial?i:c.serial,h=c.atomname;(h.length===1||h.length<4&&c.element.length===1&&h[0]===c.element)&&(h=" "+h),c.formalCharge?(o=Math.abs(c.formalCharge).toPrecision(1),s=c.formalCharge>0?"+":"-"):(o=" ",s=" "),n._records.push(Bi.sprintf(l,u,h,c.resname,O(c.chainname," "),c.resno,c.x,c.y,c.z,O(c.occupancy,1),O(c.bfactor,0),"",O(c.element,""),o,s)),i+=1},n.structure.getSelection()),n._records.push(Bi.sprintf("%-80s","ENDMDL")),r+=1}),this._records.push(Bi.sprintf("%-80s","END"))},t.prototype.getString=function(){return console.warn("PdbWriter.getString() is deprecated, use .getData instead"),this.getData()},t.prototype.getData=function(){return this._writeRecords(),this._records.join(`
`)},t})(np);(function(e){function t(i){e.call(this),this.mimeType="text/plain",this.defaultName="structure",this.defaultExt="sdf",this.structure=i,this._records=[]}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={idString:{configurable:!0},titleString:{configurable:!0},countsString:{configurable:!0},chargeLines:{configurable:!0}};return n.idString.get=function(){return this.structure.id},n.titleString.get=function(){return"  "+this.structure.title},n.countsString.get=function(){return Bi.sprintf("%3i%3i  0  0  0  0  0  0  0  0999 V2000",this.structure.atomCount,this.structure.bondCount)},n.chargeLines.get=function(){var i=[];this.structure.eachAtom(function(l){l.formalCharge!=null&&l.formalCharge!==0&&i.push([l.index,l.formalCharge])});for(var r=[],o=0;o<i.length;o+=8){for(var s=Math.min(8,i.length-o),a=Bi.sprintf("M  CHG%3i",s),c=o;c<o+s;c++)a+=Bi.sprintf(" %3i %3i",i[c][0]+1,i[c][1]);r.push(a)}return r},t.prototype.formatAtom=function(i){var r=0;i.formalCharge!=null&&i.formalCharge!==0&&(r=4-i.formalCharge);var o=Bi.sprintf("%10.4f%10.4f%10.4f %-3s 0%3i  0  0  0",i.x,i.y,i.z,i.element,r);if(o.length!==48)throw new Error("Incompatible atom for sdf format");return o},t.prototype.formatBond=function(i){return Bi.sprintf("%3i%3i%3i  0  0  0",i.atomIndex1+1,i.atomIndex2+1,i.bondOrder)},t.prototype._writeRecords=function(){this._records.length=0,this._writeHeader(),this._writeCTab(),this._writeFooter()},t.prototype._writeHeader=function(){this._records.push(this.idString,this.titleString,"")},t.prototype._writeCTab=function(){var i=this;this._records.push(this.countsString),this.structure.eachAtom(function(r){i._records.push(i.formatAtom(r))}),this.structure.eachBond(function(r){i._records.push(i.formatBond(r))}),this.chargeLines.forEach(function(r){i._records.push(r)}),this._records.push("M  END")},t.prototype._writeFooter=function(){this._records.push("$$$$")},t.prototype.getData=function(){return this._writeRecords(),this._records.join(`
`)},Object.defineProperties(t.prototype,n),t})(np);var W1=[],Et=function(e,t){t===void 0&&(t={}),this._mark=0,this._marks=[],this.offset=0,this.littleEndian=!0;var n=!1;e===void 0&&(e=8192),typeof e=="number"?e=new ArrayBuffer(e):n=!0;var i=t.offset?t.offset>>>0:0,r=e.byteLength-i,o=i;e instanceof ArrayBuffer||(e.byteLength!==e.buffer.byteLength&&(o=e.byteOffset+i),e=e.buffer),this._lastWrittenByte=n?r:0,this.buffer=e,this.length=r,this.byteLength=r,this.byteOffset=o,this._data=new DataView(this.buffer,o,r)};Et.prototype.available=function(e){return e===void 0&&(e=1),this.offset+e<=this.length},Et.prototype.isLittleEndian=function(){return this.littleEndian},Et.prototype.setLittleEndian=function(){return this.littleEndian=!0,this},Et.prototype.isBigEndian=function(){return!this.littleEndian},Et.prototype.setBigEndian=function(){return this.littleEndian=!1,this},Et.prototype.skip=function(e){return e===void 0&&(e=1),this.offset+=e,this},Et.prototype.seek=function(e){return this.offset=e,this},Et.prototype.mark=function(){return this._mark=this.offset,this},Et.prototype.reset=function(){return this.offset=this._mark,this},Et.prototype.pushMark=function(){return this._marks.push(this.offset),this},Et.prototype.popMark=function(){var e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this},Et.prototype.rewind=function(){return this.offset=0,this},Et.prototype.ensureAvailable=function(e){if(e===void 0&&(e=1),!this.available(e)){var t=2*(this.offset+e),n=new Uint8Array(t);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=this.byteLength=t,this._data=new DataView(this.buffer)}return this},Et.prototype.readBoolean=function(){return this.readUint8()!==0},Et.prototype.readInt8=function(){return this._data.getInt8(this.offset++)},Et.prototype.readUint8=function(){return this._data.getUint8(this.offset++)},Et.prototype.readByte=function(){return this.readUint8()},Et.prototype.readBytes=function(e){e===void 0&&(e=1);for(var t=new Uint8Array(e),n=0;n<e;n++)t[n]=this.readByte();return t},Et.prototype.readInt16=function(){var e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},Et.prototype.readUint16=function(){var e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e},Et.prototype.readInt32=function(){var e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},Et.prototype.readUint32=function(){var e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},Et.prototype.readFloat32=function(){var e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},Et.prototype.readFloat64=function(){var e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},Et.prototype.readChar=function(){return String.fromCharCode(this.readInt8())},Et.prototype.readChars=function(e){e===void 0&&(e=1),W1.length=e;for(var t=0;t<e;t++)W1[t]=this.readChar();return W1.join("")},Et.prototype.writeBoolean=function(e){return e===void 0&&(e=!1),this.writeUint8(e?255:0),this},Et.prototype.writeInt8=function(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this},Et.prototype.writeUint8=function(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this},Et.prototype.writeByte=function(e){return this.writeUint8(e)},Et.prototype.writeBytes=function(e){this.ensureAvailable(e.length);for(var t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this},Et.prototype.writeInt16=function(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this},Et.prototype.writeUint16=function(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this},Et.prototype.writeInt32=function(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this},Et.prototype.writeUint32=function(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this},Et.prototype.writeFloat32=function(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this},Et.prototype.writeFloat64=function(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this},Et.prototype.writeChar=function(e){return this.writeUint8(e.charCodeAt(0))},Et.prototype.writeChars=function(e){for(var t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this},Et.prototype.toArray=function(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)},Et.prototype._updateLastWrittenByte=function(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)};(function(e){function t(n){e.call(this),this.mimeType="application/vnd.ms-pki.stl",this.defaultName="surface",this.defaultExt="stl",this.surface=n}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getData=function(){var n=this.surface.index.length/3,i=new Et(2*n+3*n*4*4+80+4);i.skip(80),i.writeUint32(n);for(var r=new T,o=new T,s=new T,a=new T,c=0;c<n;c++){var l=[this.surface.index[3*c],this.surface.index[3*c+1],this.surface.index[3*c+2]];o.fromArray(this.surface.normal,3*l[0]),s.fromArray(this.surface.normal,3*l[1]),a.fromArray(this.surface.normal,3*l[2]),r.addVectors(o,s).add(a).normalize(),i.writeFloat32(r.x),i.writeFloat32(r.y),i.writeFloat32(r.z);for(var u=0;u<3;u++)r.fromArray(this.surface.position,3*l[u]),i.writeFloat32(r.x),i.writeFloat32(r.y),i.writeFloat32(r.z);i.writeUint16(0)}return new DataView(i.buffer)},t})(np);var Eo=function(){this.count=0,this.signals={countChanged:new yt.Signal}};Eo.prototype.clear=function(){this.change(-this.count)},Eo.prototype.change=function(e){this.count+=e,this.signals.countChanged.dispatch(e,this.count),this.count<0&&de.warn("Counter.count below zero",this.count)},Eo.prototype.increment=function(){this.change(1)},Eo.prototype.decrement=function(){this.change(-1)},Eo.prototype.listen=function(e){this.change(e.count),e.signals.countChanged.add(this.change,this)},Eo.prototype.unlisten=function(e){var t=e.signals.countChanged;t.has(this.change,this)&&t.remove(this.change,this)},Eo.prototype.onZeroOnce=function(e,t){var n=this;if(this.count===0)e.call(t);else{var i=function(){n.count===0&&(n.signals.countChanged.remove(i,n),e.call(t))};this.signals.countChanged.add(i,this)}},Eo.prototype.dispose=function(){this.clear(),this.signals.countChanged.dispose()},jt.add("shader/BasicLine.vert",`void main(){
#include begin_vertex
#include project_vertex
}`),jt.add("shader/BasicLine.frag",`uniform vec3 uColor;
#include common
#include fog_pars_fragment
void main(){
gl_FragColor = vec4( uColor, 1.0 );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include encodings_fragment
#include fog_fragment
}`),jt.add("shader/Quad.vert",`varying vec2 vUv;
void main() {
vUv = uv;
gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`),jt.add("shader/Quad.frag",`varying vec2 vUv;
uniform sampler2D tForeground;
uniform float scale;
void main() {
vec4 foreground = texture2D( tForeground, vUv );
gl_FragColor = foreground * scale;
}`);var hm=function(){this.signals={updated:new yt.Signal},this.maxDuration=-1/0,this.minDuration=1/0,this.avgDuration=14,this.lastDuration=1/0,this.prevFpsTime=0,this.lastFps=1/0,this.lastFrames=1,this.frames=0,this.count=0,this.begin()};hm.prototype.update=function(){this.startTime=this.end(),this.currentTime=this.startTime,this.signals.updated.dispatch()},hm.prototype.begin=function(){this.startTime=window.performance.now(),this.lastFrames=this.frames},hm.prototype.end=function(){var e=window.performance.now();return this.count+=1,this.frames+=1,this.lastDuration=e-this.startTime,this.minDuration=Math.min(this.minDuration,this.lastDuration),this.maxDuration=Math.max(this.maxDuration,this.lastDuration),this.avgDuration-=this.avgDuration/30,this.avgDuration+=this.lastDuration/30,e>this.prevFpsTime+1e3&&(this.lastFps=this.frames,this.prevFpsTime=e,this.frames=0),e},jt.add("shader/chunk/fog_fragment.glsl",`#ifdef USE_FOG
float depth = length( vViewPosition );
#ifdef FOG_EXP2
float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );
#else
float fogFactor = smoothstep( fogNear, fogFar, depth );
#endif
gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`),jt.add("shader/chunk/interior_fragment.glsl",`if( gl_FrontFacing == false ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}`),jt.add("shader/chunk/matrix_scale.glsl",`float matrixScale( in mat4 m ){
vec4 r = m[ 0 ];
return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );
}`),jt.add("shader/chunk/nearclip_vertex.glsl",`#ifdef NEAR_CLIP
if( vViewPosition.z < clipNear - 5.0 )
gl_Position.z = 2.0 * gl_Position.w;
#endif`),jt.add("shader/chunk/nearclip_fragment.glsl",`#ifdef NEAR_CLIP
if( vViewPosition.z < clipNear )
discard;
#endif`),jt.add("shader/chunk/opaque_back_fragment.glsl",`#ifdef OPAQUE_BACK
#ifdef FLIP_SIDED
if( gl_FrontFacing == true ){
gl_FragColor.a = 1.0;
}
#else
if( gl_FrontFacing == false ){
gl_FragColor.a = 1.0;
}
#endif
#endif`),jt.add("shader/chunk/radiusclip_vertex.glsl",`#ifdef RADIUS_CLIP
if( distance( vViewPosition, vClipCenter ) > clipRadius + 5.0 )
gl_Position.z = 2.0 * gl_Position.w;
#endif`),jt.add("shader/chunk/radiusclip_fragment.glsl",`#ifdef RADIUS_CLIP
if( distance( vViewPosition, vClipCenter ) > clipRadius )
discard;
#endif`),jt.add("shader/chunk/unpack_color.glsl",`vec3 unpackColor(float f) {
vec3 color;
color.r = floor(f / 256.0 / 256.0);
color.g = floor((f - color.r * 256.0 * 256.0) / 256.0);
color.b = floor(f - color.r * 256.0 * 256.0 - color.g * 256.0);
return color / 255.0;
}`);var BF=/^(?!\/\/)\s*#include\s+(\S+)/gim,q1={};function Ih(e,t){t===void 0&&(t={});var n=e+"|";for(var i in t)n+=i+":"+t[i];if(!q1[n]){var r=function(s){if(s===void 0)return"";var a=[];for(var c in s){var l=s[c];l&&a.push("#define "+c+" "+l)}return a.join(`
`)+`
`}(t),o=jt.get("shader/"+e);if(!o)throw new Error("empty shader, '"+e+"'");o=o.replace(BF,function(s,a){var c="shader/chunk/"+a+".glsl",l=jt.get(c)||Dt[a];if(!l)throw new Error("empty chunk, '"+a+"'");return l}),q1[n]=r+o}return q1[n]}if(typeof WebGLRenderingContext<"u"){var Ko=WebGLRenderingContext.prototype,FF=Ko.getShaderParameter;Ko.getShaderParameter=function(){return!Pe||FF.apply(this,arguments)};var NF=Ko.getShaderInfoLog;Ko.getShaderInfoLog=function(){return Pe?NF.apply(this,arguments):""};var zF=Ko.getProgramParameter;Ko.getProgramParameter=function(e,t){return!Pe&&t===Ko.LINK_STATUS||zF.apply(this,arguments)};var UF=Ko.getProgramInfoLog;Ko.getProgramInfoLog=function(){return Pe?UF.apply(this,arguments):""}}var CT=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];CT.forEach(function(e){e.forEach(function(t){t[0]*=.0625,t[1]*=.0625})});var Lh=function(e,t,n,i){this.canvas=document.createElement("canvas"),this._viewer=n,this._factor=O(i.factor,2),this._antialias=O(i.antialias,!1),this._onProgress=i.onProgress,this._onFinish=i.onFinish,this._antialias&&(this._factor*=2),this._n=this._factor*this._factor,this._width=this._viewer.width,this._height=this._viewer.height,this._antialias?(this.canvas.width=this._width*this._factor/2,this.canvas.height=this._height*this._factor/2):(this.canvas.width=this._width*this._factor,this.canvas.height=this._height*this._factor),this._ctx=this.canvas.getContext("2d"),this._viewerSampleLevel=n.sampleLevel,this._viewer.setSampling(-1)};Lh.prototype._renderTile=function(e){var t=this._viewer,n=this._width,i=this._height,r=this._factor,o=e%r*n,s=Math.floor(e/r)*i;if(t.camera.setViewOffset(n*r,i*r,o,s,n,i),t.render(),this._antialias){var a=Math.round((o+n)/2)-Math.round(o/2),c=Math.round((s+i)/2)-Math.round(s/2);this._ctx.drawImage(t.renderer.domElement,Math.round(o/2),Math.round(s/2),a,c)}else this._ctx.drawImage(t.renderer.domElement,Math.floor(o),Math.floor(s),Math.ceil(n),Math.ceil(i));typeof this._onProgress=="function"&&this._onProgress(e+1,this._n,!1)},Lh.prototype._finalize=function(){this._viewer.setSampling(this._viewerSampleLevel),this._viewer.camera.view=null,typeof this._onFinish=="function"&&this._onFinish(this._n+1,this._n,!1)},Lh.prototype.render=function(){for(var e=0;e<=this._n;++e)e===this._n?this._finalize():this._renderTile(e)},Lh.prototype.renderAsync=function(){for(var e=this,t=0,n=this._n,i=function(){t===n?e._finalize():e._renderTile(t),t+=1},r=0;r<=n;++r)setTimeout(i,0)};var X1=2*Math.PI,PT=180/Math.PI;function Y1(e,t,n,i,r){n===void 0&&(n=1),i===void 0&&(i=0);var o=r?r.length:e.length/n,s=0,a=0;if(r)for(var c=0;c<o;++c){var l=(e[r[c]*n+i]+t)%t/t*X1-Math.PI;s+=Math.cos(l),a+=Math.sin(l)}else for(var u=i;u<o;u+=n){var h=(e[u]+t)%t/t*X1-Math.PI;s+=Math.cos(h),a+=Math.sin(h)}return s/=o,a/=o,(Math.atan2(a,s)+Math.PI)/X1*t}function No(e,t,n,i){i===void 0&&(i=0);for(var r=e.length,o=n||new Float32Array(r),s=0;s<r;s+=3)o[i+s+0]=(e[s+0]+t[s+0])/2,o[i+s+1]=(e[s+1]+t[s+1])/2,o[i+s+2]=(e[s+2]+t[s+2])/2;return o}function v0(e,t){for(var n=e.length,i=new Float32Array(n),r=0;r<n;r+=3)i[r+0]=t[r+0]-e[r+0],i[r+1]=t[r+1]-e[r+1],i[r+2]=t[r+2]-e[r+2];return i}function yr(e,t,n){for(var i=n||new Float32Array(e),r=0;r<e;++r)i[r]=t;return i}function tn(e,t,n,i,r){for(var o=r||new Float32Array(3*e),s=0;s<e;++s){var a=3*s;o[a+0]=t,o[a+1]=n,o[a+2]=i}return o}function Du(e){for(var t=new Float32Array(e),n=0;n<e;++n)t[n]=n;return t}function Wx(e,t,n,i){n===void 0&&(n=0);for(var r=i||new Float32Array(e*t),o=0;o<e;++o)for(var s=n+o*t,a=0;a<t;++a)r[s+a]=o;return r}function Z1(e,t){for(var n=e.length,i=new Float32Array(n*t),r=0;r<n;++r)for(var o=r*t,s=e[r],a=0;a<t;++a)i[o+a]=s;return i}function Wn(e,t,n,i,r){for(var o=0;o<r;++o)t[i+o]=e[n+o]}function Q3(e,t,n,i){Wn(e,e,t,n,i)}function fm(e){for(var t=-1/0,n=0,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}function pm(e){for(var t=1/0,n=0,i=e.length;n<i;++n)e[n]<t&&(t=e[n]);return t}function L_(e,t,n){t===void 0&&(t=1),n===void 0&&(n=0);for(var i=e.length,r=0,o=n;o<i;o+=t)r+=e[o];return r}function dm(e,t,n){return t===void 0&&(t=1),n===void 0&&(n=0),L_(e,t,n)/(e.length/t)}var GF={trim:!1,factor:1,antialias:!1,transparent:!1,onProgress:void 0};function $F(e,t){t===void 0&&(t={});var n=br(t,GF),i=n.trim,r=n.factor,o=n.antialias,s=n.transparent,a=e.renderer,c=e.camera,l=a.getClearAlpha(),u=a.getClearColor();function h(m){m===void 0&&(m=!1);var y=r;o&&(y*=2),m&&(y=1/y),e.scene.traverse(function(v){var d=v.material;d&&d.linewidth&&(d.linewidth*=y),d&&d.uniforms&&d.uniforms.size&&d.uniforms.size.__seen===void 0&&(d.uniforms.size.value*=y,d.uniforms.size.__seen=!0),d&&d.uniforms&&d.uniforms.linewidth&&d.uniforms.linewidth.__seen===void 0&&(d.uniforms.linewidth.value*=y,d.uniforms.linewidth.__seen=!0)}),e.scene.traverse(function(v){var d=v.material;d&&d.uniforms&&d.uniforms.size&&delete d.uniforms.size.__seen,d&&d.uniforms&&d.uniforms.linewidth&&delete d.uniforms.linewidth.__seen})}function f(m){if(i){var y=u;return function(v,d,g,b,x){var _,S,w,C,A=v.height,k=v.width,L=v.getContext("2d").getImageData(0,0,k,A).data;for(w=!1,S=0;S<A;S++){for(_=0;_<k;_++)if(L[C=4*(S*k+_)]!==d||L[C+1]!==g||L[C+2]!==b||L[C+3]!==x){w=!0;break}if(w)break}var D=S;for(w=!1,_=0;_<k;_++){for(S=0;S<A;S++)if(L[C=4*(S*k+_)]!==d||L[C+1]!==g||L[C+2]!==b||L[C+3]!==x){w=!0;break}if(w)break}var F=_;for(w=!1,S=A-1;S>=0;S--){for(_=k-1;_>=0;_--)if(L[C=4*(S*k+_)]!==d||L[C+1]!==g||L[C+2]!==b||L[C+3]!==x){w=!0;break}if(w)break}var I=S;for(w=!1,_=k-1;_>=0;_--){for(S=A-1;S>=0;S--)if(L[C=4*(S*k+_)]!==d||L[C+1]!==g||L[C+2]!==b||L[C+3]!==x){w=!0;break}if(w)break}var P=_,N=document.createElement("canvas");return N.width=P-F,N.height=I-D,N.getContext("2d").drawImage(v,F,D,N.width,N.height,0,0,N.width,N.height),N}(m,s?0:255*y.r,s?0:255*y.g,s?0:255*y.b,s?0:255)}return m}function p(m,y,v){typeof t.onProgress=="function"&&t.onProgress(m,y,v)}return new Promise(function(m,y){var v=new Lh(a,c,e,{factor:r,antialias:o,onProgress:p,onFinish:function(d,g){f(v.canvas).toBlob(function(b){a.setClearAlpha(l),h(!0),e.requestRender(),p(g,g,!0),b?m(b):y("error creating image")},"image/png")}});a.setClearAlpha(s?0:1),h(),v.renderAsync()})}var K1=new T,J3=new De,eS=new De,tS=new Ee,Fg=new De,Ng=new De;function Q1(e,t){Fg.getInverse(t.projectionMatrix),Ng.copy(t.projectionMatrix).transpose(),e.traverse(function(n){var i=n.material;if(i){var r=i.uniforms;r&&(r.projectionMatrixInverse&&r.projectionMatrixInverse.value.copy(Fg),r.projectionMatrixTranspose&&r.projectionMatrixTranspose.value.copy(Ng))}})}function nS(e,t,n){var i=e.createShader(n);if(i)return e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(console.log("error compiling shader "+i+": "+e.getShaderInfoLog(i)),e.deleteShader(i),null);console.log("error creating WebGL shader "+n)}function J1(e,t){var n=e.getExtension(t);return n||console.log("extension '"+t+"' not available"),n}var VF=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function Id(e){var t=document.createElement("canvas");t.width=16,t.height=16,t.style.width="16px",t.style.height="16px";var n=t.getContext("webgl")||t.getContext("experimental-webgl");if(!n)return console.log("error creating webgl context for "+e),!1;if(!(n instanceof WebGLRenderingContext))return console.log("Got unexpected type for WebGL rendering context"),!1;J1(n,"OES_texture_float"),J1(n,"OES_texture_half_float"),J1(n,"WEBGL_color_buffer_float");var i=nS(n,`
attribute vec4 a_position;

void main() {
  gl_Position = a_position;
}`,n.VERTEX_SHADER),r=nS(n,`
precision mediump float;
uniform vec4 u_color;
uniform sampler2D u_texture;

void main() {
  gl_FragColor = texture2D(u_texture, vec2(0.5, 0.5)) * u_color;
}`,n.FRAGMENT_SHADER);if(!i||!r)return!1;var o=function(v,d,g,b){var x=v.createProgram();if(x)return d.forEach(function(_){return v.attachShader(x,_)}),g&&g.forEach(function(_,S){v.bindAttribLocation(x,b?b[S]:S,_)}),v.linkProgram(x),v.getProgramParameter(x,v.LINK_STATUS)?x:(console.log("error linking program: "+v.getProgramInfoLog(x)),v.deleteProgram(x),null);console.log("error creating WebGL program")}(n,[i,r]);if(!o)return console.log("error creating WebGL program"),!1;n.useProgram(o);var s=n.getAttribLocation(o,"a_position"),a=n.getUniformLocation(o,"u_color");if(!a)return console.log("error getting 'u_color' uniform location"),!1;var c=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,c),n.bufferData(n.ARRAY_BUFFER,VF,n.STATIC_DRAW),n.enableVertexAttribArray(s),n.vertexAttribPointer(s,2,n.FLOAT,!1,0,0);var l=n.createTexture(),u=new Uint8Array([255,255,255,255]);n.bindTexture(n.TEXTURE_2D,l),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,u);var h=n.createTexture();n.bindTexture(n.TEXTURE_2D,h),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,e,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);var f=n.createFramebuffer();if(n.bindFramebuffer(n.FRAMEBUFFER,f),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,h,0),n.checkFramebufferStatus(n.FRAMEBUFFER)!==n.FRAMEBUFFER_COMPLETE)return console.log("error creating framebuffer for "+e),!1;n.bindTexture(n.TEXTURE_2D,l),n.uniform4fv(a,[0,10,20,1]),n.drawArrays(n.TRIANGLES,0,6),n.bindTexture(n.TEXTURE_2D,h),n.bindFramebuffer(n.FRAMEBUFFER,null),n.clearColor(1,0,0,1),n.clear(n.COLOR_BUFFER_BIT),n.uniform4fv(a,[0,.1,.05,1]),n.drawArrays(n.TRIANGLES,0,6);var p=new Uint8Array(4);if(n.readPixels(0,0,1,1,n.RGBA,n.UNSIGNED_BYTE,p),p[0]!==0||p[1]<248||p[2]<248||p[3]<254)return console.log("not able to actually render to "+e+" texture"),!1;if(e===n.FLOAT){n.bindFramebuffer(n.FRAMEBUFFER,f);var m=new Float32Array(4);n.readPixels(0,0,1,1,n.RGBA,n.FLOAT,m);var y=n.getError();if(y)return console.log("error reading pixels as float: '"+function(v,d){switch(d){case v.NO_ERROR:return"no error";case v.INVALID_ENUM:return"invalid enum";case v.INVALID_VALUE:return"invalid value";case v.INVALID_OPERATION:return"invalid operation";case v.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case v.OUT_OF_MEMORY:return"out of memory";case v.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}(n,y)+"'"),!1}return!0}var HF=new Float32Array(100),jF=new Uint8Array(100),iS=[12,7,13,17,11,6,8,18,16,2,14,22,10,1,3,9,19,23,21,15,5,0,4,24,20],Ld=new De;function WF(e,t,n,i,r){var o=r.uniforms,s=[];if(o&&(o.objectId&&(o.objectId.value=ea?this.id:this.id/255,s.push("objectId")),(o.modelViewMatrixInverse||o.modelViewMatrixInverseTranspose||o.modelViewProjectionMatrix||o.modelViewProjectionMatrixInverse)&&this.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,this.matrixWorld),o.modelViewMatrixInverse&&(o.modelViewMatrixInverse.value.getInverse(this.modelViewMatrix),s.push("modelViewMatrixInverse")),o.modelViewMatrixInverseTranspose&&(o.modelViewMatrixInverse?o.modelViewMatrixInverseTranspose.value.copy(o.modelViewMatrixInverse.value).transpose():o.modelViewMatrixInverseTranspose.value.getInverse(this.modelViewMatrix).transpose(),s.push("modelViewMatrixInverseTranspose")),o.modelViewProjectionMatrix&&(o.modelViewProjectionMatrix.value.multiplyMatrices(n.projectionMatrix,this.modelViewMatrix),s.push("modelViewProjectionMatrix")),o.modelViewProjectionMatrixInverse&&(o.modelViewProjectionMatrix?(Ld.copy(o.modelViewProjectionMatrix.value),o.modelViewProjectionMatrixInverse.value.getInverse(Ld)):(Ld.multiplyMatrices(n.projectionMatrix,this.modelViewMatrix),o.modelViewProjectionMatrixInverse.value.getInverse(Ld)),s.push("modelViewProjectionMatrixInverse")),s.length)){var a=e.properties.get(r);if(a.program){var c=e.getContext(),l=a.program;c.useProgram(l.program);var u=l.getUniforms();s.forEach(function(h){u.setValue(c,h,o[h].value)})}}}var Mt=function(e){if(this.boundingBox=new hn,this.boundingBoxSize=new T,this.boundingBoxLength=0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this.distVector=new T,this.signals={ticked:new yt.Signal,rendered:new yt.Signal},typeof e=="string"){var t=document.getElementById(e);this.container=t===null?document.createElement("div"):t}else e instanceof HTMLElement?this.container=e:this.container=document.createElement("div");if(this.container===document.body)this.width=window.innerWidth||1,this.height=window.innerHeight||1;else{var n=this.container.getBoundingClientRect();this.width=n.width||1,this.height=n.height||1,this.container.style.overflow="hidden"}this.wrapper=document.createElement("div"),this.wrapper.style.position="relative",this.container.appendChild(this.wrapper),this._initParams(),this._initStats(),this._initCamera(),this._initScene(),this._initRenderer()!==!1?(this._initHelper(),this.setBackground(),this.setFog(),this.animate=this.animate.bind(this)):de.error("Viewer: could not initialize renderer")},ey={cameraDistance:{configurable:!0}};Mt.prototype._initParams=function(){this.parameters={fogColor:new Fe(0),fogNear:50,fogFar:100,backgroundColor:new Fe(0),cameraType:"perspective",cameraFov:40,cameraEyeSep:.3,cameraZ:-80,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",lightColor:new Fe(14540253),lightIntensity:1,ambientColor:new Fe(14540253),ambientIntensity:.2,sampleLevel:0,rendererEncoding:Ti}},Mt.prototype._initCamera=function(){var e=new T(0,0,0),t=this.width,n=this.height;this.perspectiveCamera=new jn(this.parameters.cameraFov,t/n),this.perspectiveCamera.position.z=this.parameters.cameraZ,this.perspectiveCamera.lookAt(e),this.orthographicCamera=new Pa(t/-2,t/2,n/2,n/-2),this.orthographicCamera.position.z=this.parameters.cameraZ,this.orthographicCamera.lookAt(e),this.stereoCamera=new nT,this.stereoCamera.aspect=.5,this.stereoCamera.eyeSep=this.parameters.cameraEyeSep;var i=this.parameters.cameraType;if(i==="orthographic")this.camera=this.orthographicCamera;else{if(i!=="perspective"&&i!=="stereo")throw new Error("Unknown cameraType '"+i+"'");this.camera=this.perspectiveCamera}this.camera.updateProjectionMatrix()},Mt.prototype._initStats=function(){this.stats=new hm},Mt.prototype._initScene=function(){this.scene||(this.scene=new ru,this.scene.name="scene"),this.rotationGroup=new nn,this.rotationGroup.name="rotationGroup",this.scene.add(this.rotationGroup),this.translationGroup=new nn,this.translationGroup.name="translationGroup",this.rotationGroup.add(this.translationGroup),this.modelGroup=new nn,this.modelGroup.name="modelGroup",this.translationGroup.add(this.modelGroup),this.pickingGroup=new nn,this.pickingGroup.name="pickingGroup",this.translationGroup.add(this.pickingGroup),this.backgroundGroup=new nn,this.backgroundGroup.name="backgroundGroup",this.translationGroup.add(this.backgroundGroup),this.helperGroup=new nn,this.helperGroup.name="helperGroup",this.translationGroup.add(this.helperGroup),this.scene.fog=new sg(this.parameters.fogColor.getHex()),this.spotLight=new Tg(this.parameters.lightColor.getHex(),this.parameters.lightIntensity),this.scene.add(this.spotLight),this.ambientLight=new Eg(this.parameters.ambientColor.getHex(),this.parameters.ambientIntensity),this.scene.add(this.ambientLight)},Mt.prototype._initRenderer=function(){var e=window.devicePixelRatio,t=this.width,n=this.height;try{this.renderer=new bp({preserveDrawingBuffer:!0,alpha:!0,antialias:!0})}catch{return this.wrapper.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100%;"><p style="padding:15px;text-align:center;">Your browser/graphics card does not seem to support <a target="_blank" href="https://en.wikipedia.org/wiki/WebGL">WebGL</a>.<br/><br/>Find out how to get it <a target="_blank" href="http://get.webgl.org/">here</a>.</p></div>',!1}this.renderer.setPixelRatio(e),this.renderer.setSize(t,n),this.renderer.autoClear=!1,this.renderer.sortObjects=!0,this.renderer.outputEncoding=this.parameters.rendererEncoding;var i=this.renderer.getContext();this.renderer.capabilities.isWebGL2?(K3(!0),Z3(this.renderer.extensions.get("EXT_color_buffer_float")),this.supportsHalfFloat=!0):(K3(this.renderer.extensions.get("EXT_frag_depth")),this.renderer.extensions.get("OES_element_index_uint"),Z3(this.renderer.extensions.get("OES_texture_float")&&this.renderer.extensions.get("WEBGL_color_buffer_float")||this.renderer.extensions.get("OES_texture_float")&&Id(i.FLOAT)),this.renderer.extensions.get("OES_texture_float"),this.supportsHalfFloat=this.renderer.extensions.get("OES_texture_half_float")&&Id(36193)),this.wrapper.appendChild(this.renderer.domElement);var r=t*e,o=n*e;Pe&&console.log(JSON.stringify({Browser:_T,OES_texture_float:!!this.renderer.extensions.get("OES_texture_float"),OES_texture_half_float:!!this.renderer.extensions.get("OES_texture_half_float"),WEBGL_color_buffer_float:!!this.renderer.extensions.get("WEBGL_color_buffer_float"),"testTextureSupport Float":Id(i.FLOAT),"testTextureSupport HalfFloat":Id(36193),"this.supportsHalfFloat":this.supportsHalfFloat,SupportsReadPixelsFloat:ea},null,2)),this.pickingTarget=new zi(r,o,{minFilter:ln,magFilter:ln,stencilBuffer:!1,format:er,type:ea?cs:gc}),this.pickingTarget.texture.generateMipmaps=!1,this.pickingTarget.texture.encoding=this.parameters.rendererEncoding,this.renderer.setRenderTarget(this.pickingTarget),this.renderer.clear(),this.renderer.setRenderTarget(null),this.sampleTarget=new zi(r,o,{minFilter:Xn,magFilter:Xn,format:er}),this.sampleTarget.texture.encoding=this.parameters.rendererEncoding,this.holdTarget=new zi(r,o,{minFilter:ln,magFilter:ln,format:er,type:gc}),this.holdTarget.texture.encoding=this.parameters.rendererEncoding,this.compositeUniforms={tForeground:new Zf(this.sampleTarget.texture),scale:new Zf(1)},this.compositeMaterial=new ti({uniforms:this.compositeUniforms,vertexShader:Ih("Quad.vert"),fragmentShader:Ih("Quad.frag"),premultipliedAlpha:!0,transparent:!0,blending:Zv,depthTest:!1,depthWrite:!1}),this.compositeCamera=new Pa(-1,1,1,-1,0,1),this.compositeScene=new ru,this.compositeScene.name="compositeScene",this.compositeScene.add(new pn(new Tf(2,2),this.compositeMaterial))},Mt.prototype._initHelper=function(){var e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),t=new Float32Array(24),n=new We;n.setIndex(new rt(e,1)),n.setAttribute("position",new rt(t,3));var i=new ti({uniforms:{uColor:{value:new Fe("skyblue")}},vertexShader:Ih("BasicLine.vert"),fragmentShader:Ih("BasicLine.frag")});this.boundingBoxMesh=new On(n,i),this.helperGroup.add(this.boundingBoxMesh)},Mt.prototype.updateHelper=function(){var e=this.boundingBoxMesh.geometry.attributes.position,t=e.array,n=this.boundingBox,i=n.min,r=n.max;t[0]=r.x,t[1]=r.y,t[2]=r.z,t[3]=i.x,t[4]=r.y,t[5]=r.z,t[6]=i.x,t[7]=i.y,t[8]=r.z,t[9]=r.x,t[10]=i.y,t[11]=r.z,t[12]=r.x,t[13]=r.y,t[14]=i.z,t[15]=i.x,t[16]=r.y,t[17]=i.z,t[18]=i.x,t[19]=i.y,t[20]=i.z,t[21]=r.x,t[22]=i.y,t[23]=i.z,e.needsUpdate=!0,this.boundingBox.isEmpty()||this.boundingBoxMesh.geometry.computeBoundingSphere()},ey.cameraDistance.get=function(){return Math.abs(this.camera.position.z)},ey.cameraDistance.set=function(e){this.camera.position.z=-e},Mt.prototype.add=function(e,t){var n=this;t?t.forEach(function(i){return n.addBuffer(e,i)}):this.addBuffer(e),e.group.name="meshGroup",e.wireframeGroup.name="wireframeGroup",e.parameters.background?(this.backgroundGroup.add(e.group),this.backgroundGroup.add(e.wireframeGroup)):(this.modelGroup.add(e.group),this.modelGroup.add(e.wireframeGroup)),e.pickable&&this.pickingGroup.add(e.pickingGroup),Pe&&this.updateHelper()},Mt.prototype.addBuffer=function(e,t){function n(s){s instanceof nn?s.children.forEach(n):(s.userData.buffer=e,s.userData.instance=t,s.onBeforeRender=WF)}var i=e.getMesh();t&&i.applyMatrix4(t.matrix),n(i),e.group.add(i);var r=e.getWireframeMesh();if(t&&(r.matrix.copy(i.matrix),r.position.copy(i.position),r.quaternion.copy(i.quaternion),r.scale.copy(i.scale)),n(r),e.wireframeGroup.add(r),e.pickable){var o=e.getPickingMesh();t&&(o.matrix.copy(i.matrix),o.position.copy(i.position),o.quaternion.copy(i.quaternion),o.scale.copy(i.scale)),n(o),e.pickingGroup.add(o)}t?this._updateBoundingBox(e.geometry,e.matrix,t.matrix):this._updateBoundingBox(e.geometry,e.matrix)},Mt.prototype.remove=function(e){this.translationGroup.children.forEach(function(t){t.remove(e.group),t.remove(e.wireframeGroup)}),e.pickable&&this.pickingGroup.remove(e.pickingGroup),this.updateBoundingBox(),Pe&&this.updateHelper()},Mt.prototype._updateBoundingBox=function(e,t,n){var i=this.boundingBox;function r(s,a,c){s.boundingBox==null&&s.computeBoundingBox();var l=s.boundingBox.clone();a&&l.applyMatrix4(a),c&&l.applyMatrix4(c),l.min.equals(l.max)&&l.expandByScalar(5),i.union(l)}function o(s){var a,c;s.geometry!==void 0&&(s.userData.buffer&&(a=s.userData.buffer.matrix),s.userData.instance&&(c=s.userData.instance.matrix),r(s.geometry,a,c))}e?r(e,t,n):(i.makeEmpty(),this.modelGroup.traverse(o),this.backgroundGroup.traverse(o)),i.getSize(this.boundingBoxSize),this.boundingBoxLength=this.boundingBoxSize.length()},Mt.prototype.updateBoundingBox=function(){this._updateBoundingBox(),Pe&&this.updateHelper()},Mt.prototype.getPickingPixels=function(){var e=this.width,t=this.height,n=e*t*4,i=ea?new Float32Array(n):new Uint8Array(n);return this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,0,0,e,t,i),i},Mt.prototype.getImage=function(e){var t=this;return new Promise(function(n){if(e){var i=t,r=i.width,o=i.height,s=r*o*4,a=t.getPickingPixels();if(ea){for(var c=new Uint8Array(s),l=0;l<s;++l)c[l]=Math.round(255*a[l]);a=c}var u=document.createElement("canvas");u.width=r,u.height=o;var h=u.getContext("2d"),f=h.getImageData(0,0,r,o);f.data.set(a),h.putImageData(f,0,0),u.toBlob(n,"image/png")}else t.renderer.domElement.toBlob(n,"image/png")})},Mt.prototype.makeImage=function(e){return e===void 0&&(e={}),$F(this,e)},Mt.prototype.setLight=function(e,t,n,i){var r=this.parameters;e!==void 0&&r.lightColor.set(e),t!==void 0&&(r.lightIntensity=t),n!==void 0&&r.ambientColor.set(n),i!==void 0&&(r.ambientIntensity=i),this.requestRender()},Mt.prototype.setFog=function(e,t,n){var i=this.parameters;e!==void 0&&i.fogColor.set(e),t!==void 0&&(i.fogNear=t),n!==void 0&&(i.fogFar=n),this.requestRender()},Mt.prototype.setBackground=function(e){var t=this.parameters;e&&t.backgroundColor.set(e),this.setFog(t.backgroundColor),this.renderer.setClearColor(t.backgroundColor,0),this.renderer.domElement.style.backgroundColor=t.backgroundColor.getStyle(),this.requestRender()},Mt.prototype.setSampling=function(e){e!==void 0&&(this.parameters.sampleLevel=e,this.sampleLevel=e),this.requestRender()},Mt.prototype.setOutputEncoding=function(e){this.parameters.rendererEncoding=e,this.renderer.outputEncoding=e,this.pickingTarget.texture.encoding=e,this.sampleTarget.texture.encoding=e,this.holdTarget.texture.encoding=e},Mt.prototype.setColorWorkflow=function(e){if(e!="linear"&&e!="sRGB")throw new Error("setColorWorkflow: invalid color workflow "+e);vT=e=="linear"?"linear":"sRGB",this.setOutputEncoding(e=="linear"?yp:Ti),this.requestRender()},Mt.prototype.setCamera=function(e,t,n){var i=this.parameters;if(e&&(i.cameraType=e),t&&(i.cameraFov=t),n&&(i.cameraEyeSep=n),i.cameraType==="orthographic")this.camera!==this.orthographicCamera&&(this.camera=this.orthographicCamera,this.camera.position.copy(this.perspectiveCamera.position),this.camera.up.copy(this.perspectiveCamera.up),this.updateZoom());else{if(i.cameraType!=="perspective"&&i.cameraType!=="stereo")throw new Error("Unknown cameraType '"+i.cameraType+"'");this.camera!==this.perspectiveCamera&&(this.camera=this.perspectiveCamera,this.camera.position.copy(this.orthographicCamera.position),this.camera.up.copy(this.orthographicCamera.up))}this.perspectiveCamera.fov=i.cameraFov,this.stereoCamera.eyeSep=i.cameraEyeSep,this.camera.updateProjectionMatrix(),this.requestRender()},Mt.prototype.setClip=function(e,t,n,i,r){var o=this.parameters;e!==void 0&&(o.clipNear=e),t!==void 0&&(o.clipFar=t),n!==void 0&&(o.clipDist=n),i!==void 0&&(o.clipMode=i),r!==void 0&&(o.clipScale=r),this.requestRender()},Mt.prototype.setSize=function(e,t){this.width=e||1,this.height=t||1,this.perspectiveCamera.aspect=this.width/this.height,this.orthographicCamera.left=-this.width/2,this.orthographicCamera.right=this.width/2,this.orthographicCamera.top=this.height/2,this.orthographicCamera.bottom=-this.height/2,this.camera.updateProjectionMatrix();var n=window.devicePixelRatio;this.renderer.setPixelRatio(n),this.renderer.setSize(e,t);var i=this.width*n,r=this.height*n;this.pickingTarget.setSize(i,r),this.sampleTarget.setSize(i,r),this.holdTarget.setSize(i,r),this.requestRender()},Mt.prototype.handleResize=function(){if(this.container===document.body)this.setSize(window.innerWidth,window.innerHeight);else{var e=this.container.getBoundingClientRect();this.setSize(e.width,e.height)}},Mt.prototype.updateInfo=function(e){var t=this.info,n=t.memory,i=t.render;if(e)n.programs=0,n.geometries=0,n.textures=0,i.calls=0,i.vertices=0,i.points=0;else{var r=this.renderer.info,o=r.memory,s=r.render;n.geometries=o.geometries,n.textures=o.textures,i.calls+=s.calls,i.faces+=s.triangles,i.points+=s.points}},Mt.prototype.animate=function(){if(this.signals.ticked.dispatch(this.stats),window.performance.now()-this.stats.startTime>500&&!this.isStill&&this.sampleLevel<3&&this.sampleLevel!==-1){var e=this.sampleLevel;this.sampleLevel=3,this.renderPending=!0,this.render(),this.isStill=!0,this.sampleLevel=e,Pe&&de.log("rendered still frame")}this.frameRequest=window.requestAnimationFrame(this.animate)},Mt.prototype.pick=function(e,t){if(this.parameters.cameraType==="stereo")return{pid:0,instance:void 0,picker:void 0};e*=window.devicePixelRatio,t*=window.devicePixelRatio,e=Math.max(e-2,0),t=Math.max(t-2,0);var n,i,r=0,o=ea?HF:jF;this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,e,t,5,5,o);for(var s=0;s<iS.length;s++){var a=4*iS[s],c=Math.round(o[a+3]),l=this.pickingGroup.getObjectById(c);l&&(n=l.userData.instance,i=l.userData.buffer.picking,r=ea?Math.round(255*o[a])<<16&16711680|Math.round(255*o[a+1])<<8&65280|255&Math.round(255*o[a+2]):o[a]<<16|o[a+1]<<8|o[a+2])}return{pid:r,instance:n,picker:i}},Mt.prototype.requestRender=function(){var e=this;this.renderPending||(window.performance.now()-this.stats.startTime>22&&(this.stats.begin(),this.isStill=!1),this.renderPending=!0,window.requestAnimationFrame(function(){e.render(),e.stats.update()}))},Mt.prototype.updateZoom=function(){var e=Tn(this.perspectiveCamera.fov),t=2*Math.tan(e/2)*this.cameraDistance;this.orthographicCamera.zoom=this.height/t},Mt.prototype.absoluteToRelative=function(e){return 50*(1-e/this.bRadius)},Mt.prototype.relativeToAbsolute=function(e){return this.bRadius*(1-e/50)},Mt.prototype.__updateClipping=function(){var e=this.parameters;this.bRadius=Math.max(10,.5*this.boundingBoxLength),isFinite(this.bRadius)||(this.bRadius=50),this.camera.getWorldPosition(this.distVector),this.cDist=this.distVector.length(),this.cDist||(this.cameraDistance=Math.abs(e.cameraZ),this.cDist=Math.abs(e.cameraZ));var t=this.scene.fog;if(t.color.set(e.fogColor),e.clipMode==="camera")this.camera.near=e.clipNear,this.camera.far=e.clipFar,t.near=e.fogNear,t.far=e.fogFar;else if(e.clipScale==="absolute")this.camera.near=this.cDist-e.clipNear,this.camera.far=this.cDist+e.clipFar,t.near=this.cDist-e.fogNear,t.far=this.cDist+e.fogFar;else{var n=(50-e.clipNear)/50,i=-(50-e.clipFar)/50;this.camera.near=this.cDist-this.bRadius*n,this.camera.far=this.cDist+this.bRadius*i;var r=(50-e.fogNear)/50,o=-(50-e.fogFar)/50;t.near=this.cDist-this.bRadius*r,t.far=this.cDist+this.bRadius*o}e.clipMode!=="camera"&&(this.camera.type==="PerspectiveCamera"?(this.camera.near=Math.max(.1,e.clipDist,this.camera.near),this.camera.far=Math.max(1,this.camera.far),t.near=Math.max(.1,t.near),t.far=Math.max(1,t.far)):this.camera.type==="OrthographicCamera"&&e.clipDist>0&&(this.camera.near=Math.max(e.clipDist,this.camera.near)))},Mt.prototype.__updateCamera=function(){var e=this.camera;e.updateMatrix(),e.updateMatrixWorld(!0),e.updateProjectionMatrix(),function(t,n,i,r,o){var s=new Ee;i.getSize(s);var a=s.height,c=i.getPixelRatio(),l=n.type==="OrthographicCamera";tS.set(s.width,s.height),Fg.getInverse(n.projectionMatrix),Ng.copy(n.projectionMatrix).transpose(),t.traverse(function(u){var h=u.material;if(h){var f=h.uniforms;if(f){if(h.clipNear){var p=(50-h.clipNear)/50,m=r-o*p;f.clipNear.value=m}f.canvasHeight&&(f.canvasHeight.value=a),f.resolution&&f.resolution.value.copy(tS),f.pixelRatio&&(f.pixelRatio.value=c),f.projectionMatrixInverse&&f.projectionMatrixInverse.value.copy(Fg),f.projectionMatrixTranspose&&f.projectionMatrixTranspose.value.copy(Ng),f.ortho&&(f.ortho.value=l)}}})}(this.scene,e,this.renderer,this.cDist,this.bRadius),function(t,n){t.traverseVisible(function(i){if(i instanceof Lf&&i.userData.buffer.parameters.sortParticles){var r=i.geometry.attributes,o=r.position.count;if(o!==0){var s,a,c,l,u,h,f;J3.multiplyMatrices(n.matrixWorldInverse,i.matrixWorld),eS.multiplyMatrices(n.projectionMatrix,J3),i.userData.sortData?(s=i.userData.sortData,c=s.__zArray,a=s.__sortArray,l=s.__cmpFn):(c=new Float32Array(o),a=new Uint32Array(o),s={__zArray:c,__sortArray:a,__cmpFn:l=function(x,_){var S=c[x],w=c[_];return S>w?1:S<w?-1:0}},i.userData.sortData=s);for(var p=0;p<o;++p)K1.fromArray(r.position.array,3*p),K1.applyMatrix4(eS),c[p]=-K1.z,a[p]=p;for(var m in function(x,_,S,w){S===void 0&&(S=0),_=_||function($,B){return $>B?1:$<B?-1:0};var C,A,k,L=[],D=-1,F=S,I=w=(w||x.length)-1;function P($,B){var q=x[$];x[$]=x[B],x[B]=q}for(;;)if(I-F<=25){for(var N=F+1;N<=I;++N){for(C=x[N],A=N-1;A>=F&&_(x[A],C)>0;)x[A+1]=x[A],--A;x[A+1]=C}if(D===-1)break;I=L[D--],F=L[D--]}else{for(k=I,P(F+I>>1,A=F+1),_(x[F],x[I])>0&&P(F,I),_(x[A],x[I])>0&&P(A,I),_(x[F],x[A])>0&&P(F,A),C=x[A];;){do A++;while(_(x[A],C)<0);do k--;while(_(x[k],C)>0);if(k<A)break;P(A,k)}x[F+1]=x[k],x[k]=C,I-A+1>=k-F?(L[++D]=A,L[++D]=I,I=k-1):(L[++D]=F,L[++D]=k-1,F=A)}}(a,l),r){var y=r[m],v=y.array,d=y.itemSize;s[m]||(s[m]=new Float32Array(d*o)),f=s[m],s[m]=v;for(var g=0;g<o;++g){u=a[g];for(var b=0;b<d;++b)h=u*d+b,f[g*d+b]=v[h]}r[m].array=f,r[m].needsUpdate=!0}}}})}(this.scene,e)},Mt.prototype.__setVisibility=function(e,t,n,i){this.modelGroup.visible=e,this.pickingGroup.visible=t,this.backgroundGroup.visible=n,this.helperGroup.visible=i},Mt.prototype.__updateLights=function(){this.spotLight.color.set(this.parameters.lightColor),this.spotLight.intensity=this.parameters.lightIntensity,this.distVector.copy(this.camera.position).setLength(100*this.boundingBoxLength),this.spotLight.position.copy(this.camera.position).add(this.distVector),this.ambientLight.color.set(this.parameters.ambientColor),this.ambientLight.intensity=this.parameters.ambientIntensity},Mt.prototype.__renderPickingGroup=function(e){this.renderer.setRenderTarget(this.pickingTarget||null),this.renderer.clear(),this.__setVisibility(!1,!0,!1,!1),this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.updateInfo()},Mt.prototype.__renderModelGroup=function(e,t){this.renderer.setRenderTarget(t||null),this.renderer.clear(),this.__setVisibility(!1,!1,!0,!1),this.renderer.render(this.scene,e),this.renderer.clear(!1,!0,!0),this.updateInfo(),this.__setVisibility(!0,!1,!1,Pe),this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.updateInfo()},Mt.prototype.__renderSuperSample=function(e,t){var n=CT[Math.max(0,Math.min(this.sampleLevel,5))],i=1/n.length;this.compositeUniforms.tForeground.value=this.sampleTarget.texture;var r=this.sampleTarget.width,o=this.sampleTarget.height;this.parameters.cameraType==="stereo"&&(r/=2);for(var s=0;s<n.length;++s){var a=n[s];e.setViewOffset(r,o,a[0],a[1],r,o),e.updateProjectionMatrix(),Q1(this.scene,e);var c=i;c+=.03125*((s+.5)/n.length-.5),this.compositeUniforms.scale.value=c,this.__renderModelGroup(e,this.sampleTarget),this.renderer.setRenderTarget(this.holdTarget),s===0&&this.renderer.clear(),this.renderer.render(this.compositeScene,this.compositeCamera)}this.compositeUniforms.scale.value=1,this.compositeUniforms.tForeground.value=this.holdTarget.texture,e.clearViewOffset(),this.renderer.setRenderTarget(t||null),this.renderer.clear(),this.renderer.render(this.compositeScene,this.compositeCamera)},Mt.prototype.__renderStereo=function(e,t){e===void 0&&(e=!1);var n=this.stereoCamera;n.update(this.perspectiveCamera);var i=this.renderer,r=new Ee;i.getSize(r),i.setScissorTest(!0),i.setScissor(0,0,r.width/2,r.height),i.setViewport(0,0,r.width/2,r.height),Q1(this.scene,n.cameraL),this.__render(e,n.cameraL),i.setScissor(r.width/2,0,r.width/2,r.height),i.setViewport(r.width/2,0,r.width/2,r.height),Q1(this.scene,n.cameraR),this.__render(e,n.cameraR),i.setScissorTest(!1),i.setViewport(0,0,r.width,r.height)},Mt.prototype.__render=function(e,t,n){e===void 0&&(e=!1),e?this.lastRenderedPicking||this.__renderPickingGroup(t):this.sampleLevel>0&&this.parameters.cameraType!=="stereo"?this.__renderSuperSample(t,n):this.__renderModelGroup(t,n)},Mt.prototype.render=function(e,t){if(e===void 0&&(e=!1),this.rendering)de.warn("'tried to call 'render' from within 'render'");else{this.rendering=!0;try{this.__updateClipping(),this.__updateCamera(),this.__updateLights(),this.updateInfo(!0),this.parameters.cameraType==="stereo"?this.__renderStereo(e,t):this.__render(e,this.camera,t),this.lastRenderedPicking=e}finally{this.rendering=!1,this.renderPending=!1}this.signals.rendered.dispatch()}},Mt.prototype.clear=function(){de.log("scene cleared"),this.scene.remove(this.rotationGroup),this._initScene(),this.renderer.clear()},Mt.prototype.dispose=function(){this.renderer.dispose(),window.cancelAnimationFrame(this.frameRequest)},Object.defineProperties(Mt.prototype,ey);function rS(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;return Math.sqrt(t*t+n*n)}var bi=function(e,t){t===void 0&&(t={}),this.domElement=e,this.signals={moved:new yt.Signal,scrolled:new yt.Signal,dragged:new yt.Signal,dropped:new yt.Signal,clicked:new yt.Signal,hovered:new yt.Signal,doubleClicked:new yt.Signal},this.position=new Ee,this.prevPosition=new Ee,this.down=new Ee,this.canvasPosition=new Ee,this.prevClickCP=new Ee,this.moving=!1,this.hovering=!0,this.scrolled=!1,this.lastMoved=1/0,this.which=0,this.buttons=0,this.pressed=!1,this.altKey=!1,this.ctrlKey=!1,this.metaKey=!1,this.shiftKey=!1,this.domElement.style.touchAction="none",this.hoverTimeout=O(t.hoverTimeout,50),this.handleScroll=O(t.handleScroll,!0),this.doubleClickSpeed=O(t.doubleClickSpeed,500),this._listen=this._listen.bind(this),this._onMousewheel=this._onMousewheel.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMousedown=this._onMousedown.bind(this),this._onMouseup=this._onMouseup.bind(this),this._onContextmenu=this._onContextmenu.bind(this),this._onTouchstart=this._onTouchstart.bind(this),this._onTouchend=this._onTouchend.bind(this),this._onTouchmove=this._onTouchmove.bind(this),this._listen();var n={passive:!1};document.addEventListener("mousewheel",this._onMousewheel,n),document.addEventListener("wheel",this._onMousewheel,n),document.addEventListener("MozMousePixelScroll",this._onMousewheel,n),document.addEventListener("mousemove",this._onMousemove,n),document.addEventListener("mousedown",this._onMousedown,n),document.addEventListener("mouseup",this._onMouseup,n),document.addEventListener("contextmenu",this._onContextmenu,n),document.addEventListener("touchstart",this._onTouchstart,n),document.addEventListener("touchend",this._onTouchend,n),document.addEventListener("touchmove",this._onTouchmove,n)},oS={key:{configurable:!0}};oS.key.get=function(){var e=0;return this.altKey&&(e+=1),this.ctrlKey&&(e+=2),this.metaKey&&(e+=4),this.shiftKey&&(e+=8),e},bi.prototype.setParameters=function(e){e===void 0&&(e={}),this.hoverTimeout=O(e.hoverTimeout,this.hoverTimeout)},bi.prototype._listen=function(){var e=window.performance.now(),t=this.canvasPosition;this.doubleClickPending&&e-this.lastClicked>this.doubleClickSpeed&&(this.doubleClickPending=!1),e-this.lastMoved>this.hoverTimeout&&(this.moving=!1),(this.scrolled||!this.moving&&!this.hovering)&&(this.scrolled=!1,this.hoverTimeout!==-1&&this.overElement&&(this.hovering=!0,this.signals.hovered.dispatch(t.x,t.y))),this.frameRequest=window.requestAnimationFrame(this._listen)},bi.prototype._onMousewheel=function(e){var t=this;if(e.target===this.domElement&&this.handleScroll){e.preventDefault(),this._setKeys(e);var n=0;"deltaY"in e&&"deltaMode"in e&&e.deltaY!==void 0&&e.deltaMode!==void 0?n=e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?.025*-e.deltaY:e.deltaMode===WheelEvent.DOM_DELTA_LINE?-e.deltaY*(2.5/3):2.5*-e.deltaY:"deltaY"in e&&!("detail"in e)?n=.025*-e.deltaY:e.wheelDelta!==void 0?n=.025*-e.wheelDelta:e.wheelDeltaY!==void 0?n=.025*-e.wheelDeltaY:e.detail!==void 0&&(n=-e.detail/3),this.signals.scrolled.dispatch(n),setTimeout(function(){t.scrolled=!0},this.hoverTimeout)}},bi.prototype._onMousemove=function(e){e.target===this.domElement?(e.preventDefault(),this.overElement=!0):this.overElement=!1,this._setKeys(e),this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(e.clientX,e.clientY),this._setCanvasPosition(e);var t=this.prevPosition.x-this.position.x,n=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(t,n),this.pressed&&this.signals.dragged.dispatch(t,n)},bi.prototype._onMousedown=function(e){e.target===this.domElement&&(e.preventDefault(),this._setKeys(e),this.moving=!1,this.hovering=!1,this.down.set(e.clientX,e.clientY),this.position.set(e.clientX,e.clientY),this.which=e.which,this.buttons=function(t){if(typeof t=="object"){if("buttons"in t)return t.buttons;if("which"in t){var n=t.which;if(n===2)return 4;if(n===3)return 2;if(n>0)return 1<<n-1}else if("button"in t){var i=t.button;if(i===1)return 4;if(i===2)return 2;if(i>=0)return 1<<i}}return 0}(e),this.pressed=!0,this._setCanvasPosition(e))},bi.prototype._onMouseup=function(e){e.target===this.domElement&&e.preventDefault(),this._setKeys(e);var t=this.canvasPosition;this._distance()<4&&(this.lastClicked=window.performance.now(),this.doubleClickPending&&this.prevClickCP.distanceTo(t)<4&&(this.signals.doubleClicked.dispatch(t.x,t.y),this.doubleClickPending=!1),this.signals.clicked.dispatch(t.x,t.y),this.doubleClickPending=!0,this.prevClickCP.copy(t)),this.which=void 0,this.buttons=void 0,this.pressed=void 0},bi.prototype._onContextmenu=function(e){e.target===this.domElement&&e.preventDefault()},bi.prototype._onTouchstart=function(e){if(e.target===this.domElement)switch(e.preventDefault(),this.pressed=!0,e.touches.length){case 1:this.moving=!1,this.hovering=!1,this.down.set(e.touches[0].pageX,e.touches[0].pageY),this.position.set(e.touches[0].pageX,e.touches[0].pageY),this._setCanvasPosition(e.touches[0]);break;case 2:this.down.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),this.position.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),this.lastTouchDistance=rS(e)}},bi.prototype._onTouchend=function(e){e.target===this.domElement&&e.preventDefault(),this.which=void 0,this.buttons=void 0,this.pressed=void 0},bi.prototype._onTouchmove=function(e){switch(e.target===this.domElement?(e.preventDefault(),this.overElement=!0):this.overElement=!1,e.touches.length){case 1:this._setKeys(e),this.which=1,this.buttons=1,this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(e.touches[0].pageX,e.touches[0].pageY),this._setCanvasPosition(e.touches[0]);var t=this.prevPosition.x-this.position.x,n=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(t,n),this.pressed&&this.signals.dragged.dispatch(t,n);break;case 2:var i=rS(e),r=i-this.lastTouchDistance;if(this.lastTouchDistance=i,this.prevPosition.copy(this.position),this.position.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),Math.abs(r)>2&&this.handleScroll&&this.position.distanceTo(this.prevPosition)<2)this.which=0,this.buttons=0,this.signals.scrolled.dispatch(r/2);else{this.which=3,this.buttons=2;var o=this.prevPosition.x-this.position.x,s=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(o,s),this.pressed&&this.signals.dragged.dispatch(o,s)}}},bi.prototype._distance=function(){return this.position.distanceTo(this.down)},bi.prototype._setCanvasPosition=function(e){var t,n,i=this.domElement.getBoundingClientRect();"clientX"in e&&"clientY"in e?(t=e.clientX-i.left,n=e.clientY-i.top):(t=e.offsetX,n=e.offsetY),this.canvasPosition.set(t,i.height-n)},bi.prototype._setKeys=function(e){this.altKey=e.altKey,this.ctrlKey=e.ctrlKey,this.metaKey=e.metaKey,this.shiftKey=e.shiftKey},bi.prototype.dispose=function(){document.removeEventListener("mousewheel",this._onMousewheel),document.removeEventListener("wheel",this._onMousewheel),document.removeEventListener("MozMousePixelScroll",this._onMousewheel),document.removeEventListener("mousemove",this._onMousemove),document.removeEventListener("mousedown",this._onMousedown),document.removeEventListener("mouseup",this._onMouseup),document.removeEventListener("contextmenu",this._onContextmenu),document.removeEventListener("touchstart",this._onTouchstart),document.removeEventListener("touchend",this._onTouchend),document.removeEventListener("touchmove",this._onTouchmove),window.cancelAnimationFrame(this.frameRequest)},Object.defineProperties(bi.prototype,oS);var ty=new De,ny=new De,sS=new De,Hi=new De,aS=new De,wr=new T,hh=new un,cS=new un,Qo=new De,qa=new T,Rd=new T,or=function(e,t){t===void 0&&(t={}),this.stage=e,this.rotateSpeed=O(t.rotateSpeed,2),this.zoomSpeed=O(t.zoomSpeed,1.2),this.panSpeed=O(t.panSpeed,1),this.viewer=e.viewer,this.mouse=e.mouseObserver,this.controls=e.viewerControls},iy={component:{configurable:!0},atom:{configurable:!0}};iy.component.get=function(){return this.stage.transformComponent},iy.atom.get=function(){return this.stage.transformAtom},or.prototype._setPanVector=function(e,t,n){n===void 0&&(n=0);var i=this.controls.getCanvasScaleFactor(n);qa.set(e,t,0),qa.multiplyScalar(this.panSpeed*i)},or.prototype._getRotateXY=function(e,t){return[this.rotateSpeed*-e*.01,this.rotateSpeed*t*.01]},or.prototype._getCameraRotation=function(e){return e.extractRotation(this.viewer.camera.matrixWorld),e.multiply(ny.makeRotationY(Math.PI)),e},or.prototype._transformPanVector=function(){this.component&&(Qo.extractRotation(this.component.transform),Qo.premultiply(this.viewer.rotationGroup.matrix),Qo.getInverse(Qo),Qo.multiply(this._getCameraRotation(Hi)),qa.applyMatrix4(Qo))},or.prototype.zoom=function(e){this.controls.zoom(this.zoomSpeed*e*.02)},or.prototype.pan=function(e,t){this._setPanVector(e,t),Qo.getInverse(this.viewer.rotationGroup.matrix),Qo.multiply(this._getCameraRotation(Hi)),qa.applyMatrix4(Qo),this.controls.translate(qa)},or.prototype.panComponent=function(e,t){this.component&&(this._setPanVector(e,t),this._transformPanVector(),this.component.position.add(qa),this.component.updateMatrix())},or.prototype.panAtom=function(e,t){this.atom&&this.component&&(this.atom.positionToVector3(Rd),Rd.add(this.viewer.translationGroup.position),Rd.applyMatrix4(this.viewer.rotationGroup.matrix),this._setPanVector(e,t,Rd.z),this._transformPanVector(),this.atom.positionAdd(qa),this.component.updateRepresentations({position:!0}))},or.prototype.rotate=function(e,t){var n=this._getRotateXY(e,t),i=n[0],r=n[1];this._getCameraRotation(Hi),wr.set(1,0,0),wr.applyMatrix4(Hi),hh.setFromAxisAngle(wr,r),wr.set(0,1,0),wr.applyMatrix4(Hi),cS.setFromAxisAngle(wr,i),hh.multiply(cS),Hi.makeRotationFromQuaternion(hh),this.controls.applyMatrix(Hi)},or.prototype.zRotate=function(e,t){var n=this.rotateSpeed*((-e+t)/-2)*.01;sS.makeRotationZ(n),this.controls.applyMatrix(sS)},or.prototype.rotateComponent=function(e,t){if(this.component){var n=this._getRotateXY(e,t),i=n[0],r=n[1];this._getCameraRotation(aS),Hi.extractRotation(this.component.transform),Hi.premultiply(this.viewer.rotationGroup.matrix),Hi.getInverse(Hi),Hi.premultiply(aS),wr.set(1,0,0),wr.applyMatrix4(Hi),ty.makeRotationAxis(wr,r),wr.set(0,1,0),wr.applyMatrix4(Hi),ny.makeRotationAxis(wr,i),ty.multiply(ny),hh.setFromRotationMatrix(ty),this.component.quaternion.premultiply(hh),this.component.quaternion.normalize(),this.component.updateMatrix()}},Object.defineProperties(or.prototype,iy);var Jc=new T,mm=function(e,t){this.stage=t,this.pid=e.pid,this.picker=e.picker,this.instance=e.instance,this.stage=t,this.controls=t.viewerControls,this.mouse=t.mouseObserver},Vt={type:{configurable:!0},altKey:{configurable:!0},ctrlKey:{configurable:!0},metaKey:{configurable:!0},shiftKey:{configurable:!0},canvasPosition:{configurable:!0},component:{configurable:!0},object:{configurable:!0},position:{configurable:!0},closestBondAtom:{configurable:!0},closeAtom:{configurable:!0},arrow:{configurable:!0},atom:{configurable:!0},axes:{configurable:!0},bond:{configurable:!0},box:{configurable:!0},cone:{configurable:!0},clash:{configurable:!0},contact:{configurable:!0},cylinder:{configurable:!0},distance:{configurable:!0},ellipsoid:{configurable:!0},octahedron:{configurable:!0},point:{configurable:!0},mesh:{configurable:!0},slice:{configurable:!0},sphere:{configurable:!0},tetrahedron:{configurable:!0},torus:{configurable:!0},surface:{configurable:!0},unitcell:{configurable:!0},unknown:{configurable:!0},volume:{configurable:!0},wideline:{configurable:!0}};Vt.type.get=function(){return this.picker.type},Vt.altKey.get=function(){return this.mouse.altKey},Vt.ctrlKey.get=function(){return this.mouse.ctrlKey},Vt.metaKey.get=function(){return this.mouse.metaKey},Vt.shiftKey.get=function(){return this.mouse.shiftKey},Vt.canvasPosition.get=function(){return this.mouse.canvasPosition},Vt.component.get=function(){return this.stage.getComponentsByObject(this.picker.data).list[0]},Vt.object.get=function(){return this.picker.getObject(this.pid)},Vt.position.get=function(){return this.picker.getPosition(this.pid,this.instance,this.component)},Vt.closestBondAtom.get=function(){if(this.type==="bond"&&this.bond){var e=this.bond,t=this.controls,n=this.canvasPosition,i=e.atom1.positionToVector3(),r=e.atom2.positionToVector3();i.applyMatrix4(this.component.matrix),r.applyMatrix4(this.component.matrix);var o,s,a,c=t.getPositionOnCanvas(i),l=t.getPositionOnCanvas(r);return s=c,a=l,(o=n).distanceTo(s)<o.distanceTo(a)?e.atom1:e.atom2}},Vt.closeAtom.get=function(){var e=this.canvasPosition,t=this.closestBondAtom;if(t){var n=t.positionToVector3().applyMatrix4(this.component.matrix),i=this.controls.getPositionOnCanvas(n);t.positionToVector3(Jc),this.instance&&Jc.applyMatrix4(this.instance.matrix),Jc.applyMatrix4(this.component.matrix);var r=this.controls.viewer;Jc.add(r.translationGroup.position),Jc.applyMatrix4(r.rotationGroup.matrix);var o=this.controls.getCanvasScaleFactor(Jc.z),s=this.component.getMaxRepresentationRadius(t.index);return e.distanceTo(i)<=s/o?t:void 0}},Vt.arrow.get=function(){return this._objectIfType("arrow")},Vt.atom.get=function(){return this._objectIfType("atom")},Vt.axes.get=function(){return this._objectIfType("axes")},Vt.bond.get=function(){return this._objectIfType("bond")},Vt.box.get=function(){return this._objectIfType("box")},Vt.cone.get=function(){return this._objectIfType("cone")},Vt.clash.get=function(){return this._objectIfType("clash")},Vt.contact.get=function(){return this._objectIfType("contact")},Vt.cylinder.get=function(){return this._objectIfType("cylinder")},Vt.distance.get=function(){return this._objectIfType("distance")},Vt.ellipsoid.get=function(){return this._objectIfType("ellipsoid")},Vt.octahedron.get=function(){return this._objectIfType("octahedron")},Vt.point.get=function(){return this._objectIfType("point")},Vt.mesh.get=function(){return this._objectIfType("mesh")},Vt.slice.get=function(){return this._objectIfType("slice")},Vt.sphere.get=function(){return this._objectIfType("sphere")},Vt.tetrahedron.get=function(){return this._objectIfType("tetrahedron")},Vt.torus.get=function(){return this._objectIfType("torus")},Vt.surface.get=function(){return this._objectIfType("surface")},Vt.unitcell.get=function(){return this._objectIfType("unitcell")},Vt.unknown.get=function(){return this._objectIfType("unknown")},Vt.volume.get=function(){return this._objectIfType("volume")},Vt.wideline.get=function(){return this._objectIfType("wideline")},mm.prototype._objectIfType=function(e){return this.type===e?this.object:void 0},mm.prototype.getLabel=function(){var e=this.atom||this.closeAtom,t="nothing";return this.arrow?t=this.arrow.name:e?t="atom: "+e.qualifiedName()+" ("+e.structure.name+")":this.axes?t="axes":this.bond?t="bond: "+this.bond.atom1.qualifiedName()+" - "+this.bond.atom2.qualifiedName()+" ("+this.bond.structure.name+")":this.box?t=this.box.name:this.cone?t=this.cone.name:this.clash?t="clash: "+this.clash.clash.sele1+" - "+this.clash.clash.sele2:this.contact?t=this.contact.type+": "+this.contact.atom1.qualifiedName()+" - "+this.contact.atom2.qualifiedName()+" ("+this.contact.atom1.structure.name+")":this.cylinder?t=this.cylinder.name:this.distance?t="distance: "+this.distance.atom1.qualifiedName()+" - "+this.distance.atom2.qualifiedName()+" ("+this.distance.structure.name+")":this.ellipsoid?t=this.ellipsoid.name:this.octahedron?t=this.octahedron.name:this.point?t=this.point.name:this.mesh?t="mesh: "+(this.mesh.name||this.mesh.serial)+" ("+this.mesh.shape.name+")":this.slice?t="slice: "+this.slice.value.toPrecision(3)+" ("+this.slice.volume.name+")":this.sphere?t=this.sphere.name:this.surface?t="surface: "+this.surface.surface.name:this.tetrahedron?t=this.tetrahedron.name:this.torus?t=this.torus.name:this.unitcell?t="unitcell: "+this.unitcell.unitcell.spacegroup+" ("+this.unitcell.structure.name+")":this.unknown?t="unknown":this.volume?t="volume: "+this.volume.value.toPrecision(3)+" ("+this.volume.volume.name+")":this.wideline&&(t=this.wideline.name),t},Object.defineProperties(mm.prototype,Vt);var TT=function(e){this.stage=e,this.viewer=e.viewer};TT.prototype.pick=function(e,t){var n=this.viewer.pick(e,t);if(n.picker&&n.picker.type!=="ignore"&&n.pid!==void 0){var i=n.picker.array;if(!(i&&n.pid>=i.length))return new mm(n,this.stage);console.error("pid >= picker.array.length")}};var lS=new un,uS=new T,hS=new T,ry=new T,qF=new T,fS=new De,pS=new T,dS=new De,_i=function(e){this.stage=e,this.signals={changed:new yt.Signal},this.viewer=e.viewer},oy={position:{configurable:!0},rotation:{configurable:!0}};oy.position.get=function(){return this.viewer.translationGroup.position},oy.rotation.get=function(){return this.viewer.rotationGroup.quaternion},_i.prototype.changed=function(){this.viewer.requestRender(),this.signals.changed.dispatch()},_i.prototype.getPositionOnCanvas=function(e,t){var n=y0(t,Ee),i=this.viewer;return ry.copy(e).add(i.translationGroup.position).applyMatrix4(i.rotationGroup.matrix).project(i.camera),n.set((ry.x+1)*i.width/2,(ry.y+1)*i.height/2)},_i.prototype.getCanvasScaleFactor=function(e){e===void 0&&(e=0);var t=this.viewer.camera;if(t instanceof Pa)return 1/t.zoom;e=Math.abs(e),e+=this.getCameraDistance();var n=Tn(t.fov);return 2*e*Math.tan(n/2)/this.viewer.height},_i.prototype.getOrientation=function(e){var t=Eh(e);t.copy(this.viewer.rotationGroup.matrix);var n=this.getCameraDistance();return t.scale(qF.set(n,n,n)),t.setPosition(this.viewer.translationGroup.position),t},_i.prototype.orient=function(e){Eh(e).decompose(uS,lS,hS);var t=this.viewer;t.rotationGroup.setRotationFromQuaternion(lS),t.translationGroup.position.copy(uS),t.cameraDistance=hS.z,t.updateZoom(),this.changed()},_i.prototype.translate=function(e){this.viewer.translationGroup.position.add(ac(e)),this.changed()},_i.prototype.center=function(e){this.viewer.translationGroup.position.copy(ac(e)).negate(),this.changed()},_i.prototype.zoom=function(e){this.distance(this.getCameraDistance()*(1-e))},_i.prototype.getCameraDistance=function(){return this.viewer.cameraDistance},_i.prototype.distance=function(e){this.viewer.cameraDistance=Math.max(Math.abs(e),.2),this.viewer.updateZoom(),this.changed()},_i.prototype.spin=function(e,t){fS.getInverse(this.viewer.rotationGroup.matrix),pS.copy(ac(e)).applyMatrix4(fS),this.viewer.rotationGroup.rotateOnAxis(pS,t),this.changed()},_i.prototype.rotate=function(e){this.viewer.rotationGroup.setRotationFromQuaternion($x(e)),this.changed()},_i.prototype.align=function(e){dS.getInverse(Eh(e)),this.viewer.rotationGroup.setRotationFromMatrix(dS),this.changed()},_i.prototype.applyMatrix=function(e){this.viewer.rotationGroup.applyMatrix4(Eh(e)),this.changed()},Object.defineProperties(_i.prototype,oy);var cr=function(e,t){for(var n,i=[],r=arguments.length-2;r-- >0;)i[r]=arguments[r+2];this.pausedTime=-1,this.elapsedDuration=0,this.pausedDuration=0,this.ignoreGlobalToggle=!1,this._paused=!1,this._resolveList=[],this.duration=O(e,1e3),this.controls=t,this.startTime=window.performance.now(),(n=this)._init.apply(n,i)},sy={done:{configurable:!0},paused:{configurable:!0}};sy.done.get=function(){return this.alpha===1},sy.paused.get=function(){return this._paused},cr.prototype.tick=function(e){if(!this._paused)return this.elapsedDuration=e.currentTime-this.startTime-this.pausedDuration,this.duration===0?this.alpha=1:this.alpha=_p(0,1,this.elapsedDuration/this.duration),this._tick(e),this.done&&this._resolveList.forEach(function(t){return t()}),this.done},cr.prototype.pause=function(e){e&&(this._hold=!0),this.pausedTime===-1&&(this.pausedTime=window.performance.now()),this._paused=!0},cr.prototype.resume=function(e){!e&&this._hold||(this.pausedDuration+=window.performance.now()-this.pausedTime,this._paused=!1,this._hold=!1,this.pausedTime=-1)},cr.prototype.toggle=function(){this._paused?this.resume():this.pause()},cr.prototype.then=function(e){var t=this;return(this.done?Promise.resolve():new Promise(function(n){return t._resolveList.push(n)})).then(e)},Object.defineProperties(cr.prototype,sy);var mS=function(e){function t(n,i){for(var r=[],o=arguments.length-2;o-- >0;)r[o]=arguments[o+2];e.apply(this,[O(n,1/0),i].concat(r))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._init=function(n,i){Array.isArray(n)?this.axis=new T().fromArray(n):this.axis=O(n,new T(0,1,0)),this.angle=O(i,.01)},t.prototype._tick=function(n){this.axis&&this.angle&&this.controls.spin(this.axis,this.angle*n.lastDuration/16)},t}(cr),gS=function(e){function t(n,i){for(var r=[],o=arguments.length-2;o-- >0;)r[o]=arguments[o+2];e.apply(this,[O(n,1/0),i].concat(r)),this.angleSum=0,this.direction=1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._init=function(n,i,r){Array.isArray(n)?this.axis=new T().fromArray(n):this.axis=O(n,new T(0,1,0)),this.angleStep=O(i,.01),this.angleEnd=O(r,.2)},t.prototype._tick=function(n){if(this.axis&&this.angleStep&&this.angleEnd){var i=_p(0,1,Math.abs(this.angleSum)/this.angleEnd),r=this.angleStep*this.direction*(1.1-i);this.controls.spin(this.axis,r*n.lastDuration/16),this.angleSum+=this.angleStep,this.angleSum>=this.angleEnd&&(this.direction*=-1,this.angleSum=-this.angleEnd)}},t}(cr),yS=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._init=function(n,i){this.moveFrom=ac(O(n,new T)),this.moveTo=ac(O(i,new T))},t.prototype._tick=function(){this.controls.position.lerpVectors(this.moveFrom,this.moveTo,this.alpha).negate(),this.controls.changed()},t}(cr),XF=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._init=function(n,i){this.zoomFrom=n,this.zoomTo=i},t.prototype._tick=function(){this.controls.distance(Tr(this.zoomFrom,this.zoomTo,this.alpha))},t}(cr),YF=function(e){function t(){e.apply(this,arguments),this._currentRotation=new un}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._init=function(n,i){this.rotateFrom=$x(n),this.rotateTo=$x(i),this._currentRotation=new un},t.prototype._tick=function(){this._currentRotation.copy(this.rotateFrom).slerp(this.rotateTo,this.alpha),this.controls.rotate(this._currentRotation)},t}(cr),ZF=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._init=function(n,i,r){this.valueFrom=n,this.valueTo=i,this.callback=r},t.prototype._tick=function(){this.callback(Tr(this.valueFrom,this.valueTo,this.alpha))},t}(cr),KF=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._init=function(n){this.callback=n},t.prototype._tick=function(){this.alpha===1&&this.callback()},t}(cr),zg=function(e){e===void 0&&(e=[]),this._resolveList=[],this._list=e},vS={done:{configurable:!0}};vS.done.get=function(){return this._list.every(function(e){return e.done})},zg.prototype.then=function(e){var t,n=this;return t=this.done?Promise.resolve():new Promise(function(i){n._resolveList.push(i),n._list.forEach(function(r){r.then(function(){n._resolveList.forEach(function(o){o()}),n._resolveList.length=0})})}),t.then(e)},Object.defineProperties(zg.prototype,vS);var Dn=function(e){this.stage=e,this.animationList=[],this.finishedList=[],this.viewer=e.viewer,this.controls=e.viewerControls},xS={paused:{configurable:!0}};xS.paused.get=function(){return this.animationList.every(function(e){return e.paused})},Dn.prototype.add=function(e){return e.duration===0?e.tick(this.viewer.stats):this.animationList.push(e),e},Dn.prototype.remove=function(e){var t=this.animationList,n=t.indexOf(e);n>-1&&t.splice(n,1)},Dn.prototype.run=function(e){for(var t=this.finishedList,n=this.animationList,i=n.length,r=0;r<i;++r){var o=n[r];o.tick(e)&&t.push(o)}var s=t.length;if(s){for(var a=0;a<s;++a)this.remove(t[a]);t.length=0}},Dn.prototype.spin=function(e,t,n){return this.add(new mS(n,this.controls,e,t))},Dn.prototype.rock=function(e,t,n,i){return this.add(new gS(i,this.controls,e,t,n))},Dn.prototype.rotate=function(e,t){var n=this.viewer.rotationGroup.quaternion.clone();return this.add(new YF(t,this.controls,n,e))},Dn.prototype.move=function(e,t){var n=this.controls.position.clone().negate();return this.add(new yS(t,this.controls,n,e))},Dn.prototype.zoom=function(e,t){var n=this.viewer.camera.position.z;return this.add(new XF(t,this.controls,n,e))},Dn.prototype.zoomMove=function(e,t,n){return new zg([this.move(e,n),this.zoom(t,n)])},Dn.prototype.orient=function(e,t){var n=new T,i=new un,r=new T;return Eh(e).decompose(n,i,r),new zg([this.move(n.negate(),t),this.rotate(i,t),this.zoom(-r.x,t)])},Dn.prototype.value=function(e,t,n,i){return this.add(new ZF(i,this.controls,e,t,n))},Dn.prototype.timeout=function(e,t){return this.add(new KF(t,this.controls,e))},Dn.prototype.spinComponent=function(e,t,n,i){return this.add(new mS(i,e.controls,t,n))},Dn.prototype.rockComponent=function(e,t,n,i,r){return this.add(new gS(r,e.controls,t,n,i))},Dn.prototype.moveComponent=function(e,t,n){var i=e.controls.position.clone().negate();return this.add(new yS(n,e.controls,i,t))},Dn.prototype.pause=function(){this.animationList.forEach(function(e){return e.pause()})},Dn.prototype.resume=function(){this.animationList.forEach(function(e){return e.resume()})},Dn.prototype.toggle=function(){this.paused?this.resume():this.pause()},Dn.prototype.clear=function(){this.animationList.length=0},Dn.prototype.dispose=function(){this.clear()},Object.defineProperties(Dn.prototype,xS);var cl=function(e,t){if(this.fn=e,this.queue=[],this.pending=!1,this.next=this.next.bind(this),t){for(var n=0,i=t.length;n<i;++n)this.queue.push(t[n]);this.next()}};cl.prototype.run=function(e){this.fn(e,this.next)},cl.prototype.next=function(){var e=this,t=this.queue.shift();t!==void 0?(this.pending=!0,setTimeout(function(){return e.run(t)})):this.pending=!1},cl.prototype.push=function(e){this.queue.push(e),this.pending||this.next()},cl.prototype.kill=function(){this.queue.length=0},cl.prototype.length=function(){return this.queue.length};var Un=function(e,t,n){this.type="",this.parameters={lazy:{type:"boolean"},clipNear:{type:"range",step:1,max:100,min:0,buffer:!0},clipRadius:{type:"number",precision:1,max:1e3,min:0,buffer:!0},clipCenter:{type:"vector3",precision:1,buffer:!0},flatShaded:{type:"boolean",buffer:!0},opacity:{type:"range",step:.01,max:1,min:0,buffer:!0},depthWrite:{type:"boolean",buffer:!0},side:{type:"select",buffer:!0,options:{front:"front",back:"back",double:"double"}},wireframe:{type:"boolean",buffer:!0},colorData:{type:"hidden",update:"color"},colorScheme:{type:"select",update:"color",options:{}},colorScale:{type:"select",update:"color",options:Rt.getScales()},colorReverse:{type:"boolean",update:"color"},colorValue:{type:"color",update:"color"},colorDomain:{type:"hidden",update:"color"},colorMode:{type:"select",update:"color",options:Rt.getModes()},roughness:{type:"range",step:.01,max:1,min:0,buffer:!0},metalness:{type:"range",step:.01,max:1,min:0,buffer:!0},diffuse:{type:"color",buffer:!0},diffuseInterior:{type:"boolean",buffer:!0},useInteriorColor:{type:"boolean",buffer:!0},interiorColor:{type:"color",buffer:!0},interiorDarkening:{type:"range",step:.01,max:1,min:0,buffer:!0},matrix:{type:"hidden",buffer:!0},disablePicking:{type:"boolean",rebuild:!0}},this.viewer=t,this.tasks=new Eo,this.queue=new cl(this.make.bind(this)),this.bufferList=[],this.parameters.colorScheme&&(this.parameters.colorScheme.options=Rt.getSchemes()),this.toBePrepared=!1};Un.prototype.init=function(e){var t=e||{};this.clipNear=O(t.clipNear,0),this.clipRadius=O(t.clipRadius,0),this.clipCenter=O(t.clipCenter,new T),this.flatShaded=O(t.flatShaded,!1),this.side=O(t.side,"double"),this.opacity=O(t.opacity,1),this.depthWrite=O(t.depthWrite,!0),this.wireframe=O(t.wireframe,!1),this.setColor(t.color,t),this.colorData=O(t.colorData,void 0),this.colorScheme=O(t.colorScheme,"uniform"),this.colorScale=O(t.colorScale,""),this.colorReverse=O(t.colorReverse,!1),this.colorValue=O(t.colorValue,9474192),this.colorDomain=O(t.colorDomain,void 0),this.colorMode=O(t.colorMode,"hcl"),this.visible=O(t.visible,!0),this.quality=O(t.quality,void 0),this.roughness=O(t.roughness,.4),this.metalness=O(t.metalness,0),this.diffuse=O(t.diffuse,16777215),this.diffuseInterior=O(t.diffuseInterior,!1),this.useInteriorColor=O(t.useInteriorColor,!1),this.interiorColor=O(t.interiorColor,2236962),this.interiorDarkening=O(t.interiorDarkening,0),this.lazy=O(t.lazy,!1),this.lazyProps={build:!1,bufferParams:{},what:{}},this.matrix=O(t.matrix,new De),this.disablePicking=O(t.disablePicking,!1);var n=this.parameters;n.sphereDetail===!0&&(n.sphereDetail={type:"integer",max:3,min:0,rebuild:"impostor"}),n.radialSegments===!0&&(n.radialSegments={type:"integer",max:25,min:5,rebuild:"impostor"}),n.openEnded===!0&&(n.openEnded={type:"boolean",rebuild:"impostor",buffer:!0}),n.disableImpostor===!0&&(n.disableImpostor={type:"boolean",rebuild:!0}),t.quality==="low"?(n.sphereDetail&&(this.sphereDetail=0),n.radialSegments&&(this.radialSegments=5)):t.quality==="medium"?(n.sphereDetail&&(this.sphereDetail=1),n.radialSegments&&(this.radialSegments=10)):t.quality==="high"?(n.sphereDetail&&(this.sphereDetail=2),n.radialSegments&&(this.radialSegments=20)):(n.sphereDetail&&(this.sphereDetail=O(t.sphereDetail,1)),n.radialSegments&&(this.radialSegments=O(t.radialSegments,10))),n.openEnded&&(this.openEnded=O(t.openEnded,!0)),n.disableImpostor&&(this.disableImpostor=O(t.disableImpostor,!1))},Un.prototype.getColorParams=function(e){return Object.assign({data:this.colorData,scheme:this.colorScheme,scale:this.colorScale,reverse:this.colorReverse,value:this.colorValue,domain:this.colorDomain,mode:this.colorMode,colorSpace:this.colorSpace},e)},Un.prototype.getBufferParams=function(e){return e===void 0&&(e={}),Object.assign({clipNear:this.clipNear,clipRadius:this.clipRadius,clipCenter:this.clipCenter,flatShaded:this.flatShaded,opacity:this.opacity,depthWrite:this.depthWrite,side:this.side,wireframe:this.wireframe,roughness:this.roughness,metalness:this.metalness,diffuse:this.diffuse,diffuseInterior:this.diffuseInterior,useInteriorColor:this.useInteriorColor,interiorColor:this.interiorColor,interiorDarkening:this.interiorDarkening,matrix:this.matrix,disablePicking:this.disablePicking},e)},Un.prototype.setColor=function(e,t){var n=Object.keys(Rt.getSchemes());if(typeof e=="string"&&n.includes(e.toLowerCase()))t?t.colorScheme=e:this.setParameters({colorScheme:e});else if(e!==void 0){var i=new Fe(e).getHex();t?(t.colorScheme="uniform",t.colorValue=i):this.setParameters({colorScheme:"uniform",colorValue:i})}return this},Un.prototype.prepare=function(e){},Un.prototype.create=function(){},Un.prototype.update=function(e){this.build()},Un.prototype.build=function(e){if(!this.lazy||this.visible&&this.opacity){if(!this.toBePrepared)return this.tasks.increment(),void this.make();this.queue.length()>0?(this.tasks.change(1-this.queue.length()),this.queue.kill()):this.tasks.increment(),this.queue.push(e||!1)}else this.lazyProps.build=!0},Un.prototype.make=function(e,t){var n=this;Pe&&de.time("Representation.make "+this.type);var i=function(){e?(n.update(e),n.viewer.requestRender(),n.tasks.decrement(),t&&t()):(n.clear(),n.create(),n.manualAttach||n.disposed||(Pe&&de.time("Representation.attach "+n.type),n.attach(function(){Pe&&de.timeEnd("Representation.attach "+n.type),n.tasks.decrement(),t&&t()}))),Pe&&de.timeEnd("Representation.make "+n.type)};this.toBePrepared?this.prepare(i):i()},Un.prototype.attach=function(e){this.setVisibility(this.visible),e()},Un.prototype.setVisibility=function(e,t){if(this.visible=e,this.visible&&this.opacity){var n=this.lazyProps,i=n.bufferParams,r=n.what;if(n.build)return n.build=!1,this.build(),this;(Object.keys(i).length||Object.keys(r).length)&&(n.bufferParams={},n.what={},this.updateParameters(i,r))}return this.bufferList.forEach(function(o){o.setVisibility(e)}),t||this.viewer.requestRender(),this},Un.prototype.setParameters=function(e,t,n){t===void 0&&(t={}),n===void 0&&(n=!1);var i=e||{},r=this.parameters,o={};for(var s in this.opacity||i.opacity===void 0||(this.lazyProps.build?(this.lazyProps.build=!1,n=!0):(Object.assign(o,this.lazyProps.bufferParams),Object.assign(t,this.lazyProps.what),this.lazyProps.bufferParams={},this.lazyProps.what={})),this.setColor(i.color,i),i)i[s]!==void 0&&r[s]!==void 0&&(r[s].int&&(i[s]=parseInt(i[s])),r[s].float&&(i[s]=parseFloat(i[s])),i[s]!==this[s]||i[s].equals&&!i[s].equals(this[s]))&&(this[s]&&this[s].copy&&i[s].copy?this[s].copy(i[s]):this[s]&&this[s].set?this[s].set(i[s]):this[s]=i[s],r[s].buffer&&(r[s].buffer===!0?o[s]=i[s]:o[r[s].buffer]=i[s]),r[s].update&&(t[r[s].update]=!0),!r[s].rebuild||r[s].rebuild==="impostor"&&Fo&&!this.disableImpostor||(n=!0));return n?this.build():this.updateParameters(o,t),this},Un.prototype.updateParameters=function(e,t){if(e===void 0&&(e={}),this.lazy&&(!this.visible||!this.opacity)&&e.hasOwnProperty("opacity")===!1)return Object.assign(this.lazyProps.bufferParams,e),void Object.assign(this.lazyProps.what,t);this.bufferList.forEach(function(n){n.setParameters(e)}),Object.keys(t).length&&this.update(t),this.viewer.requestRender()},Un.prototype.getParameters=function(){var e=this,t={lazy:this.lazy,visible:this.visible,quality:this.quality};return Object.keys(this.parameters).forEach(function(n){e.parameters[n]!==null&&(t[n]=e[n])}),t},Un.prototype.clear=function(){var e=this;this.bufferList.forEach(function(t){e.viewer.remove(t),t.dispose()}),this.bufferList.length=0,this.viewer.requestRender()},Un.prototype.dispose=function(){this.disposed=!0,this.queue.kill(),this.tasks.dispose(),this.clear()};var Ug=function(e){var t=this;this.pending=0,this.postCount=0,this.onmessageDict={},this.onerrorDict={},this.name=e,this.blobUrl=window.URL.createObjectURL(tp.get(e)),this.worker=new Worker(this.blobUrl),tp.activeWorkerCount+=1,this.worker.onmessage=function(n){t.pending-=1;var i=n.data.__postId;Pe&&de.timeEnd("Worker.postMessage "+e+" #"+i);var r=t.onmessageDict[i];r&&r.call(t.worker,n),delete t.onmessageDict[i],delete t.onerrorDict[i]},this.worker.onerror=function(n){if(t.pending-=1,n.data){var i=n.data.__postId,r=t.onerrorDict[i];r?r.call(t.worker,n):de.error("Worker.onerror",i,e,n),delete t.onmessageDict[i],delete t.onerrorDict[i]}else de.error("Worker.onerror",e,n)}};Ug.prototype.post=function(e,t,n,i){e===void 0&&(e={}),this.onmessageDict[this.postCount]=n,this.onerrorDict[this.postCount]=i,e.__name=this.name,e.__postId=this.postCount,e.__debug=Pe,Pe&&de.time("Worker.postMessage "+this.name+" #"+this.postCount);try{this.worker.postMessage(e,t)}catch(r){de.error("worker.post:",r),this.worker.postMessage(e)}return this.pending+=1,this.postCount+=1,this},Ug.prototype.terminate=function(){this.worker?(this.worker.terminate(),window.URL.revokeObjectURL(this.blobUrl),tp.activeWorkerCount-=1):de.log("no worker to terminate")};var ll=function(e,t){t===void 0&&(t=2),this.pool=[],this.count=0,this.maxCount=Math.min(8,t),this.name=e};function qx(e){for(var t=e.length,n=t/3,i=0,r=0,o=0,s=0;s<t;s+=3)i+=e[s+0],r+=e[s+1],o+=e[s+2];return new T(i/n,r/n,o/n)}function lc(e,t,n){return n?e.sub(n).projectOnVector(t).add(n):e.projectOnVector(t),e}function ip(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,o=-1/0,s=-1/0,a=0,c=e.length;a<c;a+=3){var l=e[a],u=e[a+1],h=e[a+2];l<t&&(t=l),u<n&&(n=u),h<i&&(i=h),l>r&&(r=l),u>o&&(o=u),h>s&&(s=h)}return[xt([t,n,i]),xt([r,o,s])]}function x0(e,t){for(var n=0,i=t.length;n<i;n+=3){var r=t[n],o=t[n+1],s=t[n+2];t[n]=e[0]*r+e[4]*o+e[8]*s+e[12],t[n+1]=e[1]*r+e[5]*o+e[9]*s+e[13],t[n+2]=e[2]*r+e[6]*o+e[10]*s+e[14]}}function R_(e,t){for(var n=0,i=t.length;n<i;n+=3){var r=t[n],o=t[n+1],s=t[n+2];t[n]=e[0]*r+e[3]*o+e[6]*s,t[n+1]=e[1]*r+e[4]*o+e[7]*s,t[n+2]=e[2]*r+e[5]*o+e[8]*s}}function ET(e){for(var t=0,n=e.length;t<n;t+=3){var i=e[t],r=e[t+1],o=e[t+2],s=i*i+r*r+o*o;if(s>0){var a=1/Math.sqrt(s);e[t]=i*a,e[t+1]=r*a,e[t+2]=o*a}}}function xt(e){return new Float32Array(e||3)}function tr(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],c=n[2];e[0]=r*c-o*a,e[1]=o*s-i*c,e[2]=i*a-r*s}function qi(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Sn(e,t,n){e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2]}function to(e,t,n){e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2]}function Fi(e,t,n){n===void 0&&(n=0),e[0]=t[n],e[1]=t[n+1],e[2]=t[n+2]}function At(e,t,n){n===void 0&&(n=0),t[n]=e[0],t[n+1]=e[1],t[n+2]=e[2]}function IT(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function xa(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}function kl(e,t,n){rn(e,t,1/n)}function rn(e,t,n){e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n}function Pn(e,t){var n=IT(t);n==0?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):rn(e,t,1/Math.sqrt(n))}function LT(e,t,n){e[0]=t[0]-n,e[1]=t[1]-n,e[2]=t[2]-n}function gm(e,t,n){e[0]=t[0]+n,e[1]=t[1]+n,e[2]=t[2]+n}function Xx(e,t){e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2])}function Rh(e,t){e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2])}function b0(e,t){e[0]=-t[0],e[1]=-t[1],e[2]=-t[2]}function QF(e,t){t===void 0&&(t=9);for(var n=Math.floor(t/2),i=e.position1.length/3,r=3*(n*i),o=1/t,s=v0(e.position1,e.position2),a=new Float32Array(r),c=new Float32Array(r),l=new T,u=0;u<i;++u){var h=3*u;l.set(s[h],s[h+1],s[h+2]);for(var f=e.position1[h],p=e.position1[h+1],m=e.position1[h+2],y=0;y<n;++y){var v=n*h+3*y,d=o*(2*y+1),g=o*(2*y+2);a[v]=f+l.x*d,a[v+1]=p+l.y*d,a[v+2]=m+l.z*d,c[v]=f+l.x*g,c[v+1]=p+l.y*g,c[v+2]=m+l.z*g}}var b=No(a,c),x=function(S,w){for(var C=S.length/3,A=new Float32Array(C*w*3),k=0;k<C;++k)for(var L=3*k,D=k*w*3,F=S[L+0],I=S[L+1],P=S[L+2],N=0;N<w;++N){var $=D+3*N;A[$+0]=F,A[$+1]=I,A[$+2]=P}return A}(e.color,n),_={position:b,position1:a,position2:c,color:x,color2:x};return e.radius&&(_.radius=Z1(e.radius,n)),e.picking&&e.picking.array&&(e.picking.array=Z1(e.picking.array,n),_.picking=e.picking),e.primitiveId&&(_.primitiveId=Z1(e.primitiveId,n)),_}function RT(e,t){t===void 0&&(t=.1);for(var n=v0(e.position1,e.position2),i=[],r=[],o=[],s=e.radius?[]:void 0,a=e.picking?[]:void 0,c=e.primitiveId?[]:void 0,l=new T,u=e.position1.length/3,h=0,f=0;f<u;++f){var p=3*f;l.set(n[p],n[p+1],n[p+2]);for(var m=l.length()/t,y=Math.floor(m/2),v=1/m,d=e.position1[p],g=e.position1[p+1],b=e.position1[p+2],x=0;x<y;++x){var _=3*h+3*x,S=v*(2*x+1),w=v*(2*x+2);i[_]=d+l.x*S,i[_+1]=g+l.y*S,i[_+2]=b+l.z*S,r[_]=d+l.x*w,r[_+1]=g+l.y*w,r[_+2]=b+l.z*w,e.color&&(o[_]=e.color[p],o[_+1]=e.color[p+1],o[_+2]=e.color[p+2]),s&&(s[h+x]=e.radius[f]),a&&(e.picking.array?a[h+x]=e.picking.array[f]:a[h+x]=f),c&&(c[h+x]=e.primitiveId[f])}h+=y}var C=new Float32Array(i),A=new Float32Array(r),k=No(C,A),L=new Float32Array(o),D={position:k,position1:C,position2:A,color:L,color2:L};return s&&(D.radius=new Float32Array(s)),a&&e.picking&&(e.picking.array=new Float32Array(a),D.picking=e.picking),c&&(D.primitiveId=new Float32Array(c)),D}function Yx(e,t){t===void 0&&(t=.1);for(var n=v0(e.position1,e.position2),i=[],r=[],o=[],s=e.radius?[]:void 0,a=e.picking?[]:void 0,c=e.primitiveId?[]:void 0,l=new T,u=e.position1.length/3,h=t,f=!0,p=0,m=0,y=0,v=0;v<u;++v){var d=3*v,g=e.position1[d],b=e.position1[d+1],x=e.position1[d+2];l.set(n[d],n[d+1],n[d+2]);var _=l.length();f&&(i[m]=g,i[m+1]=b,i[m+2]=x);for(var S=h,w=1/_;S<_;){var C=f?r:i;C[m]=g+l.x*S*w,C[m+1]=b+l.y*S*w,C[m+2]=x+l.z*S*w,f&&(m=3*++p),f=!f,h=t,S+=t}f&&(r[m]=e.position2[d],r[m+1]=e.position2[d+1],r[m+2]=e.position2[d+2],m=3*++p),h=S-_;for(var A=y;A<p;A++){if(e.color){var k=3*A;o[k]=e.color[d],o[k+1]=e.color[d+1],o[k+2]=e.color[d+2]}s&&(s[A]=e.radius[v]),a&&(e.picking.array?a[A]=e.picking.array[v]:a[A]=v),c&&(c[A]=e.primitiveId[v])}y=p}if(!f&&u>0){var L=3*p;r[L]=e.position2[3*u-3],r[L+1]=e.position2[3*u-2],r[L+1]=e.position2[3*u-1]}var D=new Float32Array(i),F=new Float32Array(r),I=No(D,F),P=new Float32Array(o),N={position:I,position1:D,position2:F,color:P,color2:P};return s&&(N.radius=new Float32Array(s)),a&&e.picking&&(e.picking.array=new Float32Array(a),N.picking=e.picking),c&&(N.primitiveId=new Float32Array(c)),N}ll.prototype.post=function(e,t,n,i){e===void 0&&(e={});var r=this.getNextWorker();return r?r.post(e,t,n,i):console.error("unable to get worker from pool"),this},ll.prototype.terminate=function(){this.pool.forEach(function(e){e.terminate()})},ll.prototype.getNextWorker=function(){for(var e,t=1/0,n=0;n<this.maxCount;++n){if(n>=this.count){e=new Ug(this.name),this.pool.push(e),this.count+=1;break}var i=this.pool[n];if(i.pending===0){e=i;break}i.pending<t&&(t=i.pending,e=i)}return e},ll.prototype.constructor=ll,ip.__deps=[xt],kl.__deps=[rn],Pn.__deps=[rn,IT];var Ea=new T,oi=function(){},ay={Picker:{configurable:!0},Buffer:{configurable:!0}};ay.Picker.get=function(){return Ar.get(this.type)},ay.Buffer.get=function(){return _r.get(this.type)},oi.getShapeKey=function(e){return this.type+e[0].toUpperCase()+e.substr(1)},oi.expandBoundingBox=function(e,t){},oi.valueToShape=function(e,t,n){var i,r,o=e._primitiveData[this.getShapeKey(t)];switch(this.fields[t]){case"v3":case"c":r=o,(i=n).toArray!==void 0?i=i.toArray():i.x!==void 0?i=[i.x,i.y,i.z]:i.r!==void 0&&(i=[i.r,i.g,i.b]),r.push.apply(r,i);break;default:o.push(n)}},oi.objectToShape=function(e,t){var n=this;Object.keys(this.fields).forEach(function(i){n.valueToShape(e,i,t[i])}),this.valueToShape(e,"name",t.name),this.expandBoundingBox(e.boundingBox,t)},oi.valueFromShape=function(e,t,n){var i=e._primitiveData[this.getShapeKey(n)];switch(this.fields[n]){case"v3":return new T().fromArray(i,3*t);case"c":return new Fe().fromArray(i,3*t);default:return i[t]}},oi.objectFromShape=function(e,t){var n=this,i=this.valueFromShape(e,t,"name");i===void 0&&(i=this.type+": "+t+" ("+e.name+")");var r={shape:e,name:i};return Object.keys(this.fields).forEach(function(o){r[o]=n.valueFromShape(e,t,o)}),r},oi.arrayFromShape=function(e,t){var n=e._primitiveData[this.getShapeKey(t)];return this.fields[t]==="s"?n:new Float32Array(n)},oi.dataFromShape=function(e){var t=this,n={};return this.Picker&&(n.picking=new this.Picker(e)),Object.keys(this.fields).forEach(function(i){n[i]=t.arrayFromShape(e,i)}),n},oi.bufferFromShape=function(e,t){return new this.Buffer(this.dataFromShape(e),t)},Object.defineProperties(oi,ay),oi.type="",oi.fields={};var Au=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.positionFromShape=function(n,i){return this.valueFromShape(n,i,"position")},t.expandBoundingBox=function(n,i){n.expandByPoint(Ea.fromArray(i.position))},t}(oi);Au.type="sphere",Au.fields={position:"v3",color:"c",radius:"f"};var Pc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.positionFromShape=function(n,i){return this.valueFromShape(n,i,"position")},t.expandBoundingBox=function(n,i){n.expandByPoint(Ea.fromArray(i.position))},t}(oi);Pc.type="box",Pc.fields={position:"v3",color:"c",size:"f",heightAxis:"v3",depthAxis:"v3"};var _0=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Pc);_0.type="octahedron";var w0=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Pc);w0.type="tetrahedron";var Tc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.positionFromShape=function(n,i){var r=this.valueFromShape(n,i,"position1"),o=this.valueFromShape(n,i,"position2");return r.add(o).multiplyScalar(.5)},t.expandBoundingBox=function(n,i){n.expandByPoint(Ea.fromArray(i.position1)),n.expandByPoint(Ea.fromArray(i.position2))},t.bufferFromShape=function(n,i){i===void 0&&(i={});var r=this.dataFromShape(n);return this.type==="cylinder"&&i.dashedCylinder&&(r=RT(r)),new this.Buffer(r,i)},t}(oi);Tc.type="cylinder",Tc.fields={position1:"v3",position2:"v3",color:"c",radius:"f"};var S0=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Tc);S0.type="arrow";var M0=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Tc);M0.type="cone";var Cu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Au);Cu.type="ellipsoid",Cu.fields={position:"v3",color:"c",radius:"f",majorAxis:"v3",minorAxis:"v3"};var A0=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Cu);A0.type="torus";var Gg=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.positionFromShape=function(n,i){return this.valueFromShape(n,i,"position")},t.expandBoundingBox=function(n,i){n.expandByPoint(Ea.fromArray(i.position))},t}(oi);Gg.type="text",Gg.fields={position:"v3",color:"c",size:"f",text:"s"};var rp=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.positionFromShape=function(n,i){return this.valueFromShape(n,i,"position")},t.expandBoundingBox=function(n,i){n.expandByPoint(Ea.fromArray(i.position))},t}(oi);rp.type="point",rp.fields={position:"v3",color:"c"};var op=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.positionFromShape=function(n,i){var r=this.valueFromShape(n,i,"position1"),o=this.valueFromShape(n,i,"position2");return r.add(o).multiplyScalar(.5)},t.expandBoundingBox=function(n,i){n.expandByPoint(Ea.fromArray(i.position1)),n.expandByPoint(Ea.fromArray(i.position2))},t}(oi);op.type="wideline",op.fields={position1:"v3",position2:"v3",color:"c"};var Ec=function(e,t){this.exp=3;var n=t||function(L){for(var D=L.x,F=L.y,I=L.z,P=new hn,N=D.length,$=P.min,B=P.max,q=0;q<N;q++)$.x=Math.min(D[q],$.x),$.y=Math.min(F[q],$.y),$.z=Math.min(I[q],$.z),B.x=Math.max(D[q],B.x),B.y=Math.max(F[q],B.y),B.z=Math.max(I[q],B.z);return P}(e);this.minX=n.min.x,this.minY=n.min.y,this.minZ=n.min.z,this.boundX=1+(n.max.x-this.minX>>this.exp),this.boundY=1+(n.max.y-this.minY>>this.exp),this.boundZ=1+(n.max.z-this.minZ>>this.exp);for(var i=this.boundX*this.boundY*this.boundZ,r=e.count!==void 0?e.count:e.x.length,o=e.x,s=e.y,a=e.z,c=0,l=new Uint32Array(i),u=new Int32Array(r),h=0;h<r;++h){var f=o[h]-this.minX>>this.exp,p=s[h]-this.minY>>this.exp,m=a[h]-this.minZ>>this.exp,y=(f*this.boundY+p)*this.boundZ+m;(l[y]+=1)===1&&(c+=1),u[h]=y}for(var v=new Uint16Array(c),d=0,g=0;d<i;++d){var b=l[d];b>0&&(l[d]=g+1,v[g]=b,g+=1)}for(var x=new Uint32Array(c),_=1;_<c;++_)x[_]+=x[_-1]+v[_-1];for(var S=new Uint16Array(c),w=new Int32Array(r),C=0;C<r;++C){var A=l[u[C]];if(A>0){var k=A-1;w[x[k]+S[k]]=C,S[k]+=1}}this.grid=l,this.bucketCount=v,this.bucketOffset=x,this.bucketArray=w,this.xArray=o,this.yArray=s,this.zArray=a};Ec.prototype.within=function(e,t,n,i){var r=[];return this.eachWithin(e,t,n,i,function(o){return r.push(o)}),r},Ec.prototype.eachWithin=function(e,t,n,i,r){for(var o=i*i,s=Math.max(0,e-i-this.minX>>this.exp),a=Math.max(0,t-i-this.minY>>this.exp),c=Math.max(0,n-i-this.minZ>>this.exp),l=Math.min(this.boundX,1+(e+i-this.minX>>this.exp)),u=Math.min(this.boundY,1+(t+i-this.minY>>this.exp)),h=Math.min(this.boundZ,1+(n+i-this.minZ>>this.exp)),f=s;f<l;++f)for(var p=a;p<u;++p)for(var m=c;m<h;++m){var y=(f*this.boundY+p)*this.boundZ+m,v=this.grid[y];if(v>0)for(var d=v-1,g=this.bucketOffset[d],b=g+this.bucketCount[d],x=g;x<b;++x){var _=this.bucketArray[x],S=this.xArray[_]-e,w=this.yArray[_]-t,C=this.zArray[_]-n,A=S*S+w*w+C*C;A<=o&&r(_,A)}}};var hi=function(e){this._fields=this._defaultFields,this._init(0)},bS={_defaultFields:{configurable:!0}};bS._defaultFields.get=function(){return[]},hi.prototype._init=function(e){this.length=e,this.count=0;for(var t=0,n=this._fields.length;t<n;++t){var i=this._fields[t],r=i[0],o=i[1],s=i[2];this._initField(r,o,s)}},hi.prototype._initField=function(e,t,n){this[e]=yT(n,this.length*t)},hi.prototype.addField=function(e,t,n){this._fields.push([e,t,n]),this._initField(e,t,n)},hi.prototype.resize=function(e){this.length=Math.round(e||0),this.count=Math.min(this.count,this.length);for(var t=0,n=this._fields.length;t<n;++t){var i=this._fields[t][0],r=this._fields[t][1],o=this.length*r,s=new this[i].constructor(o);this[i].length>o?s.set(this[i].subarray(0,o)):s.set(this[i]),this[i]=s}},hi.prototype.growIfFull=function(){if(this.count>=this.length){var e=Math.round(1.5*this.length);this.resize(Math.max(256,e))}},hi.prototype.copyFrom=function(e,t,n,i){for(var r=0,o=this._fields.length;r<o;++r)for(var s=this._fields[r][0],a=this._fields[r][1],c=this[s],l=e[s],u=0;u<i;++u)for(var h=a*(t+u),f=a*(n+u),p=0;p<a;++p)c[h+p]=l[f+p]},hi.prototype.copyWithin=function(e,t,n){for(var i=0,r=this._fields.length;i<r;++i)for(var o=this._fields[i][0],s=this._fields[i][1],a=this[o],c=0;c<n;++c)for(var l=s*(e+c),u=s*(t+c),h=0;h<s;++h)a[l+h]=a[u+h]},hi.prototype.sort=function(e){de.time("Store.sort");var t=this,n=new this.constructor(1);(function i(r,o){if(r<o){var s=Math.floor((r+o)/2),a=r,c=o;do{for(;e(a,s)<0;)a+=1;for(;e(c,s)>0;)c-=1;a<=c&&(a===s?s=c:c===s&&(s=a),(l=a)!==(u=c)&&(n.copyFrom(t,0,l,1),t.copyWithin(l,u,1),t.copyFrom(n,u,0,1)),a+=1,c-=1)}while(a<=c);i(r,c),i(a,o)}var l,u})(0,this.count-1),de.timeEnd("Store.sort")},hi.prototype.clear=function(){this.count=0},hi.prototype.dispose=function(){for(var e=0,t=this._fields.length;e<t;++e)delete this[this._fields[e][0]]},Object.defineProperties(hi.prototype,bS);var JF=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={_defaultFields:{configurable:!0}};return n._defaultFields.get=function(){return[["index1",1,"int32"],["index2",1,"int32"],["type",1,"int8"]]},t.prototype.addContact=function(i,r,o){this.growIfFull();var s=this.count;i<r?(this.index1[s]=i,this.index2[s]=r):(this.index2[s]=i,this.index1[s]=r),o&&(this.type[s]=o),this.count+=1},Object.defineProperties(t.prototype,n),t}(hi);function Od(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24}var gt=function(e,t){this.length=e,this._words=new Uint32Array(e+32>>>5),t===!0&&this.setAll()};function OT(e){for(var t=e.edgeCount,n=e.nodeCount,i=e.nodeArray1,r=e.nodeArray2,o=new Uint8Array(n),s=new Int32Array(n),a=0;a<t;++a)o[i[a]]+=1,o[r[a]]+=1;for(var c=1;c<n;++c)s[c]+=s[c-1]+o[c-1];for(var l=2*t,u=new Int32Array(l),h=0;h<l;++h)u[h]=-1;for(var f=0;f<t;++f){for(var p=i[f],m=r[f],y=s[p];u[y]!==-1&&y<l;)y+=1;u[y]=f;for(var v=s[m];u[v]!==-1&&v<l;)v+=1;u[v]=f}return{countArray:o,offsetArray:s,indexArray:u}}function ii(e,t){return e===void 0&&(e=0),t===void 0&&(t=0),{type:e,group:t,x:0,y:0,z:0,atomSet:[]}}function Nn(e,t){e.x+=t.x,e.y+=t.y,e.z+=t.z,e.atomSet.push(t.index)}function zn(e,t){var n=t.atomSet.length;if(n>0){var i=e.types,r=e.groups,o=e.centers,s=e.atomSets;i.push(t.type),r.push(t.group),o.x.push(t.x/n),o.y.push(t.y/n),o.z.push(t.z/n),s.push(t.atomSet)}}gt.prototype.get=function(e){return(this._words[e>>>5]&1<<e)!=0},gt.prototype.set=function(e){this._words[e>>>5]|=1<<e},gt.prototype.clear=function(e){this._words[e>>>5]&=~(1<<e)},gt.prototype.flip=function(e){this._words[e>>>5]^=1<<e},gt.prototype._assignRange=function(e,t,n){if(!(t<e)){for(var i=this._words,r=n===!0?4294967295:0,o=e>>>5,s=t>>>5,a=o+1;a<s;++a)i[a]=r;var c=o<<5,l=s<<5;if(n===!0)if(t-e<32)for(var u=e,h=t+1;u<h;++u)i[u>>>5]|=1<<u;else{for(var f=e,p=c+32;f<p;++f)i[f>>>5]|=1<<f;for(var m=l,y=t+1;m<y;++m)i[m>>>5]|=1<<m}else if(t-e<32)for(var v=e,d=t+1;v<d;++v)i[v>>>5]&=~(1<<v);else{for(var g=e,b=c+32;g<b;++g)i[g>>>5]&=~(1<<g);for(var x=l,_=t+1;x<_;++x)i[x>>>5]&=~(1<<x)}return this}},gt.prototype.setRange=function(e,t){return this._assignRange(e,t,!0)},gt.prototype.clearRange=function(e,t){return this._assignRange(e,t,!1)},gt.prototype.setBits=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var n=this._words,i=e.length,r=0;r<i;++r){var o=e[r];n[o>>>5]|=1<<o}return this},gt.prototype.clearBits=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var n=this._words,i=e.length,r=0;r<i;++r){var o=e[r];n[o>>>5]&=~(1<<o)}return this},gt.prototype.setAll=function(){return this._assignRange(0,this.length-1,!0)},gt.prototype.clearAll=function(){return this._assignRange(0,this.length-1,!1)},gt.prototype.flipAll=function(){for(var e=this._words.length,t=this._words,n=32-this.length%32,i=0;i<e-1;++i)t[i]=~t[i];return t[e-1]=~(t[e-1]<<n)>>>n,this},gt.prototype._isRangeValue=function(e,t,n){if(!(t<e)){for(var i=this._words,r=n===!0?4294967295:0,o=e>>>5,s=t>>>5,a=o+1;a<s;++a)if(i[a]!==r)return!1;if(t-e<32){for(var c=e,l=t+1;c<l;++c)if(!!(i[c>>>5]&1<<c)!==n)return!1}else{for(var u=s<<5,h=e,f=(o<<5)+32;h<f;++h)if(!!(i[h>>>5]&1<<h)!==n)return!1;for(var p=u,m=t+1;p<m;++p)if(!!(i[p>>>5]&1<<p)!==n)return!1}return!0}},gt.prototype.isRangeSet=function(e,t){return this._isRangeValue(e,t,!0)},gt.prototype.isRangeClear=function(e,t){return this._isRangeValue(e,t,!1)},gt.prototype.isAllSet=function(){return this._isRangeValue(0,this.length-1,!0)},gt.prototype.isAllClear=function(){return this._isRangeValue(0,this.length-1,!1)},gt.prototype.isSet=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var n=this._words,i=e.length,r=0;r<i;++r){var o=e[r];if(!(n[o>>>5]&1<<o))return!1}return!0},gt.prototype.isClear=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var n=this._words,i=e.length,r=0;r<i;++r){var o=e[r];if(n[o>>>5]&1<<o)return!1}return!0},gt.prototype.isEqualTo=function(e){for(var t=this._words,n=e._words,i=Math.min(t.length,n.length),r=0;r<i;++r)if(t[r]!==n[r])return!1;return!0},gt.prototype.getSize=function(){for(var e=this._words.length,t=this._words,n=0,i=0;i<e;++i)n+=Od(t[i]);return n},gt.prototype.difference=function(e){for(var t=this._words,n=e._words,i=Math.min(t.length,n.length),r=0;r<i;++r)t[r]=t[r]&~n[r];for(var o=t.length;o<i;++o)t[o]=0;return this},gt.prototype.union=function(e){for(var t=this._words,n=e._words,i=Math.min(t.length,n.length),r=0;r<i;++r)t[r]|=n[r];for(var o=t.length;o<i;++o)t[o]=0;return this},gt.prototype.intersection=function(e){for(var t=this._words,n=e._words,i=Math.min(t.length,n.length),r=0;r<i;++r)t[r]&=n[r];for(var o=t.length;o<i;++o)t[o]=0;return this},gt.prototype.intersects=function(e){for(var t=this._words,n=e._words,i=Math.min(t.length,n.length),r=0;r<i;++r)if(t[r]&n[r])return!0;return!1},gt.prototype.getIntersectionSize=function(e){for(var t=this._words,n=e._words,i=Math.min(t.length,n.length),r=0,o=0;o<i;++o)r+=Od(t[o]&n[o]);return r},gt.prototype.makeIntersection=function(e){var t=this._words,n=e._words,i=Math.min(t.length,n.length),r=new Uint32Array(i),o=Object.create(gt.prototype);o._words=r,o.length=Math.min(this.length,e.length);for(var s=0;s<i;++s)r[s]=t[s]&n[s];return o},gt.prototype.forEach=function(e){for(var t=this._words.length,n=this._words,i=0,r=0;r<t;++r)for(var o=n[r];o!==0;){var s=o&-o;e((r<<5)+Od(s-1),i),o^=s,++i}},gt.prototype.toArray=function(){for(var e=this._words,t=new Array(this.getSize()),n=this._words.length,i=0,r=0;r<n;++r)for(var o=e[r];o!==0;){var s=o&-o;t[i++]=(r<<5)+Od(s-1),o^=s}return t},gt.prototype.toString=function(){return"{"+this.toArray().join(",")+"}"},gt.prototype.toSeleString=function(){var e=this.toArray().join(",");return e?"@"+e:"NONE"},gt.prototype.clone=function(){var e=Object.create(gt.prototype);return e.length=this.length,e._words=new Uint32Array(this._words),e};var eN=["D-BETA-PEPTIDE, C-GAMMA LINKING","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-PEPTIDE COOH CARBOXY TERMINUS","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE LINKING","PEPTIDE LINKING","PEPTIDE-LIKE"],tN=["RNA OH 3 PRIME TERMINUS","RNA OH 5 PRIME TERMINUS","RNA LINKING"],nN=["DNA OH 3 PRIME TERMINUS","DNA OH 5 PRIME TERMINUS","DNA LINKING","L-DNA LINKING","L-RNA LINKING"],kT=["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","SACCHARIDE"],iN=["NON-POLYMER"].concat(["OTHER"],kT),DT=["h","g","i"],BT=["e","b"],FT=["s","t","l",""],rN={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109,DS:110,RG:111,CN:112,NH:113,FL:114,MC:115,LV:116,TS:117,OG:118},oN={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:2,114:2,115:2,116:2,117:2,118:2},sN={1:.31,2:.28,3:1.28,4:.96,5:.84,6:.76,7:.71,8:.66,9:.57,10:.58,11:1.66,12:1.41,13:1.21,14:1.11,15:1.07,16:1.05,17:1.02,18:1.06,19:2.03,20:1.76,21:1.7,22:1.6,23:1.53,24:1.39,25:1.39,26:1.32,27:1.26,28:1.24,29:1.32,30:1.22,31:1.22,32:1.2,33:1.19,34:1.2,35:1.2,36:1.16,37:2.2,38:1.95,39:1.9,40:1.75,41:1.64,42:1.54,43:1.47,44:1.46,45:1.42,46:1.39,47:1.45,48:1.44,49:1.42,50:1.39,51:1.39,52:1.38,53:1.39,54:1.4,55:2.44,56:2.15,57:2.07,58:2.04,59:2.03,60:2.01,61:1.99,62:1.98,63:1.98,64:1.96,65:1.94,66:1.92,67:1.92,68:1.89,69:1.9,70:1.87,71:1.87,72:1.75,73:1.7,74:1.62,75:1.51,76:1.44,77:1.41,78:1.36,79:1.36,80:1.32,81:1.45,82:1.46,83:1.48,84:1.4,85:1.5,86:1.5,87:2.6,88:2.21,89:2.15,90:2.06,91:2,92:1.96,93:1.9,94:1.87,95:1.8,96:1.69,97:1.6,98:1.6,99:1.6,100:1.6,101:1.6,102:1.6,103:1.6,104:1.6,105:1.6,106:1.6,107:1.6,108:1.6,109:1.6,110:1.6,111:1.6,112:1.6,113:1.6,114:1.6,115:1.6,116:1.6,117:1.6,118:1.6},_S={1:[1],2:[0],3:[1],4:[2],5:[3],6:[4],7:[3],8:[2],9:[1],10:[0],11:[1],12:[2],13:[6],14:[6],15:[3,5,7],16:[2,4,6],17:[1],18:[0],19:[1],20:[2],31:[3],32:[4],33:[3,5],34:[2,4,6],35:[1],36:[0],37:[1],38:[2],49:[3],50:[4],51:[3,5],52:[2],53:[1,2,5],54:[0,2],55:[1],56:[2],81:[3],82:[4],83:[3],84:[2],85:[1],86:[0],87:[1],88:[2]},aN={1:1,2:2,3:1,4:2,5:3,6:4,7:5,8:6,9:7,10:8,11:1,12:2,13:3,14:4,15:5,16:6,17:7,18:8,19:1,20:2,21:3,22:4,23:5,24:6,25:7,26:8,27:9,28:10,29:11,30:2,31:3,32:4,33:5,34:6,35:7,36:8,37:1,38:2,39:3,40:4,41:5,42:6,43:7,44:8,45:9,46:10,47:11,48:2,49:3,50:4,51:5,52:6,53:7,54:8,55:1,56:2,57:3,58:4,59:3,60:4,61:5,62:6,63:7,64:8,65:9,66:10,67:11,68:12,69:13,70:14,71:15,72:4,73:5,74:6,75:7,76:8,77:9,78:10,79:11,80:2,81:3,82:4,83:5,84:6,85:7,86:8,87:1,88:2,89:3,90:4,91:3,92:4,93:5,94:6,95:7,96:8,97:9,98:10,99:11,100:12,101:13,102:14,103:15,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:3,114:4,115:5,116:6,117:7,118:8},wS={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53]},cN=[0,0,0],$g={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O"},ql=Object.keys($g),NT=["A","C","T","G","U","I"],zT=["DA","DC","DT","DG","DU","DI"],lN=["A","G","I","DA","DG","DI"],Yh=NT.concat(zT),Vg=["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP3","TIP4","SPC"],uN=["118","119","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","543","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MLT","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","NCO","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","OHX"],hN=["045","0AT","0BD","0MK","0NZ","0TS","0V4","0XY","0YT","10M","147","149","14T","15L","16G","18T","18Y","1AR","1BW","1GL","1GN","1JB","1LL","1NA","1S3","26M","26Q","26R","26V","26W","26Y","27C","289","291","293","2DG","2F8","2FG","2FL","2FP","2GL","2M4","2M5","32O","34V","3CM","3DO","3DY","3FM","3LR","3MF","3MG","3SA","3ZW","46D","46M","46Z","48Z","4CQ","4GC","4NN","50A","5DI","5GF","5MM","5RP","5SA","5SP","64K","6PG","6SA","7JZ","7SA","A1Q","A2G","AAB","AAL","AAO","ABC","ABD","ABE","ABF","ABL","ACG","ACI","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AHR","AIG","ALL","ALX","AMU","AOG","AOS","ARA","ARB","ARE","ARI","ASG","ASO","AXP","AXR","B0D","B16","B2G","B4G","B6D","B8D","B9D","BBK","BCD","BDG","BDP","BDR","BEM","BFP","BGC","BGL","BGP","BGS","BHG","BMA","BMX","BNG","BNX","BOG","BRI","BXF","BXP","BXX","BXY","C3X","C4X","C5X","CAP","CBI","CBK","CBS","CDR","CEG","CGF","CHO","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D6G","DAF","DAG","DDA","DDB","DDL","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGS","DIG","DLF","DLG","DMU","DNO","DOM","DP5","DQQ","DQR","DR2","DR3","DR4","DRI","DSR","DT6","DVC","E4P","E5G","EAG","EBG","EBQ","EGA","EJT","EPG","ERE","ERI","F1P","F1X","F6P","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FIX","FMO","FRU","FSI","FU4","FUB","FUC","FUD","FUL","FXP","G16","G1P","G2F","G3I","G4D","G4S","G6D","G6P","G6S","GAC","GAD","GAL","GC1","GC4","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GCX","GE1","GFG","GFP","GIV","GL0","GL2","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GMH","GN1","GNX","GP1","GP4","GPH","GPM","GQ1","GQ2","GQ4","GS1","GS4","GSA","GSD","GTE","GTH","GTK","GTR","GTZ","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUP","GUZ","GYP","GYV","H2P","HDL","HMS","HS2","HSD","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","IAB","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IMK","IN1","IPT","ISL","KBG","KD2","KDA","KDM","KDO","KFN","KO1","KO2","KTU","L6S","LAG","LAI","LAK","LAO","LAT","LB2","LBT","LCN","LDY","LGC","LGU","LM2","LMT","LMU","LOG","LOX","LPK","LSM","LTM","LVZ","LXB","LXZ","M1F","M3M","M6P","M8C","MA1","MA2","MA3","MAB","MAG","MAL","MAN","MAT","MAV","MAW","MBG","MCU","MDA","MDM","MDP","MFA","MFB","MFU","MG5","MGA","MGL","MLB","MMA","MMN","MN0","MRP","MTT","MUG","MVP","MXY","N1L","N9S","NAA","NAG","NBG","NDG","NED","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGL","NGS","NGY","NHF","NM6","NM9","NTF","NTO","NTP","NXD","NYT","OPG","OPM","ORP","OX2","P3M","P53","P6P","PA5","PNA","PNG","PNW","PRP","PSJ","PSV","PTQ","QDK","QPS","QV4","R1P","R1X","R2B","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RIB","RIP","RNS","RNT","ROB","ROR","RPA","RST","RUB","RUU","RZM","S6P","S7P","SA0","SCR","SDD","SF6","SF9","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHG","SI3","SIO","SOE","SOL","SSG","SUC","SUP","SUS","T6P","T6T","TAG","TCB","TDG","TGK","TGY","TH1","TIA","TM5","TM6","TM9","TMR","TMX","TOA","TOC","TRE","TYV","UCD","UDC","VG1","X0X","X1X","X2F","X4S","X5S","X6X","XBP","XDN","XDP","XIF","XIM","XLF","XLS","XMM","XUL","XXR","XYP","XYS","YO5","Z3Q","Z6J","Z9M","ZDC","ZDM"],fN=["CA","C","N","O","O1","O2","OC1","OC2","OX1","OXT","OT1","OT2","H","H1","H2","H3","HA","HN","BB"],UT=["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"],ym={1:{trace:"CA",direction1:"C",direction2:["O","OC1","O1","OX1","OXT","OT1","OT2"],backboneStart:"N",backboneEnd:"C"},2:{trace:["C4'","C4*"],direction1:["C1'","C1*"],direction2:["C3'","C3*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},3:{trace:["C3'","C3*"],direction1:["C2'","C2*"],direction2:["O4'","O4*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},4:{trace:["CA","BB"],backboneStart:["CA","BB"],backboneEnd:["CA","BB"]},5:{trace:["C4'","C4*","P"],backboneStart:["C4'","C4*","P"],backboneEnd:["C4'","C4*","P"]},6:{trace:["C3'","C3*","C2'","P"],backboneStart:["C3'","C3*","C2'","P"],backboneEnd:["C3'","C3*","C2'","P"]},0:{}},SS={HD:"H",HS:"H",A:"C",NA:"N",NS:"N",OA:"O",OS:"O",SA:"S",G0:"C",G1:"C",G2:"C",G3:"C",CG0:"C",CG1:"C",CG2:"C",CG3:"C",W:"O"};function kd(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}var MS=new Map([[2,Tn(180)],[3,Tn(120)],[4,Tn(109.4721)],[6,Tn(90)]]);function Dd(e,t){var n=[],i=new T,r=new T;return i.subVectors(t,e),e.eachBondedAtom(function(o){o.number!==1&&(r.subVectors(o,e),n.push(i.angleTo(r)))}),n}function AS(e,t){var n=e.clone(),i=new T;i.subVectors(t,e);var r=[new T,new T],o=0;if(e.eachBondedAtom(function(a){o>1||a.number!==1&&(n.index=a.index,r[o++].subVectors(a,e))}),o===1&&n.eachBondedAtom(function(a){o>1||a.number!==1&&a.index!==e.index&&r[o++].subVectors(a,e)}),o===2){var s=r[0].cross(r[1]);return Math.abs(Math.PI/2-s.angleTo(i))}}function pN(e,t){var n=e.structure,i=n.atomCount,r=new Int8Array(i),o=new Int8Array(i),s=new Int8Array(i),a=new Int8Array(i);return n.eachAtom(function(c){var l=c.index,u=function(y,v){var d=y.bondToElementCount(1),g=y.formalCharge||0,b=v.assignCharge==="always"||v.assignCharge==="auto"&&g===0,x=v.assignH==="always"||v.assignH==="auto"&&d===0,_=y.bondCount,S=function(D){var F=0;return D.eachBond(function(I){return F+=I.bondOrder}),F}(y),w=function(D){var F=D.structure.getBondProxy(),I=D.number,P=I===8||I===7;if(P&&D.bondCount===4)return!1;var N=!1;return D.eachBond(function($){if($.bondOrder>1)N=!0;else if(P){var B=$.getOtherAtom(D);B.eachBond(function(q){if(q.bondOrder>1){var ee=B.number;if((ee===15||ee===16)&&q.getOtherAtom(B).number===8)return;N=!0}},F)}}),N}(y),C=S-_>0,A=0,k=8;switch(y.number){case 1:b&&(_===0?(g=1,k=0):_===1&&(g=0,k=1));break;case 6:b&&(g=0),x&&(A=Math.max(0,4-S-Math.abs(g))),k=kd(_+A+Math.max(0,-g));break;case 7:if(b)if(x)if(w&&S<4)g=_-d==1&&S-d==2?1:0;else{var L=!1;y.eachBondedAtom(function(D){(D.number===16||D.isMetal())&&(L=!0)}),g=L?0:1}else g=S-3;x&&(A=Math.max(0,3-S+g)),k=kd(w&&!C?_+A-g:_+A+1-g);break;case 8:b&&(x||(g=S-2),S===1&&y.eachBondedAtom(function(D){D.eachBond(function(F){var I=F.getOtherAtom(D);I.index!==y.index&&I.number===8&&F.bondOrder===2&&(g=-1)})})),x&&(A=Math.max(0,2-S+g)),k=kd(w&&!C?_+A-g+1:_+A-g+2);break;case 16:b&&(x||(g=S<=3&&!y.bondToElementCount(8)?S-2:0)),x&&S<2&&(A=Math.max(0,2-S+g)),S<=3&&(k=kd(_+A-g+2));break;case 9:case 17:case 35:case 53:case 85:b&&(g=S-1);break;case 3:case 11:case 19:case 37:case 55:case 87:b&&(g=1-S);break;case 4:case 12:case 20:case 38:case 56:case 88:b&&(g=2-S);break;default:console.warn("Requested charge, protonation for an unhandled element",y.element)}return[g,A,A+d,k]}(c,t),h=u[0],f=u[1],p=u[2],m=u[3];r[l]=h,o[l]=f,s[l]=p,a[l]=m}),{charge:r,implicitH:o,totalH:s,idealGeometry:a}}function ul(e){if(e["@valenceModel"])return e["@valenceModel"];var t=pN(e,{assignCharge:"auto",assignH:"auto"});return e["@valenceModel"]=t,t}function CS(e){return e.number===15&&e.bondToElementCount(8)===e.bondCount}var dN=["ARG","HIS","LYS"],mN=["GLU","ASP"];function gN(e,t,n){n===void 0&&(n={});for(var i=O(n.maxIonicDist,wn.maxIonicDist),r=O(n.maxPiStackingDist,wn.maxPiStackingDist),o=O(n.maxPiStackingOffset,wn.maxPiStackingOffset),s=O(n.maxPiStackingAngle,wn.maxPiStackingAngle),a=O(n.maxCationPiDist,wn.maxCationPiDist),c=O(n.maxCationPiOffset,wn.maxCationPiOffset),l=O(n.masterModelIndex,wn.masterModelIndex),u=Math.max(i+2,r,a),h=r*r,f=a*a,p=t.features,m=t.spatialHash,y=t.contactStore,v=t.featureSet,d=p.types,g=p.centers,b=p.atomSets,x=g.x,_=g.y,S=g.z,w=d.length,C=e.atomStore.x,A=e.atomStore.y,k=e.atomStore.z,L=e.getAtomProxy(),D=e.getAtomProxy(),F=new T,I=new T,P=new T,N=new T,$=new T,B=new T,q=new T,ee=function(he,K){F.set(C[he[0]],A[he[0]],k[he[0]]),I.set(C[he[1]],A[he[1]],k[he[1]]),P.set(C[he[2]],A[he[2]],k[he[2]]),N.subVectors(F,I),$.subVectors(F,P),K.crossVectors(N,$)},W=function(he,K,ce){return F.set(x[he],_[he],S[he]),I.set(x[K],_[K],S[K]),F.sub(I).projectOnPlane(ce).add(I).distanceTo(I)},Q=function(he,K,ce){v.setBits(he,K),y.addContact(he,K,ce)},Z=function(he){m.eachWithin(x[he],_[he],S[he],u,function(K,ce){if(!(K<=he||(L.index=b[he][0],D.index=b[K][0],Oh(L,D,l)))){var se=d[he],ue=d[K];if(function(fe,me){return fe===2&&me===1||fe===1&&me===2}(se,ue))(function(fe,me,ve){for(var G=fe.length,V=me.length,pe=0;pe<G;++pe){L.index=fe[pe];for(var le=0;le<V;++le)if(D.index=me[le],L.distanceTo(D)<=ve)return!0}return!1})(b[he],b[K],i)&&Q(he,K,1);else if(function(fe,me){return fe===3&&me===3}(se,ue)){if(ce<=h){ee(b[he],B),ee(b[K],q);var H=57.29578*B.angleTo(q);Math.min(W(he,K,q),W(K,he,B))<=o&&(H<=s||H>=180-s||H<=s+90&&H>=90-s)&&Q(he,K,3)}}else if(function(fe,me){return fe===3&&me===1||fe===1&&me===3}(se,ue)&&ce<=f){var j=se===3?[he,K]:[K,he],X=j[0],ie=j[1];ee(b[X],B),W(ie,X,B)<=c&&Q(X,ie,2)}}})},re=0;re<w;++re)Z(re)}function PS(e){return e.resname==="HIS"&&e.number==7&&e.isRing()}var yN=[3,11,19,37,55,12,20,38,56,13,31,49,81,21,50,82,83,51,80],vN=[17,35,53,85],xN=[7,8,16],bN=[6,7,15,16],_N=Tn(180),wN=Tn(120);function TS(e,t,n){return!GT(e,t,n)&&(e.modelIndex!==t.modelIndex||e.altloc&&t.altloc&&e.altloc!==t.altloc)}var wn={maxHydrophobicDist:4,maxHbondDist:3.5,maxHbondSulfurDist:4.1,maxHbondAccAngle:45,maxHbondDonAngle:45,maxHbondAccPlaneAngle:90,maxHbondDonPlaneAngle:30,maxPiStackingDist:5.5,maxPiStackingOffset:2,maxPiStackingAngle:30,maxCationPiDist:6,maxCationPiOffset:2,maxIonicDist:5,maxHalogenBondDist:4,maxHalogenBondAngle:30,maxMetalDist:3,refineSaltBridges:!0,masterModelIndex:-1,lineOfSightDistFactor:1};function GT(e,t,n){return e.modelIndex===n&&t.modelIndex!==n||t.modelIndex===n&&e.modelIndex!==n}function Oh(e,t,n){return!GT(e,t,n)&&(e.modelIndex!==t.modelIndex||e.residueIndex===t.residueIndex||e.altloc&&t.altloc&&e.altloc!==t.altloc)}function SN(e){var t={types:[],groups:[],centers:{x:[],y:[],z:[]},atomSets:[]};return Pe&&de.time("calculateFeatures"),function(n,i){var r=ul(n.data).charge,o={};n.eachResidue(function(s){if(dN.includes(s.resname)){var a=ii(1);s.eachAtom(function(c){c.number===7&&c.isSidechain()&&Nn(a,c)}),zn(i,a)}else ql.includes(s.resname)||s.isNucleic()||(s.eachAtom(function(c){var l=!1,u=ii(1);(function(h){var f=0;return h.number===6&&h.bondCount===3&&h.bondToElementCount(7)===3&&h.eachBondedAtom(function(p){p.bondCount-p.bondToElementCount(1)==1&&++f}),f===2})(c)?(u.group=8,l=!0):function(h){var f=0;return h.number===6&&h.bondCount===3&&h.bondToElementCount(7)===2&&h.bondToElementCount(6)===1&&h.eachBondedAtom(function(p){p.bondCount-p.bondToElementCount(1)==1&&++f}),f===2}(c)&&(u.group=9,l=!0),l&&(c.eachBondedAtom(function(h){h.number===7&&(o[h.index]=!0,Nn(u,h))}),zn(i,u))}),s.eachAtom(function(c){var l=ii(1);r[c.index]>0&&(o[c.index]||(Nn(l,c),zn(i,l)))}))})}(e,t),function(n,i){var r=ul(n.data).charge,o={};n.eachResidue(function(s){if(mN.includes(s.resname)){var a=ii(2);s.eachAtom(function(l){l.number===8&&l.isSidechain()&&Nn(a,l)}),zn(i,a)}else if(Yh.includes(s.resname)){var c=ii(2);s.eachAtom(function(l){CS(l)&&(c.group=6,l.eachBondedAtom(function(u){u.number===8&&Nn(c,u)}),zn(i,c))})}else ql.includes(s.resname)||Yh.includes(s.resname)||(s.eachAtom(function(l){var u=!1,h=ii(2);(function(f){return f.number===16&&f.bondToElementCount(8)===3})(l)?(h.group=4,u=!0):CS(l)?(h.group=6,u=!0):function(f){return f.number===16&&f.bondToElementCount(8)===4}(l)?(h.group=5,u=!0):function(f){var p=0;return f.number===6&&f.bondToElementCount(8)===2&&f.bondToElementCount(6)===1&&f.eachBondedAtom(function(m){m.number===8&&m.bondCount-m.bondToElementCount(1)==1&&++p}),p===2}(l)&&(h.group=10,u=!0),u&&(l.eachBondedAtom(function(f){f.number===8&&(o[f.index]=!0,Nn(h,f))}),zn(i,h))}),s.eachAtom(function(l){var u=ii(2);r[l.index]<0&&(o[l.index]||(Nn(u,l),zn(i,u)))}))})}(e,t),function(n,i){var r=n.getAtomProxy();n.eachResidue(function(o){var s=o.getAromaticRings();if(s){var a=o.atomOffset;s.forEach(function(c){var l=ii(3);c.forEach(function(u){r.index=u+a,Nn(l,r)}),zn(i,l)})}})}(e,t),function(n,i){var r=ul(n.data),o=r.charge,s=r.implicitH,a=r.idealGeometry;n.eachAtom(function(c){var l=ii(5),u=c.number;if(u===8)Nn(l,c),zn(i,l);else if(u===7){if(PS(c))Nn(l,c),zn(i,l);else if(o[c.index]<1){var h=c.bondCount+s[c.index],f=a[c.index];(f===4&&h<4||f===3&&h<3||f===2&&h<2)&&(Nn(l,c),zn(i,l))}}else u===16&&(c.resname!=="CYS"&&c.resname!=="MET"&&c.formalCharge!==-1||(Nn(l,c),zn(i,l)))})}(e,t),function(n,i){var r=ul(n.data).totalH;n.eachAtom(function(o){var s=ii(4),a=o.number;(PS(o)||r[o.index]>0&&(a===7||a===8||a===16))&&(Nn(s,o),zn(i,s))})}(e,t),function(n,i){var r=ul(n.data).totalH;n.eachAtom(function(o){if(o.number===6&&r[o.index]>0&&(o.bondToElementCount(7)>0||o.bondToElementCount(8)>0||function(a){if(!a.isAromatic())return!1;var c=a.residueType.getRings();if(!c)return!1;var l=!1;return c.rings.forEach(function(u){l||u.some(function(h){return a.index-a.residueAtomOffset===h})&&(l=u.some(function(h){var f=a.residueType.atomTypeIdList[h],p=a.atomMap.get(f).number;return p===7||p===8}))}),l}(o))){var s=ii(9);Nn(s,o),zn(i,s)}})}(e,t),function(n,i){n.eachAtom(function(r){var o=!1,s=!1,a=ql.includes(r.resname),c=Yh.includes(r.resname);if(a||c?a?r.number===8?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(r.resname)&&r.isSidechain()||r.isBackbone())&&(o=!0,s=!0):r.number===16&&r.resname==="CYS"?(o=!0,s=!0):r.number===7&&r.resname==="HIS"&&r.isSidechain()&&(o=!0):c&&(r.number===8&&r.isBackbone()?(o=!0,s=!0):["N3","N4","N7"].includes(r.atomname)?o=!0:["O2","O4","O6"].includes(r.atomname)&&(o=!0,s=!0)):r.isHalogen()||r.number===8||r.number===16?(o=!0,s=!0):r.number===7&&(o=!0),o){var l=ii(11);Nn(l,r),zn(i,l)}if(s){var u=ii(10);Nn(u,r),zn(i,u)}})}(e,t),function(n,i){n.eachAtom(function(r){if(r.isTransitionMetal()||r.number===30||r.number===48){var o=ii(12);Nn(o,r),zn(i,o)}else if(yN.includes(r.number)){var s=ii(13);Nn(s,r),zn(i,s)}})}(e,t),function(n,i){n.eachAtom(function(r){var o=ii(8),s=!1;r.number===6?(s=!0,r.eachBondedAtom(function(a){var c=a.number;c!==6&&c!==1&&(s=!1)})):r.number===9&&(s=!0),s&&(Nn(o,r),zn(i,o))})}(e,t),function(n,i){n.eachAtom(function(r){if(xN.includes(r.number)){var o=!1;if(r.eachBondedAtom(function(a){bN.includes(a.number)&&(o=!0)}),o){var s=ii(7);Nn(s,r),zn(i,s)}}})}(e,t),function(n,i){n.eachAtom(function(r){if(vN.includes(r.number)&&r.bondToElementCount(6)===1){var o=ii(6);Nn(o,r),zn(i,o)}})}(e,t),Pe&&de.timeEnd("calculateFeatures"),t}function MN(e,t){t===void 0&&(t=wn);var n=function(r){var o=r.types,s=r.centers;return{features:r,spatialHash:new Ec(s),contactStore:new JF,featureSet:new gt(o.length,!1)}}(SN(e));Pe&&de.time("calculateContacts"),gN(e,n,t),function(r,o,s){s===void 0&&(s={});for(var a=O(s.maxHbondDist,wn.maxHbondDist),c=O(s.maxHbondSulfurDist,wn.maxHbondSulfurDist),l=Tn(O(s.maxHbondAccAngle,wn.maxHbondAccAngle)),u=Tn(O(s.maxHbondDonAngle,wn.maxHbondDonAngle)),h=Tn(O(s.maxHbondAccPlaneAngle,wn.maxHbondAccPlaneAngle)),f=Tn(O(s.maxHbondDonPlaneAngle,wn.maxHbondDonPlaneAngle)),p=O(s.masterModelIndex,wn.masterModelIndex),m=Math.max(a,c),y=a*a,v=o.features,d=o.spatialHash,g=o.contactStore,b=o.featureSet,x=v.types,_=v.centers,S=v.atomSets,w=_.x,C=_.y,A=_.z,k=x.length,L=ul(r.data).idealGeometry,D=r.getAtomProxy(),F=r.getAtomProxy(),I=function(N){d.eachWithin(w[N],C[N],A[N],m,function($,B){if(!($<=N)){var q=x[N],ee=x[$],W=function(fe,me){return fe===9&&me===5||fe===5&&me===9}(q,ee);if(W||function(fe,me){return fe===5&&me===4||fe===4&&me===5}(q,ee)){var Q=ee===5?[N,$]:[$,N],Z=Q[0],re=Q[1];if(D.index=S[Z][0],F.index=S[re][0],F.index!==D.index&&!Oh(D,F,p)&&!(D.number!==16&&F.number!==16&&B>y||D.connectedTo(F))){var he=Dd(D,F),K=MS.get(L[D.index])||Tn(120);if(!he.some(function(fe){return Math.abs(K-fe)>u})){if(L[D.index]===3){var ce=AS(D,F);if(ce!==void 0&&ce>f)return}var se=Dd(F,D),ue=MS.get(L[F.index])||Tn(120);if(!se.some(function(fe){return ue-fe>l})){if(L[F.index]===3){var H=AS(F,D);if(H!==void 0&&H>h)return}b.setBits(Z,re);var j,X,ie=W?8:function(fe,me){return fe.isWater()&&me.isWater()}(j=D,X=F)?9:function(fe,me){return fe.isBackbone()&&me.isBackbone()}(j,X)?10:4;g.addContact(Z,re,ie)}}}}}})},P=0;P<k;++P)I(P)}(e,n,t),function(r,o,s){s===void 0&&(s={});for(var a=O(s.maxMetalDist,wn.maxMetalDist),c=O(s.masterModelIndex,wn.masterModelIndex),l=o.features,u=o.spatialHash,h=o.contactStore,f=o.featureSet,p=l.types,m=l.centers,y=l.atomSets,v=m.x,d=m.y,g=m.z,b=p.length,x=r.getAtomProxy(),_=r.getAtomProxy(),S=function(C){u.eachWithin(v[C],d[C],g[C],a,function(A,k){if(!(A<=C||(x.index=y[C][0],_.index=y[A][0],Oh(x,_,c)))){var L=x.isMetal(),D=_.isMetal();if(L||D){var F=L?[p[C],p[A]]:[p[A],p[C]];I=F[0],P=F[1],(I===12?P===11||P===12:I===13&&P===10)&&(f.setBits(C,A),h.addContact(C,A,7))}}var I,P})},w=0;w<b;++w)S(w)}(e,n,t),function(r,o,s){s===void 0&&(s={});for(var a=O(s.maxHydrophobicDist,wn.maxHydrophobicDist),c=O(s.masterModelIndex,wn.masterModelIndex),l=o.features,u=o.spatialHash,h=o.contactStore,f=o.featureSet,p=l.types,m=l.centers,y=l.atomSets,v=m.x,d=m.y,g=m.z,b=p.length,x=r.getAtomProxy(),_=r.getAtomProxy(),S=function(C){u.eachWithin(v[C],d[C],g[C],a,function(A,k){var L,D;A<=C||(x.index=y[C][0],_.index=y[A][0],Oh(x,_,c)||x.number===9&&_.number===9||x.connectedTo(_)||(L=p[C],D=p[A],L===8&&D===8&&(f.setBits(C,A),h.addContact(C,A,6))))})},w=0;w<b;++w)S(w)}(e,n,t),function(r,o,s){s===void 0&&(s={});for(var a=O(s.maxHalogenBondDist,wn.maxHalogenBondDist),c=Tn(O(s.maxHalogenBondAngle,wn.maxHalogenBondAngle)),l=O(s.masterModelIndex,wn.masterModelIndex),u=o.features,h=o.spatialHash,f=o.contactStore,p=o.featureSet,m=u.types,y=u.centers,v=u.atomSets,d=y.x,g=y.y,b=y.z,x=m.length,_=r.getAtomProxy(),S=r.getAtomProxy(),w=function(A){h.eachWithin(d[A],g[A],b[A],a,function(k,L){if(!(k<=A)&&(_.index=v[A][0],S.index=v[k][0],!Oh(_,S,l)&&(D=m[A],F=m[k],D===7&&F===6||D===6&&F===7))){var D,F,I=m[A]===6?[_,S]:[S,_],P=I[0],N=I[1],$=Dd(P,N);if($.length===1&&!(_N-$[0]>c)){var B=Dd(N,P);B.length!==0&&(B.some(function(q){return wN-q>c})||(p.setBits(A,k),f.addContact(A,k,5)))}}})},C=0;C<x;++C)w(C)}(e,n,t);var i=function(r){var o=r.contactStore,s=OT({nodeArray1:o.index1,nodeArray2:o.index2,edgeCount:o.count,nodeCount:r.featureSet.length}),a=new gt(r.contactStore.count,!0);return Object.assign({adjacencyList:s,contactSet:a},r)}(n);return function(r,o,s){s===void 0&&(s={}),Pe&&de.time("refineLineOfSight");var a=O(s.lineOfSightDistFactor,wn.lineOfSightDistFactor),c=O(s.masterModelIndex,wn.masterModelIndex),l=r.spatialHash,u=o.contactSet,h=o.contactStore,f=o.features,p=h.index1,m=h.index2,y=f.centers,v=f.atomSets,d=y.x,g=y.y,b=y.z,x=r.getAtomProxy(),_=r.getAtomProxy(),S=r.getAtomProxy(),w=new T,C=new T,A=3*a,k=a*a;u.forEach(function(L){w.set(d[p[L]],g[p[L]],b[p[L]]),C.set(d[m[L]],g[m[L]],b[m[L]]);var D=(w.x+C.x)/2,F=(w.y+C.y)/2,I=(w.z+C.z)/2,P=v[p[L]],N=v[m[L]];x.index=P[0],_.index=N[0],l.eachWithin(D,F,I,A,function($,B){S.index=$,S.number!==1&&S.vdw*S.vdw*k>B&&!TS(x,S,c)&&!TS(_,S,c)&&!P.includes($)&&!N.includes($)&&w.distanceToSquared(S)>1&&C.distanceToSquared(S)>1&&(u.clear(L),Pe&&de.log("removing",x.qualifiedName(),_.qualifiedName(),"because",S.qualifiedName()))})}),Pe&&de.timeEnd("refineLineOfSight")}(e,i,t),function(r,o){var s=o.contactSet,a=o.contactStore,c=o.features,l=a.type,u=a.index1,h=a.index2,f=c.atomSets,p=r.getAtomProxy(),m=r.getAtomProxy(),y={},v=function(d,g,b){var x=y[b]||[1/0,-1],_=x[0],S=x[1];d<_?(S!==-1&&s.clear(S),y[b]=[d,g]):s.clear(g)};s.forEach(function(d){if(l[d]===6){p.index=f[u[d]][0],m.index=f[h[d]][0];var g=p.distanceTo(m);v(g,d,p.index+"|"+m.residueIndex),v(g,d,m.index+"|"+p.residueIndex)}})}(e,i),t.refineSaltBridges&&function(r,o){var s=o.contactSet,a=o.contactStore,c=o.features,l=a.type,u=a.index1,h=a.index2,f=c.atomSets,p={},m=function(y,v){p[y]||(p[y]=[]),p[y].push(v)};s.forEach(function(y){l[y]===1&&(f[u[y]].forEach(function(v){return m(v,y)}),f[h[y]].forEach(function(v){return m(v,y)}))}),s.forEach(function(y){if(function(x){return x===4||x===9||x===10}(l[y])){var v=p[f[u[y]][0]],d=p[f[h[y]][0]];if(v&&d){for(var g=v.length,b=0;b<g;++b)if(d.includes(v[b]))return void s.clear(y)}}})}(0,i),function(r,o){var s=o.contactSet,a=o.contactStore,c=o.features,l=a.type,u=a.index1,h=a.index2,f=c.atomSets,p={},m=function(y,v){p[y]||(p[y]=[]),p[y].push(v)};s.forEach(function(y){l[y]===3&&(f[u[y]].forEach(function(v){return m(v,y)}),f[h[y]].forEach(function(v){return m(v,y)}))}),s.forEach(function(y){if(l[y]===6||l[y]===2){var v=p[f[u[y]][0]],d=p[f[h[y]][0]];if(v&&d){for(var g=v.length,b=0;b<g;++b)if(d.includes(v[b]))return void s.clear(y)}}})}(0,i),function(r,o){var s=o.contactSet,a=o.contactStore,c=o.features,l=a.type,u=a.index1,h=a.index2,f=c.atomSets,p={},m=function(y,v){p[y]||(p[y]=[]),p[y].push(v)};s.forEach(function(y){l[y]===1&&(f[u[y]].forEach(function(v){return m(v,y)}),f[h[y]].forEach(function(v){return m(v,y)}))}),s.forEach(function(y){if(l[y]===7){var v=p[f[u[y]][0]],d=p[f[h[y]][0]];if(v&&d){for(var g=v.length,b=0;b<g;++b)if(d.includes(v[b]))return void s.clear(v[b])}}})}(0,i),Pe&&de.timeEnd("calculateContacts"),i}function AN(e){switch(e){case 4:case 9:case 10:return"hydrogen bond";case 6:return"hydrophobic contact";case 5:return"halogen bond";case 1:return"ionic interaction";case 7:return"metal coordination";case 2:return"cation-pi interaction";case 3:return"pi-pi stacking";case 8:return"weak hydrogen bond";default:return"unknown contact"}}var CN={hydrogenBond:!0,hydrophobic:!0,halogenBond:!0,ionicInteraction:!0,metalCoordination:!0,cationPi:!0,piStacking:!0,weakHydrogenBond:!0,waterHydrogenBond:!0,backboneHydrogenBond:!0,radius:1,filterSele:""},Jo=new Fe;function PN(e,t,n){var i=br(n,CN),r=[];i.hydrogenBond&&r.push(4),i.hydrophobic&&r.push(6),i.halogenBond&&r.push(5),i.ionicInteraction&&r.push(1),i.metalCoordination&&r.push(7),i.cationPi&&r.push(2),i.piStacking&&r.push(3),i.weakHydrogenBond&&r.push(8),i.waterHydrogenBond&&r.push(9),i.backboneHydrogenBond&&r.push(10);var o,s=e.features,a=e.contactSet,c=e.contactStore,l=s.centers,u=s.atomSets,h=l.x,f=l.y,p=l.z,m=c.index1,y=c.index2,v=c.type,d=[],g=[],b=[],x=[],_=[];return i.filterSele&&(o=Array.isArray(i.filterSele)?i.filterSele.map(function(S){return t.getAtomSet(new Jt(S))}):t.getAtomSet(new Jt(i.filterSele))),a.forEach(function(S){var w=v[S];if(r.includes(w)){if(o){var C=u[m[S]][0],A=u[y[S]][0];if(Array.isArray(o)){if(!(o[0].isSet(C)&&o[1].isSet(A)||o[1].isSet(C)&&o[0].isSet(A)))return}else if(!o.isSet(C)&&!o.isSet(A))return}var k=m[S],L=y[S];d.push(h[k],f[k],p[k]),g.push(h[L],f[L],p[L]),b.push.apply(b,function(D){switch(D){case 4:case 9:case 10:return Jo.setHex(2851770).toArray();case 6:return Jo.setHex(8421504).toArray();case 5:return Jo.setHex(4259775).toArray();case 1:return Jo.setHex(15779860).toArray();case 7:return Jo.setHex(9191577).toArray();case 2:return Jo.setHex(16744448).toArray();case 3:return Jo.setHex(9220966).toArray();case 8:return Jo.setHex(12967404).toArray();default:return Jo.setHex(13421772).toArray()}}(w)),x.push(i.radius),_.push(S)}}),{position1:new Float32Array(d),position2:new Float32Array(g),color:new Float32Array(b),color2:new Float32Array(b),radius:new Float32Array(x),picking:new LN(_,e,t)}}var Ai=function(e){this.array=e},cy={type:{configurable:!0},data:{configurable:!0}};cy.type.get=function(){return""},cy.data.get=function(){return{}},Ai.prototype.getIndex=function(e){return this.array?this.array[e]:e},Ai.prototype.getObject=function(e){return{}},Ai.prototype._applyTransformations=function(e,t,n){return t&&e.applyMatrix4(t.matrix),n&&e.applyMatrix4(n.matrix),e},Ai.prototype._getPosition=function(e){return new T},Ai.prototype.getPosition=function(e,t,n){return this._applyTransformations(this._getPosition(e),t,n)},Object.defineProperties(Ai.prototype,cy);var Ur=function(e){function t(i){e.call(this),this.shape=i}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={primitive:{configurable:!0},data:{configurable:!0},type:{configurable:!0}};return n.primitive.get=function(){},n.data.get=function(){return this.shape},n.type.get=function(){return this.primitive.type},t.prototype.getObject=function(i){return this.primitive.objectFromShape(this.shape,this.getIndex(i))},t.prototype._getPosition=function(i){return this.primitive.positionFromShape(this.shape,this.getIndex(i))},Object.defineProperties(t.prototype,n),t}(Ai),TN=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={primitive:{configurable:!0}};return n.primitive.get=function(){return Tc},Object.defineProperties(t.prototype,n),t}(Ur),EN=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={primitive:{configurable:!0}};return n.primitive.get=function(){return S0},Object.defineProperties(t.prototype,n),t}(Ur),Oc=function(e){function t(i,r){e.call(this,i),this.structure=r}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},data:{configurable:!0}};return n.type.get=function(){return"atom"},n.data.get=function(){return this.structure},t.prototype.getObject=function(i){return this.structure.getAtomProxy(this.getIndex(i))},t.prototype._getPosition=function(i){return new T().copy(this.getObject(i))},Object.defineProperties(t.prototype,n),t}(Ai),IN=function(e){function t(i){e.call(this),this.axes=i}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},data:{configurable:!0}};return n.type.get=function(){return"axes"},n.data.get=function(){return this.axes},t.prototype.getObject=function(){return{axes:this.axes}},t.prototype._getPosition=function(){return this.axes.center.clone()},Object.defineProperties(t.prototype,n),t}(Ai),$T=function(e){function t(i,r,o){e.call(this,i),this.structure=r,this.bondStore=o||r.bondStore}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},data:{configurable:!0}};return n.type.get=function(){return"bond"},n.data.get=function(){return this.structure},t.prototype.getObject=function(i){var r=this.structure.getBondProxy(this.getIndex(i));return r.bondStore=this.bondStore,r},t.prototype._getPosition=function(i){var r=this.getObject(i);return new T().copy(r.atom1).add(r.atom2).multiplyScalar(.5)},Object.defineProperties(t.prototype,n),t}(Ai),LN=function(e){function t(i,r,o){e.call(this,i),this.contacts=r,this.structure=o}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},data:{configurable:!0}};return n.type.get=function(){return"contact"},n.data.get=function(){return this.contacts},t.prototype.getObject=function(i){var r=this.getIndex(i),o=this.contacts,s=o.features,a=o.contactStore,c=s.centers,l=s.atomSets,u=c.x,h=c.y,f=c.z,p=a.index1,m=a.index2,y=a.type,v=p[r],d=m[r];return{center1:new T(u[v],h[v],f[v]),center2:new T(u[d],h[d],f[d]),atom1:this.structure.getAtomProxy(l[v][0]),atom2:this.structure.getAtomProxy(l[d][0]),type:AN(y[r])}},t.prototype._getPosition=function(i){var r=this.getObject(i),o=r.center1,s=r.center2;return new T().addVectors(o,s).multiplyScalar(.5)},Object.defineProperties(t.prototype,n),t}(Ai),RN=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={primitive:{configurable:!0}};return n.primitive.get=function(){return M0},Object.defineProperties(t.prototype,n),t}(Ur),ON=function(e){function t(i,r,o){e.call(this,i),this.validation=r,this.structure=o}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},data:{configurable:!0}};return n.type.get=function(){return"clash"},n.data.get=function(){return this.validation},t.prototype.getObject=function(i){var r=this.validation,o=this.getIndex(i);return{validation:r,index:o,clash:r.clashArray[o]}},t.prototype._getAtomProxyFromSele=function(i){var r=new Jt(i),o=this.structure.getAtomIndices(r)[0];return this.structure.getAtomProxy(o)},t.prototype._getPosition=function(i){var r=this.getObject(i).clash,o=this._getAtomProxyFromSele(r.sele1),s=this._getAtomProxyFromSele(r.sele2);return new T().copy(o).add(s).multiplyScalar(.5)},Object.defineProperties(t.prototype,n),t}(Ai),kN=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"distance"},Object.defineProperties(t.prototype,n),t}($T),DN=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={primitive:{configurable:!0}};return n.primitive.get=function(){return Cu},Object.defineProperties(t.prototype,n),t}(Ur),BN=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={primitive:{configurable:!0}};return n.primitive.get=function(){return _0},Object.defineProperties(t.prototype,n),t}(Ur),FN=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={primitive:{configurable:!0}};return n.primitive.get=function(){return Pc},Object.defineProperties(t.prototype,n),t}(Ur),NN=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"ignore"},Object.defineProperties(t.prototype,n),t}(Ai),zN=function(e){function t(i,r){e.call(this,i),this.mesh=r}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"mesh"},t.prototype.getObject=function(){var i=this.mesh;return{shape:this.shape,name:i.name,serial:i.serial}},t.prototype._getPosition=function(){return this.__position||(this.__position=qx(this.mesh.position)),this.__position},Object.defineProperties(t.prototype,n),t}(Ur),UN=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={primitive:{configurable:!0}};return n.primitive.get=function(){return Au},Object.defineProperties(t.prototype,n),t}(Ur),GN=function(e){function t(i,r){e.call(this,i),this.surface=r}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},data:{configurable:!0}};return n.type.get=function(){return"surface"},n.data.get=function(){return this.surface},t.prototype.getObject=function(i){return{surface:this.surface,index:this.getIndex(i)}},t.prototype._getPosition=function(){return this.surface.center.clone()},Object.defineProperties(t.prototype,n),t}(Ai),$N=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={primitive:{configurable:!0}};return n.primitive.get=function(){return w0},Object.defineProperties(t.prototype,n),t}(Ur),VN=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={primitive:{configurable:!0}};return n.primitive.get=function(){return A0},Object.defineProperties(t.prototype,n),t}(Ur),HN=function(e){function t(i,r){e.call(this),this.unitcell=i,this.structure=r}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},data:{configurable:!0}};return n.type.get=function(){return"unitcell"},n.data.get=function(){return this.unitcell},t.prototype.getObject=function(){return{unitcell:this.unitcell,structure:this.structure}},t.prototype._getPosition=function(){return this.unitcell.getCenter(this.structure)},Object.defineProperties(t.prototype,n),t}(Ai),VT=function(e){function t(i,r){e.call(this,i),this.volume=r}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},data:{configurable:!0}};return n.type.get=function(){return"volume"},n.data.get=function(){return this.volume},t.prototype.getObject=function(i){var r=this.volume,o=this.getIndex(i);return{volume:r,index:o,value:r.data[o]}},t.prototype._getPosition=function(i){var r=this.volume.position,o=this.getIndex(i);return new T(r[3*o],r[3*o+1],r[3*o+2])},Object.defineProperties(t.prototype,n),t}(Ai),jN=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"slice"},Object.defineProperties(t.prototype,n),t}(VT),WN=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={primitive:{configurable:!0}};return n.primitive.get=function(){return rp},Object.defineProperties(t.prototype,n),t}(Ur),qN=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={primitive:{configurable:!0}};return n.primitive.get=function(){return op},Object.defineProperties(t.prototype,n),t}(Ur);function HT(){return new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0])}function jT(){return new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1])}function XN(){return[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]]}function O_(e,t,n,i,r){var o,s,a,c,l,u,h,f=0,p=!1,m=!1,y=!1,v=!1,d=-1,g=t*n*i,b=t,x=t*n,_=new Int32Array(12),S=[],w=[],C=[],A=[],k=HT(),L=jT(),D=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]];function F(W,Q,Z){return W+(Q-W)*Z}function I(W,Q,Z){return x*(Z=(Z+h)%i)+b*(Q=(Q+u)%n)+(W=(W+l)%t)}function P(W,Q,Z,re,he,K,ce){var se=3*W;if(s[se]<0){var ue=(f-K)/(ce-K),H=o,j=3*a;if(S[j+0]=Z+ue,S[j+1]=re,S[j+2]=he,!p){var X=3*W;w[j]=d*F(H[X],H[X+3],ue),w[j+1]=d*F(H[X+1],H[X+4],ue),w[j+2]=d*F(H[X+2],H[X+5],ue)}r&&(A[a]=r[W+Math.round(ue)]),s[se]=a,_[Q]=a,a+=1}else _[Q]=s[se]}function N(W,Q,Z,re,he,K,ce){var se=3*W+1;if(s[se]<0){var ue=(f-K)/(ce-K),H=o,j=3*a;if(S[j]=Z,S[j+1]=re+ue,S[j+2]=he,!p){var X=3*W,ie=X+3*b;w[j]=d*F(H[X],H[ie],ue),w[j+1]=d*F(H[X+1],H[ie+1],ue),w[j+2]=d*F(H[X+2],H[ie+2],ue)}r&&(A[a]=r[W+Math.round(ue)*b]),s[se]=a,_[Q]=a,a+=1}else _[Q]=s[se]}function $(W,Q,Z,re,he,K,ce){var se=3*W+2;if(s[se]<0){var ue=(f-K)/(ce-K),H=o,j=3*a;if(S[j]=Z,S[j+1]=re,S[j+2]=he+ue,!p){var X=3*W,ie=X+3*x;w[j]=d*F(H[X],H[ie],ue),w[j+1]=d*F(H[X+1],H[ie+1],ue),w[j+2]=d*F(H[X+2],H[ie+2],ue)}r&&(A[a]=r[W+Math.round(ue)*x]),s[se]=a,_[Q]=a,a+=1}else _[Q]=s[se]}function B(W){var Q=3*W;o[Q]===0&&(o[Q]=e[(W-1+g)%g]-e[(W+1)%g],o[Q+1]=e[(W-b+g)%g]-e[(W+b)%g],o[Q+2]=e[(W-x+g)%g]-e[(W+x)%g])}function q(W,Q,Z,re,he){var K,ce,se,ue,H,j,X;y?(re=I(W,Q,Z),K=I(W+1,Q,Z),ce=I(W,Q+1,Z),se=I(W,Q,Z+1),ue=I(W+1,Q+1,Z),H=I(W+1,Q,Z+1),j=I(W,Q+1,Z+1),X=I(W+1,Q+1,Z+1)):(K=re+1,ue=(ce=re+b)+1,H=(se=re+x)+1,X=(j=ce+x)+1);var ie=0,fe=e[re],me=e[K],ve=e[ce],G=e[ue],V=e[se],pe=e[H],le=e[j],ne=e[X];fe<f&&(ie|=1),me<f&&(ie|=2),ve<f&&(ie|=8),G<f&&(ie|=4),V<f&&(ie|=16),pe<f&&(ie|=32),le<f&&(ie|=128),ne<f&&(ie|=64);var oe=k[ie];if(oe===0)return 0;var xe=W+1,Ae=Q+1,ge=Z+1;1&oe&&(p||(B(re),B(K)),P(re,0,W,Q,Z,fe,me)),2&oe&&(p||(B(K),B(ue)),N(K,1,xe,Q,Z,me,G)),4&oe&&(p||(B(ce),B(ue)),P(ce,2,W,Ae,Z,ve,G)),8&oe&&(p||(B(re),B(ce)),N(re,3,W,Q,Z,fe,ve)),16&oe&&(p||(B(se),B(H)),P(se,4,W,Q,ge,V,pe)),32&oe&&(p||(B(H),B(X)),N(H,5,xe,Q,ge,pe,ne)),64&oe&&(p||(B(j),B(X)),P(j,6,W,Ae,ge,le,ne)),128&oe&&(p||(B(se),B(j)),N(se,7,W,Q,ge,V,le)),256&oe&&(p||(B(re),B(se)),$(re,8,W,Q,Z,fe,V)),512&oe&&(p||(B(K),B(H)),$(K,9,xe,Q,Z,me,pe)),1024&oe&&(p||(B(ue),B(X)),$(ue,10,xe,Ae,Z,G,ne)),2048&oe&&(p||(B(ce),B(j)),$(ce,11,W,Ae,Z,ve,le));for(var Me,be,Oe,Te=ie<<4,Ce=0;L[Te+Ce]!==-1;)Me=L[Te+Ce],be=L[Te+Ce+1],Oe=L[Te+Ce+2],m?(D[Me][be]&he&&(C[c++]=_[Me],C[c++]=_[be]),D[be][Oe]&he&&(C[c++]=_[be],C[c++]=_[Oe]),D[Me][Oe]&he&&(C[c++]=_[Me],C[c++]=_[Oe])):(C[c++]=_[v?Me:be],C[c++]=_[v?be:Me],C[c++]=_[Oe]),Ce+=3}function ee(W,Q,Z,re,he,K){var ce,se,ue,H,j,X,ie,fe,me,ve,G,V,pe;if(W=W!==void 0?W:0,Q=Q!==void 0?Q:0,Z=Z!==void 0?Z:0,re=re!==void 0?re:t-1,he=he!==void 0?he:n-1,K=K!==void 0?K:i-1,y||(p?(W=Math.max(0,W),Q=Math.max(0,Q),Z=Math.max(0,Z),re=Math.min(t-1,re),he=Math.min(n-1,he),K=Math.min(i-1,K)):(W=Math.max(1,W),Q=Math.max(1,Q),Z=Math.max(1,Z),re=Math.min(t-2,re),he=Math.min(n-2,he),K=Math.min(i-2,K))),y)for(fe=W-2,me=Q-2,G=re+2,V=he+2,pe=K+2,j=ve=Z-2;j<pe;++j)for(H=me;H<V;++H)for(ue=fe;ue<G;++ue)se=3*I(ue,H,j),s[se]=-1,s[se+1]=-1,s[se+2]=-1;else for(fe=Math.max(0,W-2),me=Math.max(0,Q-2),ve=Math.max(0,Z-2),G=Math.min(t,re+2),V=Math.min(n,he+2),pe=Math.min(i,K+2),j=ve;j<pe;++j)for(ie=x*j,H=me;H<V;++H)for(X=ie+b*H,ue=fe;ue<G;++ue)s[ce=3*(X+ue)]=-1,s[ce+1]=-1,s[ce+2]=-1;if(!y){var le,ne=W,oe=Q,xe=Z,Ae=re,ge=he,Me=K;for(le=!1,j=Z;j<K;++j){for(H=Q;H<he;++H){for(ue=W;ue<re;++ue)if(e[ce=t*n*j+t*H+ue]>=f){xe=j,le=!0;break}if(le)break}if(le)break}for(le=!1,H=Q;H<he;++H){for(j=xe;j<K;++j){for(ue=W;ue<re;++ue)if(e[ce=t*n*j+t*H+ue]>=f){oe=H,le=!0;break}if(le)break}if(le)break}for(le=!1,ue=W;ue<re;++ue){for(H=oe;H<he;++H){for(j=xe;j<K;++j)if(e[ce=t*n*j+t*H+ue]>=f){ne=ue,le=!0;break}if(le)break}if(le)break}for(le=!1,j=K;j>=Z;--j){for(H=he;H>=Q;--H){for(ue=re;ue>=W;--ue)if(e[ce=t*n*j+t*H+ue]>=f){Me=j,le=!0;break}if(le)break}if(le)break}for(le=!1,H=he;H>=Q;--H){for(j=Me;j>=Z;--j){for(ue=re;ue>=W;--ue)if(e[ce=t*n*j+t*H+ue]>=f){ge=H,le=!0;break}if(le)break}if(le)break}for(le=!1,ue=re;ue>=W;--ue){for(H=ge;H>=Q;--H){for(j=Me;j>=Z;--j)if(e[ce=t*n*j+t*H+ue]>=f){Ae=ue,le=!0;break}if(le)break}if(le)break}p?(W=Math.max(0,ne-1),Q=Math.max(0,oe-1),Z=Math.max(0,xe-1),re=Math.min(t-1,Ae+1),he=Math.min(n-1,ge+1),K=Math.min(i-1,Me+1)):(W=Math.max(1,ne-1),Q=Math.max(1,oe-1),Z=Math.max(1,xe-1),re=Math.min(t-2,Ae+1),he=Math.min(n-2,ge+1),K=Math.min(i-2,Me+1))}var be=15;for(j=Z;j<K;++j,be&=-5)for(ie=x*j,be|=2,H=Q;H<he;++H,be&=-3)for(X=ie+b*H,be|=1,ue=W;ue<re;++ue,be&=-2)q(ue,H,j,ce=X+ue,be)}this.triangulate=function(W,Q,Z,re,he){v=(f=W)<0,m=re,y=he,(p=Q||m)||(d=f>0?-1:1,o||(o=new Float32Array(3*g)));var K=3*g;if(s&&s.length===K||(s=new Int32Array(K)),a=0,c=0,Z!==void 0){var ce=Z[0].map(Math.round),se=Z[1].map(Math.round);l=t*Math.ceil(Math.abs(ce[0])/t),u=n*Math.ceil(Math.abs(ce[1])/n),h=i*Math.ceil(Math.abs(ce[2])/i),ee(ce[0],ce[1],ce[2],se[0],se[1],se[2])}else l=u=h=0,ee();return S.length=3*a,p||(w.length=3*a),C.length=c,r&&(A.length=a),{position:new Float32Array(S),normal:p?void 0:new Float32Array(w),index:Ho(C,S.length/3),atomindex:r?new Int32Array(A):void 0,contour:m}}}Ar.add("arrow",EN),Ar.add("box",FN),Ar.add("cone",RN),Ar.add("cylinder",TN),Ar.add("ellipsoid",DN),Ar.add("octahedron",BN),Ar.add("sphere",UN),Ar.add("tetrahedron",$N),Ar.add("torus",VN),Ar.add("point",WN),Ar.add("wideline",qN),Object.assign(O_,{__deps:[HT,jT,XN,Ho]});var Yt=function(e,t){this.cols=e,this.rows=t,this.size=this.cols*this.rows,this.data=new Float32Array(this.size)};function io(e,t){for(var n=0,i=0,r=t.rows,o=t.cols,s=0,a=0,c=0,l=t.data,u=e.data;n<r;a+=1,s+=o,n++)for(c=a,i=0;i<o;c+=r,i++)u[c]=l[s+i]}function vm(e,t,n){for(var i=0,r=0,o=0,s=0,a=0,c=0,l=0,u=t.cols,h=t.rows,f=n.rows,p=t.data,m=n.data,y=e.data,v=0;i<h;s+=u,i++)for(c=0,r=0;r<f;l++,r++){for(a=s,v=0,o=0;o<u;a++,c++,o++)v+=p[a]*m[c];y[l]=v}}function ly(e,t,n){var i=e.data,r=t.data,o=n.data,s=r[0],a=r[1],c=r[2],l=r[3],u=r[4],h=r[5],f=r[6],p=r[7],m=r[8],y=o[0],v=o[1],d=o[2],g=o[3],b=o[4],x=o[5],_=o[6],S=o[7],w=o[8];i[0]=s*y+a*g+c*_,i[1]=s*v+a*b+c*S,i[2]=s*d+a*x+c*w,i[3]=l*y+u*g+h*_,i[4]=l*v+u*b+h*S,i[5]=l*d+u*x+h*w,i[6]=f*y+p*g+m*_,i[7]=f*v+p*b+m*S,i[8]=f*d+p*x+m*w}function Zx(e){for(var t=e.rows,n=e.cols,i=e.data,r=new Array(n),o=0;o<n;++o)r[o]=0;for(var s=0,a=0;s<t;++s)for(var c=0;c<n;++c,++a)r[c]+=i[a];for(var l=0;l<n;++l)r[l]/=t;return r}function Kx(e,t){for(var n=e.rows,i=e.cols,r=e.data,o=0,s=0;o<n;++o)for(var a=0;a<i;++a,++s)r[s]-=t[a]}function uy(e,t,n,i){i=e[t],e[t]=e[n],e[n]=i}function YN(e,t){return(e=Math.abs(e))>(t=Math.abs(t))?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}Yt.prototype.copyTo=function(e){e.data.set(this.data)};function WT(e,t,n,i){var r=0,o=0,s=e.rows,a=e.cols,c=s,l=a;c<l&&(r=1,o=c,c=l,l=o);var u=new Yt(c,c),h=new Yt(1,l),f=new Yt(l,l);if(r===0)io(u,e);else{for(o=0;o<a*s;o++)u.data[o]=e.data[o];for(;o<l*c;o++)u.data[o]=0}if(function(p,m,y,v,d,g,b,x){for(var _=0,S=0,w=0,C=0,A=Math.max(g,30),k=0,L=0,D=0,F=0,I=0,P=0,N=0,$=0,B=0,q=0,ee=0,W=0,Q=0,Z=0,re=0,he=0,K=0,ce=4660,se=0,ue=0,H=0,j=new Float64Array(b<<3);_<b;_++){for(w=0,ee=0;w<g;w++)ee+=($=p[_*m+w])*$;if(j[_]=ee,v){for(w=0;w<b;w++)v[_*d+w]=0;v[_*d+_]=1}}for(;C<A;C++){for(I=0,_=0;_<b-1;_++)for(S=_+1;S<b;S++){for(k=_*m|0,L=S*m|0,re=j[_],he=0,K=j[S],w=2,he+=p[k]*p[L],he+=p[k+1]*p[L+1];w<g;w++)he+=p[k+w]*p[L+w];if(!(Math.abs(he)<=2384185792e-16*Math.sqrt(re*K))){for(Q=YN(he*=2,W=re-K),W<0?(Z=.5*(Q-W),P=he/(Q*(N=Math.sqrt(Z/Q))*2)):N=he/(Q*(P=Math.sqrt((Q+W)/(2*Q)))*2),re=0,K=0,w=2,B=P*p[k]+N*p[L],q=-N*p[k]+P*p[L],p[k]=B,p[L]=q,re+=B*B,K+=q*q,B=P*p[k+1]+N*p[L+1],q=-N*p[k+1]+P*p[L+1],p[k+1]=B,p[L+1]=q,re+=B*B,K+=q*q;w<g;w++)B=P*p[k+w]+N*p[L+w],q=-N*p[k+w]+P*p[L+w],p[k+w]=B,p[L+w]=q,re+=B*B,K+=q*q;if(j[_]=re,j[S]=K,I=1,v)for(F=S*d|0,w=2,B=P*v[D=_*d|0]+N*v[F],q=-N*v[D]+P*v[F],v[D]=B,v[F]=q,B=P*v[D+1]+N*v[F+1],q=-N*v[D+1]+P*v[F+1],v[D+1]=B,v[F+1]=q;w<b;w++)B=P*v[D+w]+N*v[F+w],q=-N*v[D+w]+P*v[F+w],v[D+w]=B,v[F+w]=q}}if(I===0)break}for(_=0;_<b;_++){for(w=0,ee=0;w<g;w++)ee+=($=p[_*m+w])*$;j[_]=Math.sqrt(ee)}for(_=0;_<b-1;_++){for(S=_,w=_+1;w<b;w++)j[S]<j[w]&&(S=w);if(_!==S&&(uy(j,_,S,ee),v)){for(w=0;w<g;w++)uy(p,_*m+w,S*m+w,$);for(w=0;w<b;w++)uy(v,_*d+w,S*d+w,$)}}for(_=0;_<b;_++)y[_]=j[_];if(v)for(_=0;_<x;_++){for(ee=_<b?j[_]:0;ee<=1e-37;){for(ue=1/g,w=0;w<g;w++)se=256&(ce=214013*ce+2531011)>>16?ue:-ue,p[_*m+w]=se;for(C=0;C<2;C++)for(S=0;S<_;S++){for(ee=0,w=0;w<g;w++)ee+=p[_*m+w]*p[S*m+w];for(H=0,w=0;w<g;w++)$=p[_*m+w]-ee*p[S*m+w],p[_*m+w]=$,H+=Math.abs($);for(H=H?1/H:0,w=0;w<g;w++)p[_*m+w]*=H}for(ee=0,w=0;w<g;w++)ee+=($=p[_*m+w])*$;ee=Math.sqrt(ee)}for(N=1/ee,w=0;w<g;w++)p[_*m+w]*=N}}(u.data,c,h.data,f.data,l,c,l,c),t){for(o=0;o<l;o++)t.data[o]=h.data[o];for(;o<a;o++)t.data[o]=0}r===0?(n&&io(n,u),i&&io(i,f)):(n&&io(n,f),i&&io(i,u))}function kh(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function Xl(e,t,n,i,r,o,s,a,c,l,u,h,f,p,m,y,v){e[0]=t,e[4]=n,e[8]=i,e[12]=r,e[1]=o,e[5]=s,e[9]=a,e[13]=c,e[2]=l,e[6]=u,e[10]=h,e[14]=f,e[3]=p,e[7]=m,e[11]=y,e[15]=v}function xm(e,t,n){var i=t[0],r=t[4],o=t[8],s=t[12],a=t[1],c=t[5],l=t[9],u=t[13],h=t[2],f=t[6],p=t[10],m=t[14],y=t[3],v=t[7],d=t[11],g=t[15],b=n[0],x=n[4],_=n[8],S=n[12],w=n[1],C=n[5],A=n[9],k=n[13],L=n[2],D=n[6],F=n[10],I=n[14],P=n[3],N=n[7],$=n[11],B=n[15];e[0]=i*b+r*w+o*L+s*P,e[4]=i*x+r*C+o*D+s*N,e[8]=i*_+r*A+o*F+s*$,e[12]=i*S+r*k+o*I+s*B,e[1]=a*b+c*w+l*L+u*P,e[5]=a*x+c*C+l*D+u*N,e[9]=a*_+c*A+l*F+u*$,e[13]=a*S+c*k+l*I+u*B,e[2]=h*b+f*w+p*L+m*P,e[6]=h*x+f*C+p*D+m*N,e[10]=h*_+f*A+p*F+m*$,e[14]=h*S+f*k+p*I+m*B,e[3]=y*b+v*w+d*L+g*P,e[7]=y*x+v*C+d*D+g*N,e[11]=y*_+v*A+d*F+g*$,e[15]=y*S+v*k+d*I+g*B}function Qx(e,t,n,i){Xl(e,t,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1)}function Jx(e,t,n,i){Xl(e,1,0,0,t,0,1,0,n,0,0,1,i,0,0,0,1)}function eb(e,t){var n=Math.cos(t),i=Math.sin(t);Xl(e,n,0,i,0,0,1,0,0,-i,0,n,0,0,0,0,1)}function qT(){return new Float32Array([1,0,0,0,1,0,0,0,1])}function k_(e,t){var n=xt([t[0],t[1],t[2]]),i=xt([t[4],t[5],t[6]]),r=xt([t[8],t[9],t[10]]),o=xt();tr(o,i,r),e[0]=o[0],e[1]=o[1],e[2]=o[2],tr(o,r,n),e[3]=o[0],e[4]=o[1],e[5]=o[2],tr(o,n,i),e[6]=o[0],e[7]=o[1],e[8]=o[2]}function D_(e,t,n,i){n=n||1,i=i||!0;var r=e.length/3,o=t.length/3,s=void 0;i&&(s=new Float32Array(3*r));var a,c,l,u,h=new Float32Array(3*r),f=new Array(20);for(a=0;a<20;++a)f[a]=new Uint32Array(r);for(a=0;a<r;++a)f[0][a]=0;for(a=0;a<o;++a){var p=3*a,m=3*a+1,y=3*a+2;for(u=!0,c=0,l=f[0][t[p]];c<l;++c)if(t[m]===f[c+1][t[p]]){u=!1;break}for(u&&(f[0][t[p]]++,f[f[0][t[p]]][t[p]]=t[m]),u=!0,c=0,l=f[0][t[p]];c<l;++c)if(t[y]===f[c+1][t[p]]){u=!1;break}for(u&&(f[0][t[p]]++,f[f[0][t[p]]][t[p]]=t[y]),u=!0,c=0,l=f[0][t[m]];c<l;++c)if(t[p]===f[c+1][t[m]]){u=!1;break}for(u&&(f[0][t[m]]++,f[f[0][t[m]]][t[m]]=t[p]),u=!0,c=0,l=f[0][t[m]];c<l;++c)if(t[y]===f[c+1][t[m]]){u=!1;break}for(u&&(f[0][t[m]]++,f[f[0][t[m]]][t[m]]=t[y]),u=!0,c=0;c<f[0][t[y]];++c)if(t[p]===f[c+1][t[y]]){u=!1;break}for(u&&(f[0][t[y]]++,f[f[0][t[y]]][t[y]]=t[p]),u=!0,c=0,l=f[0][t[y]];c<l;++c)if(t[m]===f[c+1][t[y]]){u=!1;break}u&&(f[0][t[y]]++,f[f[0][t[y]]][t[y]]=t[m])}for(var v,d,g,b,x,_=.5,S=.75/4.5,w=0;w<n;++w){for(a=0;a<r;++a)if(v=3*a,(g=f[0][a])<3)h[v]=e[v],h[v+1]=e[v+1],h[v+2]=e[v+2];else if(g===3||g===4){for(h[v]=0,h[v+1]=0,h[v+2]=0,c=0;c<g;++c)d=3*f[c+1][a],h[v]+=e[d],h[v+1]+=e[d+1],h[v+2]+=e[d+2];h[v]+=_*e[v],h[v+1]+=_*e[v+1],h[v+2]+=_*e[v+2],x=_+g,h[v]/=x,h[v+1]/=x,h[v+2]/=x}else{for(h[v]=0,h[v+1]=0,h[v+2]=0,c=0;c<g;++c)d=3*f[c+1][a],h[v]+=e[d],h[v+1]+=e[d+1],h[v+2]+=e[d+2];h[v]+=1*e[v],h[v+1]+=1*e[v+1],h[v+2]+=1*e[v+2],b=1+g,h[v]/=b,h[v+1]/=b,h[v+2]/=b}if(e.set(h),i){sp(e,t,s);var C=3*r;for(v=0;v<C;v+=3)e[v]+=-1*S*s[v],e[v+1]+=-1*S*s[v+1],e[v+2]+=-1*S*s[v+2]}}}function sp(e,t,n){var i,r;if(n===void 0)n=new Float32Array(e.length);else for(i=0,r=n.length;i<r;i++)n[i]=0;var o=new Float32Array(3),s=new Float32Array(3),a=new Float32Array(3),c=new Float32Array(3),l=new Float32Array(3);if(t)for(i=0,r=t.length;i<r;i+=3){var u=3*t[i],h=3*t[i+1],f=3*t[i+2];Fi(o,e,u),Fi(s,e,h),Fi(a,e,f),Sn(c,a,s),Sn(l,o,s),tr(c,c,l),n[u]+=c[0],n[u+1]+=c[1],n[u+2]+=c[2],n[h]+=c[0],n[h+1]+=c[1],n[h+2]+=c[2],n[f]+=c[0],n[f+1]+=c[1],n[f+2]+=c[2]}else for(i=0,r=e.length;i<r;i+=9)Fi(o,e,i),Fi(s,e,i+3),Fi(a,e,i+6),Sn(c,a,s),Sn(l,o,s),tr(c,c,l),n[i]=c[0],n[i+1]=c[1],n[i+2]=c[2],n[i+3]=c[0],n[i+4]=c[1],n[i+5]=c[2],n[i+6]=c[0],n[i+7]=c[1],n[i+8]=c[2];return ET(n),n}function XT(e){for(var t={},n=0,i=e.length;n<i;++n)t[e[n]]=!0;return t}function ap(e,t,n,i,r){var o=1/i*3;LT(e,e,r+(o+=n)),gm(t,t,r+o),rn(e,e,i),Xx(e,e),kl(e,e,i),rn(t,t,i),Rh(t,t),kl(t,t,i);var s=new Float32Array(3);Sn(s,t,e),rn(s,s,i),Rh(s,s),gm(s,s,1);var a=256*Math.pow(10,6),c=s[0]*s[1]*s[2]*3;a<=c&&(rn(e,e,i*=Math.pow(a/c,1/3)),Xx(e,e),kl(e,e,i),rn(t,t,i),Rh(t,t),kl(t,t,i),Sn(s,t,e),rn(s,s,i),Rh(s,s),gm(s,s,1));var l=new Float32Array(e);b0(l,l);var u=kh(),h=kh();eb(h,Tn(90)),xm(u,u,h);var f=kh();Qx(f,-1/i,1/i,1/i),xm(u,u,f);var p=kh();return Jx(p,-i*l[2],-i*l[1],-i*l[0]),xm(u,u,p),{dim:s,tran:l,matrix:u,scaleFactor:i}}Qx.__deps=[Xl],Jx.__deps=[Xl],eb.__deps=[Xl],k_.__deps=[xt,tr],Object.assign(D_,{__deps:[sp]}),Object.assign(sp,{__deps:[Sn,tr,Fi,ET]}),Object.assign(ap,{__deps:[Tn,LT,gm,kl,rn,Xx,Rh,Sn,b0,kh,xm,Jx,Qx,eb]});var Si=function(e,t,n){this.name=e||"",this.path=t||"",this.info={},this.center=new T,this.boundingBox=new hn,n instanceof dt||n instanceof We||n instanceof nn?this.fromGeometry(n):n&&(this.set(n.position,n.index,n.normal,n.color,n.atomindex,n.contour),this.boundingBox.setFromArray(n.position),this.boundingBox.getCenter(this.center))},ES={type:{configurable:!0}};function ba(e,t,n,i,r){var o=new O_(e,t,n,i,r);this.getSurface=function(s,a,c,l,u,h){h===void 0&&(h=!1);var f=o.triangulate(s,a,c,u,h);if(a&&!u&&(D_(f.position,f.index,a,!0),f.normal=sp(f.position,f.index)),l&&(x0(l,f.position),f.normal)){var p=qT();k_(p,l),R_(p,f.normal)}return f}}ES.type.get=function(){return"Surface"},Si.prototype.set=function(e,t,n,i,r,o){o===void 0&&(o=!1),this.position=e,this.index=t,this.normal=n,this.color=i,this.atomindex=r,this.size=e.length/3,this.contour=o},Si.prototype.fromGeometry=function(e){var t,n,i,r;if(Pe&&de.time("GeometrySurface.fromGeometry"),e instanceof dt?(e.computeVertexNormals(!0),t=new We().fromGeometry(e)):t=e instanceof We?e:e[0],t.boundingBox||t.computeBoundingBox(),this.boundingBox.copy(t.boundingBox),this.boundingBox.getCenter(this.center),t instanceof We){var o=t.attributes,s=!!o.normal&&o.normal.array;(!s||s[0]===0&&s[1]===0&&s[2]===0)&&t.computeVertexNormals(),n=o.position.array,i=o.index?o.index.array:null,r=o.normal.array}this.set(n,i,r,void 0,void 0),Pe&&de.timeEnd("GeometrySurface.setGeometry")},Si.prototype.getPosition=function(){return this.position},Si.prototype.getColor=function(e){var t=e||{};t.surface=this;var n=this.size,i=new Float32Array(3*n),r=Rt.getScheme(t);if(r.volumeColor||t.scheme==="random")for(var o=0;o<n;++o)r.volumeColorToArray(o,i,3*o);else if(r.positionColor)for(var s=new T,a=this.position,c=0;c<n;++c){var l=3*c;s.set(a[l],a[l+1],a[l+2]),r.positionColorToArray(s,i,l)}else if(r.atomColor&&this.atomindex)for(var u=t.structure.getAtomProxy(),h=this.atomindex,f=0;f<n;++f)u.index=h[f],r.atomColorToArray(u,i,3*f);else{var p=new Fe(t.value);tn(n,p.r,p.g,p.b,i)}return i},Si.prototype.getPicking=function(e){return this.atomindex&&e?new Oc(this.atomindex,e):new GN(Du(this.size),this)},Si.prototype.getNormal=function(){return this.normal},Si.prototype.getSize=function(e,t){return yr(this.size,e*t)},Si.prototype.getIndex=function(){return this.index},Si.prototype.getFilteredIndex=function(e,t){if(e&&this.atomindex){for(var n=new Jt(e),i=t.getAtomSet(n),r=[],o=this.atomindex,s=this.index,a=s.length,c=this.contour?2:3,l=0,u=0;u<a;u+=c){for(var h=!0,f=0;f<c;f++){var p=o[s[u+f]];if(!i.get(p)){h=!1;break}}if(h)for(var m=0;m<c;m++,l++)r[l]=s[u+m]}return Ho(r,this.position.length/3)}return this.index},Si.prototype.getAtomindex=function(){return this.atomindex},Si.prototype.dispose=function(){},Object.defineProperties(Si.prototype,ES),Object.assign(ba,{__deps:[D_,sp,O_,x0,R_,qT,k_]}),tp.add("surf",function(e,t){var n=e.data.args,i=e.data.params;if(n&&(self.volsurf=new ba(n[0],n[1],n[2],n[3],n[4])),i){var r=self.volsurf.getSurface(i.isolevel,i.smooth,i.box,i.matrix,i.contour,i.wrap),o=[r.position.buffer,r.index.buffer];r.normal&&o.push(r.normal.buffer),r.atomindex&&o.push(r.atomindex.buffer),t({sd:r,p:i},o)}},[ba]);var Xt=function(e,t,n,i,r,o,s){this.name=e,this.path=t,this.matrix=new De,this.normalMatrix=new di,this.inverseMatrix=new De,this.center=new T,this.boundingBox=new hn,this.setData(n,i,r,o,s)},Ws={type:{configurable:!0},position:{configurable:!0},min:{configurable:!0},max:{configurable:!0},sum:{configurable:!0},mean:{configurable:!0},rms:{configurable:!0}};function IS(e){return e==="front"?Iu:e==="back"?Kn:mp}Ws.type.get=function(){return"Volume"},Xt.prototype.setData=function(e,t,n,i,r){this.nx=t||1,this.ny=n||1,this.nz=i||1,this.data=e||new Float32Array(1),this.setAtomindex(r),this._position=new Float32Array,delete this._min,delete this._max,delete this._mean,delete this._rms,this.worker&&this.worker.terminate()},Xt.prototype.setStats=function(e,t,n,i){this._min=e,this._max=t,this._mean=n,this._rms=i},Xt.prototype.setMatrix=function(e){this.matrix.copy(e);var t=this.boundingBox,n=this.center,i=this.nx-1,r=this.ny-1,o=this.nz-1;t.makeEmpty(),t.expandByPoint(n.set(i,r,o)),t.expandByPoint(n.set(i,r,0)),t.expandByPoint(n.set(i,0,o)),t.expandByPoint(n.set(i,0,0)),t.expandByPoint(n.set(0,r,o)),t.expandByPoint(n.set(0,0,o)),t.expandByPoint(n.set(0,r,0)),t.expandByPoint(n.set(0,0,0)),t.applyMatrix4(this.matrix),t.getCenter(this.center);var s=this.matrix.elements,a=new T(s[0],s[1],s[2]),c=new T(s[4],s[5],s[6]),l=new T(s[8],s[9],s[10]),u=new T,h=this.normalMatrix.elements;u.crossVectors(c,l),h[0]=u.x,h[1]=u.y,h[2]=u.z,u.crossVectors(l,a),h[3]=u.x,h[4]=u.y,h[5]=u.z,u.crossVectors(a,c),h[6]=u.x,h[7]=u.y,h[8]=u.z,this.inverseMatrix.getInverse(this.matrix)},Xt.prototype.setAtomindex=function(e){this.atomindex=e},Xt.prototype.getBox=function(e,t,n){return n||(n=new hn),n.set(e,e),n.expandByScalar(t),n.applyMatrix4(this.inverseMatrix),n.min.round(),n.max.round(),n},Xt.prototype._getBox=function(e,t){if(e&&t){this.__box||(this.__box=new hn);var n=this.getBox(e,t,this.__box);return[n.min.toArray(),n.max.toArray()]}},Xt.prototype._makeSurface=function(e,t,n){var i=this.name+"@"+t.toPrecision(2),r=new Si(i,"",e);return r.info.isolevel=t,r.info.smooth=n,r.info.volume=this,r},Xt.prototype.getSurface=function(e,t,n,i,r,o){o===void 0&&(o=!1),e=isNaN(e)?this.getValueForSigma(2):e,t=O(t,0),this.volsurf===void 0&&(this.volsurf=new ba(this.data,this.nx,this.ny,this.nz,this.atomindex));var s=this._getBox(n,i),a=this.volsurf.getSurface(e,t,s,this.matrix.elements,r,o);return this._makeSurface(a,e,t)},Xt.prototype.getSurfaceWorker=function(e,t,n,i,r,o,s){var a=this;if(e=isNaN(e)?this.getValueForSigma(2):e,t=t||0,window.hasOwnProperty("Worker")){this.workerPool===void 0&&(this.workerPool=new ll("surf",2));var c={},l=this.workerPool.getNextWorker();l.postCount===0&&Object.assign(c,{args:[this.data,this.nx,this.ny,this.nz,this.atomindex]}),Object.assign(c,{params:{isolevel:e,smooth:t,box:this._getBox(n,i),matrix:this.matrix.elements,contour:r,wrap:o}}),l.post(c,void 0,function(h){var f=h.data.sd,p=h.data.p;s(a._makeSurface(f,p.isolevel,p.smooth))},function(h){console.warn("Volume.getSurfaceWorker error - trying without worker",h);var f=a.getSurface(e,t,n,i,r,o);s(f)})}else{var u=this.getSurface(e,t,n,i,r,o);s(u)}},Xt.prototype.getValueForSigma=function(e){return this.mean+O(e,2)*this.rms},Xt.prototype.getSigmaForValue=function(e){return(O(e,0)-this.mean)/this.rms},Ws.position.get=function(){if(!this._position){for(var e=this.nz,t=this.ny,n=this.nx,i=new Float32Array(n*t*e*3),r=0,o=0;o<e;++o)for(var s=0;s<t;++s)for(var a=0;a<n;++a)i[r+0]=a,i[r+1]=s,i[r+2]=o,r+=3;x0(this.matrix.elements,i),this._position=i}return this._position},Xt.prototype.getDataAtomindex=function(){return this.atomindex},Xt.prototype.getDataPosition=function(){return this.position},Xt.prototype.getDataColor=function(e){var t=e||{};t.volume=this,t.scale=t.scale||"Spectral",t.domain=t.domain||[this.min,this.max];for(var n=Rt.getScheme(t),i=this.position.length/3,r=new Float32Array(3*i),o=0;o<i;++o)n.volumeColorToArray(o,r,3*o);return r},Xt.prototype.getDataPicking=function(){var e=Du(this.position.length/3);return new VT(e,this)},Xt.prototype.getDataSize=function(e,t){var n,i=this.data,r=this.position.length/3;switch(e){case"value":case"deviation":n=new Float32Array(i);break;case"abs-value":n=new Float32Array(i);for(var o=0;o<r;++o)n[o]=Math.abs(n[o]);break;case"value-min":n=new Float32Array(i);for(var s=this.min,a=0;a<r;++a)n[a]-=s;break;default:n=yr(r,e)}if(t!==1)for(var c=0;c<r;++c)n[c]*=t;return n},Ws.min.get=function(){return this._min===void 0&&(this._min=pm(this.data)),this._min},Ws.max.get=function(){return this._max===void 0&&(this._max=fm(this.data)),this._max},Ws.sum.get=function(){return this._sum===void 0&&(this._sum=L_(this.data)),this._sum},Ws.mean.get=function(){return this._mean===void 0&&(this._mean=dm(this.data)),this._mean},Ws.rms.get=function(){return this._rms===void 0&&(this._rms=function(e){for(var t=e.length,n=0,i=0;i<t;++i){var r=e[i];n+=r*r}return Math.sqrt(n/t)}(this.data)),this._rms},Xt.prototype.clone=function(){var e=new Xt(this.name,this.path,this.data,this.nx,this.ny,this.nz,this.atomindex);return e.matrix.copy(this.matrix),e.header=Object.assign({},this.header),e},Xt.prototype.dispose=function(){this.workerPool&&this.workerPool.terminate()},Object.defineProperties(Xt.prototype,Ws),jt.add("shader/Mesh.vert",`#define STANDARD
uniform float clipNear;
uniform vec3 clipCenter;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#elif defined( NOLIGHT )
varying vec3 vColor;
#else
#include color_pars_vertex
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#endif
#include common
void main(){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#elif defined( NOLIGHT )
vColor = color;
#else
#include color_vertex
#include beginnormal_vertex
#include defaultnormal_vertex
#ifndef FLAT_SHADED
vNormal = normalize( transformedNormal );
#endif
#endif
#include begin_vertex
#include project_vertex
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`),jt.add("shader/Mesh.frag",`#define STANDARD
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
#elif defined( NOLIGHT )
varying vec3 vColor;
#else
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#elif defined( NOLIGHT )
gl_FragColor = vec4( vColor, opacity );
#else
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
#include normal_fragment_begin
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
#include interior_fragment
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include encodings_fragment
#include fog_fragment
#include opaque_back_fragment
#endif
}`);var LS={f:1,v2:2,v3:3,c:3};function hy(e,t){e.matrix.copy(t),e.matrix.decompose(e.position,e.quaternion,e.scale),e.matrixWorldNeedsUpdate=!0}var Vi={opaqueBack:!1,side:"double",opacity:1,depthWrite:!0,clipNear:0,clipRadius:0,clipCenter:new T,flatShaded:!1,wireframe:!1,roughness:.4,metalness:0,diffuse:16777215,diffuseInterior:!1,useInteriorColor:!1,interiorColor:14540253,interiorDarkening:0,forceTransparent:!1,matrix:new De,disablePicking:!1,sortParticles:!1,background:!1},kc={opaqueBack:{updateShader:!0},side:{updateShader:!0,property:!0},opacity:{uniform:!0},depthWrite:{property:!0},clipNear:{updateShader:!0,property:!0},clipRadius:{updateShader:!0,uniform:!0},clipCenter:{uniform:!0},flatShaded:{updateShader:!0},background:{updateShader:!0},wireframe:{updateVisibility:!0},roughness:{uniform:!0},metalness:{uniform:!0},diffuse:{uniform:!0},diffuseInterior:{updateShader:!0},useInteriorColor:{updateShader:!0},interiorColor:{uniform:!0},interiorDarkening:{uniform:!0},matrix:{}},Bt=function(e,t){t===void 0&&(t={}),this.parameterTypes=kc,this.geometry=new We,this.indexVersion=0,this.wireframeIndexVersion=-1,this.group=new nn,this.wireframeGroup=new nn,this.pickingGroup=new nn,this.vertexShader="",this.fragmentShader="",this.isImpostor=!1,this.isText=!1,this.isSurface=!1,this.isPoint=!1,this.isLine=!1,this.dynamic=!0,this.visible=!0,this.wireframeIndexCount=0,this.parameters=br(t,this.defaultParameters),this.uniforms=rg.merge([He.common,{fogColor:{value:new Fe(0)},fogNear:{value:0},fogFar:{value:0},opacity:{value:this.parameters.opacity},clipNear:{value:0},clipRadius:{value:this.parameters.clipRadius},clipCenter:{value:this.parameters.clipCenter}},{emissive:{value:new Fe(0)},roughness:{value:this.parameters.roughness},metalness:{value:this.parameters.metalness},interiorColor:{value:new Fe(this.parameters.interiorColor)},interiorDarkening:{value:this.parameters.interiorDarkening}},He.lights]),this.uniforms.diffuse.value.set(this.parameters.diffuse),this.pickingUniforms={clipNear:{value:0},objectId:{value:0},opacity:{value:this.parameters.opacity}};var n=e.position||e.position1;this._positionDataSize=n?n.length/3:0,e.primitiveId||(e.primitiveId=Du(this._positionDataSize)),this.addAttributes({position:{type:"v3",value:e.position},color:{type:"c",value:e.color},primitiveId:{type:"f",value:e.primitiveId}}),t.matrix&&(this.matrix=t.matrix),e.index&&this.initIndex(e.index),this.picking=e.picking,this.makeWireframeGeometry()},qs={defaultParameters:{configurable:!0},matrix:{configurable:!0},transparent:{configurable:!0},size:{configurable:!0},attributeSize:{configurable:!0},pickable:{configurable:!0}};qs.defaultParameters.get=function(){return Vi},qs.matrix.set=function(e){this.setMatrix(e)},qs.matrix.get=function(){return this.group.matrix.clone()},qs.transparent.get=function(){return this.parameters.opacity<1||this.parameters.forceTransparent},qs.size.get=function(){return this._positionDataSize},qs.attributeSize.get=function(){return this.size},qs.pickable.get=function(){return!!this.picking&&!this.parameters.disablePicking},Bt.prototype.setMatrix=function(e){hy(this.group,e),hy(this.wireframeGroup,e),hy(this.pickingGroup,e)},Bt.prototype.initIndex=function(e){this.geometry.setIndex(new rt(e,1));var t=this.geometry.getIndex();t?t.setUsage(this.dynamic?WebGLRenderingContext.DYNAMIC_DRAW:0):de.error("Index is null")},Bt.prototype.makeMaterial=function(){var e=IS(this.parameters.side),t=new ti({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!0,fog:!0,side:e});t.vertexColors=!0,t.extensions.derivatives=!0,t.extensions.fragDepth=this.isImpostor;var n=new ti({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!1,fog:!0,side:e});n.vertexColors=!0;var i=new ti({uniforms:this.pickingUniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:!1,depthWrite:this.parameters.depthWrite,lights:!1,fog:!1,side:e,blending:ps});i.vertexColors=!0,i.extensions.fragDepth=this.isImpostor,t.clipNear=this.parameters.clipNear,n.clipNear=this.parameters.clipNear,i.clipNear=this.parameters.clipNear,this.material=t,this.wireframeMaterial=n,this.pickingMaterial=i,this.updateShader()},Bt.prototype.makeWireframeGeometry=function(){this.makeWireframeIndex();var e=this.geometry,t=this.wireframeIndex,n=new We;n.attributes=e.attributes,t&&(n.setIndex(new rt(t,1).setUsage(this.dynamic?WebGLRenderingContext.DYNAMIC_DRAW:0)),n.setDrawRange(0,this.wireframeIndexCount)),this.wireframeGeometry=n},Bt.prototype.makeWireframeIndex=function(){var e=[];function t(v,d){if(v>d){var g=v;v=d,d=g}var b=e[v];return b===void 0?(e[v]=[d],!0):!b.includes(d)&&(b.push(d),!0)}var n=this.geometry,i=n.index;if(this.parameters.wireframe)if(i){var r,o=i.array,s=o.length;n.drawRange.count!==1/0&&(s=n.drawRange.count),this.wireframeIndex&&this.wireframeIndex.length>2*s?r=this.wireframeIndex:r=Ho(2*s,n.attributes.position.count);var a=0;e.length=0;for(var c=0;c<s;c+=3){var l=o[c+0],u=o[c+1],h=o[c+2];t(l,u)&&(r[a+0]=l,r[a+1]=u,a+=2),t(u,h)&&(r[a+0]=u,r[a+1]=h,a+=2),t(h,l)&&(r[a+0]=h,r[a+1]=l,a+=2)}this.wireframeIndex=r,this.wireframeIndexCount=a,this.wireframeIndexVersion=this.indexVersion}else{var f,p=n.attributes.position.count;f=this.wireframeIndex&&this.wireframeIndex.length>2*p?this.wireframeIndex:Ho(2*p,p);for(var m=0,y=0;m<p;m+=3)f[y+0]=m,f[y+1]=m+1,f[y+2]=m+1,f[y+3]=m+2,f[y+4]=m+2,f[y+5]=m,y+=6;this.wireframeIndex=f,this.wireframeIndexCount=2*p,this.wireframeIndexVersion=this.indexVersion}else this.wireframeIndex=new Uint16Array(0),this.wireframeIndexCount=0},Bt.prototype.updateWireframeIndex=function(){if(this.wireframeGeometry&&this.wireframeIndex){if(this.wireframeGeometry.setDrawRange(0,1/0),this.wireframeIndexVersion<this.indexVersion&&this.makeWireframeIndex(),this.wireframeGeometry.index&&this.wireframeIndex.length>this.wireframeGeometry.index.array.length)this.wireframeGeometry.setIndex(new rt(this.wireframeIndex,1).setUsage(this.dynamic?WebGLRenderingContext.DYNAMIC_DRAW:0));else{var e=this.wireframeGeometry.getIndex();if(!e)return void de.error("Index is null");e.set(this.wireframeIndex),e.needsUpdate=this.wireframeIndexCount>0,e.updateRange.count=this.wireframeIndexCount}this.wireframeGeometry.setDrawRange(0,this.wireframeIndexCount)}},Bt.prototype.getRenderOrder=function(){var e=0;return this.isText?e=1:this.transparent&&(e=this.isSurface?3:2),e},Bt.prototype._getMesh=function(e){this.material||this.makeMaterial();var t,n=this.geometry,i=this[e];return(t=this.isLine?new On(n,i):this.isPoint?new Lf(n,i):new pn(n,i)).frustumCulled=!1,t.renderOrder=this.getRenderOrder(),t},Bt.prototype.getMesh=function(){return this._getMesh("material")},Bt.prototype.getWireframeMesh=function(){var e;return this.material||this.makeMaterial(),this.wireframeGeometry||this.makeWireframeGeometry(),(e=new On(this.wireframeGeometry,this.wireframeMaterial)).frustumCulled=!1,e.renderOrder=this.getRenderOrder(),e},Bt.prototype.getPickingMesh=function(){return this._getMesh("pickingMaterial")},Bt.prototype.getShader=function(e,t){return Ih(e,this.getDefines(t))},Bt.prototype.getVertexShader=function(e){return this.getShader(this.vertexShader,e)},Bt.prototype.getFragmentShader=function(e){return this.getShader(this.fragmentShader,e)},Bt.prototype.getDefines=function(e){var t={};return this.parameters.clipNear&&(t.NEAR_CLIP=1),this.parameters.clipRadius&&(t.RADIUS_CLIP=1),e==="picking"?t.PICKING=1:((e==="background"||this.parameters.background)&&(t.NOLIGHT=1),this.parameters.flatShaded&&(t.FLAT_SHADED=1),this.parameters.opaqueBack&&(t.OPAQUE_BACK=1),this.parameters.diffuseInterior&&(t.DIFFUSE_INTERIOR=1),this.parameters.useInteriorColor&&(t.USE_INTERIOR_COLOR=1)),t},Bt.prototype.getParameters=function(){return this.parameters},Bt.prototype.addUniforms=function(e){this.uniforms=rg.merge([this.uniforms,e]),this.pickingUniforms=rg.merge([this.pickingUniforms,e])},Bt.prototype.addAttributes=function(e){for(var t in e){var n=void 0,i=e[t],r=this.attributeSize*LS[i.type];i.value?(r!==i.value.length&&de.error("attribute value has wrong length",t),n=i.value):n=yT("float32",r),this.geometry.setAttribute(t,new rt(n,LS[i.type]).setUsage(this.dynamic?WebGLRenderingContext.DYNAMIC_DRAW:0))}},Bt.prototype.updateRenderOrder=function(){var e=this.getRenderOrder();function t(n){n.renderOrder=e}this.group.children.forEach(t),this.pickingGroup&&this.pickingGroup.children.forEach(t)},Bt.prototype.updateShader=function(){var e=this.material,t=this.wireframeMaterial,n=this.pickingMaterial;e.vertexShader=this.getVertexShader(),e.fragmentShader=this.getFragmentShader(),e.needsUpdate=!0,t.vertexShader=this.getShader("Line.vert"),t.fragmentShader=this.getShader("Line.frag"),t.needsUpdate=!0,n.vertexShader=this.getVertexShader("picking"),n.fragmentShader=this.getFragmentShader("picking"),n.needsUpdate=!0},Bt.prototype.setParameters=function(e){var t=e,n=this.parameterTypes,i=this.parameters,r={},o={},s=!1,a=!1;for(var c in t){var l=t[c];l!==void 0&&(i[c]=l,n[c]!==void 0&&(n[c].property&&(n[c].property!==!0?r[n[c].property]=l:r[c]=l),n[c].uniform&&(n[c].uniform!==!0?o[n[c].uniform]=l:o[c]=l),n[c].updateShader&&(s=!0),n[c].updateVisibility&&(a=!0),this.dynamic&&c==="wireframe"&&l===!0&&this.updateWireframeIndex(),c==="forceTransparent"&&(r.transparent=this.transparent),c==="matrix"&&(this.matrix=l)))}this.setProperties(r),this.setUniforms(o),s&&this.updateShader(),a&&this.setVisibility(this.visible)},Bt.prototype.setAttributes=function(e){var t=this.geometry,n=t.attributes;for(var i in e)if(i!=="picking"){var r=e[i],o=r.length;if(i==="index"){var s=t.getIndex();if(!s){de.error("Index is null");continue}t.setDrawRange(0,1/0),o>s.array.length?t.setIndex(new rt(r,1).setUsage(this.dynamic?WebGLRenderingContext.DYNAMIC_DRAW:0)):(s.set(r),s.count=o,s.needsUpdate=o>0,s.updateRange.count=o,t.setDrawRange(0,o)),this.indexVersion++,this.parameters.wireframe&&this.updateWireframeIndex()}else{var a=n[i];o>a.array.length?t.setAttribute(i,new rt(r,a.itemSize).setUsage(this.dynamic?WebGLRenderingContext.DYNAMIC_DRAW:0)):(n[i].set(r),n[i].needsUpdate=o>0,n[i].updateRange.count=o)}}},Bt.prototype.setUniforms=function(e){if(e){var t=this.material.uniforms,n=this.wireframeMaterial.uniforms,i=this.pickingMaterial.uniforms;for(var r in e)r==="opacity"&&this.setProperties({transparent:this.transparent}),t[r]!==void 0&&(t[r].value.isVector3?t[r].value.copy(e[r]):t[r].value.set?t[r].value.set(e[r]):t[r].value=e[r]),n[r]!==void 0&&(n[r].value.isVector3?n[r].value.copy(e[r]):n[r].value.set?n[r].value.set(e[r]):n[r].value=e[r]),i[r]!==void 0&&(i[r].value.isVector3?i[r].value.copy(e[r]):i[r].value.set?i[r].value.set(e[r]):i[r].value=e[r])}},Bt.prototype.setProperties=function(e){if(e){var t=this.material,n=this.wireframeMaterial,i=this.pickingMaterial;for(var r in e){var o=r,s=e[o];o==="transparent"?this.updateRenderOrder():o==="side"&&(s=IS(s)),t[o]=s,n[o]=s,i[o]=s}t.needsUpdate=!0,n.needsUpdate=!0,i.needsUpdate=!0}},Bt.prototype.setVisibility=function(e){this.visible=e,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=e,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=e,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=e))},Bt.prototype.dispose=function(){this.material&&this.material.dispose(),this.wireframeMaterial&&this.wireframeMaterial.dispose(),this.pickingMaterial&&this.pickingMaterial.dispose(),this.geometry.dispose(),this.wireframeGeometry&&this.wireframeGeometry.dispose()},Bt.prototype.toJSON=function(){var e={};for(var t in this)t!=="group"&&t!=="wireframeGroup"&&t!="pickingGroup"&&t!=="picking"&&(e[t]=this[t]);return e},Object.defineProperties(Bt.prototype,qs);var Cs=function(e){function t(n,i){i===void 0&&(i={}),e.call(this,n,i),this.vertexShader="Mesh.vert",this.fragmentShader="Mesh.frag",this.addAttributes({normal:{type:"v3",value:n.normal}}),n.normal===void 0&&this.geometry.computeVertexNormals()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Bt),YT=function(e){function t(){e.apply(this,arguments),this.isSurface=!0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Cs);function Bd(e){e.visible=!0}function RS(e){e.visible=!1}var Cr=function(e){this.group=new nn,this.wireframeGroup=new nn,this.pickingGroup=new nn,this.frontMeshes=[],this.backMeshes=[],this.size=e.size,this.side=e.parameters.side,this.visible=e.visible,this.geometry=e.geometry,this.picking=e.picking,this.group=new nn,this.wireframeGroup=new nn,this.pickingGroup=new nn,this.matrix=e.matrix;var t=e,n=new e.constructor({position:new Float32Array(0)});t.makeMaterial(),n.makeMaterial(),n.picking=e.picking,n.geometry=e.geometry,n.wireframeGeometry=e.wireframeGeometry,n.setParameters(e.getParameters()),n.updateShader(),t.setParameters({side:"front"}),n.setParameters({side:"back",opacity:n.parameters.opacity}),this.buffer=e,this.frontBuffer=t,this.backBuffer=n},fh={matrix:{configurable:!0},pickable:{configurable:!0},parameters:{configurable:!0}};fh.matrix.set=function(e){Bt.prototype.setMatrix.call(this,e)},fh.matrix.get=function(){return this.group.matrix.clone()},fh.pickable.get=function(){return!!this.picking&&!this.parameters.disablePicking},fh.parameters.get=function(){return this.buffer.parameters},Cr.prototype.getParameters=function(){var e=Object.assign({},this.buffer.parameters);return e.side=this.side,e},Cr.prototype.getMesh=function(e){var t,n;return e?(n=this.backBuffer.getPickingMesh(),t=this.frontBuffer.getPickingMesh()):(n=this.backBuffer.getMesh(),t=this.frontBuffer.getMesh()),this.frontMeshes.push(t),this.backMeshes.push(n),this.setParameters({side:this.side}),new nn().add(n,t)},Cr.prototype.getWireframeMesh=function(){return this.buffer.getWireframeMesh()},Cr.prototype.getPickingMesh=function(){return this.getMesh(!0)},Cr.prototype.setAttributes=function(e){this.buffer.setAttributes(e)},Cr.prototype.setParameters=function(e){(e=Object.assign({},e)).side==="front"?(this.frontMeshes.forEach(Bd),this.backMeshes.forEach(RS)):e.side==="back"?(this.frontMeshes.forEach(RS),this.backMeshes.forEach(Bd)):e.side==="double"&&(this.frontMeshes.forEach(Bd),this.backMeshes.forEach(Bd)),e.side!==void 0&&(this.side=e.side),delete e.side,e.matrix!==void 0&&(this.matrix=e.matrix),delete e.matrix,this.frontBuffer.setParameters(e),e.wireframe!==void 0&&(this.wireframe=e.wireframe,this.setVisibility(this.visible)),delete e.wireframe,this.backBuffer.setParameters(e)},Cr.prototype.setVisibility=function(e){this.visible=e,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=e,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=e,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=e))},Cr.prototype.dispose=function(){this.frontBuffer.dispose(),this.backBuffer.dispose()},Cr.prototype.toJSON=function(){var e={};for(var t in this)["side","size","visible","matrix","parameters"].includes(t)&&(e[t]=this[t]);return e},Object.defineProperties(Cr.prototype,fh),jt.add("shader/Line.vert",`uniform float clipNear;
uniform vec3 clipCenter;
varying vec3 vViewPosition;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#include color_pars_vertex
void main(){
#include color_vertex
#include begin_vertex
#include project_vertex
vViewPosition = -mvPosition.xyz;
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`),jt.add("shader/Line.frag",`uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
varying vec3 vViewPosition;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#include common
#include color_pars_fragment
#include fog_pars_fragment
void main(){
#include nearclip_fragment
#include radiusclip_fragment
gl_FragColor = vec4( vColor, opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include encodings_fragment
#include fog_fragment
}`);var ZT=function(e){function t(){e.apply(this,arguments),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Bt),tb=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="surface",this.parameters=Object.assign({isolevelType:{type:"select",options:{value:"value",sigma:"sigma"}},isolevel:{type:"number",precision:2,max:1e3,min:-1e3},negateIsolevel:{type:"boolean"},isolevelScroll:{type:"boolean"},smooth:{type:"integer",precision:1,max:10,min:0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},boxSize:{type:"integer",precision:1,max:100,min:0},colorVolume:{type:"hidden"},contour:{type:"boolean",rebuild:!0},useWorker:{type:"boolean",rebuild:!0},wrap:{type:"boolean",rebuild:!0}},this.parameters),n instanceof Xt?(this.surface=void 0,this.volume=n):(this.surface=n,this.volume=void 0),this.boxCenter=new T,this.__boxCenter=new T,this.box=new hn,this.__box=new hn,this._position=new T,this.inverseMatrix=new De,this.setBox=function(){this._position.copy(i.translationGroup.position).negate(),this._position.applyMatrix4(this.inverseMatrix),this._position.equals(this.boxCenter)||this.setParameters({boxCenter:this._position})},this.toBePrepared=!0,this.viewer.signals.ticked.add(this.setBox,this),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.colorScheme=O(i.colorScheme,"uniform"),i.colorValue=O(i.colorValue,14540253),this.isolevelType=O(i.isolevelType,"sigma"),this.isolevel=O(i.isolevel,2),this.negateIsolevel=O(i.negateIsolevel,!1),this.isolevelScroll=O(i.isolevelScroll,!1),this.smooth=O(i.smooth,0),this.background=O(i.background,!1),this.opaqueBack=O(i.opaqueBack,!0),this.boxSize=O(i.boxSize,0),this.colorVolume=O(i.colorVolume,void 0),this.contour=O(i.contour,!1),this.useWorker=O(i.useWorker,!0),this.wrap=O(i.wrap,!1),e.prototype.init.call(this,i),this.inverseMatrix.getInverse(this.matrix),this.build()},t.prototype.attach=function(n){var i=this;this.bufferList.forEach(function(r){i.viewer.add(r)}),this.setVisibility(this.visible),n()},t.prototype.prepare=function(n){var i,r=this;if(this.volume)if(i=this.isolevelType==="sigma"?this.volume.getValueForSigma(this.isolevel):this.isolevel,this.negateIsolevel&&(i*=-1),!this.surface||this.__isolevel!==i||this.__smooth!==this.smooth||this.__contour!==this.contour||this.__wrap!==this.wrap||this.__boxSize!==this.boxSize||this.boxSize>0&&!this.__boxCenter.equals(this.boxCenter)){this.__isolevel=i,this.__smooth=this.smooth,this.__contour=this.contour,this.__wrap=this.wrap,this.__boxSize=this.boxSize,this.__boxCenter.copy(this.boxCenter),this.__box.copy(this.box);var o=function(s){r.surface=s,n()};this.useWorker?this.volume.getSurfaceWorker(i,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap,o):o(this.volume.getSurface(i,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap))}else n();else n()},t.prototype.create=function(){var n,i={position:this.surface.getPosition(),color:this.surface.getColor(this.getColorParams()),index:this.surface.getIndex()};if(this.contour)n=new ZT(i,this.getBufferParams({wireframe:!1}));else{Object.assign(i,{normal:this.surface.getNormal(),picking:this.surface.getPicking()});var r=new YT(i,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));n=new Cr(r)}this.bufferList.push(n)},t.prototype.update=function(n){if(this.bufferList.length!==0){var i={};(n=n||{}).position&&(i.position=this.surface.getPosition()),n.color&&(i.color=this.surface.getColor(this.getColorParams())),n.index&&(i.index=this.surface.getIndex()),n.normal&&(i.normal=this.surface.getNormal()),this.bufferList.forEach(function(r){r.setAttributes(i)})}},t.prototype.setParameters=function(n,i,r){return n&&n.isolevelType!==void 0&&this.volume&&(this.isolevelType==="value"&&n.isolevelType==="sigma"?this.isolevel=this.volume.getSigmaForValue(this.isolevel):this.isolevelType==="sigma"&&n.isolevelType==="value"&&(this.isolevel=this.volume.getValueForSigma(this.isolevel)),this.isolevelType=n.isolevelType),n&&n.boxCenter&&(this.boxCenter.copy(n.boxCenter),delete n.boxCenter),n&&n.wireframe&&(n.contour||n.contour===void 0&&this.contour)&&(n.wireframe=!1),e.prototype.setParameters.call(this,n,i,r),n.matrix&&this.inverseMatrix.getInverse(n.matrix),this.volume&&this.volume.getBox(this.boxCenter,this.boxSize,this.box),n&&n.colorVolume!==void 0&&i&&(i.color=!0),this.surface&&(n.isolevel!==void 0||n.negateIsolevel!==void 0||n.smooth!==void 0||n.wrap!==void 0||n.boxSize!==void 0||this.boxSize>0&&!this.__box.equals(this.box))&&this.build({position:!0,color:!0,index:!0,normal:!this.contour}),this},t.prototype.getColorParams=function(){var n=e.prototype.getColorParams.call(this);return n.volume=this.colorVolume,n},t.prototype.dispose=function(){this.viewer.signals.ticked.remove(this.setBox,this),e.prototype.dispose.call(this)},t}(Un),ht=function(){};ht.zoomScroll=function(e,t){e.trackballControls.zoom(t)},ht.clipNearScroll=function(e,t){var n=e.getParameters();e.setParameters({clipNear:n.clipNear+t/10})},ht.focusScroll=function(e,t){var n=e.getFocus(),i=Math.sign(t)*function(r,o,s){if(r>o)return r;var a=r/o;return((2*s-o)*a+(2*o-3*s))*a*a+s}((100-n)/10,5,.2);e.setFocus(n+i)},ht.zoomFocusScroll=function(e,t){e.trackballControls.zoom(t);var n=e.viewer.camera.position.z;e.setFocus(100-Math.abs(n/8))},ht.isolevelScroll=function(e,t){var n=Math.sign(t)/10;e.eachRepresentation(function(i,r){if(i.repr instanceof tb){var o=i.getParameters();o.isolevelScroll&&i.setParameters({isolevel:o.isolevel+n})}})},ht.panDrag=function(e,t,n){e.trackballControls.pan(t,n)},ht.rotateDrag=function(e,t,n){e.trackballControls.rotate(t,n)},ht.zRotateDrag=function(e,t,n){e.trackballControls.zRotate(t,n)},ht.zoomDrag=function(e,t,n){e.trackballControls.zoom((t+n)/-2)},ht.zoomFocusDrag=function(e,t,n){e.trackballControls.zoom((t+n)/-2);var i=e.viewer.camera.position.z;e.setFocus(100-Math.abs(i/8))},ht.panComponentDrag=function(e,t,n){e.trackballControls.panComponent(t,n)},ht.panAtomDrag=function(e,t,n){e.trackballControls.panAtom(t,n)},ht.rotateComponentDrag=function(e,t,n){e.trackballControls.rotateComponent(t,n)},ht.movePick=function(e,t){t&&e.animationControls.move(t.position.clone())},ht.tooltipPick=function(e,t){var n=e.tooltip;if(e.getParameters().tooltip&&t){var i=t.mouse.position;n.innerText=t.getLabel(),n.style.bottom=window.innerHeight-i.y+3+"px",n.style.left=i.x+3+"px",n.style.display="block"}else n.style.display="none"};var KT={default:[["scroll",ht.zoomScroll],["scroll-shift",ht.focusScroll],["scroll-ctrl",ht.isolevelScroll],["scroll-shift-ctrl",ht.zoomFocusScroll],["drag-left",ht.rotateDrag],["drag-right",ht.panDrag],["drag-ctrl-left",ht.panDrag],["drag-ctrl-right",ht.zRotateDrag],["drag-shift-left",ht.zoomDrag],["drag-middle",ht.zoomFocusDrag],["drag-ctrl-shift-right",ht.panComponentDrag],["drag-ctrl-shift-left",ht.rotateComponentDrag],["clickPick-right",ht.measurePick=function(e,t){if(t&&(t.atom||t.bond)){var n=t.atom||t.closestBondAtom;t.component.measurePick(n)}else e.measureClear()}],["clickPick-ctrl-left",ht.measurePick],["clickPick-middle",ht.movePick],["clickPick-left",ht.movePick],["hoverPick",ht.tooltipPick]],pymol:[["drag-left",ht.rotateDrag],["drag-middle",ht.panDrag],["drag-right",ht.zoomDrag],["drag-shift-right",ht.focusScroll],["clickPick-ctrl+shift-middle",ht.movePick],["hoverPick",ht.tooltipPick]],coot:[["scroll",ht.isolevelScroll],["drag-left",ht.rotateDrag],["drag-middle",ht.panDrag],["drag-ctrl-left",ht.panDrag],["drag-right",ht.zoomFocusDrag],["drag-ctrl-right",ht.focusScroll],["clickPick-middle",ht.movePick],["hoverPick",ht.tooltipPick]],astexviewer:[["drag-left",ht.rotateDrag],["drag-ctrl-left",ht.panDrag],["drag-shift-left",ht.zoomDrag],["scroll",ht.focusScroll],["clickPick-middle",ht.movePick],["hoverPick",ht.tooltipPick]]};function OS(e){var t=e.split(/[-+]/),n="";t.includes("scroll")&&(n="scroll"),t.includes("drag")&&(n="drag"),t.includes("click")&&(n="click"),t.includes("doubleClick")&&(n="doubleClick"),t.includes("hover")&&(n="hover"),t.includes("clickPick")&&(n="clickPick"),t.includes("hoverPick")&&(n="hoverPick");var i=0;t.includes("alt")&&(i+=1),t.includes("ctrl")&&(i+=2),t.includes("meta")&&(i+=4),t.includes("shift")&&(i+=8);var r=0;return t.includes("left")&&(r+=1),t.includes("right")&&(r+=2),t.includes("middle")&&(r+=4),[n,i,r]}var hl=function(e,t){t===void 0&&(t={}),this.stage=e,this.actionList=[],this.mouse=e.mouseObserver,this.disabled=t.disabled||!1,this.preset(t.preset||"default")};hl.prototype.run=function(e){for(var t=this,n=[],i=arguments.length-1;i-- >0;)n[i]=arguments[i+1];if(!this.disabled){var r=this.mouse.key||0,o=this.mouse.buttons||0;this.actionList.forEach(function(s){s.type===e&&s.key===r&&s.button===o&&s.callback.apply(s,[t.stage].concat(n))})}},hl.prototype.add=function(e,t){var n=OS(e),i=n[0],r=n[1],o=n[2];this.actionList.push({type:i,key:r,button:o,callback:t})},hl.prototype.remove=function(e,t){var n=e.includes("*"),i=OS(e),r=i[0],o=i[1],s=i[2],a=this.actionList.filter(function(c){return!((c.type===r||n&&r==="")&&(c.key===o||n&&o===0)&&(c.button===s||n&&s===0)&&(c.callback===t||t===void 0))});this.actionList=a},hl.prototype.preset=function(e){var t=this;this.clear(),(KT[e]||[]).forEach(function(n){return t.add(n[0],n[1])})},hl.prototype.clear=function(){this.actionList.length=0};var ia=function(){};ia.autoView=function(e){e.autoView(1e3)},ia.toggleAnimations=function(e){e.animationControls.toggle()},ia.toggleRock=function(e){e.toggleRock()};var ZN={default:[["i",ia.toggleSpin=function(e){e.toggleSpin()}],["k",ia.toggleRock],["p",ia.toggleAnimations],["a",ia.toggleAntialiasing=function(e){var t=e.getParameters();e.setParameters({sampleLevel:t.sampleLevel===-1?0:-1})}],["r",ia.autoView]]},fl=function(e,t){t===void 0&&(t={}),this.stage=e,this.actionList=[],this.disabled=t.disabled||!1,this.preset(t.preset||"default")};fl.prototype.run=function(e){var t=this;this.disabled||this.actionList.forEach(function(n){n.key===e&&n.callback(t.stage)})},fl.prototype.add=function(e,t){this.actionList.push({key:e,callback:t})},fl.prototype.remove=function(e,t){var n=this.actionList.filter(function(i){return!(i.key===e&&(i.callback===t||t===void 0))});this.actionList=n},fl.prototype.preset=function(e){var t=this;this.clear(),(ZN[e]||[]).forEach(function(n){return t.add(n[0],n[1])})},fl.prototype.clear=function(){this.actionList.length=0};var bm=function(e){this.stage=e,this.stage=e,this.mouse=e.mouseObserver,this.controls=e.mouseControls,this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this)};bm.prototype._onClick=function(e,t){var n=this.stage.pickingControls.pick(e,t);this.stage.signals.clicked.dispatch(n),this.controls.run("clickPick",n)},bm.prototype._onHover=function(e,t){var n=this.stage.pickingControls.pick(e,t);n&&this.mouse.down.equals(this.mouse.position)&&(this.stage.transformComponent=n.component,this.stage.transformAtom=n.atom),this.stage.signals.hovered.dispatch(n),this.controls.run("hoverPick",n)},bm.prototype.dispose=function(){this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)};var Ys=function(e){this.stage=e,this.stage=e,this.mouse=e.mouseObserver,this.controls=e.mouseControls,this.mouse.signals.moved.add(this._onMove,this),this.mouse.signals.scrolled.add(this._onScroll,this),this.mouse.signals.dragged.add(this._onDrag,this),this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this),this.mouse.signals.doubleClicked.add(this._onDblclick,this)};Ys.prototype._onMove=function(){this.stage.tooltip.style.display="none"},Ys.prototype._onScroll=function(e){this.controls.run("scroll",e)},Ys.prototype._onDrag=function(e,t){this.controls.run("drag",e,t)},Ys.prototype._onClick=function(e,t){this.controls.run("click",e,t)},Ys.prototype._onDblclick=function(e,t){this.controls.run("doubleClick",e,t)},Ys.prototype._onHover=function(e,t){this.controls.run("hover",e,t)},Ys.prototype.dispose=function(){this.mouse.signals.moved.remove(this._onMove,this),this.mouse.signals.scrolled.remove(this._onScroll,this),this.mouse.signals.dragged.remove(this._onDrag,this),this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)};var nb=function(e){this.stage=e,this.viewer=e.viewer,this.animationControls=e.animationControls,this.viewer.signals.ticked.add(this._onTick,this)};nb.prototype._onTick=function(e){this.animationControls.run(e)},nb.prototype.dispose=function(){this.viewer.signals.ticked.remove(this._onTick,this)};var QT=!!wT&&{passive:!0},pl=function(e){this.stage=e,this.stage=e,this.controls=e.keyControls,this.domElement=e.viewer.renderer.domElement,this.domElement.setAttribute("tabIndex","-1"),this.domElement.style.outline="none",this._focusDomElement=this._focusDomElement.bind(this),this._onKeydown=this._onKeydown.bind(this),this._onKeyup=this._onKeyup.bind(this),this._onKeypress=this._onKeypress.bind(this),this.domElement.addEventListener("mousedown",this._focusDomElement),this.domElement.addEventListener("touchstart",this._focusDomElement,QT),this.domElement.addEventListener("keydown",this._onKeydown),this.domElement.addEventListener("keyup",this._onKeyup),this.domElement.addEventListener("keypress",this._onKeypress)};pl.prototype._onKeydown=function(){},pl.prototype._onKeyup=function(){},pl.prototype._onKeypress=function(e){var t;t="key"in KeyboardEvent.prototype?e.key:String.fromCharCode(e.which||e.keyCode),this.controls.run(t)},pl.prototype._focusDomElement=function(){this.domElement.focus()},pl.prototype.dispose=function(){this.domElement.removeEventListener("mousedown",this._focusDomElement),this.domElement.removeEventListener("touchstart",this._focusDomElement,QT),this.domElement.removeEventListener("keydown",this._onKeypress),this.domElement.removeEventListener("keyup",this._onKeypress),this.domElement.removeEventListener("keypress",this._onKeypress)};var Zs=function(e,t,n,i){i===void 0&&(i={}),this.component=e,this.position=t,this.offsetX=O(i.offsetX,0),this.offsetY=O(i.offsetY,0),this.visible=O(i.visible,!0),this.stage=e.stage,this.viewer=e.stage.viewer,this._viewerPosition=new T,this._updateViewerPosition(),this._canvasPosition=new Ee,this._cameraPosition=new T,this.element=document.createElement("div"),Object.assign(this.element.style,{display:"block",position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",left:"-10000px"}),this.viewer.wrapper.appendChild(this.element),this.setContent(n),this.updateVisibility(),this.viewer.signals.rendered.add(this._update,this),this.component.signals.matrixChanged.add(this._updateViewerPosition,this)};Zs.prototype.setContent=function(e){var t=this.element.style.display;if(t==="none"&&(this.element.style.left="-10000px",this.element.style.display="block"),e instanceof HTMLElement)this.element.appendChild(e);else{var n=document.createElement("div");n.innerText=e,Object.assign(n.style,{backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.element.appendChild(n)}this._clientRect=this.element.getBoundingClientRect(),t==="none"&&(this.element.style.display=t)},Zs.prototype.setVisibility=function(e){this.visible=e,this.updateVisibility()},Zs.prototype.getVisibility=function(){return this.visible&&this.component.parameters.visible},Zs.prototype.updateVisibility=function(){this.element.style.display=this.getVisibility()?"block":"none"},Zs.prototype._updateViewerPosition=function(){this._viewerPosition.copy(this.position).applyMatrix4(this.component.matrix)},Zs.prototype._update=function(){if(this.getVisibility()){var e=this.element.style,t=this._canvasPosition,n=this._viewerPosition,i=this._clientRect;if(this._cameraPosition.copy(n).add(this.viewer.translationGroup.position).applyMatrix4(this.viewer.rotationGroup.matrix).sub(this.viewer.camera.position),this._cameraPosition.z<0)e.display="none";else{e.display="block";var r=this._cameraPosition.length(),o=this.viewer.scene.fog;e.opacity=(1-_p(o.near,o.far,r)).toString(),e.zIndex=Math.round(100*(o.far-r)).toString(),this.stage.viewerControls.getPositionOnCanvas(n,t),e.bottom=this.offsetX+t.y+i.height/2+"px",e.left=this.offsetY+t.x-i.width/2+"px"}}},Zs.prototype.dispose=function(){this.viewer.wrapper.removeChild(this.element),this.viewer.signals.ticked.remove(this._update,this),this.component.signals.matrixChanged.remove(this._updateViewerPosition,this)};var es=new De,Fd=new T,kS=new un,_m=function(e){this.component=e,this.signals={changed:new yt.Signal},this.stage=e.stage,this.viewer=e.stage.viewer},fy={position:{configurable:!0},rotation:{configurable:!0}};fy.position.get=function(){return this.component.position},fy.rotation.get=function(){return this.component.quaternion},_m.prototype.changed=function(){this.component.updateMatrix(),this.viewer.requestRender(),this.signals.changed.dispatch()},_m.prototype.spin=function(e,t){es.getInverse(this.viewer.rotationGroup.matrix),Fd.copy(ac(e)).applyMatrix4(es),es.extractRotation(this.component.transform),es.premultiply(this.viewer.rotationGroup.matrix),es.getInverse(es),Fd.copy(ac(e)),Fd.applyMatrix4(es),es.makeRotationAxis(Fd,t),kS.setFromRotationMatrix(es),this.component.quaternion.premultiply(kS),this.changed()},Object.defineProperties(_m.prototype,fy);var JT={"":"",vdw:"by vdW radius",covalent:"by covalent radius",sstruc:"by secondary structure",bfactor:"by bfactor",size:"size",data:"data",explicit:"explicit"},jo=function(e){e===void 0&&(e={}),this.max=10,this.type=O(e.type,"size"),this.scale=O(e.scale,1),this.size=O(e.size,1),this.data=O(e.data,{})};jo.prototype.atomRadius=function(e){var t;switch(this.type){case"vdw":t=e.vdw;break;case"covalent":t=e.covalent;break;case"bfactor":t=e.bfactor||1;break;case"sstruc":var n=e.sstruc;t=n==="h"||n==="g"||n==="i"||n==="e"||n==="b"?.25:UT.includes(e.atomname)?.4:.1;break;case"data":t=O(this.data[e.index],1);break;case"explicit":(t=e.radius)===null&&(t=this.size);break;default:t=this.size}return Math.min(t*this.scale,this.max)},jo.types=JT;var KN=new T(-1,-1,-1),QN=new De,Zh=function(e){var t=e.rows,n=t/3,i=new Yt(t,3),r=new Yt(3,3),o=new Yt(1,3),s=new Yt(3,3),a=new Yt(3,3),c=Zx(e);Kx(e,c),io(i,e),vm(r,i,i),WT(r,o,s,a);var l=new T(c[0],c[1],c[2]),u=new T(s.data[0],s.data[3],s.data[6]),h=new T(s.data[1],s.data[4],s.data[7]),f=new T(s.data[2],s.data[5],s.data[8]),p=u.clone().multiplyScalar(Math.sqrt(o.data[0]/n)),m=h.clone().multiplyScalar(Math.sqrt(o.data[1]/n)),y=f.clone().multiplyScalar(Math.sqrt(o.data[2]/n));this.begA=l.clone().sub(p),this.endA=l.clone().add(p),this.begB=l.clone().sub(m),this.endB=l.clone().add(m),this.begC=l.clone().sub(y),this.endC=l.clone().add(y),this.center=l,this.vecA=p,this.vecB=m,this.vecC=y,this.normVecA=u,this.normVecB=h,this.normVecC=f};Zh.prototype.getBasisMatrix=function(e){e===void 0&&(e=new De);var t=e;return t.makeBasis(this.normVecB,this.normVecA,this.normVecC),t.determinant()<0&&t.scale(KN),t},Zh.prototype.getRotationQuaternion=function(e){e===void 0&&(e=new un);var t=e;return t.setFromRotationMatrix(this.getBasisMatrix(QN)),t.inverse()},Zh.prototype.getProjectedScaleForAtoms=function(e){var t=-1/0,n=-1/0,i=-1/0,r=-1/0,o=-1/0,s=-1/0,a=new T,c=new T,l=this.center,u=this.normVecA,h=this.normVecB,f=this.normVecC;return e.eachAtom(function(p){lc(a.copy(p),u,l);var m=c.subVectors(a,l).normalize().dot(u),y=a.distanceTo(l);m>0?y>t&&(t=y):y>n&&(n=y),lc(a.copy(p),h,l);var v=c.subVectors(a,l).normalize().dot(h),d=a.distanceTo(l);v>0?d>i&&(i=d):d>r&&(r=d),lc(a.copy(p),f,l);var g=c.subVectors(a,l).normalize().dot(f),b=a.distanceTo(l);g>0?b>o&&(o=b):b>s&&(s=b)}),{d1a:t,d2a:i,d3a:o,d1b:-n,d2b:-r,d3b:-s}};var Pr=function(e,t,n,i){this.volume=e,this.setFilter(t,n,i)},Wr={header:{configurable:!0},matrix:{configurable:!0},normalMatrix:{configurable:!0},inverseMatrix:{configurable:!0},center:{configurable:!0},boundingBox:{configurable:!0},min:{configurable:!0},max:{configurable:!0},mean:{configurable:!0},rms:{configurable:!0}};Wr.header.get=function(){return this.volume.header},Wr.matrix.get=function(){return this.volume.matrix},Wr.normalMatrix.get=function(){return this.volume.normalMatrix},Wr.inverseMatrix.get=function(){return this.volume.inverseMatrix},Wr.center.get=function(){return this.volume.center},Wr.boundingBox.get=function(){return this.volume.boundingBox},Wr.min.get=function(){return this.volume.min},Wr.max.get=function(){return this.volume.max},Wr.mean.get=function(){return this.volume.mean},Wr.rms.get=function(){return this.volume.rms},Pr.prototype._getFilterHash=function(e,t,n){return JSON.stringify([e,t,n])},Pr.prototype.setFilter=function(e,t,n){isNaN(e)&&this.header&&(e=this.header.DMEAN+2*this.header.ARMS),e=e===void 0||isNaN(e)?-1/0:e,t=O(t,1/0),n=O(n,!1);var i=this.volume.data,r=this.volume.position,o=this.volume.atomindex,s=this._getFilterHash(e,t,n);if(s!==this._filterHash){if(e===-1/0&&t===1/0)this.data=i,this.position=r,this.atomindex=o;else{var a=i.length;this._dataBuffer||(this._dataBuffer=new ArrayBuffer(4*a),this._positionBuffer=new ArrayBuffer(3*a*4),o&&(this._atomindexBuffer=new ArrayBuffer(4*a)));var c,l=new Float32Array(this._dataBuffer),u=new Float32Array(this._positionBuffer);o&&(c=new Uint32Array(this._atomindexBuffer));for(var h=0,f=0;f<a;++f){var p=3*f,m=i[f];if(!n&&m>=e&&m<=t||n&&(m<e||m>t)){var y=3*h;l[h]=m,u[y+0]=r[p+0],u[y+1]=r[p+1],u[y+2]=r[p+2],o&&c&&(c[h]=o[f]),h+=1}}this.data=new Float32Array(this._dataBuffer,0,h),this.position=new Float32Array(this._positionBuffer,0,3*h),o&&(this.atomindex=new Int32Array(this._atomindexBuffer,0,h))}this._filterHash=s}},Object.defineProperties(Pr.prototype,Wr),Pr.prototype.getValueForSigma=Xt.prototype.getValueForSigma,Pr.prototype.getSigmaForValue=Xt.prototype.getSigmaForValue,Pr.prototype.getDataAtomindex=Xt.prototype.getDataAtomindex,Pr.prototype.getDataPosition=Xt.prototype.getDataPosition,Pr.prototype.getDataColor=Xt.prototype.getDataColor,Pr.prototype.getDataPicking=Xt.prototype.getDataPicking,Pr.prototype.getDataSize=Xt.prototype.getDataSize;var JN=function(e,t){var n=OT({nodeArray1:e.atomIndex1,nodeArray2:e.atomIndex2,edgeCount:e.count,nodeCount:t});this.countArray=n.countArray,this.offsetArray=n.offsetArray,this.indexArray=n.indexArray},wm=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={_defaultFields:{configurable:!0}};return n._defaultFields.get=function(){return[["atomIndex1",1,"int32"],["atomIndex2",1,"int32"],["bondOrder",1,"int8"]]},t.prototype.addBond=function(i,r,o){this.growIfFull();var s=this.count,a=i.index,c=r.index;a<c?(this.atomIndex1[s]=a,this.atomIndex2[s]=c):(this.atomIndex2[s]=a,this.atomIndex1[s]=c),o&&(this.bondOrder[s]=o),this.count+=1},t.prototype.addBondIfConnected=function(i,r,o){return!!i.connectedTo(r)&&(this.addBond(i,r,o),!0)},Object.defineProperties(t.prototype,n),t}(hi),e6=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={_defaultFields:{configurable:!0}};return n._defaultFields.get=function(){return[["residueIndex",1,"uint32"],["atomTypeId",1,"uint16"],["x",1,"float32"],["y",1,"float32"],["z",1,"float32"],["serial",1,"int32"],["bfactor",1,"float32"],["altloc",1,"uint8"],["occupancy",1,"float32"]]},t.prototype.setAltloc=function(i,r){this.altloc[i]=r.charCodeAt(0)},t.prototype.getAltloc=function(i){var r=this.altloc[i];return r?String.fromCharCode(r):""},Object.defineProperties(t.prototype,n),t}(hi),t6=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={_defaultFields:{configurable:!0}};return n._defaultFields.get=function(){return[["chainIndex",1,"uint32"],["atomOffset",1,"uint32"],["atomCount",1,"uint32"],["residueTypeId",1,"uint16"],["resno",1,"int32"],["sstruc",1,"uint8"],["inscode",1,"uint8"]]},t.prototype.setSstruc=function(i,r){this.sstruc[i]=r.charCodeAt(0)},t.prototype.getSstruc=function(i){var r=this.sstruc[i];return r?String.fromCharCode(r):""},t.prototype.setInscode=function(i,r){this.inscode[i]=r.charCodeAt(0)},t.prototype.getInscode=function(i){var r=this.inscode[i];return r?String.fromCharCode(r):""},Object.defineProperties(t.prototype,n),t}(hi),n6=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={_defaultFields:{configurable:!0}};return n._defaultFields.get=function(){return[["entityIndex",1,"uint16"],["modelIndex",1,"uint16"],["residueOffset",1,"uint32"],["residueCount",1,"uint32"],["chainname",4,"uint8"],["chainid",4,"uint8"]]},t.prototype.setChainname=function(i,r){var o=4*i;this.chainname[o]=r.charCodeAt(0),this.chainname[o+1]=r.charCodeAt(1),this.chainname[o+2]=r.charCodeAt(2),this.chainname[o+3]=r.charCodeAt(3)},t.prototype.getChainname=function(i){for(var r="",o=0;o<4;++o){var s=this.chainname[4*i+o];if(!s)break;r+=String.fromCharCode(s)}return r},t.prototype.setChainid=function(i,r){var o=4*i;this.chainid[o]=r.charCodeAt(0),this.chainid[o+1]=r.charCodeAt(1),this.chainid[o+2]=r.charCodeAt(2),this.chainid[o+3]=r.charCodeAt(3)},t.prototype.getChainid=function(i){for(var r="",o=0;o<4;++o){var s=this.chainid[4*i+o];if(!s)break;r+=String.fromCharCode(s)}return r},Object.defineProperties(t.prototype,n),t}(hi),i6=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={_defaultFields:{configurable:!0}};return n._defaultFields.get=function(){return[["chainOffset",1,"uint32"],["chainCount",1,"uint32"]]},Object.defineProperties(t.prototype,n),t}(hi),ls=function(e){this.polymer=e,this.size=e.residueCount};ls.prototype.getCenterIterator=function(e){e===void 0&&(e=0);var t=this.getPosition().center,n=t.length/3,i=0,r=-1,o=[new T,new T,new T,new T];return{size:n,next:function(){var s=this.get(r);return r+=1,s},get:function(s){s=Math.min(n-1,Math.max(0,s));var a=o[i%4],c=3*s;if(a.fromArray(t,c),e){for(var l=Math.min(e,s,n-s-1),u=1;u<=l;++u){var h=3*u,f=(l+1-u)/(l+1);a.x+=f*t[c-h+0]+f*t[c+h+0],a.y+=f*t[c-h+1]+f*t[c+h+1],a.z+=f*t[c-h+2]+f*t[c+h+2]}a.x/=l+1,a.y/=l+1,a.z/=l+1}return i+=1,a},reset:function(){i=0,r=-1}}},ls.prototype.getColor=function(e){var t=this.polymer,n=t.structure,i=t.residueCount,r=t.residueIndexStart,o=new Float32Array(3*i),s=e||{};s.structure=n;for(var a=Rt.getScheme(s),c=n.getResidueProxy(),l=n.getAtomProxy(),u=0;u<i;++u)c.index=r+u,l.index=c.traceAtomIndex,a.atomColorToArray(l,o,3*u);return{color:o}},ls.prototype.getPicking=function(){for(var e=this.polymer,t=e.structure,n=e.residueCount,i=e.residueIndexStart,r=new Float32Array(n),o=t.getResidueProxy(),s=0;s<n;++s)o.index=i+s,r[s]=o.traceAtomIndex;return{picking:new Oc(r,t)}},ls.prototype.getSize=function(e){for(var t=this.polymer,n=t.structure,i=t.residueCount,r=t.residueIndexStart,o=new Float32Array(i),s=new jo(e),a=n.getResidueProxy(),c=n.getAtomProxy(),l=0;l<i;++l)a.index=r+l,c.index=a.traceAtomIndex,o[l]=s.atomRadius(c);return{size:o}},ls.prototype.getPosition=function(){for(var e=this.polymer,t=e.structure,n=e.residueCount,i=n-3,r=new Float32Array(3*n),o=new Float32Array(3*n),s=new Float32Array(n),a=new Float32Array(n),c=new Float32Array(n),l=new Float32Array(n),u=new Float32Array(3*n),h=new T,f=new T,p=new T,m=new T,y=new T,v=new T,d=new T,g=new T,b=new T,x=new T,_=new T,S=new T(0,0,0),w="trace",C=t.getAtomProxy(),A=t.getAtomProxy(e.getAtomIndexByType(0,w)),k=t.getAtomProxy(e.getAtomIndexByType(1,w)),L=t.getAtomProxy(e.getAtomIndexByType(2,w)),D=0;D<i;++D){C.index=A.index,A.index=k.index,k.index=L.index,L.index=e.getAtomIndexByType(D+3,w);var F=3*D;h.subVectors(A,C),f.subVectors(k,A),p.subVectors(L,k),m.subVectors(h,f),y.subVectors(f,p),b.crossVectors(m,y).normalize(),b.toArray(o,F),D>0&&(s[D]=b.angleTo(x));var I=Math.cos(m.angleTo(y));l[D]=180/Math.PI*Math.acos(I);var P=m.length(),N=y.length();a[D]=Math.sqrt(N*P)/Math.max(2,2*(1-I)),c[D]=Math.abs(f.dot(b)),v.copy(m).multiplyScalar(a[D]/P),d.copy(y).multiplyScalar(a[D]/N),v.subVectors(A,v),d.subVectors(k,d),v.toArray(r,F+3),d.toArray(r,F+6),_.subVectors(C,S),_.toArray(u,F),x.copy(b),S.copy(v)}v.fromArray(r,3),d.fromArray(r,6),b.subVectors(v,d).normalize(),C.index=e.getAtomIndexByType(0,w),S.copy(C),g.copy(C),lc(g,b,v),g.toArray(r,0),_.subVectors(S,v),_.toArray(u,0),v.fromArray(r,3*n-6),d.fromArray(r,3*n-9),b.subVectors(v,d).normalize(),C.index=e.getAtomIndexByType(n-1,w),S.copy(C),g.copy(C),lc(g,b,v),g.toArray(r,3*n-3);for(var $=n-3;$<n;++$)v.fromArray(r,3*$),C.index=e.getAtomIndexByType($,w),S.copy(C),_.subVectors(S,v),_.toArray(u,3*$);var B=new Float32Array(n),q=new Float32Array(n),ee=new Float32Array(n),W=new Float32Array(n);B[1]=a[0],q[1]=l[0],ee[1]=a[0];for(var Q=2;Q<n-2;++Q)B[Q]=.5*(a[Q-2]+a[Q-1]),q[Q]=.5*(l[Q-2]+l[Q-1]),ee[Q]=.5*(c[Q-2]+c[Q-1]),v.fromArray(o,3*(Q-2)),d.fromArray(o,3*(Q-1)),W[Q]=180/Math.PI*Math.acos(Math.cos(v.angleTo(d)));B[n-2]=a[n-4],q[n-2]=l[n-4],ee[n-2]=c[n-4];var Z=new Float32Array(3*n);Wn(o,Z,0,0,3),Wn(o,Z,0,3,3);for(var re=2;re<n-2;++re)v.fromArray(o,3*(re-2)),d.fromArray(o,3*(re-1)),b.addVectors(d,v).multiplyScalar(.5).normalize(),b.toArray(Z,3*re);return Wn(o,Z,3*n-12,3*n-6,3),Wn(o,Z,3*n-12,3*n-3,3),{center:r,axis:Z,bending:W,radius:B,rise:ee,twist:q,resdir:u}};var B_=function(e){this.polymer=e,this.helixorient=new ls(e),this.position=this.helixorient.getPosition()};B_.prototype.getAxis=function(e,t,n,i,r){e=e||30,t=t||2.5,n=n!==void 0&&n;var o=this.polymer,s=o.structure,a=o.residueCount,c=o.residueIndexStart,l=this.position,u=i||{};u.structure=s;for(var h,f,p=Rt.getScheme(u),m=new jo(r),y=0,v=0,d=[],g=[],b=[],x=[],_=[],S=[],w=[],C=[],A=[],k=new Float32Array(3*a),L=new Float32Array(3*a),D=new T,F=new T,I=s.getResidueProxy(),P=s.getResidueProxy(),N=s.getAtomProxy(),$=new T,B=new T,q=!1,ee=0;ee<a;++ee)if(I.index=c+ee,$.fromArray(l.center,3*ee),ee===a-1?q=!0:(P.index=c+ee+1,B.fromArray(l.center,3*ee+3),(n&&I.sstruc!==P.sstruc||$.distanceTo(B)>t||l.bending[ee]>e)&&(q=!0)),q){if(ee-y<4){y=ee,q=!1;continue}N.index=I.traceAtomIndex,k=l.axis.subarray(3*y+3,3*ee),L=l.center.subarray(3*y,3*ee+3),h=qx(k).normalize(),f=qx(L),D.fromArray(L),lc(D,h,f),F.fromArray(L,L.length-3),lc(F,h,f),h.subVectors(F,D),h.toArray(d,v),f.toArray(g,v),D.toArray(b,v),F.toArray(x,v),p.atomColorToArray(N,_,v),S.push(N.index),w.push(m.atomRadius(N)),C.push(c+y),A.push(c+ee+1-y),v+=3,y=ee,q=!1}var W=new Float32Array(S);return{axis:new Float32Array(d),center:new Float32Array(g),begin:new Float32Array(b),end:new Float32Array(x),color:new Float32Array(_),picking:new Oc(W,s),size:new Float32Array(w),residueOffset:C,residueCount:A}};var Ks=function(e){this.scoreFunction=e,this.content=[],this.scoreFunction=e};Ks.prototype.push=function(e){this.content.push(e),this.bubbleUp(this.content.length-1)},Ks.prototype.pop=function(){var e=this.content[0],t=this.content.pop();return t&&this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e},Ks.prototype.peek=function(){return this.content[0]},Ks.prototype.remove=function(e){for(var t=this.content.length,n=0;n<t;n++)if(this.content[n]===e){var i=this.content.pop();return void(i&&n!==t-1&&(this.content[n]=i,this.scoreFunction(i)<this.scoreFunction(e)?this.bubbleUp(n):this.sinkDown(n)))}throw new Error("Node not found.")},Ks.prototype.size=function(){return this.content.length},Ks.prototype.bubbleUp=function(e){for(var t=this.content[e];e>0;){var n=Math.floor((e+1)/2)-1,i=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(i)))break;this.content[n]=t,this.content[e]=i,e=n}},Ks.prototype.sinkDown=function(e){for(var t=this.content.length,n=this.content[e],i=this.scoreFunction(n),r=0;;){var o=2*(e+1),s=o-1,a=null;if(s<t){var c=this.content[s];(r=this.scoreFunction(c))<i&&(a=s)}if(o<t){var l=this.content[o];this.scoreFunction(l)<(a===null?i:r)&&(a=o)}if(a===null)break;this.content[e]=this.content[a],this.content[a]=n,e=a}};/**
 * Kdtree
 * @class
 * @author Alexander Rose <alexander.rose@weirdbyte.de>, 2016
 * @author Roman Bolzern <roman.bolzern@fhnw.ch>, 2013
 * @author I4DS http://www.fhnw.ch/i4ds, 2013
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 * @description
 * k-d Tree for typed arrays of 3d points (e.g. for Float32Array), in-place
 * provides fast nearest neighbour search
 *
 * Based on https://github.com/ubilabs/kd-tree-javascript by Ubilabs
 *
 * Further information (including mathematical properties)
 * http://en.wikipedia.org/wiki/Binary_tree
 * http://en.wikipedia.org/wiki/K-d_tree
 *
 * @example
 * points: [x, y, z, x, y, z, x, y, z, ...]
 * metric: function(a, b){
 *    return Math.pow(a[0]-b[0], 2) + Math.pow(a[1]-b[1], 2) + Math.pow(a[2]-b[2], 2);
 * }
 *
 * @param {Float32Array} points - points
 * @param {Function} metric - metric
 */var Dh=function(e,t){this.points=e,this.metric=t,this.maxDepth=0,this.currentNode=0;for(var n=e.length/3,i=new Uint32Array(n),r=0;r<n;++r)i[r]=r;this.indices=i,this.nodes=new Int32Array(4*n),this.rootIndex=this.buildTree(0,-1,0,n)};Dh.prototype.buildTree=function(e,t,n,i){e>this.maxDepth&&(this.maxDepth=e);var r=i-n;if(r===0)return-1;var o=4*this.currentNode,s=this.nodes;if(this.currentNode+=1,r===1)return s[o]=n,s[o+1]=-1,s[o+2]=-1,s[o+3]=t,o;for(var a,c,l,u,h,f=this.indices,p=this.points,m=n+Math.floor(r/2),y=e%3,v=n,d=i-1;d>v;){for(u=p[3*f[l=v+d>>1]+y],c=f[l],f[l]=f[d],f[d]=c,h=v,a=v;a<d;++a)p[3*f[a]+y]<u&&(c=f[h],f[h]=f[a],f[a]=c,++h);if(c=f[d],f[d]=f[h],f[h]=c,m===(l=h))break;m<l?d=l-1:v=l+1}return s[o]=m,s[o+1]=this.buildTree(e+1,o,n,m),s[o+2]=this.buildTree(e+1,o,m+1,i),s[o+3]=t,o},Dh.prototype.getNodeDepth=function(e){var t=this.nodes[e+3];return t===-1?0:this.getNodeDepth(t)+1},Dh.prototype.nearest=function(e,t,n){var i=this,r=new Ks(function(f){return-f[1]}),o=this.nodes,s=this.points,a=this.indices,c=function(f){var p,m,y=i.getNodeDepth(f)%3,v=3*a[o[f]],d=[s[v+0],s[v+1],s[v+2]],g=i.metric(e,d);function b(A,k){r.push([A,k]),r.size()>t&&r.pop()}var x=o[f+1],_=o[f+2];if(_!==-1||x!==-1){p=_===-1?x:x===-1?_:e[y]<=s[v+y]?x:_,c(p),(r.size()<t||g<r.peek()[1])&&g<=n&&b(f,g);for(var S=[],w=0;w<3;w+=1)S[w]=w===y?e[w]:s[v+w];var C=i.metric(S,d);(r.size()<t||Math.abs(C)<r.peek()[1])&&Math.abs(C)<=n&&(m=p===x?_:x)!==-1&&c(m)}else(r.size()<t||g<r.peek()[1])&&g<=n&&b(f,g)};c(this.rootIndex);for(var l=[],u=0,h=Math.min(r.size(),t);u<h;u+=1)l.push(r.content[u]);return l},Dh.prototype.verify=function(e,t){t===void 0&&(t=0);var n=1;if(e===void 0&&(e=this.rootIndex),e===-1)throw new Error("node is null");var i=t%3,r=this.nodes,o=this.points,s=this.indices,a=r[e+1],c=r[e+2];if(a!==-1){if(o[3*s[r[a]]+i]>o[3*s[r[e]]+i])throw new Error("left child is > parent!");n+=this.verify(a,t+1)}if(c!==-1){if(o[3*s[r[c]]+i]<o[3*s[r[e]]+i])throw new Error("right child is < parent!");n+=this.verify(c,t+1)}return n};var ot=function(e,t){t===void 0&&(t=0),this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueMap=e.residueMap,this.atomMap=e.atomMap},_t={bondHash:{configurable:!0},entity:{configurable:!0},entityIndex:{configurable:!0},modelIndex:{configurable:!0},chainIndex:{configurable:!0},residue:{configurable:!0},residueIndex:{configurable:!0},sstruc:{configurable:!0},inscode:{configurable:!0},resno:{configurable:!0},chainname:{configurable:!0},chainid:{configurable:!0},residueType:{configurable:!0},atomType:{configurable:!0},residueAtomOffset:{configurable:!0},resname:{configurable:!0},hetero:{configurable:!0},atomname:{configurable:!0},number:{configurable:!0},element:{configurable:!0},vdw:{configurable:!0},covalent:{configurable:!0},x:{configurable:!0},y:{configurable:!0},z:{configurable:!0},serial:{configurable:!0},bfactor:{configurable:!0},occupancy:{configurable:!0},altloc:{configurable:!0},partialCharge:{configurable:!0},radius:{configurable:!0},formalCharge:{configurable:!0},aromatic:{configurable:!0},bondCount:{configurable:!0}};function eE(e,t){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return n*n+i*i+r*r}function r6(e,t){return Math.sqrt(eE(e,t))}_t.bondHash.get=function(){return this.structure.bondHash},_t.entity.get=function(){return this.structure.entityList[this.entityIndex]},_t.entityIndex.get=function(){return this.chainStore.entityIndex[this.chainIndex]},_t.modelIndex.get=function(){return this.chainStore.modelIndex[this.chainIndex]},_t.chainIndex.get=function(){return this.residueStore.chainIndex[this.residueIndex]},_t.residue.get=function(){return console.warn("residue - might be expensive"),this.structure.getResidueProxy(this.residueIndex)},_t.residueIndex.get=function(){return this.atomStore.residueIndex[this.index]},_t.residueIndex.set=function(e){this.atomStore.residueIndex[this.index]=e},_t.sstruc.get=function(){return this.residueStore.getSstruc(this.residueIndex)},_t.inscode.get=function(){return this.residueStore.getInscode(this.residueIndex)},_t.resno.get=function(){return this.residueStore.resno[this.residueIndex]},_t.chainname.get=function(){return this.chainStore.getChainname(this.chainIndex)},_t.chainid.get=function(){return this.chainStore.getChainid(this.chainIndex)},_t.residueType.get=function(){return this.residueMap.get(this.residueStore.residueTypeId[this.residueIndex])},_t.atomType.get=function(){return this.atomMap.get(this.atomStore.atomTypeId[this.index])},_t.residueAtomOffset.get=function(){return this.residueStore.atomOffset[this.residueIndex]},_t.resname.get=function(){return this.residueType.resname},_t.hetero.get=function(){return this.residueType.hetero},_t.atomname.get=function(){return this.atomType.atomname},_t.number.get=function(){return this.atomType.number},_t.element.get=function(){return this.atomType.element},_t.vdw.get=function(){return this.atomType.vdw},_t.covalent.get=function(){return this.atomType.covalent},_t.x.get=function(){return this.atomStore.x[this.index]},_t.x.set=function(e){this.atomStore.x[this.index]=e},_t.y.get=function(){return this.atomStore.y[this.index]},_t.y.set=function(e){this.atomStore.y[this.index]=e},_t.z.get=function(){return this.atomStore.z[this.index]},_t.z.set=function(e){this.atomStore.z[this.index]=e},_t.serial.get=function(){return this.atomStore.serial[this.index]},_t.serial.set=function(e){this.atomStore.serial[this.index]=e},_t.bfactor.get=function(){return this.atomStore.bfactor[this.index]},_t.bfactor.set=function(e){this.atomStore.bfactor[this.index]=e},_t.occupancy.get=function(){return this.atomStore.occupancy[this.index]},_t.occupancy.set=function(e){this.atomStore.occupancy[this.index]=e},_t.altloc.get=function(){return this.atomStore.getAltloc(this.index)},_t.altloc.set=function(e){this.atomStore.setAltloc(this.index,e)},_t.partialCharge.get=function(){return this.atomStore.partialCharge?this.atomStore.partialCharge[this.index]:null},_t.partialCharge.set=function(e){this.atomStore.partialCharge&&(this.atomStore.partialCharge[this.index]=e)},_t.radius.get=function(){return this.atomStore.radius?this.atomStore.radius[this.index]:null},_t.radius.set=function(e){this.atomStore.radius&&(this.atomStore.radius[this.index]=e)},_t.formalCharge.get=function(){return this.atomStore.formalCharge?this.atomStore.formalCharge[this.index]:null},_t.formalCharge.set=function(e){this.atomStore.formalCharge&&(this.atomStore.formalCharge[this.index]=e)},_t.aromatic.get=function(){return this.atomStore.aromatic?this.atomStore.aromatic[this.index]:this.residueType.isAromatic(this)?1:0},_t.aromatic.set=function(e){this.atomStore.aromatic&&(this.atomStore.aromatic[this.index]=e)},_t.bondCount.get=function(){return this.bondHash.countArray[this.index]},ot.prototype.eachBond=function(e,t){t=t||this.structure._bp;for(var n=this.index,i=this.bondHash,r=i.indexArray,o=i.countArray[n],s=i.offsetArray[n],a=0;a<o;++a)t.index=r[s+a],e(t)},ot.prototype.eachBondedAtom=function(e,t){var n=t||this.structure._ap,i=this.index;this.eachBond(function(r){n.index=i!==r.atomIndex1?r.atomIndex1:r.atomIndex2,e(n)}),this.index=i},ot.prototype.hasBondTo=function(e){var t=!1;return this.eachBondedAtom(function(n){e.index===n.index&&(t=!0)}),t},ot.prototype.bondToElementCount=function(e){var t=0,n=this.index;return this.eachBondedAtom(function(i){i.number===e&&(t+=1)}),this.index=n,t},ot.prototype.hasBondToElement=function(e){return this.bondToElementCount(e)>0},ot.prototype.isBackbone=function(){var e=this.residueType.backboneIndexList;return e.length>0&&e.includes(this.index-this.residueAtomOffset)},ot.prototype.isPolymer=function(){if(this.structure.entityList.length>0)return this.entity.isPolymer();var e=this.residueType.moleculeType;return e===3||e===4||e===5},ot.prototype.isSidechain=function(){return this.isPolymer()&&!this.isBackbone()},ot.prototype.isCg=function(){var e=this.residueType.backboneType;return e===4||e===5||e===6},ot.prototype.isTrace=function(){return this.index===this.residueType.traceAtomIndex+this.residueAtomOffset},ot.prototype.isHetero=function(){return this.residueType.hetero===1},ot.prototype.isProtein=function(){return this.residueType.moleculeType===3},ot.prototype.isNucleic=function(){var e=this.residueType.moleculeType;return e===4||e===5},ot.prototype.isRna=function(){return this.residueType.moleculeType===4},ot.prototype.isDna=function(){return this.residueType.moleculeType===5},ot.prototype.isWater=function(){return this.residueType.moleculeType===1},ot.prototype.isIon=function(){return this.residueType.moleculeType===2},ot.prototype.isSaccharide=function(){return this.residueType.moleculeType===6},ot.prototype.isHelix=function(){return DT.includes(this.sstruc)},ot.prototype.isSheet=function(){return BT.includes(this.sstruc)},ot.prototype.isTurn=function(){return FT.includes(this.sstruc)&&this.isProtein()},ot.prototype.isBonded=function(){return this.bondHash.countArray[this.index]!==0},ot.prototype.isRing=function(){return this.residueType.getRings().atomRings[this.index-this.residueAtomOffset]!==void 0},ot.prototype.isAromatic=function(){return this.aromatic===1},ot.prototype.isPolarHydrogen=function(){var e=!1;return this.number!==1?e:e=!this.hasBondToElement(6)},ot.prototype.isMetal=function(){return this.atomType.isMetal()},ot.prototype.isNonmetal=function(){return this.atomType.isNonmetal()},ot.prototype.isMetalloid=function(){return this.atomType.isMetalloid()},ot.prototype.isHalogen=function(){return this.atomType.isHalogen()},ot.prototype.isDiatomicNonmetal=function(){return this.atomType.isDiatomicNonmetal()},ot.prototype.isPolyatomicNonmetal=function(){return this.atomType.isPolyatomicNonmetal()},ot.prototype.isAlkaliMetal=function(){return this.atomType.isAlkaliMetal()},ot.prototype.isAlkalineEarthMetal=function(){return this.atomType.isAlkalineEarthMetal()},ot.prototype.isNobleGas=function(){return this.atomType.isNobleGas()},ot.prototype.isTransitionMetal=function(){return this.atomType.isTransitionMetal()},ot.prototype.isPostTransitionMetal=function(){return this.atomType.isPostTransitionMetal()},ot.prototype.isLanthanide=function(){return this.atomType.isLanthanide()},ot.prototype.isActinide=function(){return this.atomType.isActinide()},ot.prototype.getDefaultValence=function(){return this.atomType.getDefaultValence()},ot.prototype.getValenceList=function(){return this.atomType.getValenceList()},ot.prototype.getOuterShellElectronCount=function(){return this.atomType.getOuterShellElectronCount()},ot.prototype.distanceTo=function(e){var t=this.atomStore,n=e.atomStore,i=this.index,r=e.index,o=t.x[i]-n.x[r],s=t.y[i]-n.y[r],a=t.z[i]-n.z[r],c=o*o+s*s+a*a;return Math.sqrt(c)},ot.prototype.connectedTo=function(e){var t=this.atomStore,n=e.atomStore,i=this.index,r=e.index;if(t.altloc&&n.altloc){var o=t.altloc[i],s=n.altloc[r];if(o!==0&&s!==0&&o!==32&&s!==32&&o!==s)return!1}var a=t.x[i]-n.x[r],c=t.y[i]-n.y[r],l=t.z[i]-n.z[r],u=a*a+c*c+l*l;if(u<48&&this.isCg())return!0;if(isNaN(u))return!1;var h=this.covalent+e.covalent,f=h+.3,p=h-.5;return u<f*f&&u>p*p},ot.prototype.positionFromArray=function(e,t){return t===void 0&&(t=0),this.x=e[t+0],this.y=e[t+1],this.z=e[t+2],this},ot.prototype.positionToArray=function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);var n=this.index,i=this.atomStore;return e[t+0]=i.x[n],e[t+1]=i.y[n],e[t+2]=i.z[n],e},ot.prototype.positionToVector3=function(e){return e===void 0&&(e=new T),e.x=this.x,e.y=this.y,e.z=this.z,e},ot.prototype.positionFromVector3=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},ot.prototype.positionAdd=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},ot.prototype.positionSub=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},ot.prototype.getResidueBonds=function(e){e===void 0&&(e=!1);var t,n,i,r,o=this.residueAtomOffset,s=this.index-this.residueAtomOffset,a=this.residueType.getBonds(),c=a.atomIndices1,l=a.atomIndices2;for(e||(r=[]),t=c.indexOf(s);t!==-1;){if(i=l[t]+o,!r)return i;r.push(i),t=c.indexOf(s,t+1)}for(n=l.indexOf(s);n!==-1;){if(i=c[n]+o,!r)return i;r.push(i),n=l.indexOf(s,n+1)}return r},ot.prototype.qualifiedName=function(e){e===void 0&&(e=!1);var t="";return this.resname&&!e&&(t+="["+this.resname+"]"),this.resno!==void 0&&(t+=this.resno),this.inscode&&(t+="^"+this.inscode),this.chainname&&(t+=":"+this.chainname),this.atomname&&(t+="."+this.atomname),this.altloc&&(t+="%"+this.altloc),this.structure.modelStore.count>1&&(t+="/"+this.modelIndex),t},ot.prototype.clone=function(){return new ot(this.structure,this.index)},ot.prototype.toObject=function(){return{index:this.index,residueIndex:this.residueIndex,resname:this.resname,x:this.x,y:this.y,z:this.z,element:this.element,chainname:this.chainname,resno:this.resno,serial:this.serial,vdw:this.vdw,covalent:this.covalent,hetero:this.hetero,bfactor:this.bfactor,altloc:this.altloc,atomname:this.atomname,modelIndex:this.modelIndex}},Object.defineProperties(ot.prototype,_t);var py=new Float32Array(3),tE=function(e,t){t===void 0&&(t=!1),Pe&&de.time("Kdtree build");var n=t?eE:r6,i=new Float32Array(3*e.atomCount),r=new Uint32Array(e.atomCount),o=0;e.eachAtom(function(s){i[o+0]=s.x,i[o+1]=s.y,i[o+2]=s.z,r[o/3]=s.index,o+=3}),this.atomIndices=r,this.points=i,this.kdtree=new Dh(i,n),Pe&&de.timeEnd("Kdtree build")};tE.prototype.nearest=function(e,t,n){e instanceof T?e.toArray(py):e instanceof ot&&e.positionToArray(py);for(var i=this.kdtree.nearest(py,t,n),r=this.kdtree.indices,o=this.kdtree.nodes,s=this.atomIndices,a=[],c=0,l=i.length;c<l;++c){var u=i[c],h=u[0],f=u[1];a.push({index:s[r[o[h]]],distance:f})}return a};var o6={" ":"X","!":"Y","#":"Z",$:"-X","%":"-Y","&":"-Z","'":"Y+1/2","(":"1/2+X",")":"1/2+Y","*":"1/2-X","+":"1/2+Z",",":"1/2-Y","-":"1/2-Z",".":"X+1/2","/":"Z+1/2",0:"-X+1/2",1:"-Y+1/2",2:"-Z+1/2",3:"1/4+X",4:"1/4-Y",5:"1/4+Z",6:"1/4-X",7:"1/4+Y",8:"3/4-Y",9:"3/4+Z",":":"3/4+Y",";":"3/4+X","<":"3/4-X","=":"1/4-Z",">":"3/4-Z","?":"X-Y","@":"Y-X",A:"Z+1/3",B:"Z+2/3",C:"X+2/3",D:"Y+1/3",E:"-Y+2/3",F:"X-Y+1/3",G:"Y-X+2/3",H:"-X+1/3",I:"X+1/3",J:"Y+2/3",K:"-Y+1/3",L:"X-Y+2/3",M:"Y-X+1/3",N:"-X+2/3",O:"2/3+X",P:"1/3+Y",Q:"1/3+Z",R:"2/3-Y",S:"1/3+X-Y",T:"2/3+Y-X",U:"1/3-X",V:"2/3-X",W:"1/3-Y",X:"1/3-Z",Y:"2/3+Y",Z:"1/3+Y-X","[":"2/3+X-Y","]":"1/3+X","^":"2/3+Z",_:"2/3-Z","`":"5/6+Z",a:"1/6+Z",b:"5/6-Z",c:"1/6-Z",d:"Z+5/6",e:"Z+1/6",f:"Z+1/4",g:"+Y"},s6={"P 1":" !#","P -1":" !#$%&","P 1 2 1":" !#$!&","P 1 21 1":" !#$'&","C 1 2 1":" !#$!&()#*)&","P 1 m 1":" !# %#","P 1 c 1":" !# %+","C 1 m 1":" !# %#()#(,#","C 1 c 1":" !# %+()#(,+","P 1 2/m 1":" !# %#$!&$%&","P 1 21/m 1":" !#$)&$%& ,#","C 1 2/m 1":" !# %#$!&$%&()#(,#*)&*,&","P 1 2/c 1":" !#$!-$%& %+","P 1 21/c 1":" !#$%&$)- ,+","C 1 2/c 1":" !#$!-$%& %+()#*)-*,&(,+","P 2 2 2":" !#$%#$!& %&","P 2 2 21":" !#$%+$!- %&","P 21 21 2":" !#$%#*)&(,&","P 21 21 21":" !#*%+$)-(,&","C 2 2 21":" !#$%+$!- %&()#*,+*)-(,&","C 2 2 2":" !#$%#$!& %&()#*,#*)&(,&","F 2 2 2":" !#$%#$!& %& )+$,+$)- ,-(!+*%+*!-(%-()#*,#*)&(,&","I 2 2 2":" !#$%# %&$!&.'/01/.120'2","I 21 21 21":" !#*%+$)-(,&()+$,#*!& %-","P m m 2":" !#$%# %#$!#","P m c 21":" !#$%+ %+$!#","P c c 2":" !#$%# %+$!+","P m a 2":" !#$%#(%#*!#","P c a 21":" !#$%+(%#*!+","P n c 2":" !#$%# ,+$)+","P m n 21":" !#*%+(%+$!#","P b a 2":" !#$%#(,#*)#","P n a 21":" !#$%+(,#*)+","P n n 2":" !#$%#(,+*)+","C m m 2":" !#$%# %#$!#()#*,#(,#*)#","C m c 21":" !#$%+ %+$!#()#*,+(,+*)#","C c c 2":" !#$%# %+$!+()#*,#(,+*)+","A m m 2":" !#$%# %#$!# )+$,+ ,+$)+","A b m 2":" !#$%# ,#$)# )+$,+ %+$!+","A m a 2":" !#$%#(%#*!# )+$,+(,+*)+","A b a 2":" !#$%#(,#*)# )+$,+(%+*!+","F m m 2":" !#$%# %#$!# )+$,+ ,+$)+(!+*%+(%+*!+()#*,#(,#*)#","F d d 2":" !#$%#345675 )+$,+3896:9(!+*%+;49<79()#*,#;85<:5","I m m 2":" !#$%# %#$!#()+*,+(,+*)+","I b a 2":" !#$%#(,#*)#()+*,+ %+$!+","I m a 2":" !#$%#(%#*!#()+*,+ ,+$)+","P 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#","P 2/n 2/n 2/n":" !#$%#$!& %&*,-()-(,+*)+","P 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+","P 2/b 2/a 2/n":" !#$%#$!& %&*,&()&(,#*)#","P 21/m 2/m 2/a":" !#*%#$!&(%&$%&(!& %#*!#","P 2/n 21/n 2/a":" !#*%#*)- ,-$%&(!&(,+$)+","P 2/m 2/n 21/a":" !#*%+*!- %&$%&(!-(%+$!#","P 21/c 2/c 2/a":" !#*%#$!-(%-$%&(!& %+*!+","P 21/b 21/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#","P 21/c 21/c 2/n":" !#*,#$)-(%-$%&()& ,+*!+","P 2/b 21/c 21/m":" !#$%+$)- ,&$%& !- ,+$)#","P 21/n 21/n 2/m":" !#$%#*)-(,-$%& !&(,+*)+","P 21/m 21/m 2/n":" !#$%#*'&.,&*,&.'& %#$!#","P 21/b 2/c 21/n":" !#*,+$!-(,&$%&()- %+*)#","P 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#","P 21/n 21/m 21/a":" !#0%/$'&.12$%&.!2 1#0'/","C 2/m 2/c 21/m":" !#$%+$!- %&$%& !- %+$!#()#*,+*)-(,&*,&()-(,+*)#","C 2/m 2/c 21/a":" !#$,+$)- %&$%& )- ,+$!#()#*%+*!-(,&*,&(!-(%+*)#","C 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()#*,#*)&(,&*,&()&(,#*)#","C 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+()#*,#*)-(,-*,&()&(,+*)+","C 2/m 2/m 2/a":" !#$,#$)& %&$%& )& ,#$!#()#*%#*!&(,&*,&(!&(%#*)#","C 2/c 2/c 2/a":" !#*,#$!&(,&$,-(!- ,+*!+()#$%#*)& %&*%- )-(%+$)+","F 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!# )+$,+$)- ,-$,- )- ,+$)+(!+*%+*!-(%-*%-(!-(%+*!+()#*,#*)&(,&*,&()&(,#*)#","F 2/d 2/d 2/d":" !#$%#$!& %&64=37=345675 )+$,+$)- ,-68>3:>3896:9(!+*%+*!-(%-<4>;7>;49<79()#*,#*)&(,&<8=;:=;85<:5","I 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()+*,+*)-(,-*,-()-(,+*)+","I 2/b 2/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#()+*,+$!- %-*,-()- %+$!+","I 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#()+$,#*!& %-*,- )&(%#$!+","I 21/m 21/m 21/a":" !#$,#$)& %&$%& )& ,#$!#()+*%+*!-(,-*,-(!-(%+*)+","P 4":" !#$%#% #!$#","P 41":" !#$%+% 5!$9","P 42":" !#$%#% +!$+","P 43":" !#$%+% 9!$5","I 4":" !#$%#% #!$#()+*,+,(+)*+","I 41":" !#*,+%(5)$9()+$%#, 9!*5","P -4":" !#$%#!$&% &","I -4":" !#$%#!$&% &()+*,+)*-,(-","P 4/m":" !#$%#% #!$#$%& !&!$&% &","P 42/m":" !#$%#% +!$+$%& !&!$-% -","P 4/n":" !#$%#,(#)*#*,&()&!$&% &","P 42/n":" !#$%#,(+)*+*,-()-!$&% &","I 4/m":" !#$%#% #!$#$%& !&!$&% &()+*,+,(+)*+*,-()-)*-,(-","I 41/a":" !#*,+%(5)$9$,=(!>!$&,(-()+$%#, 9!*5*%> )=)*-% &","P 4 2 2":" !#$%#% #!$#$!& %&! &%$&","P 4 21 2":" !#$%#,(#)*#*)&(,&! &%$&","P 41 2 2":" !#$%+% 5!$9$!& %-! >%$=","P 41 21 2":" !#$%+,(5)*9*)=(,>! &%$-","P 42 2 2":" !#$%#% +!$+$!& %&! -%$-","P 42 21 2":" !#$%#,(+)*+*)-(,-! &%$&","P 43 2 2":" !#$%+% 9!$5$!& %-! =%$>","P 43 21 2":" !#$%+,(9)*5*)>(,=! &%$-","I 4 2 2":" !#$%#% #!$#$!& %&! &%$&()+*,+,(+)*+*)-(,-)(-,*-","I 41 2 2":" !#*,+%(5)$9*!> ,=)(-%$&()+$%#, 9!*5$)=(%>! &,*-","P 4 m m":" !#$%#% #!$# %#$!#%$#! #","P 4 b m":" !#$%#% #!$#(,#*)#,*#)(#","P 42 c m":" !#$%#% +!$+ %+$!+%$#! #","P 42 n m":" !#$%#,(+)*+(,+*)+%$#! #","P 4 c c":" !#$%#% #!$# %+$!+%$+! +","P 4 n c":" !#$%#% #!$#(,+*)+,*+)(+","P 42 m c":" !#$%#% +!$+ %#$!#%$+! +","P 42 b c":" !#$%#% +!$+(,#*)#,*+)(+","I 4 m m":" !#$%#% #!$# %#$!#%$#! #()+*,+,(+)*+(,+*)+,*+)(+","I 4 c m":" !#$%#% #!$# %+$!+%$+! +()+*,+,(+)*+(,#*)#,*#)(#","I 41 m d":" !#*,+%(5)$9 %#*)+%*5) 9()+$%#, 9!*5(,+$!#,$9!(5","I 41 c d":" !#*,+%(5)$9 %+*)#%*9) 5()+$%#, 9!*5(,#$!+,$5!(9","P -4 2 m":" !#$%#% &!$&$!& %&%$#! #","P -4 2 c":" !#$%#% &!$&$!- %-%$+! +","P -4 21 m":" !#$%#% &!$&*)&(,&,*#)(#","P -4 21 c":" !#$%#% &!$&*)-(,-,*+)(+","P -4 m 2":" !#$%#!$&% & %#$!#! &%$&","P -4 c 2":" !#$%#% &!$& %+$!+! -%$-","P -4 b 2":" !#$%#% &!$&(,#*)#)(&,*&","P -4 n 2":" !#$%#% &!$&(,+*)+)(-,*-","I -4 m 2":" !#$%#% &!$& %#$!#! &%$&()+*,+,(-)*-(,+*)+)(-,*-","I -4 c 2":" !#$%#% &!$& %+$!+! -%$-()+*,+,(-)*-(,#*)#)(&,*&","I -4 2 m":" !#$%#% &!$&$!& %&%$#! #()+*,+,(-)*-*)-(,-,*+)(+","I -4 2 d":" !#$%#% &!$&*!>(%>,$9) 9()+*,+,(-)*-$)= ,=%*5!(5","P 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #","P 4/m 2/c 2/c":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +","P 4/n 2/b 2/m":" !#$%#% #!$#$!& %&! &%$&*,&()&)*&,(&(,#*)#,*#)(#","P 4/n 2/n 2/c":" !#$%#% #!$#$!& %&! &%$&*,-()-)*-,(-(,+*)+,*+)(+","P 4/m 21/b 2/m":" !#$%#% #!$#*)&(,&)(&,*&$%& !&!$&% &(,#*)#,*#)(#","P 4/m 21/n 2/c":" !#$%#% #!$#*)-(,-)(-,*-$%& !&!$&% &(,+*)+,*+)(+","P 4/n 21/m 2/m":" !#$%#,(#)*#*)&(,&! &%$&*,&()&!$&% & %#$!#,*#)(#","P 4/n 2/c 2/c":" !#$%#,(#)*#*)-(,-! -%$-*,&()&!$&% & %+$!+,*+)(+","P 42/m 2/m 2/c":" !#$%#% +!$+$!& %&! -%$-$%& !&!$-% - %#$!#%$+! +","P 42/m 2/c 2/m":" !#$%#% +!$+$!- %-! &%$&$%& !&!$-% - %+$!+%$#! #","P 42/n 2/b 2/c":" !#$%#,(+)*+$!- %-)(&,*&*,-()-!$&% &(,#*)#%$+! +","P 42/n 2/n 2/m":" !#$%#,(+)*+$!& %&)(-,*-*,-()-!$&% &(,+*)+%$#! #","P 42/m 21/b 2/c":" !#$%#% +!$+*)&(,&)(-,*-$%& !&!$-% -(,#*)#,*+)(+","P 42/m 21/n 2/m":" !#$%#,./'*/*'-.,-! &%$&$%& !&'*-,.-.,/*'/%$#! #","P 42/n 21/m 2/c":" !#$%#,(+)*+*)-(,-! &%$&*,-()-!$&% & %#$!#,*+)(+","P 42/n 21/c 2/m":" !#$%#,(+)*+*)&(,&! -%$-*,-()-!$&% & %+$!+,*#)(#","I 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #()+*,+,(+)*+*)-(,-)(-,*-*,-()-)*-,(-(,+*)+,*+)(+","I 4/m 2/c 2/m":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +()+*,+,(+)*+*)&(,&)(&,*&*,-()-)*-,(-(,#*)#,*#)(#","I 41/a 2/m 2/d":" !#*,+%(5)$9*!> ,=)(-%$&$,=(!>!$&,(-(,+$!#,$9!(5()+$%#, 9!*5$)=(%>! &,*-*%> )=)*-% & %#*)+%*5) 9","I 41/a 2/c 2/d":" !#*,+%(5)$9*!= ,>)(&%$-$,=(!>!$&,(-(,#$!+,$5!(9()+$%#, 9!*5$)>(%=! -,*&*%> )=)*-% & %+*)#%*9) 5","P 3":" !#%?#@$#","P 31":" !#%?A@$B","P 32":" !#%?B@$A","H 3":" !#%?#@$#CDAEFAGHAIJBKLBMNB","R 3":" !## !!# ","P -3":" !#%?#@$#$%&!@&? &","H -3":" !#%?#@$#$%&!@&? &OPQRSQTUQVWXYZX[]X]Y^W[^ZV^UR_PT_SO_","R -3":" !## !!# $%&&$%%&$","P 3 1 2":" !#%?#@$#%$&@!& ?&","P 3 2 1":" !#%?#@$#! &?%&$@&","P 31 1 2":" !#%?Q@$^%$_@!X ?&","P 31 2 1":" !#%?A@$B! &?%_$@X","P 32 1 2":" !#%?^@$Q%$X@!_ ?&","P 32 2 1":" !#%?B@$A! &?%X$@_","H 3 2":" !#%?#@$#! &?%&$@&OPQRSQTUQY]X[WXVZX]Y^W[^ZV^PO_SR_UT_","R 3 2":" !## !!# %$&$&%&%$","P 3 m 1":" !#%?#@$#%$#@!# ?#","P 3 1 m":" !#%?#@$#! #?%#$@#","P 3 c 1":" !#%?#@$#%$+@!+ ?+","P 3 1 c":" !#%?#@$#! +?%+$@+","H 3 m":" !#%?#@$#%$#@!# ?#OPQRSQTUQRUQTPQOSQ]Y^W[^ZV^WV^ZY^][^","R 3 m":" !## !!# ! # #!#! ","H 3 c":" !#%?#@$#%$+@!+ ?+OPQRSQTUQRU`TP`OS`]Y^W[^ZV^WVaZYa][a","R 3 c":" !## !!# '././'/'.","P -3 1 2/m":" !#%?#@$#%$&@!& ?&$%&!@&? &! #?%#$@#","P -3 1 2/c":" !#%?#@$#%$-@!- ?-$%&!@&? &! +?%+$@+","P -3 2/m 1":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#","P -3 2/c 1":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+","H -3 2/m":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#OPQRSQTUQY]X[WXVZXVWXYZX[]XRUQTPQOSQ]Y^W[^ZV^PO_SR_UT_UR_PT_SO_WV^ZY^][^","R -3 2/m":" !## !!# %$&$&%&%$$%&&$%%&$! # #!#! ","H -3 2/c":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+OPQRSQTUQY]b[WbVZbVWXYZX[]XRU`TP`OS`]Y^W[^ZV^POcSRcUTcUR_PT_SO_WVaZYa][a","R -3 2/c":" !## !!# 102021210$%&&$%%&$'././'/'.","P 6":" !#%?#@$#$%#!@#? #","P 61":" !#%?A@$B$%/!@d? e","P 65":" !#%?B@$A$%/!@e? d","P 62":" !#%?^@$Q$%#!@^? Q","P 64":" !#%?Q@$^$%#!@Q? ^","P 63":" !#%?#@$#$%+!@+? +","P -6":" !#%?#@$# !&%?&@$&","P 6/m":" !#%?#@$#$%#!@#? #$%&!@&? & !&%?&@$&","P 63/m":" !#%?#@$#$%+!@+? +$%&!@&? & !-%?-@$-","P 6 2 2":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&","P 61 2 2":" !#%?Q@$^$%+!@`? a! X?%&$@_%$b@!- ?c","P 65 2 2":" !#%?^@$Q$%+!@a? `! _?%&$@X%$c@!- ?b","P 62 2 2":" !#%?^@$Q$%#!@^? Q! _?%&$@X%$_@!& ?X","P 64 2 2":" !#%?Q@$^$%#!@Q? ^! X?%&$@_%$X@!& ?_","P 63 2 2":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-","P 6 m m":" !#%?#@$#$%#!@#? #%$#@!# ?#! #?%#$@#","P 6 c c":" !#%?#@$#$%#!@#? #%$+@!+ ?+! +?%+$@+","P 63 c m":" !#%?#@$#$%+!@+? +%$+@!+ ?+! #?%#$@#","P 63 m c":" !#%?#@$#$%+!@+? +%$#@!# ?#! +?%+$@+","P -6 m 2":" !#%?#@$# !&%?&@$&%$#@!# ?#%$&@!& ?&","P -6 c 2":" !#%?#@$# !-%?-@$-%$+@!+ ?+%$&@!& ?&","P -6 2 m":" !#%?#@$# !&%?&@$&! &?%&$@&! #?%#$@#","P -6 2 c":" !#%?#@$# !-%?-@$-! &?%&$@&! +?%+$@+","P 6/m 2/m 2/m":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&$%&!@&? & !&@$&%?&%$#@!# ?#! #?%#$@#","P 6/m 2/c 2/c":" !#%?#@$#$%#!@#? #! -?%-$@-%$-@!- ?-$%&!@&? & !&@$&%?&%$+@!+ ?+! +?%+$@+","P 63/m 2/c 2/m":" !#%?#@$#$%+!@+? +! -?%-$@-%$&@!& ?&$%&!@&? & !-@$-%?-%$+@!+ ?+! #?%#$@#","P 63/m 2/m 2/c":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-$%&!@&? & !-@$-%?-%$#@!# ?#! +?%+$@+","P 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ","F 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%&  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ","I 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(","P 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(","I 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- ","P 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$","P 2/n -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& *,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","F 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-($,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- *,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$","F 2/d -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& 64=37=345675=64=375345674=67=3453756 )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(68>3:>3896:9=<8=;:5;85<:4><7>;49;79<(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(<4>;7>;49<79>68>3:93896:8=<:=;85;:5<()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- <8=;:=;8f<:f><4>;79;49<78>6:>3893:96","I 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","P 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*","I 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*()+$,#*g& %-+()#$,&*!- %)+(,#$!&*%- *,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$","P 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$","P 42 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","F 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$","F 41 3 2":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46 )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<(!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86","I 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","P 43 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7;>46=:<5839398<5:6=4;>75:<983>7;=46","P 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<","I 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46","P -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ","F -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&%  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(+%*+!*-%(- +)$+,$-) -,#)(#,*&)*&,((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() +,$+)$-, -(#)*#,*&)(&,+!(+%*-!*-%(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(#,*#)*&,(&(+!*+%*-!(-%+) +,$-)$-, ","I -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","P -4 3 n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","F -4 3 c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() #,$#)$&, &(#!*#%*&!(&%+! +%$-!$-% (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(#%*#!*&%(& +!$+%$-! -%#) #,$&)$&, ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! +%$+!$-% - #)$#,$&) &,#!(#%*&!*&%(","I -4 3 d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7354<9:6>8;=357<946>:;=857394<>:6=8;()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- :;98657<=43>;9:658<=73>49:;586=7<>43","P 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","P 4/n -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/m -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/n -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","F 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#!  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*%*+!(+%(-!*-$-) -, +)$+,&,(&)*#,*#)((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%**%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*,$+) +, -)$-*&)(&,(#)*#,-%(-!*+%*+!(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$*,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$,*#)(#,(&)*&*-!(-%(+!*+%-, -)$+,$+) ","F 4/m -3 2/c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() &,$&)$#, #(#%*#!*&%(&!+!$+% -! -%$$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*,$#) #, &)$&*&!(&%(#!*#%-% -!$+%$+! (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(&%*&!*#%(# +%$+!$-% -!#)$#, &) &,$*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*%*#!(#%(&!*&$-! -% +!$+%&, &)$#,$#) ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! -%$-!$+% + #,$#)$&, &)#!*#%(&!(&%**,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$%$+! +% -!$-$&) &, #)$#,&%(&!*#%*#!(","F 41/d -3 2/m":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=4664=3:>;85<79=64>3:5;89<74=6:>385;79<,$+! #%(-)*&*&)(-% #!$+,-%(&)*+,$#!  )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<68>37=;49<:5=<8>;753496:4><:=;893756,*#!(+% &)$-*-!(&, +)$#%-, &!$+%*#)((!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<<4>;:=389675>68=379;45<:8=<7>;453:96%$#) +,(&!*-$&! -,(#)*+%&% -)$#,*+!(()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86<8=;7>3456:9><4=;:9385678>67=349;:5<%*+)(#, -!$&$-) &%(+!*#,&,(-!*#%$+) ","F 41/d -3 2/c":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46<8>;7=3496:5><8=;793456:8><7=;493:56%*#)(+, &!$-$-! &,(+)*#%&, -!$#%*+)( )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<<4=;:>385679>64=3:9;85<78=67>345;:9<%$+) #,(-!*&$&) -%(#!*+,&%(-)*#,$+! (!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<68=37>;45<:9=<4>;:5389674>6:=389;75<,*+!(#% -)$&*-)(&% +!$#,-,(&!*+%$#) ()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>8664>3:=;89<75=68>375;49<:4=<:>;853796,$#! +%(&)*-*&!(-, #)$+%-% &)$+,*#!(","I 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","I 41/a -3 2/d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<$%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*4<97358;=:6>6>:;=8357<94=8;>:694<573()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46*,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$865:;943>7<=<=73>4;9:658>43=7<5869:;","P 1 1 2":" !#$%#","P 1 1 21":" !#$%+","B 1 1 2":" !#$%#(g+*%+","A 1 2 1":" !#$!& )+$)-","C 1 21 1":" !#$)&()#*!&","I 1 2 1":" !#$!&.'/0'2","I 1 21 1":" !#$)&.'/0!-","P 1 1 m":" !# !&","P 1 1 b":" !# )&","B 1 1 m":" !# !&(!+(!-","B 1 1 b":" !# )&(!+()-","P 1 1 2/m":" !# !&$%#$%&","P 1 1 21/m":" !#$%+$%& !-","B 1 1 2/m":" !# !&$%#$%&(!+(!-*%+*%-","P 1 1 2/b":" !#$,#$%& )&","P 1 1 21/b":" !#$%&$,+ )-","B 1 1 2/b":" !#$,#$%& )&(!+*,+*%-()-","P 21 2 2":" !#$!&(%&*%#","P 2 21 2":" !# ,&$)&$%#","P 21 21 2 (a)":" !#*,#.%&$'&","P 21 2 21":" !#$!&(%-*%+","P 2 21 21":" !# %&$)-$,+","C 2 2 21a)":" !#*%+(,&$)-()#$,+ %&*!-","C 2 2 2a":" !#*,#.%&$'&()#$%# ,&*!&","F 2 2 2a":" !#*,#.%&$'& '/*%/.12$!2.!/$,/ %20'2.'#$%# 1&0!&","I 2 2 2a":" !#*,#.%&$'&()+$%+*!- ,-","P 21/m 21/m 2/n a":" !#*,#$)&(%&$%&.'& ,#*!#","P 42 21 2a":" !#*,#%.+'$+$'&.%&! -,*-","I 2 3a":" !#*,#.%&$'&!# ,- '&$%/$# !-*!/$%&.%()+$%+ ,-*!-)+(%&(!-*,#*+()&$)#*,- ,"},a6=/^[1-9]$/;function nE(e){var t="";return e.length>0&&(t=":"+P_(e).join(" OR :")),new Jt(t)}var fi=function(e){e===void 0&&(e=""),this.name=e,this.partList=[]},DS={type:{configurable:!0}};DS.type.get=function(){return"Assembly"},fi.prototype.addPart=function(e,t){var n=new ns(e,t);return this.partList.push(n),n},fi.prototype.getAtomCount=function(e){return this.partList.reduce(function(t,n){return t+n.getAtomCount(e)},0)},fi.prototype.getResidueCount=function(e){return this.partList.reduce(function(t,n){return t+n.getResidueCount(e)},0)},fi.prototype.getInstanceCount=function(){var e=0;return this.partList.forEach(function(t){e+=t.matrixList.length}),e},fi.prototype.isIdentity=function(e){if(this.partList.length!==1)return!1;var t=this.partList[0];if(t.matrixList.length!==1||!new De().equals(t.matrixList[0]))return!1;var n=[];return e.eachChain(function(i){n.push(i.chainname)}),n=P_(n),t.chainList.length===n.length},fi.prototype.getBoundingBox=function(e){var t=new hn;return this.partList.forEach(function(n){var i=n.getBoundingBox(e);t.expandByPoint(i.min),t.expandByPoint(i.max)}),t},fi.prototype.getCenter=function(e){return this.getBoundingBox(e).getCenter(new T)},fi.prototype.getSelection=function(){var e=[];return this.partList.forEach(function(t){e=e.concat(t.chainList)}),nE(e)},Object.defineProperties(fi.prototype,DS);var ns=function(e,t){e===void 0&&(e=[]),t===void 0&&(t=[]),this.matrixList=e,this.chainList=t},BS={type:{configurable:!0}};BS.type.get=function(){return"AssemblyPart"},ns.prototype._getCount=function(e,t){var n=this,i=0;return e.eachChain(function(r){(n.chainList.length===0||n.chainList.includes(r.chainname))&&(i+=r[t])}),this.matrixList.length*i},ns.prototype.getAtomCount=function(e){return this._getCount(e,"atomCount")},ns.prototype.getResidueCount=function(e){return this._getCount(e,"residueCount")},ns.prototype.getBoundingBox=function(e){var t=new hn,n=new hn,i=this.getSelection(),r=e.getBoundingBox(i);return this.matrixList.forEach(function(o){n.copy(r).applyMatrix4(o),t.expandByPoint(n.min),t.expandByPoint(n.max)}),t},ns.prototype.getSelection=function(){return nE(this.chainList)},ns.prototype.getView=function(e){var t=this.getSelection();return t?e.getView(t):e},ns.prototype.getInstanceList=function(){for(var e=[],t=0,n=this.matrixList.length;t<n;++t)e.push({id:t+1,name:t,matrix:this.matrixList[t]});return e},Object.defineProperties(ns.prototype,BS);var Sm=function(e){this.structure=e,this.currentModelindex=null,this.currentChainid=null,this.currentResname=null,this.currentResno=null,this.currentInscode=void 0,this.currentHetero=null,this.previousResname="",this.previousHetero=null,this.ai=-1,this.ri=-1,this.ci=-1,this.mi=-1};function iE(e,t){if(t){Pe&&de.time("assignSecondaryStructure");var n=[];e.eachModel(function(l){l.eachChain(function(u){n.push(u.chainname)})});var i=n.slice().sort(),r=[];i.forEach(function(l){r.push(n.indexOf(l))});var o=t.helices.filter(function(l){return Ka(i,l[0])>=0});o.sort(function(l,u){var h=l[0],f=u[0],p=l[1],m=u[1];if(h===f)return p===m?0:p<m?-1:1;var y=Ka(i,h),v=Ka(i,f);return r[y]<r[v]?-1:1});var s=e.residueStore;e.eachModel(function(l){var u=0,h=o.length;if(h!==0){var f=o[u],p=!1,m=!1;l.eachChain(function(y){var v=!1;if(y.chainname===f[0]){for(var d=y.residueCount,g=y.residueOffset,b=g+d,x=g;x<b;++x)if(s.resno[x]===f[1]&&s.getInscode(x)===f[2]&&(p=!0),p&&(s.sstruc[x]=f[6],s.resno[x]===f[4]&&s.getInscode(x)===f[5]&&(p=!1,(u+=1)<h?(x=g-1,f=o[u],v=y.chainname!==f[0]):m=!0)),v||m)return}})}});var a=t.sheets.filter(function(l){return Ka(i,l[0])>=0});a.sort(function(l,u){var h=l[0],f=u[0];if(h===f)return 0;var p=Ka(i,h),m=Ka(i,f);return r[p]<r[m]?-1:1});var c="e".charCodeAt(0);e.eachModel(function(l){var u=0,h=a.length;if(h!==0){var f=a[u],p=!1,m=!1;l.eachChain(function(y){var v=!1;if(y.chainname===f[0]){for(var d=y.residueCount,g=y.residueOffset,b=g+d,x=g;x<b;++x)if(s.resno[x]===f[1]&&s.getInscode(x)===f[2]&&(p=!0),p&&(s.sstruc[x]=c,s.resno[x]===f[4]&&s.getInscode(x)===f[5]&&(p=!1,(u+=1)<h?(x=g-1,f=a[u],v=y.chainname!==f[0]):m=!0)),v||m)return}})}}),Pe&&de.timeEnd("assignSecondaryStructure")}}Sm.prototype.addResidueType=function(e){for(var t=this.structure.atomStore,n=this.structure.residueStore,i=this.structure.residueMap,r=n.atomCount[e],o=n.atomOffset[e],s=new Array(r),a=0;a<r;++a)s[a]=t.atomTypeId[o+a];n.residueTypeId[e]=i.add(this.previousResname,s,this.previousHetero)},Sm.prototype.addAtom=function(e,t,n,i,r,o,s,a){var c=this.structure.atomStore,l=this.structure.residueStore,u=this.structure.chainStore,h=this.structure.modelStore,f=!1,p=!1,m=!1;this.currentModelindex!==e?(f=!0,p=!0,m=!0,this.mi+=1,this.ci+=1,this.ri+=1):this.currentChainid!==n?(p=!0,m=!0,this.ci+=1,this.ri+=1):this.currentResno===r&&this.currentResname===i&&this.currentInscode===a||(m=!0,this.ri+=1),this.ai+=1,f&&(h.growIfFull(),h.chainOffset[this.mi]=this.ci,h.chainCount[this.mi]=0,h.count+=1,u.modelIndex[this.ci]=this.mi),p&&(u.growIfFull(),u.setChainname(this.ci,t),u.setChainid(this.ci,n),u.residueOffset[this.ci]=this.ri,u.residueCount[this.ci]=0,u.count+=1,u.modelIndex[this.ci]=this.mi,h.chainCount[this.mi]+=1,l.chainIndex[this.ri]=this.ci),m&&(this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>0&&this.addResidueType(this.ri-1),l.growIfFull(),l.resno[this.ri]=r,s!==void 0&&(l.sstruc[this.ri]=s.charCodeAt(0)),a!==void 0&&(l.inscode[this.ri]=a.charCodeAt(0)),l.atomOffset[this.ri]=this.ai,l.atomCount[this.ri]=0,l.count+=1,l.chainIndex[this.ri]=this.ci,u.residueCount[this.ci]+=1),c.count+=1,c.residueIndex[this.ai]=this.ri,l.atomCount[this.ri]+=1,this.currentModelindex=e,this.currentChainid=n,this.currentResname=i,this.currentResno=r,this.currentInscode=a,this.currentHetero=o},Sm.prototype.finalize=function(){this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>-1&&this.addResidueType(this.ri)};var dy,FS,NS,C0=(dy=function(e,t,n,i){for(var r=e.structure,o=e.residueIndexStart,s=r.getResidueProxy(),a=r.getResidueProxy(),c=r.getAtomProxy(),l=r.getAtomProxy(),u=Math.max(0,t-2);u<=t;++u)for(var h=2;h<5;++h)if(!(u+h>=e.residueCount)){s.index=o+u,a.index=o+u+h,c.index=s.traceAtomIndex,l.index=a.traceAtomIndex;var f=c.distanceTo(l);if(Math.abs(f-n[h-2])>i)return!1}return!0},FS=function(e,t){return dy(e,t,[5.45,5.18,6.37],2.1)},NS=function(e,t){return dy(e,t,[6.1,10.4,13],1.42)},function(e){Pe&&de.time("calculateSecondaryStructure"),e.eachPolymer(function(t){if(!(t.residueCount<4)){if(t.isCg())(function(r){for(var o=r.residueStore,s=r.residueIndexStart,a=new B_(r).position,c=new T,l=new T,u=0,h=r.residueCount;u<h;++u){c.fromArray(a.center,3*u),l.fromArray(a.center,3*u+3);var f=c.distanceTo(l);f<2&&f>1&&a.bending[u]<20&&(o.sstruc[s+u]="h".charCodeAt(0),o.sstruc[s+u+1]="h".charCodeAt(0))}})(t);else{if(!t.isProtein())return;(function(r){for(var o=r.residueStore,s=r.residueIndexStart,a=0,c=r.residueCount;a<c;++a){var l="c";FS(r,a)?l="h":NS(r,a)&&(l="e"),o.sstruc[s+a]=l.charCodeAt(0)}})(t)}var n,i=0;t.eachResidue(function(r){r.sstruc===n?i+=1:(i===1&&(r.index-=1,r.sstruc="c"),i=1,n=r.sstruc)})}}),Pe&&de.timeEnd("calculateSecondaryStructure")});function cp(e){for(var t=26,n=e,i=0,r="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[n%t];n>=t;)r+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[(n=Math.floor(n/t))%t],i+=1;return i>=5&&de.warn("chainname overflow"),r}function P0(e,t){t===void 0&&(t=!1),Pe&&de.time("calculateChainnames");var n=!0;if(e.eachChain(function(m){m.chainname&&(n=!1)}),n){var i=e.modelStore,r=e.chainStore,o=e.residueStore,s=e.getAtomProxy(),a=e.getAtomProxy(),c=0,l=0,u=0,h=0,f=[];o.count===1?f.push({mIndex:0,chainname:"A",rStart:0,rCount:1}):e.eachResidueN(2,function(m,y){var v=!1,d=m.backboneType,g=y.backboneType;h=m.index,m.modelIndex!==y.modelIndex||m.moleculeType!==y.moleculeType?v=!0:d!==0&&d===g&&(s.index=m.backboneEndAtomIndex,a.index=y.backboneStartAtomIndex,v=t?!s.hasBondTo(a):!s.connectedTo(a)),v||y.index!==o.count-1||(v=!0,h=y.index),v&&(f.push({mIndex:l,chainname:cp(c),rStart:u,rCount:h-u+1}),c+=1,m.modelIndex!==y.modelIndex&&(c=0,l+=1),y.index===o.count-1&&h!==y.index&&f.push({mIndex:l,chainname:cp(c),rStart:o.count-1,rCount:1}),u=y.index,h=y.index)}),r.count=0,f.forEach(function(m){(function(y,v,d,g){for(var b=r.count,x=0;x<g;++x)o.chainIndex[d+x]=b;r.growIfFull(),r.modelIndex[b]=y,r.setChainname(b,v),r.setChainid(b,v),r.residueOffset[b]=d,r.residueCount[b]=g,r.count+=1,i.chainCount[y]+=1})(m.mIndex,m.chainname,m.rStart,m.rCount)});var p=0;e.eachModel(function(m){i.chainOffset[m.index]=p,i.chainCount[m.index]-=1,p+=i.chainCount[m.index]})}Pe&&de.timeEnd("calculateChainnames")}function Hg(e){Pe&&de.time("calculateBonds"),Bu(e),Fu(e),Pe&&de.timeEnd("calculateBonds")}var c6={"HIS|CD2|CG":2,"HIS|CE1|ND1":2,"ARG|CZ|NH2":2,"PHE|CE1|CZ":2,"PHE|CD2|CE2":2,"PHE|CD1|CG":2,"TRP|CD1|CG":2,"TRP|CD2|CE2":2,"TRP|CE3|CZ3":2,"TRP|CH2|CZ2":2,"ASN|CG|OD1":2,"GLN|CD|OE1":2,"TYR|CD1|CG":2,"TYR|CD2|CE2":2,"TYR|CE1|CZ":2,"ASP|CG|OD1":2,"GLU|CD|OE1":2,"G|C8|N7":2,"G|C4|C5":2,"G|C2|N3":2,"G|C6|O6":2,"C|C4|N3":2,"C|C5|C6":2,"C|C2|O2":2,"A|C2|N3":2,"A|C6|N1":2,"A|C4|C5":2,"A|C8|N7":2,"U|C5|C6":2,"U|C2|O2":2,"U|C4|O4":2,"DG|C8|N7":2,"DG|C4|C5":2,"DG|C2|N3":2,"DG|C6|O6":2,"DC|C4|N3":2,"DC|C5|C6":2,"DC|C2|O2":2,"DA|C2|N3":2,"DA|C6|N1":2,"DA|C4|C5":2,"DA|C8|N7":2,"DT|C5|C6":2,"DT|C2|O2":2,"DT|C4|O4":2};function zS(e,t,n){var i;return t=(i=t<n?[t,n]:[n,t])[0],n=i[1],ql.includes(e)&&t==="C"&&n==="O"||Yh.includes(e)&&t==="OP1"&&n==="P"?2:c6[e+"|"+t+"|"+n]||1}function Bu(e,t){t===void 0&&(t=!1),Pe&&de.time("calculateBondsWithin");var n=e.bondStore,i=e.rungBondStore,r=e.getAtomSet(!1),o=e.getAtomProxy(),s=e.getAtomProxy(),a=e.getBondProxy(),c=t?null:function(l){Pe&&de.time("calculateAtomBondMap");var u=[];return l.eachBond(function(h){var f=h.atomIndex1,p=h.atomIndex2;u[f]===void 0&&(u[f]=[]),u[f][p]=h.index}),Pe&&de.timeEnd("calculateAtomBondMap"),u}(e);e.eachResidue(function(l){if(!t&&c){var u=l.atomCount,h=l.atomOffset;if(u>500)return void de.warn("more than 500 atoms, skip residue for auto-bonding",l.qualifiedName());for(var f=l.getBonds(),p=f.atomIndices1,m=f.atomIndices2,y=f.bondOrders,v=p.length,d=0;d<v;++d){var g=p[d],b=m[d],x=g+h,_=b+h,S=c[x];S!==void 0&&S[_]!==void 0?(a.index=S[_],y[l.residueType.getBondIndex(g,b)]=a.bondOrder):(o.index=x,s.index=_,n.addBond(o,s,y[d]))}}var w=l.residueType.traceAtomIndex,C=l.residueType.rungEndAtomIndex;w!==-1&&C!==-1&&(o.index=l.traceAtomIndex,s.index=l.rungEndAtomIndex,i.addBond(o,s),r.set(o.index),r.set(s.index))}),e.atomSetDict.rung=r,Pe&&de.timeEnd("calculateBondsWithin")}function Fu(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1),Pe&&de.time("calculateBondsBetween");var i=e.bondStore,r=e.backboneBondStore,o=e.getAtomSet(!1),s=e.getAtomProxy(),a=e.getAtomProxy();function c(f,p){var m=f.backboneType,y=p.backboneType;m!==0&&m===y&&(s.index=f.backboneEndAtomIndex,a.index=p.backboneStartAtomIndex,(n&&s.hasBondTo(a)||s.connectedTo(a))&&(t||i.addBond(s,a,1),s.index=f.traceAtomIndex,a.index=p.traceAtomIndex,r.addBond(s,a),o.set(s.index),o.set(a.index)))}r.count===0&&r.resize(e.residueStore.count),e.eachResidueN(2,c);var l=e.getResidueProxy(),u=e.getResidueProxy();if(e.eachChain(function(f){f.residueCount!==0&&(l.index=f.residueOffset,u.index=f.residueOffset+f.residueCount-1,c(u,l))}),e.atomSetDict.backbone=o,!t){Pe&&de.time("calculateBondsBetween inter");var h=e.spatialHash;e.eachResidue(function(f){f.backboneType!==0||f.isWater()||f.eachAtom(function(p){p.isMetal()||h.eachWithin(p.x,p.y,p.z,4,function(m){a.index=m,p.modelIndex!==a.modelIndex||p.residueIndex===a.residueIndex||a.isMetal()||i.addBondIfConnected(p,a,1)})})}),Pe&&de.timeEnd("calculateBondsBetween inter")}Pe&&de.timeEnd("calculateBondsBetween")}function jg(e){if(e.unitcell){Pe&&de.time("buildUnitcellAssembly");var t=e.unitcell,n=e.center.clone().applyMatrix4(t.cartToFrac),i=n.clone().floor(),r=function(v){var d=s6[v],g={};if(d===void 0)return console.warn("spacegroup '"+v+"' not found in symop library"),g;for(var b=[],x=0,_=d.length;x<_;x+=3){for(var S=[],w=0;w<3;++w)S.push(o6[d[x+w]]);b.push(S)}return b.forEach(function(C){var A=0,k=new De().set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1),L=k.elements;g[C.toString()]=k,C.forEach(function(D){for(var F=!1,I=!1,P=0,N=D.length;P<N;++P){var $=D[P];if($==="-")F=!0;else if($==="+")F=!1;else if($==="/")I=!0;else if($==="X")L[0+A]=F?-1:1;else if($==="Y")L[4+A]=F?-1:1;else if($==="Z")L[8+A]=F?-1:1;else if(a6.test($)){var B=parseInt($);I?L[12+A]/=B:L[12+A]=B}else de.warn("getSymmetryOperations: unknown token '"+$+"'")}A+=1})}),g}(t.spacegroup),o=new T,s=new T,a=new fi("UNITCELL"),c=y(),l=[];if(e.biomolDict.NCS){l.push.apply(l,[new De].concat(e.biomolDict.NCS.partList[0].matrixList));var u=[];c.forEach(function(v){l.forEach(function(d){u.push(v.clone().multiply(d))})}),a.addPart(u)}else a.addPart(c);var h=new T,f=new fi("SUPERCELL"),p=Array.prototype.concat.call(y(h.set(1,0,0)),y(h.set(0,1,0)),y(h.set(0,0,1)),y(h.set(-1,0,0)),y(h.set(0,-1,0)),y(h.set(0,0,-1)),y(h.set(1,1,0)),y(h.set(1,0,1)),y(h.set(0,1,1)),y(h.set(-1,-1,0)),y(h.set(-1,0,-1)),y(h.set(0,-1,-1)),y(h.set(1,-1,-1)),y(h.set(1,1,-1)),y(h.set(1,-1,1)),y(h.set(-1,1,1)),y(h.set(-1,-1,1)),y(h.set(-1,1,-1)),y(h.set(0,1,-1)),y(h.set(0,-1,1)),y(h.set(1,0,-1)),y(h.set(-1,0,1)),y(h.set(1,-1,0)),y(h.set(-1,1,0)),y(),y(h.set(1,1,1)),y(h.set(-1,-1,-1)));if(e.biomolDict.NCS){var m=[];p.forEach(function(v){l.forEach(function(d){m.push(v.clone().multiply(d))})}),f.addPart(m)}else f.addPart(p);e.biomolDict.UNITCELL=a,e.biomolDict.SUPERCELL=f,Pe&&de.timeEnd("buildUnitcellAssembly")}function y(v){var d=[];return Object.keys(r).forEach(function(g){var b=r[g].clone();o.copy(n).applyMatrix4(b).floor(),s.setFromMatrixPosition(b),s.sub(o),s.add(i),v&&s.add(v),b.setPosition(s),b.multiplyMatrices(t.fracToCart,b),b.multiply(t.cartToFrac),d.push(b)}),d}}var US=["H","C","O","N","S","P"],l6=["NA","CL","FE"];function F_(e){var t=e.trim().toUpperCase();parseInt(t.charAt(0))>-1&&(t=t.substr(1)),parseInt(t.charAt(0))>-1&&(t=t.substr(1));var n=t.length;if(n===0)return"";if(n===1)return t;if(n===2){if(l6.indexOf(t)!==-1)return t;if(US.indexOf(t[0])!==-1)return t[0]}return n>=3&&US.indexOf(t[0])!==-1?t[0]:""}function Ic(e){var t=e.bondHash,n=t.countArray,i=t.offsetArray,r=t.indexArray,o=e.getBondProxy();e.eachResidue(function(s){var a=s.residueType;if(a.bonds===void 0){var c=s.atomOffset,l=[],u=[],h=[],f={},p=c+s.atomCount;s.eachAtom(function(m){for(var y=m.index,v=i[y],d=0,g=n[y];d<g;++d){o.index=r[v+d];var b=o.atomIndex1;if(!(b<c||b>=p)){var x=o.atomIndex2;if(!(x<c||x>=p)){if(b>x){var _=x;x=b,b=_}var S=b+"|"+x;f[S]===void 0&&(f[S]=!0,l.push(b-c),u.push(x-c),h.push(o.bondOrder))}}}}),a.bonds={atomIndices1:l,atomIndices2:u,bondOrders:h}}})}var u6=[3,11,19,37,55,87],h6=[4,12,20,38,56,88],f6=[6,15,16,34],p6=[1,7,8,9,17,35,53],d6=[2,10,18,36,54,86],m6=[13,30,31,48,49,50,80,81,82,83,84,85,112],g6=[5,14,32,33,51,52,85],y6=[9,17,35,53,85],li=function(e,t,n){this.structure=e,this.atomname=t,n=n||F_(t),this.element=n,this.number=rN[n]||0,this.vdw=oN[this.number]||2,this.covalent=sN[this.number]||1.6};li.prototype.getDefaultValence=function(){var e=_S[this.number];return e?e[0]:-1},li.prototype.getValenceList=function(){return _S[this.number]||[]},li.prototype.getOuterShellElectronCount=function(){return aN[this.number]||2},li.prototype.isMetal=function(){return this.isAlkaliMetal()||this.isAlkalineEarthMetal()||this.isLanthanide()||this.isActinide()||this.isTransitionMetal()||this.isPostTransitionMetal()},li.prototype.isNonmetal=function(){return this.isDiatomicNonmetal()||this.isPolyatomicNonmetal()||this.isNobleGas()},li.prototype.isMetalloid=function(){return g6.includes(this.number)},li.prototype.isHalogen=function(){return y6.includes(this.number)},li.prototype.isDiatomicNonmetal=function(){return p6.includes(this.number)},li.prototype.isPolyatomicNonmetal=function(){return f6.includes(this.number)},li.prototype.isAlkaliMetal=function(){return u6.includes(this.number)},li.prototype.isAlkalineEarthMetal=function(){return h6.includes(this.number)},li.prototype.isNobleGas=function(){return d6.includes(this.number)},li.prototype.isTransitionMetal=function(){var e=this.number;return e>=21&&e<=29||e>=39&&e<=47||e>=72&&e<=79||e>=104&&e<=108},li.prototype.isPostTransitionMetal=function(){return m6.includes(this.number)},li.prototype.isLanthanide=function(){return this.number>=57&&this.number<=71},li.prototype.isActinide=function(){return this.number>=89&&this.number<=103};var ib=function(e){this.structure=e,this.dict={},this.list=[],this.structure=e};ib.prototype.add=function(e,t){var n=function(o,s){return o+"|"+s}(e=e.toUpperCase(),t=t?t.toUpperCase():F_(e)),i=this.dict[n];if(i===void 0){var r=new li(this.structure,e,t);i=this.list.length,this.dict[n]=i,this.list.push(r)}return i},ib.prototype.get=function(e){return this.list[e]};var Nt=function(e,t,n,i,r,o){this.structure=e,this.bondReferenceAtomIndices=[],this.resname=t,this.atomTypeIdList=n,this.hetero=i?1:0,this.chemCompType=r,this.bonds=o,this.atomCount=n.length,this.moleculeType=this.getMoleculeType(),this.backboneType=this.getBackboneType(0),this.backboneEndType=this.getBackboneType(-1),this.backboneStartType=this.getBackboneType(1),this.backboneIndexList=this.getBackboneIndexList();var s=ym[this.backboneType],a=ym[this.backboneStartType],c=ym[this.backboneEndType],l=this.getAtomIndexByName(s.trace);this.traceAtomIndex=O(l,-1);var u=this.getAtomIndexByName(s.direction1);this.direction1AtomIndex=O(u,-1);var h=this.getAtomIndexByName(s.direction2);this.direction2AtomIndex=O(h,-1);var f=this.getAtomIndexByName(a.backboneStart);this.backboneStartAtomIndex=O(f,-1);var p,m=this.getAtomIndexByName(c.backboneEnd);this.backboneEndAtomIndex=O(m,-1),p=lN.includes(t)?this.getAtomIndexByName("N1"):this.getAtomIndexByName("N3"),this.rungEndAtomIndex=O(p,-1)};Nt.prototype.getBackboneIndexList=function(){var e,t=[];switch(this.moleculeType){case 3:e=fN;break;case 4:case 5:e=UT;break;default:return t}for(var n=this.structure.atomMap,i=this.atomTypeIdList,r=0,o=this.atomCount;r<o;++r){var s=n.get(i[r]);e.includes(s.atomname)&&t.push(r)}return t},Nt.prototype.getMoleculeType=function(){return this.isProtein()?3:this.isRna()?4:this.isDna()?5:this.isWater()?1:this.isIon()?2:this.isSaccharide()?6:0},Nt.prototype.getBackboneType=function(e){return this.hasProteinBackbone(e)?1:this.hasRnaBackbone(e)?2:this.hasDnaBackbone(e)?3:this.hasCgProteinBackbone(e)?4:this.hasCgRnaBackbone(e)?5:this.hasCgDnaBackbone(e)?6:0},Nt.prototype.isProtein=function(){return this.chemCompType?eN.includes(this.chemCompType):this.hasAtomWithName("CA","C","N")||ql.includes(this.resname)},Nt.prototype.isCg=function(){var e=this.backboneType;return e===4||e===5||e===6},Nt.prototype.isNucleic=function(){return this.isRna()||this.isDna()},Nt.prototype.isRna=function(){return this.chemCompType?tN.includes(this.chemCompType):this.hetero!==1&&(this.hasAtomWithName(["P","O3'","O3*"],["C4'","C4*"],["O2'","O2*","F2'","F2*"])||NT.includes(this.resname)&&this.hasAtomWithName(["O2'","O2*","F2'","F2*"]))},Nt.prototype.isDna=function(){return this.chemCompType?nN.includes(this.chemCompType):this.hetero!==1&&(this.hasAtomWithName(["P","O3'","O3*"],["C3'","C3*"])&&!this.hasAtomWithName(["O2'","O2*","F2'","F2*"])||zT.includes(this.resname))},Nt.prototype.isHetero=function(){return this.hetero===1},Nt.prototype.isIon=function(){return uN.includes(this.resname)},Nt.prototype.isWater=function(){return Vg.includes(this.resname)},Nt.prototype.isSaccharide=function(){return this.chemCompType?kT.includes(this.chemCompType):hN.includes(this.resname)},Nt.prototype.isStandardAminoacid=function(){return ql.includes(this.resname)},Nt.prototype.isStandardBase=function(){return Yh.includes(this.resname)},Nt.prototype.hasBackboneAtoms=function(e,t){var n=ym[t];return e===-1?this.hasAtomWithName(n.trace,n.backboneEnd,n.direction1,n.direction2):e===0?this.hasAtomWithName(n.trace,n.direction1,n.direction2):e===1?this.hasAtomWithName(n.trace,n.backboneStart,n.direction1,n.direction2):this.hasAtomWithName(n.trace,n.backboneStart,n.backboneEnd,n.direction1,n.direction2)},Nt.prototype.hasProteinBackbone=function(e){return this.isProtein()&&this.hasBackboneAtoms(e,1)},Nt.prototype.hasRnaBackbone=function(e){return this.isRna()&&this.hasBackboneAtoms(e,2)},Nt.prototype.hasDnaBackbone=function(e){return this.isDna()&&this.hasBackboneAtoms(e,3)},Nt.prototype.hasCgProteinBackbone=function(e){return this.atomCount<7&&this.isProtein()&&this.hasBackboneAtoms(e,4)},Nt.prototype.hasCgRnaBackbone=function(e){return this.atomCount<11&&this.isRna()&&this.hasBackboneAtoms(e,5)},Nt.prototype.hasCgDnaBackbone=function(e){return this.atomCount<11&&this.isDna()&&this.hasBackboneAtoms(e,6)},Nt.prototype.hasBackbone=function(e){return this.hasProteinBackbone(e)||this.hasRnaBackbone(e)||this.hasDnaBackbone(e)||this.hasCgProteinBackbone(e)||this.hasCgRnaBackbone(e)||this.hasCgDnaBackbone(e)},Nt.prototype.getAtomIndexByName=function(e){var t=this.atomCount,n=this.structure.atomMap,i=this.atomTypeIdList;if(Array.isArray(e))for(var r=0;r<t;++r){var o=i[r];if(e.includes(n.get(o).atomname))return r}else for(var s=0;s<t;++s){var a=i[s];if(e===n.get(a).atomname)return s}},Nt.prototype.hasAtomWithName=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var n=e.length,i=0;i<n;++i)if(e[i]!==void 0&&this.getAtomIndexByName(e[i])===void 0)return!1;return!0},Nt.prototype.getBonds=function(e){return this.bonds===void 0&&(this.bonds=function(t){var n=t.structure,i=n.getAtomProxy(),r=n.getAtomProxy(),o=t.atomCount,s=t.atomOffset,a=s+o-1,c=[],l=[],u=[];if(o>500)Pe&&de.warn("more than 500 atoms, skip residue for auto-bonding",t.qualifiedName());else if(o>50)for(var h=new tE(t,!0),f=t.isCg()?1.2:2.3,p=s;p<a;++p){i.index=p;for(var m=i.covalent+f+.3,y=h.nearest(i,1/0,m*m),v=y.length,d=0;d<v;++d)r.index=y[d].index,i.index<r.index&&i.connectedTo(r)&&(c.push(i.index-s),l.push(r.index-s),u.push(zS(i.resname,i.atomname,r.atomname)))}else for(var g=s;g<a;++g){i.index=g;for(var b=g+1;b<=a;++b)r.index=b,i.connectedTo(r)&&(c.push(g-s),l.push(b-s),u.push(zS(i.resname,i.atomname,r.atomname)))}return{atomIndices1:c,atomIndices2:l,bondOrders:u}}(e)),this.bonds},Nt.prototype.getRings=function(){return this.rings===void 0&&this.calculateRings(),this.rings},Nt.prototype.getBondGraph=function(){return this.bondGraph===void 0&&this.calculateBondGraph(),this.bondGraph},Nt.prototype.getAromatic=function(e){return this.aromaticAtoms===void 0&&this.calculateAromatic(this.structure.getResidueProxy(e.residueIndex)),this.aromaticAtoms},Nt.prototype.getAromaticRings=function(e){return this.aromaticRings===void 0&&this.calculateAromatic(e),this.aromaticRings},Nt.prototype.calculateBondGraph=function(){for(var e=this.bondGraph={},t=this.getBonds(),n=t.atomIndices1.length,i=t.atomIndices1,r=t.atomIndices2,o=0;o<n;++o){var s=i[o],a=r[o];(e[s]=e[s]||[]).push(a),(e[a]=e[a]||[]).push(s)}},Nt.prototype.calculateRings=function(){for(var e=function(n,i){for(var r={count:i,visited:new Int32Array(i),queue:new Int32Array(i),pred:new Int32Array(i),left:new Int32Array(Kh),right:new Int32Array(Kh),color:new Int32Array(i),currentColor:0,rings:[],atomRings:[],bonds:n},o=0;o<i;o++)r.visited[o]=-1,r.pred[o]=-1;return r}(this.getBondGraph(),this.atomCount),t=0;t<e.count;t++)e.visited[t]>=0||b6(e,t);this.rings={atomRings:e.atomRings,rings:e.rings}},Nt.prototype.isAromatic=function(e){return this.aromaticAtoms=this.getAromatic(e),this.aromaticAtoms[e.index-e.residueAtomOffset]===1},Nt.prototype.calculateAromatic=function(e){var t=this,n=this.aromaticAtoms=new Uint8Array(this.atomCount),i=this.getRings().rings,r=i.map(function(s){return function(a){if(a.some(function(h){return!v6.includes(h.number)}))return!1;var c=0,l=new Yt(3,a.length),u=l.data;return a.forEach(function(h){u[c+0]=h.x,u[c+1]=h.y,u[c+2]=h.z,c+=3}),new Zh(l).vecC.length()<.05}(s.map(function(a){return t.structure.getAtomProxy(a+e.atomOffset)}))}),o=this.aromaticRings=[];i.forEach(function(s,a){r[a]&&(o.push(s),s.forEach(function(c){return n[c]=1}))})},Nt.prototype.assignBondReferenceAtomIndices=function(){var e=this.getBondGraph(),t=this.getRings(),n=t.atomRings,i=t.rings,r=this.bonds,o=r.atomIndices1,s=r.atomIndices2,a=r.bondOrders,c=this.bondReferenceAtomIndices,l=r.atomIndices1.length;c.length=0;for(var u=0;u<l;++u)if(!(a[u]<=1)){var h=void 0,f=o[u],p=s[u],m=n[f],y=n[p];if(m&&y){for(var v=0;v<m.length;v++)if(y.indexOf(m[v])!==-1){h=i[m[v]];break}}if(e[f].length>1)for(var d=0;d<e[f].length;++d){var g=e[f][d];if(g!==p&&(h===void 0||h.indexOf(g)!==-1)){c[u]=g;break}}else if(e[p].length>1)for(var b=0;b<e[p].length;++b){var x=e[p][b];if(x!==f&&(h===void 0||h.indexOf(x)!==-1)){c[u]=x;break}}}},Nt.prototype.getBondIndex=function(e,t){for(var n=this.bonds,i=n.atomIndices1,r=n.atomIndices2,o=i.indexOf(e),s=r.indexOf(t),a=s;o!==-1;){for(;s!==-1;){if(o===s)return o;s=r.indexOf(t,s+1)}o=i.indexOf(e,o+1),s=a}},Nt.prototype.getBondReferenceAtomIndex=function(e,t){var n=this.getBondIndex(e,t);if(n!==void 0)return this.bondReferenceAtomIndices.length===0&&this.assignBondReferenceAtomIndices(),this.bondReferenceAtomIndices[n]};var v6=[5,6,7,8,14,15,16,32,33,50,51,83];function x6(e,t,n){if(!(n<t)){for(var i=e.pred,r=e.color,o=e.left,s=e.right,a=++e.currentColor,c=t,l=0;l<Kh&&(r[c]=a,!((c=i[c])<0));l++);var u=0,h=0,f=!1,p=0;c=n;for(var m=0;m<Kh;m++){if(r[c]===a){p=c,f=!0;break}if(s[h++]=c,(c=i[c])<0)break}if(f){c=t;for(var y=0;y<Kh&&(o[u++]=c,p!==c)&&!((c=i[c])<0);y++);for(var v=u+h,d=new Array(v),g=0,b=0;b<u;b++)d[g++]=o[b];for(var x=h-1;x>=0;x--)d[g++]=s[x];for(var _=e.rings.length,S=0;S<v;++S){var w=d[S];e.atomRings[w]?e.atomRings[w].push(_):e.atomRings[w]=[_]}e.rings.push(d)}}}function b6(e,t){var n=e.bonds,i=e.visited,r=e.queue,o=e.pred;i[t]=1,r[0]=t;for(var s=0,a=1;s<a;){var c=r[s++];if(n[c]!==void 0)for(var l=n[c].length,u=0;u<l;u++){var h=n[c][u];i[h]>0?o[h]!==c&&o[c]!==h&&x6(e,c,h):(i[h]=1,r[a++]=h,o[h]=c)}}}var Kh=4,rb=function(e){this.structure=e,this.dict={},this.list=[]};rb.prototype.add=function(e,t,n,i,r){i===void 0&&(i="");var o=function(c,l,u,h){return h===void 0&&(h=""),c+"|"+l.join(",")+"|"+(u?1:0)+"|"+h}(e=e.toUpperCase(),t,n,i),s=this.dict[o];if(s===void 0){var a=new Nt(this.structure,e,t,n,i,r);s=this.list.length,this.dict[o]=s,this.list.push(a)}return s},rb.prototype.get=function(e){return this.list[e]};var So=function(e,t){t===void 0&&(t=0),this.structure=e,this.index=t,this.bondStore=e.bondStore,this._v12=new T,this._v13=new T,this._ap1=this.structure.getAtomProxy(),this._ap2=this.structure.getAtomProxy(),this._ap3=this.structure.getAtomProxy()},ts={atom1:{configurable:!0},atom2:{configurable:!0},atomIndex1:{configurable:!0},atomIndex2:{configurable:!0},bondOrder:{configurable:!0}};ts.atom1.get=function(){return this.structure.getAtomProxy(this.atomIndex1)},ts.atom2.get=function(){return this.structure.getAtomProxy(this.atomIndex2)},ts.atomIndex1.get=function(){return this.bondStore.atomIndex1[this.index]},ts.atomIndex1.set=function(e){this.bondStore.atomIndex1[this.index]=e},ts.atomIndex2.get=function(){return this.bondStore.atomIndex2[this.index]},ts.atomIndex2.set=function(e){this.bondStore.atomIndex2[this.index]=e},ts.bondOrder.get=function(){return this.bondStore.bondOrder[this.index]},ts.bondOrder.set=function(e){this.bondStore.bondOrder[this.index]=e},So.prototype.getOtherAtomIndex=function(e){return e===this.atomIndex1?this.atomIndex2:this.atomIndex1},So.prototype.getOtherAtom=function(e){return this.structure.getAtomProxy(this.getOtherAtomIndex(e.index))},So.prototype.getReferenceAtomIndex=function(){var e=this._ap1,t=this._ap2;if(e.index=this.atomIndex1,t.index=this.atomIndex2,e.residueIndex===t.residueIndex){var n=e.index-e.residueAtomOffset,i=t.index-t.residueAtomOffset,r=e.residueType.getBondReferenceAtomIndex(n,i);if(r!==void 0)return r+e.residueAtomOffset;console.warn("No reference atom found",e.index,t.index)}},So.prototype.calculateShiftDir=function(e){e===void 0&&(e=new T);var t=this._ap1,n=this._ap2,i=this._ap3,r=this._v12,o=this._v13;t.index=this.atomIndex1,n.index=this.atomIndex2;var s=this.getReferenceAtomIndex();r.subVectors(t,n).normalize(),s!==void 0?(i.index=s,o.subVectors(t,i)):o.copy(t),o.normalize();var a=r.dot(o);return 1-Math.abs(a)<1e-5&&(o.set(1,0,0),a=r.dot(o),1-Math.abs(a)<1e-5&&(o.set(0,1,0),a=r.dot(o))),e.copy(o.sub(r.multiplyScalar(a))).normalize()},So.prototype.qualifiedName=function(){return this.atomIndex1+"="+this.atomIndex2},So.prototype.clone=function(){return new So(this.structure,this.index)},So.prototype.toObject=function(){return{atomIndex1:this.atomIndex1,atomIndex2:this.atomIndex2,bondOrder:this.bondOrder}},Object.defineProperties(So.prototype,ts);var Ht=function(e,t){t===void 0&&(t=0),this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueMap=e.residueMap,this.atomMap=e.atomMap},Ut={entity:{configurable:!0},entityIndex:{configurable:!0},chain:{configurable:!0},chainIndex:{configurable:!0},atomOffset:{configurable:!0},atomCount:{configurable:!0},atomEnd:{configurable:!0},modelIndex:{configurable:!0},chainname:{configurable:!0},chainid:{configurable:!0},resno:{configurable:!0},sstruc:{configurable:!0},inscode:{configurable:!0},residueType:{configurable:!0},resname:{configurable:!0},hetero:{configurable:!0},moleculeType:{configurable:!0},backboneType:{configurable:!0},backboneStartType:{configurable:!0},backboneEndType:{configurable:!0},traceAtomIndex:{configurable:!0},direction1AtomIndex:{configurable:!0},direction2AtomIndex:{configurable:!0},backboneStartAtomIndex:{configurable:!0},backboneEndAtomIndex:{configurable:!0},rungEndAtomIndex:{configurable:!0},x:{configurable:!0},y:{configurable:!0},z:{configurable:!0}};Ut.entity.get=function(){return this.structure.entityList[this.entityIndex]},Ut.entityIndex.get=function(){return this.chainStore.entityIndex[this.chainIndex]},Ut.chain.get=function(){return this.structure.getChainProxy(this.chainIndex)},Ut.chainIndex.get=function(){return this.residueStore.chainIndex[this.index]},Ut.chainIndex.set=function(e){this.residueStore.chainIndex[this.index]=e},Ut.atomOffset.get=function(){return this.residueStore.atomOffset[this.index]},Ut.atomOffset.set=function(e){this.residueStore.atomOffset[this.index]=e},Ut.atomCount.get=function(){return this.residueStore.atomCount[this.index]},Ut.atomCount.set=function(e){this.residueStore.atomCount[this.index]=e},Ut.atomEnd.get=function(){return this.atomOffset+this.atomCount-1},Ut.modelIndex.get=function(){return this.chainStore.modelIndex[this.chainIndex]},Ut.chainname.get=function(){return this.chainStore.getChainname(this.chainIndex)},Ut.chainid.get=function(){return this.chainStore.getChainid(this.chainIndex)},Ut.resno.get=function(){return this.residueStore.resno[this.index]},Ut.resno.set=function(e){this.residueStore.resno[this.index]=e},Ut.sstruc.get=function(){return this.residueStore.getSstruc(this.index)},Ut.sstruc.set=function(e){this.residueStore.setSstruc(this.index,e)},Ut.inscode.get=function(){return this.residueStore.getInscode(this.index)},Ut.inscode.set=function(e){this.residueStore.setInscode(this.index,e)},Ut.residueType.get=function(){return this.residueMap.get(this.residueStore.residueTypeId[this.index])},Ut.resname.get=function(){return this.residueType.resname},Ut.hetero.get=function(){return this.residueType.hetero},Ut.moleculeType.get=function(){return this.residueType.moleculeType},Ut.backboneType.get=function(){return this.residueType.backboneType},Ut.backboneStartType.get=function(){return this.residueType.backboneStartType},Ut.backboneEndType.get=function(){return this.residueType.backboneEndType},Ut.traceAtomIndex.get=function(){return this.residueType.traceAtomIndex+this.atomOffset},Ut.direction1AtomIndex.get=function(){return this.residueType.direction1AtomIndex+this.atomOffset},Ut.direction2AtomIndex.get=function(){return this.residueType.direction2AtomIndex+this.atomOffset},Ut.backboneStartAtomIndex.get=function(){return this.residueType.backboneStartAtomIndex+this.atomOffset},Ut.backboneEndAtomIndex.get=function(){return this.residueType.backboneEndAtomIndex+this.atomOffset},Ut.rungEndAtomIndex.get=function(){return this.residueType.rungEndAtomIndex+this.atomOffset},Ut.x.get=function(){for(var e=0,t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.x[t];return e/this.atomCount},Ut.y.get=function(){for(var e=0,t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.y[t];return e/this.atomCount},Ut.z.get=function(){for(var e=0,t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.z[t];return e/this.atomCount},Ht.prototype.eachAtom=function(e,t){var n=this.atomCount,i=this.atomOffset,r=this.structure._ap,o=i+n;if(t&&t.atomOnlyTest)for(var s=t.atomOnlyTest,a=i;a<o;++a)r.index=a,s(r)&&e(r);else for(var c=i;c<o;++c)r.index=c,e(r)},Ht.prototype.positionToArray=function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t+0]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},Ht.prototype.isProtein=function(){return this.residueType.moleculeType===3},Ht.prototype.isNucleic=function(){var e=this.residueType.moleculeType;return e===4||e===5},Ht.prototype.isRna=function(){return this.residueType.moleculeType===4},Ht.prototype.isDna=function(){return this.residueType.moleculeType===5},Ht.prototype.isCg=function(){var e=this.residueType.backboneType;return e===4||e===5||e===6},Ht.prototype.isPolymer=function(){if(this.structure.entityList.length>0)return this.entity.isPolymer();var e=this.residueType.moleculeType;return e===3||e===4||e===5},Ht.prototype.isHetero=function(){return this.residueType.hetero===1},Ht.prototype.isWater=function(){return this.residueType.moleculeType===1},Ht.prototype.isIon=function(){return this.residueType.moleculeType===2},Ht.prototype.isSaccharide=function(){return this.residueType.moleculeType===6},Ht.prototype.isStandardAminoacid=function(){return this.residueType.isStandardAminoacid()},Ht.prototype.isStandardBase=function(){return this.residueType.isStandardBase()},Ht.prototype.isHelix=function(){return DT.includes(this.sstruc)},Ht.prototype.isSheet=function(){return BT.includes(this.sstruc)},Ht.prototype.isTurn=function(){return FT.includes(this.sstruc)&&this.isProtein()},Ht.prototype.getAtomType=function(e){return this.atomMap.get(this.atomStore.atomTypeId[e])},Ht.prototype.getResname1=function(){return $g[this.resname.toUpperCase()]||"X"},Ht.prototype.getBackboneType=function(e){switch(e){case-1:return this.residueType.backboneStartType;case 1:return this.residueType.backboneEndType;default:return this.residueType.backboneType}},Ht.prototype.getAtomIndexByName=function(e){var t=this.residueType.getAtomIndexByName(e);return t!==void 0&&(t+=this.atomOffset),t},Ht.prototype.hasAtomWithName=function(e){return this.residueType.hasAtomWithName(e)},Ht.prototype.getAtomnameList=function(){console.warn("getAtomnameList - might be expensive");for(var e=this.atomCount,t=this.atomOffset,n=new Array(e),i=0;i<e;++i)n[i]=this.getAtomType(t+i).atomname;return n},Ht.prototype.connectedTo=function(e){var t=this.structure.getAtomProxy(this.backboneEndAtomIndex),n=this.structure.getAtomProxy(e.backboneStartAtomIndex);return!(!t||!n)&&t.connectedTo(n)},Ht.prototype.getNextConnectedResidue=function(){var e=this.chainStore.residueOffset[this.chainIndex],t=this.chainStore.residueCount[this.chainIndex],n=this.index+1;if(n<e+t){var i=this.structure.getResidueProxy(n);if(this.connectedTo(i))return i}else if(n===e+t){var r=this.structure.getResidueProxy(e);if(this.connectedTo(r))return r}},Ht.prototype.getPreviousConnectedResidue=function(e){var t=this.chainStore.residueOffset[this.chainIndex],n=this.index-1;if(n>=t){var i=O(e,this.structure.getResidueProxy());if(i.index=n,i.connectedTo(this))return i}else if(n===t-1){var r=this.chainStore.residueCount[this.chainIndex],o=O(e,this.structure.getResidueProxy());if(o.index=t+r-1,o.connectedTo(this))return o}},Ht.prototype.getBonds=function(){return this.residueType.getBonds(this)},Ht.prototype.getRings=function(){return this.residueType.getRings()},Ht.prototype.getAromaticRings=function(){return this.residueType.getAromaticRings(this)},Ht.prototype.qualifiedName=function(e){e===void 0&&(e=!1);var t="";return this.resname&&!e&&(t+="["+this.resname+"]"),this.resno!==void 0&&(t+=this.resno),this.inscode&&(t+="^"+this.inscode),this.chain&&(t+=":"+this.chainname),t+="/"+this.modelIndex},Ht.prototype.clone=function(){return new Ht(this.structure,this.index)},Ht.prototype.toObject=function(){return{index:this.index,chainIndex:this.chainIndex,atomOffset:this.atomOffset,atomCount:this.atomCount,resno:this.resno,resname:this.resname,sstruc:this.sstruc}},Object.defineProperties(Ht.prototype,Ut);var Wi=function(e,t,n){this.structure=e,this.residueIndexStart=t,this.residueIndexEnd=n,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueCount=n-t+1;var i=this.structure.getResidueProxy(this.residueIndexStart),r=this.structure.getResidueProxy(this.residueIndexEnd);this.isPrevConnected=i.getPreviousConnectedResidue()!==void 0;var o=r.getNextConnectedResidue();this.isNextConnected=o!==void 0,this.isNextNextConnected=o!==void 0&&o.getNextConnectedResidue()!==void 0,this.isCyclic=r.connectedTo(i),this.__residueProxy=this.structure.getResidueProxy()},Nd={chainIndex:{configurable:!0},modelIndex:{configurable:!0},chainname:{configurable:!0}};Nd.chainIndex.get=function(){return this.residueStore.chainIndex[this.residueIndexStart]},Nd.modelIndex.get=function(){return this.chainStore.modelIndex[this.chainIndex]},Nd.chainname.get=function(){return this.chainStore.getChainname(this.chainIndex)},Wi.prototype.isProtein=function(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isProtein()},Wi.prototype.isCg=function(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isCg()},Wi.prototype.isNucleic=function(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isNucleic()},Wi.prototype.getMoleculeType=function(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.moleculeType},Wi.prototype.getBackboneType=function(e){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.getBackboneType(e)},Wi.prototype.getAtomIndexByType=function(e,t){this.isCyclic?e===-1?e=this.residueCount-1:e===this.residueCount&&(e=0):(e!==-1||this.isPrevConnected||(e+=1),e!==this.residueCount||this.isNextNextConnected||(e-=1));var n,i=this.__residueProxy;switch(i.index=this.residueIndexStart+e,t){case"trace":n=i.traceAtomIndex;break;case"direction1":n=i.direction1AtomIndex;break;case"direction2":n=i.direction2AtomIndex;break;default:n=i.getAtomIndexByName(t)}return n},Wi.prototype.eachAtom=function(e,t){this.eachResidue(function(n){n.eachAtom(e,t)})},Wi.prototype.eachAtomN=function(e,t,n){for(var i=this.residueCount,r=new Array(e),o=0;o<e;++o)r[o]=this.structure.getAtomProxy(this.getAtomIndexByType(o,n));t.apply(this,r);for(var s=e;s<i;++s){for(var a=1;a<e;++a)r[a-1].index=r[a].index;r[e-1].index=this.getAtomIndexByType(s,n),t.apply(this,r)}},Wi.prototype.eachResidue=function(e){for(var t=this.structure.getResidueProxy(),n=this.residueCount,i=this.residueIndexStart,r=0;r<n;++r)t.index=i+r,e(t)},Wi.prototype.qualifiedName=function(){var e=this.structure.getResidueProxy(this.residueIndexStart),t=this.structure.getResidueProxy(this.residueIndexEnd);return e.qualifiedName()+" - "+t.qualifiedName()},Object.defineProperties(Wi.prototype,Nd);var Mo=function(e,t){t===void 0&&(t=0),this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore},Yn={entity:{configurable:!0},model:{configurable:!0},entityIndex:{configurable:!0},modelIndex:{configurable:!0},residueOffset:{configurable:!0},residueCount:{configurable:!0},residueEnd:{configurable:!0},atomOffset:{configurable:!0},atomEnd:{configurable:!0},atomCount:{configurable:!0},chainname:{configurable:!0},chainid:{configurable:!0}};Yn.entity.get=function(){return this.structure.entityList[this.entityIndex]},Yn.model.get=function(){return this.structure.getModelProxy(this.modelIndex)},Yn.entityIndex.get=function(){return this.chainStore.entityIndex[this.index]},Yn.entityIndex.set=function(e){this.chainStore.entityIndex[this.index]=e},Yn.modelIndex.get=function(){return this.chainStore.modelIndex[this.index]},Yn.modelIndex.set=function(e){this.chainStore.modelIndex[this.index]=e},Yn.residueOffset.get=function(){return this.chainStore.residueOffset[this.index]},Yn.residueOffset.set=function(e){this.chainStore.residueOffset[this.index]=e},Yn.residueCount.get=function(){return this.chainStore.residueCount[this.index]},Yn.residueCount.set=function(e){this.chainStore.residueCount[this.index]=e},Yn.residueEnd.get=function(){return this.residueOffset+this.residueCount-1},Yn.atomOffset.get=function(){return this.residueStore.atomOffset[this.residueOffset]},Yn.atomEnd.get=function(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1},Yn.atomCount.get=function(){return this.residueCount===0?0:this.atomEnd-this.atomOffset+1},Yn.chainname.get=function(){return this.chainStore.getChainname(this.index)},Yn.chainname.set=function(e){this.chainStore.setChainname(this.index,e)},Yn.chainid.get=function(){return this.chainStore.getChainid(this.index)},Yn.chainid.set=function(e){this.chainStore.setChainid(this.index,e)},Mo.prototype.eachAtom=function(e,t){this.eachResidue(function(n){n.eachAtom(e,t)},t)},Mo.prototype.eachResidue=function(e,t){var n=this.residueCount,i=this.residueOffset,r=this.structure._rp,o=i+n;if(t&&t.test){var s=t.residueOnlyTest;if(s)for(var a=i;a<o;++a)r.index=a,s(r)&&e(r);else for(var c=i;c<o;++c)r.index=c,e(r)}else for(var l=i;l<o;++l)r.index=l,e(r)},Mo.prototype.eachResidueN=function(e,t){var n=this.residueCount,i=this.residueOffset,r=i+n;if(!(n<e)){for(var o=new Array(e),s=0;s<e;++s)o[s]=this.structure.getResidueProxy(i+s);t.apply(this,o);for(var a=i+e;a<r;++a){for(var c=0;c<e;++c)o[c].index+=1;t.apply(this,o)}}},Mo.prototype.eachPolymer=function(e,t){for(var n=0,i=0,r=t?t.residueOnlyTest:void 0,o=this.model.structure,s=this.residueCount,a=this.residueOffset,c=a+s,l=this.structure.getResidueProxy(),u=this.structure.getResidueProxy(a),h=this.structure.getAtomProxy(),f=this.structure.getAtomProxy(),p=!0,m=a+1;m<c;++m){l.index=u.index,u.index=m;var y=p?l.backboneEndType:l.backboneType,v=u.backboneType;p&&(n=l.index,p=!1),i=u.index,y!==0&&y===v?(h.index=l.backboneEndAtomIndex,f.index=u.backboneStartAtomIndex,h&&f&&h.connectedTo(f)&&(!r||r(l)&&r(u))||(l.index-n>1&&e(new Wi(o,n,l.index)),n=i)):(y!==0&&l.index-n>1&&e(new Wi(o,n,l.index)),n=i)}i-n>1&&this.structure.getResidueProxy(n).backboneEndType&&e(new Wi(o,n,i))},Mo.prototype.qualifiedName=function(){return":"+this.chainname+"/"+this.modelIndex},Mo.prototype.clone=function(){return new Mo(this.structure,this.index)},Mo.prototype.toObject=function(){return{index:this.index,residueOffset:this.residueOffset,residueCount:this.residueCount,chainname:this.chainname}},Object.defineProperties(Mo.prototype,Yn);var Ao=function(e,t){t===void 0&&(t=0),this.structure=e,this.index=t,this.modelStore=e.modelStore,this.chainStore=e.chainStore,this.residueStore=e.residueStore},Sr={chainOffset:{configurable:!0},chainCount:{configurable:!0},residueOffset:{configurable:!0},atomOffset:{configurable:!0},chainEnd:{configurable:!0},residueEnd:{configurable:!0},atomEnd:{configurable:!0},residueCount:{configurable:!0},atomCount:{configurable:!0}};Sr.chainOffset.get=function(){return this.modelStore.chainOffset[this.index]},Sr.chainOffset.set=function(e){this.modelStore.chainOffset[this.index]=e},Sr.chainCount.get=function(){return this.modelStore.chainCount[this.index]},Sr.chainCount.set=function(e){this.modelStore.chainCount[this.index]=e},Sr.residueOffset.get=function(){return this.chainStore.residueOffset[this.chainOffset]},Sr.atomOffset.get=function(){return this.residueStore.atomOffset[this.residueOffset]},Sr.chainEnd.get=function(){return this.chainOffset+this.chainCount-1},Sr.residueEnd.get=function(){return this.chainStore.residueOffset[this.chainEnd]+this.chainStore.residueCount[this.chainEnd]-1},Sr.atomEnd.get=function(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1},Sr.residueCount.get=function(){return this.chainCount===0?0:this.residueEnd-this.residueOffset+1},Sr.atomCount.get=function(){return this.residueCount===0?0:this.atomEnd-this.atomOffset+1},Ao.prototype.eachAtom=function(e,t){this.eachChain(function(n){n.eachAtom(e,t)},t)},Ao.prototype.eachResidue=function(e,t){this.eachChain(function(n){n.eachResidue(e,t)},t)},Ao.prototype.eachPolymer=function(e,t){if(t&&t.chainOnlyTest){var n=t.chainOnlyTest;this.eachChain(function(i){n(i)&&i.eachPolymer(e,t)})}else this.eachChain(function(i){i.eachPolymer(e,t)})},Ao.prototype.eachChain=function(e,t){var n=this.chainCount,i=this.chainOffset,r=this.structure._cp,o=i+n;if(t&&t.test){var s=t.chainOnlyTest;if(s)for(var a=i;a<o;++a)r.index=a,s(r)&&e(r);else for(var c=i;c<o;++c)r.index=c,e(r)}else for(var l=i;l<o;++l)r.index=l,e(r)},Ao.prototype.qualifiedName=function(){return"/"+this.index},Ao.prototype.clone=function(){return new Ao(this.structure,this.index)},Ao.prototype.toObject=function(){return{index:this.index,chainOffset:this.chainOffset,chainCount:this.chainCount}},Object.defineProperties(Ao.prototype,Sr);var ut=function(e,t){e===void 0&&(e=""),t===void 0&&(t=""),this.signals={refreshed:new yt.Signal},this.init(e,t)},GS={type:{configurable:!0}};ut.prototype.init=function(e,t){this.name=e,this.path=t,this.title="",this.id="",this.data={structure:this,"@spatialLookup":void 0,"@valenceModel":void 0},this.header={},this.extraData={},this.atomSetCache={},this.atomSetDict={},this.biomolDict={},this.entityList=[],this.unitcell=void 0,this.frames=[],this.boxes=[],this.validation=void 0,this.bondStore=new wm(0),this.backboneBondStore=new wm(0),this.rungBondStore=new wm(0),this.atomStore=new e6(0),this.residueStore=new t6(0),this.chainStore=new n6(0),this.modelStore=new i6(0),this.atomMap=new ib(this),this.residueMap=new rb(this),this.bondHash=void 0,this.spatialHash=void 0,this.atomSet=void 0,this.bondSet=void 0,this.center=new T,this.boundingBox=new hn,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy()},GS.type.get=function(){return"Structure"},ut.prototype.finalizeAtoms=function(){this.atomSet=this.getAtomSet(),this.atomCount=this.atomStore.count,this.boundingBox=this.getBoundingBox(void 0,this.boundingBox),this.center=this.boundingBox.getCenter(new T),this.spatialHash=new Ec(this.atomStore,this.boundingBox)},ut.prototype.finalizeBonds=function(){for(var e in this.bondSet=this.getBondSet(),this.bondCount=this.bondStore.count,this.bondHash=new JN(this.bondStore,this.atomStore.count),this.atomSetCache={},this.atomSetDict.rung||(this.atomSetDict.rung=this.getAtomSet(!1)),this.atomSetDict)this.atomSetCache["__"+e]=this.atomSetDict[e].clone()},ut.prototype.getBondProxy=function(e){return new So(this,e)},ut.prototype.getAtomProxy=function(e){return new ot(this,e)},ut.prototype.getResidueProxy=function(e){return new Ht(this,e)},ut.prototype.getChainProxy=function(e){return new Mo(this,e)},ut.prototype.getModelProxy=function(e){return new Ao(this,e)},ut.prototype.getBondSet=function(){var e=this.bondStore.count,t=new gt(e),n=this.atomSet;if(n)if(n.isAllSet())t.setAll();else if(n.isAllClear())t.clearAll();else for(var i=this.getBondProxy(),r=0;r<e;++r)i.index=r,n.isSet(i.atomIndex1,i.atomIndex2)&&t.set(i.index);else t.setAll();return t},ut.prototype.getBackboneBondSet=function(){var e=this.backboneBondStore.count,t=new gt(e),n=this.atomSetCache.__backbone;if(n){var i=this.getBondProxy();i.bondStore=this.backboneBondStore;for(var r=0;r<e;++r)i.index=r,n.isSet(i.atomIndex1,i.atomIndex2)&&t.set(i.index)}else t.setAll();return t},ut.prototype.getRungBondSet=function(){var e=this.rungBondStore.count,t=new gt(e),n=this.atomSetCache.__rung;if(n){var i=this.getBondProxy();i.bondStore=this.rungBondStore;for(var r=0;r<e;++r)i.index=r,n.isSet(i.atomIndex1,i.atomIndex2)&&t.set(i.index)}else t.setAll();return t},ut.prototype.getAtomSet=function(e){var t=this.atomStore.count;if(e===void 0)return new gt(t,!0);if(e instanceof gt)return e;if(e===!0)return new gt(t,!0);if(e&&e.test){var n=e.string;if(n in this.atomSetCache)return this.atomSetCache[n];if(n==="")return new gt(t,!0);var i=new gt(t);return this.eachAtom(function(r){i.set(r.index)},e),this.atomSetCache[n]=i,i}return e===!1?new gt(t):new gt(t,!0)},ut.prototype.getAtomSetWithinSelection=function(e,t){var n=this.spatialHash,i=this.getAtomSet(!1),r=this.getAtomProxy();return n&&this.getAtomSet(e).forEach(function(o){r.index=o,n.within(r.x,r.y,r.z,t).forEach(function(s){i.set(s)})}),i},ut.prototype.getAtomSetWithinPoint=function(e,t){var n=e,i=this.getAtomSet(!1);return this.spatialHash&&this.spatialHash.within(n.x,n.y,n.z,t).forEach(function(r){i.set(r)}),i},ut.prototype.getAtomSetWithinVolume=function(e,t,n,i,r){var o=new Pr(e,n,i,r),s=o.getDataPosition(),a=s.length,c=o.matrix.getMaxScaleOnAxis(),l=this.getAtomSet(!1);if(!this.spatialHash)return l;for(var u=0;u<a;u+=3)this.spatialHash.within(s[u],s[u+1],s[u+2],c).forEach(function(h){l.set(h)});return l},ut.prototype.getAtomSetWithinGroup=function(e){var t=this.atomStore.residueIndex,n=this.getAtomSet(!1),i=this.getResidueProxy();return this.getAtomSet(e).forEach(function(r){i.index=t[r];for(var o=i.atomOffset;o<=i.atomEnd;++o)n.set(o)}),n},ut.prototype.getSelection=function(){},ut.prototype.getStructure=function(){return this},ut.prototype.eachEntity=function(e,t){this.entityList.forEach(function(n){t!==void 0&&n.getEntityType()!==t||e(n)})},ut.prototype.eachBond=function(e,t){var n,i=this.getBondProxy();if(t&&t.test&&(n=this.getBondSet(),this.bondSet&&n.intersection(this.bondSet)),n)n.forEach(function(s){i.index=s,e(i)});else for(var r=this.bondStore.count,o=0;o<r;++o)i.index=o,e(i)},ut.prototype.eachAtom=function(e,t){if(t&&t.test)this.eachModel(function(o){o.eachAtom(e,t)},t);else for(var n=this.atomStore.count,i=this.getAtomProxy(),r=0;r<n;++r)i.index=r,e(i)},ut.prototype.eachResidue=function(e,t){if(t&&t.test){var n=this.modelStore.count,i=this.getModelProxy(),r=t.modelOnlyTest;if(r)for(var o=0;o<n;++o)i.index=o,r(i)&&i.eachResidue(e,t);else for(var s=0;s<n;++s)i.index=s,i.eachResidue(e,t)}else for(var a=this.residueStore.count,c=this.getResidueProxy(),l=0;l<a;++l)c.index=l,e(c)},ut.prototype.eachResidueN=function(e,t){var n=this.residueStore.count;if(!(n<e)){for(var i=new Array(e),r=0;r<e;++r)i[r]=this.getResidueProxy(r);t.apply(this,i);for(var o=e;o<n;++o){for(var s=0;s<e;++s)i[s].index+=1;t.apply(this,i)}}},ut.prototype.eachPolymer=function(e,t){if(t&&t.modelOnlyTest){var n=t.modelOnlyTest;this.eachModel(function(i){n(i)&&i.eachPolymer(e,t)})}else this.eachModel(function(i){i.eachPolymer(e,t)})},ut.prototype.eachChain=function(e,t){if(t&&t.test)this.eachModel(function(o){o.eachChain(e,t)});else for(var n=this.chainStore.count,i=this.getChainProxy(),r=0;r<n;++r)i.index=r,e(i)},ut.prototype.eachModel=function(e,t){var n=this.modelStore.count,i=this.getModelProxy();if(t&&t.test){var r=t.modelOnlyTest;if(r)for(var o=0;o<n;++o)i.index=o,r(i)&&e(i);else for(var s=0;s<n;++s)i.index=s,e(i)}else for(var a=0;a<n;++a)i.index=a,e(i)},ut.prototype.getAtomData=function(e){var t=Object.assign({},e);t.colorParams&&(t.colorParams.structure=this.getStructure());var n,i,r=t.what,o=O(t.atomSet,this.atomSet),s={},a=this.getAtomProxy(),c=o.getSize();r&&!r.position||(s.position=new Float32Array(3*c)),r&&!r.color||!t.colorParams||(s.color=new Float32Array(3*c),i=Rt.getScheme(t.colorParams)),r&&!r.picking||(s.picking=new Oc(new Float32Array(c),this.getStructure())),r&&!r.radius||(s.radius=new Float32Array(c),n=new jo(t.radiusParams)),r&&!r.index||(s.index=new Uint32Array(c));var l=s.position,u=s.color,h=s.picking,f=s.radius,p=s.index;return o.forEach(function(m,y){var v=3*y;a.index=m,l&&a.positionToArray(l,v),u&&i.atomColorToArray(a,u,v),h&&(h.array[y]=m),f&&(f[y]=n.atomRadius(a)),p&&(p[y]=m)}),s},ut.prototype.getBondData=function(e){var t=Object.assign({},e);t.colorParams&&(t.colorParams.structure=this.getStructure());var n,i,r=t.what,o=O(t.bondSet,this.bondSet),s=O(t.multipleBond,"off"),a=s!=="off",c=s==="offset",l=O(t.bondScale,.4),u=O(t.bondSpacing,1),h={},f=this.getBondProxy();t.bondStore&&(f.bondStore=t.bondStore);var p,m=this.getAtomProxy(),y=this.getAtomProxy();if(a){var v=f.bondStore.bondOrder;p=0,o.forEach(function(B){p+=v[B]})}else p=o.getSize();r&&!r.position||(h.position1=new Float32Array(3*p),h.position2=new Float32Array(3*p)),r&&!r.color||!t.colorParams||(h.color=new Float32Array(3*p),h.color2=new Float32Array(3*p),i=Rt.getScheme(t.colorParams)),r&&!r.picking||(h.picking=new $T(new Float32Array(p),this.getStructure(),t.bondStore)),(!r||r.radius||a&&r.position)&&(n=new jo(t.radiusParams)),r&&!r.radius||(h.radius=new Float32Array(p),t.radius2&&(h.radius2=new Float32Array(p)));var d,g,b,x,_,S,w=h.position1,C=h.position2,A=h.color,k=h.color2,L=h.picking,D=h.radius,F=h.radius2,I=0,P=new T,N=new T,$=new T;return o.forEach(function(B){if(g=3*I,f.index=B,m.index=f.atomIndex1,y.index=f.atomIndex2,x=f.bondOrder,w)if(a&&x>1){var q=n.atomRadius(m);S=q*l/(.5*x),f.calculateShiftDir($),c?(_=2*u*q,$.multiplyScalar(_),$.negate(),N.subVectors(y,m).multiplyScalar(Math.max(.1,_/1.88)),m.positionToArray(w,g),y.positionToArray(C,g),x>=2&&(P.addVectors(m,$).add(N).toArray(w,g+3),P.addVectors(y,$).sub(N).toArray(C,g+3),x>=3&&(P.subVectors(m,$).add(N).toArray(w,g+6),P.subVectors(y,$).sub(N).toArray(C,g+6)))):(_=(u-l)*q,$.multiplyScalar(_),x===2?(P.addVectors(m,$).toArray(w,g),P.subVectors(m,$).toArray(w,g+3),P.addVectors(y,$).toArray(C,g),P.subVectors(y,$).toArray(C,g+3)):x===3?(m.positionToArray(w,g),P.addVectors(m,$).toArray(w,g+3),P.subVectors(m,$).toArray(w,g+6),y.positionToArray(C,g),P.addVectors(y,$).toArray(C,g+3),P.subVectors(y,$).toArray(C,g+6)):(m.positionToArray(w,g),y.positionToArray(C,g)))}else m.positionToArray(w,g),y.positionToArray(C,g);if(A&&k&&(i.bondColorToArray(f,1,A,g),i.bondColorToArray(f,0,k,g),a&&x>1))for(d=1;d<x;++d)Q3(A,g,b=3*d+g,3),Q3(k,g,b,3);if(L&&L.array&&(L.array[I]=B,a&&x>1))for(d=1;d<x;++d)L.array[I+d]=B;if(D&&(D[I]=n.atomRadius(m),a&&x>1))for(S=D[I]*l/(c?1:.5*x),d=c?1:0;d<x;++d)D[I+d]=S;if(F&&(F[I]=n.atomRadius(y),a&&x>1))for(S=F[I]*l/(c?1:.5*x),d=c?1:0;d<x;++d)F[I+d]=S;I+=a?x:1}),h},ut.prototype.getBackboneAtomData=function(e){return e=Object.assign({atomSet:this.atomSetCache.__backbone},e),this.getAtomData(e)},ut.prototype.getBackboneBondData=function(e){return e=Object.assign({bondSet:this.getBackboneBondSet(),bondStore:this.backboneBondStore},e),this.getBondData(e)},ut.prototype.getRungAtomData=function(e){return e=Object.assign({atomSet:this.atomSetCache.__rung},e),this.getAtomData(e)},ut.prototype.getRungBondData=function(e){return e=Object.assign({bondSet:this.getRungBondSet(),bondStore:this.rungBondStore},e),this.getBondData(e)},ut.prototype.getBoundingBox=function(e,t){Pe&&de.time("getBoundingBox"),t=t||new hn;var n=1/0,i=1/0,r=1/0,o=-1/0,s=-1/0,a=-1/0;return this.eachAtom(function(c){var l=c.x,u=c.y,h=c.z;l<n&&(n=l),u<i&&(i=u),h<r&&(r=h),l>o&&(o=l),u>s&&(s=u),h>a&&(a=h)},e),t.min.set(n,i,r),t.max.set(o,s,a),Pe&&de.timeEnd("getBoundingBox"),t},ut.prototype.getPrincipalAxes=function(e){Pe&&de.time("getPrincipalAxes");var t=0,n=new Yt(3,this.atomCount),i=n.data;return this.eachAtom(function(r){i[t+0]=r.x,i[t+1]=r.y,i[t+2]=r.z,t+=3},e),Pe&&de.timeEnd("getPrincipalAxes"),new Zh(n)},ut.prototype.atomCenter=function(e){return e?this.getBoundingBox(e).getCenter(new T):this.center.clone()},ut.prototype.hasCoords=function(){if(this._hasCoords===void 0){var e=this.atomStore;this._hasCoords=pm(e.x)!==0||fm(e.x)!==0||pm(e.y)!==0||fm(e.y)!==0||pm(e.z)!==0||fm(e.z)!==0||e.count/this.modelStore.count==1}return this._hasCoords},ut.prototype.getSequence=function(e){var t=[],n=this.getResidueProxy();return this.eachAtom(function(i){n.index=i.residueIndex,i.index===n.traceAtomIndex&&t.push(n.getResname1())},e),t},ut.prototype.getAtomIndices=function(e){if(e&&e.string){var t=[];return this.eachAtom(function(n){t.push(n.index)},e),new Uint32Array(t)}return this.getAtomData({what:{index:!0}}).index},ut.prototype.getChainnameCount=function(e){var t=new Set;return this.eachChain(function(n){n.residueCount&&t.add(n.chainname)},e),t.size},ut.prototype.updatePosition=function(e){var t=0;this.eachAtom(function(n){n.positionFromArray(e,t),t+=3},void 0),this._hasCoords=void 0},ut.prototype.refreshPosition=function(){this.getBoundingBox(void 0,this.boundingBox),this.boundingBox.getCenter(this.center),this.spatialHash=new Ec(this.atomStore,this.boundingBox)},ut.prototype.dispose=function(){this.frames&&(this.frames.length=0),this.boxes&&(this.boxes.length=0),this.bondStore.dispose(),this.backboneBondStore.dispose(),this.rungBondStore.dispose(),this.atomStore.dispose(),this.residueStore.dispose(),this.chainStore.dispose(),this.modelStore.dispose(),delete this.bondSet,delete this.atomSet},Object.defineProperties(ut.prototype,GS);var $S=new hn,ob=[S0,Pc,M0,Tc,Cu,_0,Au,w0,Gg,A0,rp,op],_6={aspectRatio:1.5,sphereDetail:2,radialSegments:50,disableImpostor:!1,openEnded:!1,dashedCylinder:!1,labelParams:{},pointSize:2,sizeAttenuation:!1,useTexture:!0,linewidth:2},Zn=function(e,t){var n=this;e===void 0&&(e="shape"),t===void 0&&(t={}),this.boundingBox=new hn,this.bufferList=[],this.meshCount=0,this._primitiveData={},this.name=e,this.parameters=br(t,_6),ob.forEach(function(i){Object.keys(i.fields).forEach(function(r){n._primitiveData[i.getShapeKey(r)]=[]}),n._primitiveData[i.getShapeKey("name")]=[]})},my={center:{configurable:!0},type:{configurable:!0}};Zn.prototype.addBuffer=function(e){this.bufferList.push(e);var t=e.geometry;return t.boundingBox||t.computeBoundingBox(),this.boundingBox.union(t.boundingBox),this},Zn.prototype.addMesh=function(e,t,n,i,r){var o;e=V1(e),t=V1(t),Array.isArray(n)&&(n=Ho(n,e.length)),i&&(i=V1(i)),o=i===void 0||i.length==0?{position:e,color:t,index:n}:{position:e,color:t,index:n,normal:i};var s=new zN(this,Object.assign({serial:this.meshCount,name:r},o)),a=new Cs(Object.assign({picking:s},o));return this.bufferList.push(a),$S.setFromArray(e),this.boundingBox.union($S),this.meshCount+=1,this},Zn.prototype.addSphere=function(e,t,n,i){return Au.objectToShape(this,{position:e,color:t,radius:n,name:i}),this},Zn.prototype.addEllipsoid=function(e,t,n,i,r,o){return Cu.objectToShape(this,{position:e,color:t,radius:n,majorAxis:i,minorAxis:r,name:o}),this},Zn.prototype.addTorus=function(e,t,n,i,r,o){return A0.objectToShape(this,{position:e,color:t,radius:n,majorAxis:i,minorAxis:r,name:o}),this},Zn.prototype.addCylinder=function(e,t,n,i,r){return Tc.objectToShape(this,{position1:e,position2:t,color:n,radius:i,name:r}),this},Zn.prototype.addCone=function(e,t,n,i,r){return M0.objectToShape(this,{position1:e,position2:t,color:n,radius:i,name:r}),this},Zn.prototype.addArrow=function(e,t,n,i,r){return S0.objectToShape(this,{position1:e,position2:t,color:n,radius:i,name:r}),this},Zn.prototype.addBox=function(e,t,n,i,r,o){return Pc.objectToShape(this,{position:e,color:t,size:n,heightAxis:i,depthAxis:r,name:o}),this},Zn.prototype.addOctahedron=function(e,t,n,i,r,o){return _0.objectToShape(this,{position:e,color:t,size:n,heightAxis:i,depthAxis:r,name:o}),this},Zn.prototype.addTetrahedron=function(e,t,n,i,r,o){return w0.objectToShape(this,{position:e,color:t,size:n,heightAxis:i,depthAxis:r,name:o}),this},Zn.prototype.addText=function(e,t,n,i){return Gg.objectToShape(this,{position:e,color:t,size:n,text:i}),this},Zn.prototype.addPoint=function(e,t,n){return rp.objectToShape(this,{position:e,color:t,name:n}),this},Zn.prototype.addWideline=function(e,t,n,i,r){return this.parameters.linewidth=i,op.objectToShape(this,{position1:e,position2:t,color:n,name:r}),this},Zn.prototype.addLabel=function(e,t,n,i){return console.warn("Shape.addLabel is deprecated, use .addText instead"),this.addText(e,t,n,i)},Zn.prototype.getBufferList=function(){var e=this,t=[];return ob.forEach(function(n){e._primitiveData[n.getShapeKey("color")].length&&t.push(n.bufferFromShape(e,e.parameters))}),this.bufferList.concat(t)},Zn.prototype.dispose=function(){var e=this;this.bufferList.forEach(function(t){t.dispose()}),this.bufferList.length=0,ob.forEach(function(t){Object.keys(t.fields).forEach(function(n){e._primitiveData[t.getShapeKey(n)].length=0}),e._primitiveData[t.getShapeKey("name")].length=0})},my.center.get=function(){return this._center||(this._center=this.boundingBox.getCenter(new T)),this._center},my.type.get=function(){return"Shape"},Object.defineProperties(Zn.prototype,my);var VS=function(e){function t(n,i,r){Array.isArray(n)||(n=[n]),e.call(this,n,i,r),this.type="buffer",this.parameters=Object.assign({},this.parameters,{colorScheme:null,colorScale:null,colorValue:null,colorDomain:null,colorMode:null}),this.buffer=n,this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){e.prototype.init.call(this,n),this.build()},t.prototype.create=function(){this.bufferList.push.apply(this.bufferList,this.buffer)},t.prototype.attach=function(n){var i=this;this.bufferList.forEach(function(r){i.viewer.add(r),r.setParameters(i.getBufferParams())}),this.setVisibility(this.visible),n()},t}(Un),zd=new De,HS=new di,Oa=function(e){function t(n,i,r){i===void 0&&(i={}),e.call(this,function(u,h){var f,p=h.attributes.position.array,m=h.index?h.index.array:void 0,y=u.position.length/3,v=p.length/3,d=y*v,g=new Float32Array(3*d),b=new Float32Array(3*d),x=new Float32Array(3*d);return m&&(f=Ho(y*m.length,d)),{position:g,color:x,index:f,normal:b,primitiveId:u.primitiveId||Wx(y,v),picking:u.picking}}(n,r),i),this.updateNormals=!1;var o=r.attributes.position.array,s=r.attributes.normal.array,a=r.index?r.index.array:void 0;this.geoPosition=o,this.geoNormal=s,this.geoIndex=a,this.positionCount=n.position.length/3,this.geoPositionCount=o.length/3,this.transformedGeoPosition=new Float32Array(3*this.geoPositionCount),this.transformedGeoNormal=new Float32Array(3*this.geoPositionCount);var c=this.geometry.attributes;if(this.meshPosition=c.position.array,this.meshColor=c.color.array,this.meshNormal=c.normal.array,this.setAttributes(n),a){var l=this.geometry.getIndex();if(!l)return void de.error("Index is null");this.meshIndex=l.array,this.makeIndex()}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setAttributes=function(n,i){n===void 0&&(n={}),i===void 0&&(i=!1);var r,o,s,a,c,l,u,h,f,p=this.geometry.attributes,m=this.updateNormals;n.position&&(r=n.position,s=this.geoPosition,u=this.meshPosition,c=this.transformedGeoPosition,p.position.needsUpdate=!0,(m||i)&&(a=this.geoNormal,f=this.meshNormal,l=this.transformedGeoNormal,p.normal.needsUpdate=!0)),n.color&&(o=n.color,h=this.meshColor,p.color.needsUpdate=!0);for(var y=this.positionCount,v=this.geoPositionCount,d=0;d<y;++d){var g=void 0,b=void 0,x=d*v*3,_=3*d;if(r&&c&&u&&f&&s&&a&&(c.set(s),zd.makeTranslation(r[_],r[_+1],r[_+2]),this.applyPositionTransform(zd,d,_),x0(zd.elements,c),u.set(c,x),m&&l?(l.set(a),HS.getNormalMatrix(zd),R_(HS.elements,l),f.set(l,x)):i&&f.set(a,x)),o&&h)for(g=0;g<v;++g)h[b=x+3*g]=o[_],h[b+1]=o[_+1],h[b+2]=o[_+2]}},t.prototype.makeIndex=function(){var n=this.geoIndex,i=this.meshIndex;if(n)for(var r=this.positionCount,o=this.geoPositionCount,s=3*(n.length/3),a=0;a<r;++a){var c=a*s,l=c+s;i.set(n,c);for(var u=c;u<l;++u)i[u]+=a*o}},t}(Cs),jS=new T,rE=Object.assign({sphereDetail:1},Vi),w6=function(e){function t(i,r){r===void 0&&(r={}),e.call(this,i,r,new Mc(1,O(r.sphereDetail,1))),this.setAttributes(i,!0)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultParameters:{configurable:!0}};return n.defaultParameters.get=function(){return rE},t.prototype.applyPositionTransform=function(i,r){var o=this._radius[r];jS.set(o,o,o),i.scale(jS)},t.prototype.setAttributes=function(i,r){i===void 0&&(i={}),i.radius&&(this._radius=i.radius),e.prototype.setAttributes.call(this,i,r)},Object.defineProperties(t.prototype,n),t}(Oa);jt.add("shader/SphereImpostor.vert",`uniform mat4 projectionMatrixInverse;
uniform float clipNear;
varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;
attribute vec2 mapping;
attribute float radius;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#endif
#include matrix_scale
const mat4 D = mat4(
1.0, 0.0, 0.0, 0.0,
0.0, 1.0, 0.0, 0.0,
0.0, 0.0, 1.0, 0.0,
0.0, 0.0, 0.0, -1.0
);
mat4 transposeM( in mat4 inMatrix ) {
vec4 i0 = inMatrix[0];
vec4 i1 = inMatrix[1];
vec4 i2 = inMatrix[2];
vec4 i3 = inMatrix[3];
mat4 outMatrix = mat4(
vec4(i0.x, i1.x, i2.x, i3.x),
vec4(i0.y, i1.y, i2.y, i3.y),
vec4(i0.z, i1.z, i2.z, i3.z),
vec4(i0.w, i1.w, i2.w, i3.w)
);
return outMatrix;
}
void ComputePointSizeAndPositionInClipCoordSphere(){
vec2 xbc;
vec2 ybc;
mat4 T = mat4(
radius, 0.0, 0.0, 0.0,
0.0, radius, 0.0, 0.0,
0.0, 0.0, radius, 0.0,
position.x, position.y, position.z, 1.0
);
mat4 R = transposeM( projectionMatrix * modelViewMatrix * T );
float A = dot( R[ 3 ], D * R[ 3 ] );
float B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );
float C = dot( R[ 0 ], D * R[ 0 ] );
xbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
xbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
float sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;
A = dot( R[ 3 ], D * R[ 3 ] );
B = -2.0 * dot( R[ 1 ], D * R[ 3 ] );
C = dot( R[ 1 ], D * R[ 1 ] );
ybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
ybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
float sy = abs( ybc[ 0 ] - ybc[ 1 ] ) * 0.5;
gl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );
gl_Position.xy -= mapping * vec2( sx, sy );
gl_Position.xy *= gl_Position.w;
}
void main(void){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
vRadius = radius * matrixScale( modelViewMatrix );
vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
mvPosition.z -= vRadius;
gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );
ComputePointSizeAndPositionInClipCoordSphere();
vRadiusSq = vRadius * vRadius;
vec4 vPoint4 = projectionMatrixInverse * gl_Position;
vPoint = vPoint4.xyz / vPoint4.w;
vPointViewPosition = -mvPosition.xyz / mvPosition.w;
}`),jt.add("shader/SphereImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform mat4 projectionMatrix;
uniform float ortho;
varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool flag2 = false;
bool interior = false;
vec3 cameraPos;
vec3 cameraNormal;
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
float calcClip( vec3 cameraPos ){
return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
bool Impostor( out vec3 cameraPos, out vec3 cameraNormal ){
vec3 cameraSpherePos = -vPointViewPosition;
cameraSpherePos.z += vRadius;
vec3 rayOrigin = mix( vec3( 0.0, 0.0, 0.0 ), vPoint, ortho );
vec3 rayDirection = mix( normalize( vPoint ), vec3( 0.0, 0.0, 1.0 ), ortho );
vec3 cameraSphereDir = mix( cameraSpherePos, rayOrigin - cameraSpherePos, ortho );
float B = dot( rayDirection, cameraSphereDir );
float det = B * B + vRadiusSq - dot( cameraSphereDir, cameraSphereDir );
if( det < 0.0 ){
discard;
return false;
}
float sqrtDet = sqrt( det );
float posT = mix( B + sqrtDet, B + sqrtDet, ortho );
float negT = mix( B - sqrtDet, sqrtDet - B, ortho );
cameraPos = rayDirection * negT + rayOrigin;
#ifdef NEAR_CLIP
if( calcDepth( cameraPos ) <= 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
}else if( calcClip( cameraPos ) > 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
flag2 = true;
}
#else
if( calcDepth( cameraPos ) <= 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
}
#endif
cameraNormal = normalize( cameraPos - cameraSpherePos );
cameraNormal *= float(!interior) * 2.0 - 1.0;
return !interior;
}
void main(void){
bool flag = Impostor( cameraPos, cameraNormal );
#ifdef NEAR_CLIP
if( calcClip( cameraPos ) > 0.0 )
discard;
#endif
gl_FragDepthEXT = calcDepth( cameraPos );
if( !flag ){
#ifdef NEAR_CLIP
if( flag2 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );
}else if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
#else
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
#endif
}
if (gl_FragDepthEXT < 0.0)
discard;
if (gl_FragDepthEXT > 1.0)
discard;
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vNormal = cameraNormal;
vec3 vViewPosition = -cameraPos;
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
#include normal_fragment_begin
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include encodings_fragment
#include fog_fragment
#endif
}`);var N_=function(e){function t(i,r,o){o===void 0&&(o={}),e.call(this,r,o),this.index=Ho(this.indexSize,this.attributeSize),this.makeIndex(),this.initIndex(this.index),this.addAttributes({mapping:{type:i,value:null}}),this.setAttributes({primitiveId:Du(this.size)})}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={attributeSize:{configurable:!0},indexSize:{configurable:!0}};return n.attributeSize.get=function(){return this.size*this.mappingSize},n.indexSize.get=function(){return this.size*this.mappingIndicesSize},t.prototype.addAttributes=function(i){var r={};for(var o in i){var s=i[o];r[o]={type:s.type,value:null}}e.prototype.addAttributes.call(this,r)},t.prototype.getAttributeIndex=function(i){return 3*i*this.mappingSize},t.prototype.setAttributes=function(i){i&&!i.position&&i.position1&&i.position2&&(i.position=No(i.position1,i.position2));var r,o,s,a,c,l,u,h=this.size,f=this.mappingSize,p=this.geometry.attributes;for(var m in i)if(m!=="index"&&m!=="picking"){o=i[m],s=(r=p[m]).itemSize,a=r.array;for(var y=0;y<h;++y){l=(c=y*s)*f;for(var v=0;v<f;++v){u=l+s*v;for(var d=0;d<s;++d)a[u+d]=o[c+d]}}r.needsUpdate=!0}},t.prototype.makeMapping=function(){for(var i=this.size,r=this.mapping,o=this.mappingSize,s=this.mappingItemSize,a=this.geometry.attributes.mapping.array,c=0;c<i;c++)a.set(r,c*s*o)},t.prototype.makeIndex=function(){for(var i=this.size,r=this.mappingSize,o=this.mappingIndices,s=this.mappingIndicesSize,a=this.index,c=0;c<i;c++){var l=c*s,u=c*r;a.set(o,l);for(var h=0;h<s;++h)a[l+h]+=u}},Object.defineProperties(t.prototype,n),t}(Bt),S6=new Float32Array([-1,1,-1,-1,1,1,1,-1]),M6=new Uint16Array([0,1,2,1,3,2]),z_=function(e){function t(i,r){r===void 0&&(r={}),e.call(this,"v2",i,r)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={mapping:{configurable:!0},mappingIndices:{configurable:!0},mappingIndicesSize:{configurable:!0},mappingSize:{configurable:!0},mappingItemSize:{configurable:!0}};return n.mapping.get=function(){return S6},n.mappingIndices.get=function(){return M6},n.mappingIndicesSize.get=function(){return 6},n.mappingSize.get=function(){return 4},n.mappingItemSize.get=function(){return 2},Object.defineProperties(t.prototype,n),t}(N_),A6=function(e){function t(n,i){i===void 0&&(i={}),e.call(this,n,i),this.isImpostor=!0,this.vertexShader="SphereImpostor.vert",this.fragmentShader="SphereImpostor.frag",this.addUniforms({projectionMatrixInverse:{value:new De},ortho:{value:0}}),this.addAttributes({radius:{type:"f",value:null}}),this.setAttributes(n),this.makeMapping()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(z_);Object.assign({disableImpostor:!1},rE);var ka=function(e,t){return!Fo||t&&t.disableImpostor?new w6(e,t):new A6(e,t)};_r.add("sphere",ka),jt.add("shader/Point.vert",`uniform float clipNear;
uniform float clipRadius;
uniform vec3 clipCenter;
uniform float size;
uniform float canvasHeight;
uniform float pixelRatio;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
varying vec3 vViewPosition;
#endif
#include common
void main(){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
#include begin_vertex
#include project_vertex
#ifdef USE_SIZEATTENUATION
gl_PointSize = size * pixelRatio * ( ( canvasHeight / 2.0 ) / -mvPosition.z );
#else
gl_PointSize = size * pixelRatio;
#endif
#ifndef PICKING
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
#include radiusclip_vertex
}`),jt.add("shader/Point.frag",`uniform vec3 diffuse;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#ifdef USE_MAP
uniform sampler2D map;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
varying vec3 vViewPosition;
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
#ifdef USE_MAP
if( texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) ).a < 0.5 )
discard;
#endif
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 outgoingLight = vec3( 0.0 );
vec4 diffuseColor = vec4( diffuse, 1.0 );
#ifdef USE_MAP
diffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );
#endif
#include color_fragment
#include alphatest_fragment
outgoingLight = diffuseColor.rgb;
gl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include encodings_fragment
#include fog_fragment
#endif
}`);var C6=Object.assign({pointSize:1,sizeAttenuation:!0,sortParticles:!1,alphaTest:.5,useTexture:!1,forceTransparent:!1,edgeBleach:0},Vi),P6=Object.assign({pointSize:{uniform:"size"},sizeAttenuation:{updateShader:!0},sortParticles:{},alphaTest:{updateShader:!0},useTexture:{updateShader:!0},forceTransparent:{},edgeBleach:{uniform:!0}},kc),U_=function(e){function t(i,r){r===void 0&&(r={}),e.call(this,i,r),this.parameterTypes=P6,this.vertexShader="Point.vert",this.fragmentShader="Point.frag",this.isPoint=!0,this.addUniforms({size:{value:this.parameters.pointSize},canvasHeight:{value:1},pixelRatio:{value:1},map:{value:null}})}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultParameters:{configurable:!0}};return n.defaultParameters.get=function(){return C6},t.prototype.makeMaterial=function(){e.prototype.makeMaterial.call(this),this.makeTexture();var i=this.material,r=this.wireframeMaterial,o=this.pickingMaterial;i.uniforms.map.value=this.tex,i.needsUpdate=!0,r.uniforms.map.value=this.tex,r.needsUpdate=!0,o.uniforms.map.value=this.tex,o.needsUpdate=!0},t.prototype.makeTexture=function(){this.tex&&this.tex.dispose(),this.tex=function(i){for(var r,o,s=i||{},a=O(s.width,256),c=O(s.height,256),l=[a/2,c/2],u=Math.min(a/2,c/2),h=O(s.delta,1/(u+1))*u,f=0,p=0,m=new Uint8Array(a*c*4),y=0,v=m.length;y<v;y+=4){var d=1-_p(u-h,u,(r=void 0,o=void 0,r=l[0]-f,o=l[1]-p,Math.sqrt(r*r+o*o)));m[y]=255*d,m[y+1]=255*d,m[y+2]=255*d,m[y+3]=255*d,++f===a&&(f=0,p++)}var g=new xs(m,a,c);return g.needsUpdate=!0,g}({delta:this.parameters.edgeBleach})},t.prototype.getDefines=function(i){var r=e.prototype.getDefines.call(this,i);return this.parameters.sizeAttenuation&&(r.USE_SIZEATTENUATION=1),this.parameters.useTexture&&(r.USE_MAP=1),this.parameters.alphaTest>0&&this.parameters.alphaTest<=1&&(r.ALPHATEST=this.parameters.alphaTest.toPrecision(2)),r},t.prototype.setUniforms=function(i){i&&i.edgeBleach!==void 0&&(this.makeTexture(),i.map=this.tex),e.prototype.setUniforms.call(this,i)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.tex&&this.tex.dispose()},Object.defineProperties(t.prototype,n),t}(Bt);_r.add("point",U_);var WS=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="dot",this.parameters=Object.assign({thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdOut:{type:"boolean",rebuild:!0},dotType:{type:"select",rebuild:!0,options:{"":"",sphere:"sphere",point:"point"}},radiusType:{type:"select",options:{"":"",value:"value","abs-value":"abs-value","value-min":"value-min",deviation:"deviation",size:"size"}},radius:{type:"number",precision:3,max:10,min:.001,property:"size"},scale:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,disableImpostor:!0,pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{colorScheme:{type:"select",update:"color",options:{"":"",value:"value",uniform:"uniform",random:"random"}}}),n instanceof Xt?(this.surface=void 0,this.volume=new Pr(n)):(this.surface=n,this.volume=void 0),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.colorScheme=O(i.colorScheme,"uniform"),i.colorValue=O(i.colorValue,14540253),this.thresholdType=O(i.thresholdType,"sigma"),this.thresholdMin=O(i.thresholdMin,2),this.thresholdMax=O(i.thresholdMax,1/0),this.thresholdOut=O(i.thresholdOut,!1),this.dotType=O(i.dotType,"point"),this.radius=O(i.radius,.1),this.scale=O(i.scale,1),this.pointSize=O(i.pointSize,1),this.sizeAttenuation=O(i.sizeAttenuation,!0),this.sortParticles=O(i.sortParticles,!1),this.useTexture=O(i.useTexture,!1),this.alphaTest=O(i.alphaTest,.5),this.forceTransparent=O(i.forceTransparent,!1),this.edgeBleach=O(i.edgeBleach,0),e.prototype.init.call(this,i),this.build()},t.prototype.attach=function(n){var i=this;this.bufferList.forEach(function(r){i.viewer.add(r)}),this.setVisibility(this.visible),n()},t.prototype.create=function(){var n={};if(this.volume){var i,r,o=this.volume;this.thresholdType==="sigma"?(i=o.getValueForSigma(this.thresholdMin),r=o.getValueForSigma(this.thresholdMax)):(i=this.thresholdMin,r=this.thresholdMax),o.setFilter(i,r,this.thresholdOut),Object.assign(n,{position:o.getDataPosition(),color:o.getDataColor(this.getColorParams())}),this.dotType==="sphere"&&Object.assign(n,{radius:o.getDataSize(this.radius,this.scale),picking:o.getDataPicking()})}else{var s=this.surface;Object.assign(n,{position:s.getPosition(),color:s.getColor(this.getColorParams())}),this.dotType==="sphere"&&Object.assign(n,{radius:s.getSize(this.radius,this.scale),picking:s.getPicking()})}this.dotType==="sphere"?this.dotBuffer=new ka(n,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!1})):this.dotBuffer=new U_(n,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach})),this.bufferList.push(this.dotBuffer)},t.prototype.update=function(n){if(n===void 0&&(n={}),this.bufferList.length!==0){var i={};n.color&&(this.volume?Object.assign(i,{color:this.volume.getDataColor(this.getColorParams())}):Object.assign(i,{color:this.surface.getColor(this.getColorParams())})),this.dotType==="sphere"&&(n.radius||n.scale)&&(this.volume?Object.assign(i,{radius:this.volume.getDataSize(this.radius,this.scale)}):Object.assign(i,{radius:this.surface.getSize(this.radius,this.scale)})),this.dotBuffer.setAttributes(i)}},t.prototype.setParameters=function(n,i,r){return i===void 0&&(i={}),n&&n.thresholdType!==void 0&&this.volume instanceof Xt&&(this.thresholdType==="value"&&n.thresholdType==="sigma"?(this.thresholdMin=this.volume.getSigmaForValue(this.thresholdMin),this.thresholdMax=this.volume.getSigmaForValue(this.thresholdMax)):this.thresholdType==="sigma"&&n.thresholdType==="value"&&(this.thresholdMin=this.volume.getValueForSigma(this.thresholdMin),this.thresholdMax=this.volume.getValueForSigma(this.thresholdMax)),this.thresholdType=n.thresholdType),n&&n.radiusType!==void 0&&(n.radiusType==="radius"?this.radius=.1:this.radius=parseFloat(n.radiusType),i.radius=!0,this.dotType!=="sphere"||Fo&&!this.disableImpostor||(r=!0)),n&&n.radius!==void 0&&(i.radius=!0,this.dotType!=="sphere"||Fo&&!this.disableImpostor||(r=!0)),n&&n.scale!==void 0&&(i.scale=!0,this.dotType!=="sphere"||Fo&&!this.disableImpostor||(r=!0)),e.prototype.setParameters.call(this,n,i,r),this},t}(Un);jt.add("shader/Image.vert",`uniform float clipRadius;
uniform vec3 clipCenter;
varying vec2 vUv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
void main() {
#include begin_vertex
#include project_vertex
vUv = uv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
}`),jt.add("shader/Image.frag",`uniform sampler2D map;
uniform float opacity;
uniform vec2 mapSize;
uniform float clipNear;
uniform float clipRadius;
varying vec2 vUv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform sampler2D pickingMap;
uniform float objectId;
#else
#include fog_pars_fragment
#endif
#if defined( CUBIC_INTERPOLATION )
#if defined( CATMULROM_FILTER ) || defined( MITCHELL_FILTER )
#if defined( CATMULROM_FILTER )
const float B = 0.0;
const float C = 0.5;
#elif defined( MITCHELL_FILTER )
const float B = 0.333;
const float C = 0.333;
#endif
float filter( float x ){
float f = x;
if( f < 0.0 ){
f = -f;
}
if( f < 1.0 ){
return ( ( 12.0 - 9.0 * B - 6.0 * C ) * ( f * f * f ) +
( -18.0 + 12.0 * B + 6.0 *C ) * ( f * f ) +
( 6.0 - 2.0 * B ) ) / 6.0;
}else if( f >= 1.0 && f < 2.0 ){
return ( ( -B - 6.0 * C ) * ( f * f * f )
+ ( 6.0 * B + 30.0 * C ) * ( f *f ) +
( - ( 12.0 * B ) - 48.0 * C ) * f +
8.0 * B + 24.0 * C ) / 6.0;
}else{
return 0.0;
}
}
#elif defined( BSPLINE_FILTER )
float filter( float x ){
float f = x;
if( f < 0.0 ){
f = -f;
}
if( f >= 0.0 && f <= 1.0 ){
return ( 2.0 / 3.0 ) + ( 0.5 ) * ( f * f * f ) - ( f * f );
}else if( f > 1.0 && f <= 2.0 ){
return 1.0 / 6.0 * pow( ( 2.0 - f ), 3.0 );
}
return 1.0;
}
#else
float filter( float x ){
return 1.0;
}
#endif
vec4 biCubic( sampler2D tex, vec2 texCoord ){
vec2 texelSize = 1.0 / mapSize;
texCoord -= texelSize / 2.0;
vec4 nSum = vec4( 0.0 );
float nDenom = 0.0;
vec2 cell = fract( texCoord * mapSize );
for( float m = -1.0; m <= 2.0; ++m ){
for( float n = -1.0; n <= 2.0; ++n ){
vec4 vecData = texture2D(
tex, texCoord + texelSize * vec2( m, n )
);
float c = filter( m - cell.x ) * filter( -n + cell.y );
nSum += vecData * c;
nDenom += c;
}
}
return nSum / nDenom;
}
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( CUBIC_INTERPOLATION )
gl_FragColor = biCubic( map, vUv );
#else
gl_FragColor = texture2D( map, vUv );
#endif
#if defined( PICKING )
if( gl_FragColor.a < 0.3 )
discard;
gl_FragColor = vec4( texture2D( pickingMap, vUv ).xyz, objectId );
#else
if( gl_FragColor.a < 0.01 )
discard;
gl_FragColor.a *= opacity;
#include fog_fragment
#endif
}`);var T6=new Uint16Array([0,1,2,1,3,2]),E6=new Float32Array([0,1,0,0,1,1,1,0]),I6=Object.assign({filter:"nearest",forceTransparent:!0},Vi),L6=Object.assign({filter:{updateShader:!0,uniform:!0}},kc),R6=function(e){function t(i,r){e.call(this,{position:i.position,index:T6,picking:i.picking},r),this.parameterTypes=L6,this.alwaysTransparent=!0,this.hasWireframe=!1,this.vertexShader="Image.vert",this.fragmentShader="Image.frag";var o=i.imageData,s=i.width,a=i.height,c=new xs(o,s,a);c.flipY=!0,this.tex=c;for(var l=o.length,u=new Uint8Array(l),h=0;h<l;h+=4){var f=h/4;u[h]=f>>16&255,u[h+1]=f>>8&255,u[h+2]=255&f}var p=new xs(u,s,a);p.flipY=!0,p.minFilter=ln,p.magFilter=ln,this.pickingTex=p,this.addUniforms({map:{value:c},pickingMap:{value:p},mapSize:{value:new Ee(s,a)}}),this.geometry.setAttribute("uv",new rt(E6,2))}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultParameters:{configurable:!0}};return n.defaultParameters.get=function(){return I6},t.prototype.getDefines=function(i){var r=e.prototype.getDefines.call(this,i),o=this.parameters.filter;return o.startsWith("cubic")&&(r.CUBIC_INTERPOLATION=1,o.endsWith("bspline")?r.BSPLINE_FILTER=1:o.endsWith("catmulrom")?r.CATMULROM_FILTER=1:o.endsWith("mitchell")&&(r.MITCHELL_FILTER=1)),r},t.prototype.updateTexture=function(){var i=this.tex,r=this.parameters.filter;r.startsWith("cubic")?(i.minFilter=ln,i.magFilter=ln):r==="linear"?(i.minFilter=Xn,i.magFilter=Xn):(i.minFilter=ln,i.magFilter=ln),i.needsUpdate=!0,this.pickingTex.needsUpdate=!0},t.prototype.makeMaterial=function(){e.prototype.makeMaterial.call(this),this.updateTexture();var i=this.material;i.uniforms.map.value=this.tex,i.blending=ma,i.needsUpdate=!0;var r=this.wireframeMaterial;r.uniforms.map.value=this.tex,r.blending=ma,r.needsUpdate=!0;var o=this.pickingMaterial;o.uniforms.map.value=this.tex,o.uniforms.pickingMap.value=this.pickingTex,o.blending=ma,o.needsUpdate=!0},t.prototype.setUniforms=function(i){i&&i.filter!==void 0&&(this.updateTexture(),i.map=this.tex),e.prototype.setUniforms.call(this,i)},Object.defineProperties(t.prototype,n),t}(Bt),sb=function(e,t){var n=t||{};this.dimension=O(n.dimension,"x"),this.positionType=O(n.positionType,"percent"),this.position=O(n.position,30),this.thresholdType=O(n.thresholdType,"sigma"),this.thresholdMin=O(n.thresholdMin,-1/0),this.thresholdMax=O(n.thresholdMax,1/0),this.normalize=O(n.normalize,!1),this.volume=e};sb.prototype.getPositionFromCoordinate=function(e){var t,n=this.dimension,i=this.volume,r=i.matrix,o=new T().setFromMatrixPosition(r)[n],s=new T().setFromMatrixScale(r)[n];return t=n==="x"?i.nx:n==="y"?i.ny:i.nz,Math.round(((e-o)/(t/100)+1)/s)},sb.prototype.getData=function(e){e=e||{};var t,n=this.volume,i=n.data,r=n.matrix;function o(se){return Math.round(se/100*(t-1))}function s(se,ue,H,j){return 3*(H*n.ny*n.nx+ue*n.nx+se)+j}t=this.positionType==="coordinate"?this.getPositionFromCoordinate(this.position):this.position;var a,c,l,u,h,f=new Float32Array(12),p=new T,m=0,y=0,v=0,d=n.nx,g=n.ny,b=n.nz;function x(se,ue,H,j){p.set(se,ue,H).applyMatrix4(r).toArray(f,j)}this.dimension==="x"?(l=o(n.nx),u=n.ny-1,h=n.nz-1,a=n.nz,c=n.ny,d=(m=l)+1,x(l,0,0,0),x(l,u,0,3),x(l,0,h,6),x(l,u,h,9)):this.dimension==="y"?(l=n.nx-1,u=o(n.ny),h=n.nz-1,a=n.nz,c=n.nx,g=(y=u)+1,x(0,u,0,0),x(l,u,0,3),x(0,u,h,6),x(l,u,h,9)):this.dimension==="z"&&(l=n.nx-1,u=n.ny-1,h=o(n.nz),a=n.nx,c=n.ny,b=(v=h)+1,x(0,0,h,0),x(0,u,h,3),x(l,0,h,6),x(l,u,h,9));var _,S,w=0,C=0,A=new Uint8Array(a*c*4),k=new Float32Array(a*c);this.thresholdType==="sigma"?(_=n.getValueForSigma(this.thresholdMin),S=n.getValueForSigma(this.thresholdMax)):(_=this.thresholdMin,S=this.thresholdMax);var L=Object.assign({},e.colorParams,{volume:n});this.normalize&&(L.domain=[0,1]);var D,F=Rt.getScheme(L),I=new Float32Array(3),P=F.getScale(),N=0,$=0;if(this.normalize){N=1/0,D=-1/0;for(var B=y;B<g;++B)for(var q=m;q<d;++q)for(var ee=v;ee<b;++ee){var W=i[s(q,B,ee,0)/3];W<N&&(N=W),W>D&&(D=W)}$=D-N}for(var Q=y;Q<g;++Q)for(var Z=m;Z<d;++Z)for(var re=v;re<b;++re){var he=s(Z,Q,re,0)/3,K=i[he];this.normalize&&(K=(K-N)/$),F.colorToArray(P(K),I),A[w]=Math.round(255*I[0]),A[w+1]=Math.round(255*I[1]),A[w+2]=Math.round(255*I[2]),A[w+3]=K>_&&K<S?255:0,k[C]=he,++C,w+=4}var ce=new jN(k,n);return{position:f,imageData:A,width:a,height:c,picking:ce}};var O6=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="slice",this.parameters=Object.assign({filter:{type:"select",buffer:!0,options:{nearest:"nearest",linear:"linear","cubic-bspline":"cubic-bspline","cubic-catmulrom":"cubic-catmulrom","cubic-mitchell":"cubic-mitchell"}},positionType:{type:"select",rebuild:!0,options:{percent:"percent",coordinate:"coordinate"}},position:{type:"range",step:.1,max:100,min:1,rebuild:!0},dimension:{type:"select",rebuild:!0,options:{x:"x",y:"y",z:"z"}},thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},normalize:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null,linewidth:null,colorScheme:null,roughness:null,metalness:null,diffuse:null}),this.volume=n,this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=this.volume,r=n||{};r.colorDomain=O(r.colorDomain,[i.min,i.max]),r.colorScheme=O(r.colorScheme,"value"),r.colorScale=O(r.colorScale,"Spectral"),this.colorScheme="value",this.dimension=O(r.dimension,"x"),this.filter=O(r.filter,"cubic-bspline"),this.positionType=O(r.positionType,"percent"),this.position=O(r.position,30),this.thresholdType=O(r.thresholdType,"sigma"),this.thresholdMin=O(r.thresholdMin,-1/0),this.thresholdMax=O(r.thresholdMax,1/0),this.normalize=O(r.normalize,!1),e.prototype.init.call(this,r),this.build()},t.prototype.attach=function(n){var i=this;this.bufferList.forEach(function(r){i.viewer.add(r)}),this.setVisibility(this.visible),n()},t.prototype.create=function(){var n=new sb(this.volume,{positionType:this.positionType,position:this.position,dimension:this.dimension,thresholdType:this.thresholdType,thresholdMin:this.thresholdMin,thresholdMax:this.thresholdMax,normalize:this.normalize}),i=new R6(n.getData({colorParams:this.getColorParams()}),this.getBufferParams({filter:this.filter}));this.bufferList.push(i)},t}(Un);function gy(e){de.error("makeRepresentation: representation type "+e+" unknown")}var G_={name:"some element",status:""},Dl=function(e,t){t===void 0&&(t={}),this.stage=e,this.signals={statusChanged:new yt.Signal,nameChanged:new yt.Signal,disposed:new yt.Signal},this.parameters=br(t,this.defaultParameters),this.uuid=T_()},yy={defaultParameters:{configurable:!0},name:{configurable:!0}};yy.defaultParameters.get=function(){return G_},yy.name.get=function(){return this.parameters.name},Dl.prototype.setStatus=function(e){return this.parameters.status=e,this.signals.statusChanged.dispatch(e),this},Dl.prototype.setName=function(e){return this.parameters.name=e,this.signals.nameChanged.dispatch(e),this},Dl.prototype.dispose=function(){this.signals.disposed.dispatch()},Object.defineProperties(Dl.prototype,yy);var k6=Object.assign({visible:!0},G_),D6=function(e){function t(i,r,o,s){o===void 0&&(o={}),e.call(this,i,Object.assign({name:r.type},o)),this.parent=s,this.signals=Object.assign({visibilityChanged:new yt.Signal,parametersChanged:new yt.Signal},this.signals),this.setRepresentation(r)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultParameters:{configurable:!0},visible:{configurable:!0},type:{configurable:!0}};return n.defaultParameters.get=function(){return k6},n.visible.get=function(){return this.parameters.visible},n.type.get=function(){return"representation"},t.prototype.getType=function(){return this.repr.type},t.prototype.setRepresentation=function(i){this._disposeRepresentation(),this.repr=i,this.stage.tasks.listen(this.repr.tasks),this.updateVisibility()},t.prototype._disposeRepresentation=function(){this.repr&&(this.stage.tasks.unlisten(this.repr.tasks),this.repr.dispose())},t.prototype.dispose=function(){this.parent&&this.parent.hasRepresentation(this)?this.parent.removeRepresentation(this):(this._disposeRepresentation(),this.signals.disposed.dispatch())},t.prototype.setVisibility=function(i){return this.parameters.visible=i,this.updateVisibility(),this.signals.visibilityChanged.dispatch(this.parameters.visible),this},t.prototype.getVisibility=function(){return this.parent?this.parent.parameters.visible&&this.parameters.visible:this.parameters.visible},t.prototype.toggleVisibility=function(){return this.setVisibility(!this.parameters.visible)},t.prototype.updateVisibility=function(){this.repr.setVisibility(this.getVisibility())},t.prototype.update=function(i){return this.repr.update(i),this},t.prototype.build=function(i){return this.repr.build(i),this},t.prototype.setSelection=function(i){var r=this.repr;return r.setSelection&&r.setSelection(i),this},t.prototype.setParameters=function(i){return this.repr.setParameters(i),this.signals.parametersChanged.dispatch(this.repr.getParameters()),this},t.prototype.getParameters=function(){return this.repr.getParameters()},t.prototype.setColor=function(i){return this.repr.setColor(i),this},Object.defineProperties(t.prototype,n),t}(Dl),el=new De,B6=new T,oE={name:"",status:"",visible:!0},qt=function(e,t,n){n===void 0&&(n={}),this.stage=e,this.object=t,this.signals={representationAdded:new yt.Signal,representationRemoved:new yt.Signal,visibilityChanged:new yt.Signal,matrixChanged:new yt.Signal,statusChanged:new yt.Signal,nameChanged:new yt.Signal,disposed:new yt.Signal},this.reprList=[],this.annotationList=[],this.matrix=new De,this.position=new T,this.quaternion=new un,this.scale=new T(1,1,1),this.transform=new De,this.parameters=br(n,this.defaultParameters),this.uuid=T_(),this.viewer=e.viewer,this.controls=new _m(this)},ph={defaultParameters:{configurable:!0},name:{configurable:!0},status:{configurable:!0},visible:{configurable:!0}};ph.defaultParameters.get=function(){return oE},ph.name.get=function(){return this.parameters.name},ph.status.get=function(){return this.parameters.status},ph.visible.get=function(){return this.parameters.visible},qt.prototype.setPosition=function(e){return Array.isArray(e)?this.position.fromArray(e):this.position.copy(e),this.updateMatrix(),this},qt.prototype.setRotation=function(e){if(Array.isArray(e))if(e.length===3){var t=new Sa().fromArray(e);this.quaternion.setFromEuler(t)}else this.quaternion.fromArray(e);else e instanceof Sa?this.quaternion.setFromEuler(e):this.quaternion.copy(e);return this.updateMatrix(),this},qt.prototype.setScale=function(e){return this.scale.set(e,e,e),this.updateMatrix(),this},qt.prototype.setTransform=function(e){return this.transform.copy(e),this.updateMatrix(),this},qt.prototype.updateMatrix=function(){var e=this.getCenterUntransformed(B6);this.matrix.makeTranslation(-e.x,-e.y,-e.z),el.makeRotationFromQuaternion(this.quaternion),this.matrix.premultiply(el),el.makeScale(this.scale.x,this.scale.y,this.scale.z),this.matrix.premultiply(el);var t=this.position;el.makeTranslation(t.x+e.x,t.y+e.y,t.z+e.z),this.matrix.premultiply(el),this.matrix.premultiply(this.transform),this.updateRepresentationMatrices(),this.stage.viewer.updateBoundingBox(),this.signals.matrixChanged.dispatch(this.matrix)},qt.prototype.updateRepresentationMatrices=function(){var e=this;this.reprList.forEach(function(t){t.setParameters({matrix:e.matrix})})},qt.prototype.addAnnotation=function(e,t,n){var i=new Zs(this,e,t,n);return this.annotationList.push(i),i},qt.prototype.eachAnnotation=function(e){this.annotationList.slice().forEach(e)},qt.prototype.removeAnnotation=function(e){var t=this.annotationList.indexOf(e);t!==-1&&(this.annotationList.splice(t,1),e.dispose())},qt.prototype.removeAllAnnotations=function(){this.eachAnnotation(function(e){return e.dispose()}),this.annotationList.length=0},qt.prototype._addRepresentation=function(e,t,n,i){i===void 0&&(i=!1);var r=n||{},o=this.stage.getParameters();r.matrix=this.matrix.clone(),r.quality=r.quality||o.quality,r.disableImpostor=O(r.disableImpostor,!o.impostor),r.useWorker=O(r.useWorker,o.workerDefault),r.visible=O(r.visible,!0);var s=Object.assign({},r,{visible:this.parameters.visible&&r.visible}),a=function(l,u,h,f){var p;if(Pe&&de.time("makeRepresentation "+l),u instanceof ut){if(!(p=yn.get(l)))return void gy(l)}else if(u instanceof Si)if(l==="surface")p=tb;else{if(l!=="dot")return void gy(l);p=WS}else if(u instanceof Xt)if(l==="surface")p=tb;else if(l==="dot")p=WS;else{if(l!=="slice")return void gy(l);p=O6}else if(u instanceof Zn)p=VS,u=u.getBufferList();else{if(l!=="buffer")return void de.error("makeRepresentation: object "+u+" unknown");p=VS}var m=new p(u,h,f);return Pe&&de.timeEnd("makeRepresentation "+l),m}(e,t,this.viewer,s),c=new D6(this.stage,a,r,this);return i||(this.reprList.push(c),this.signals.representationAdded.dispatch(c)),c},qt.prototype.addBufferRepresentation=function(e,t){return this._addRepresentation.call(this,"buffer",e,t)},qt.prototype.hasRepresentation=function(e){return this.reprList.indexOf(e)!==-1},qt.prototype.eachRepresentation=function(e){this.reprList.slice().forEach(e)},qt.prototype.removeRepresentation=function(e){var t=this.reprList.indexOf(e);t!==-1&&(this.reprList.splice(t,1),e.dispose(),this.signals.representationRemoved.dispatch(e))},qt.prototype.updateRepresentations=function(e){this.reprList.forEach(function(t){return t.update(e)}),this.stage.viewer.requestRender()},qt.prototype.removeAllRepresentations=function(){this.eachRepresentation(function(e){return e.dispose()})},qt.prototype.dispose=function(){this.removeAllAnnotations(),this.removeAllRepresentations(),this.reprList.length=0,this.signals.disposed.dispatch()},qt.prototype.setVisibility=function(e){return this.parameters.visible=e,this.eachRepresentation(function(t){return t.updateVisibility()}),this.eachAnnotation(function(t){return t.updateVisibility()}),this.signals.visibilityChanged.dispatch(e),this},qt.prototype.setStatus=function(e){return this.parameters.status=e,this.signals.statusChanged.dispatch(e),this},qt.prototype.setName=function(e){return this.parameters.name=e,this.signals.nameChanged.dispatch(e),this},qt.prototype.getBox=function(){for(var e,t=[],n=arguments.length;n--;)t[n]=arguments[n];return(e=this).getBoxUntransformed.apply(e,t).clone().applyMatrix4(this.matrix)},qt.prototype.getCenter=function(){for(var e,t=[],n=arguments.length;n--;)t[n]=arguments[n];return(e=this).getCenterUntransformed.apply(e,t).clone().applyMatrix4(this.matrix)},qt.prototype.getZoom=function(){for(var e,t=[],n=arguments.length;n--;)t[n]=arguments[n];return this.stage.getZoomForBox((e=this).getBox.apply(e,t))},qt.prototype.getBoxUntransformed=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return new hn},qt.prototype.getCenterUntransformed=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return this.getBoxUntransformed().getCenter(new T)},qt.prototype.autoView=function(e){this.stage.animationControls.zoomMove(this.getCenter(),this.getZoom(),O(e,0))},Object.defineProperties(qt.prototype,ph);var Bl=function(e){e===void 0&&(e=[]),this.list=e;for(var t=e.length,n=0;n<t;++n)e[n].signals.disposed.add(this._remove,this)},qS={first:{configurable:!0}};Bl.prototype._remove=function(e){var t=this.list.indexOf(e);t!==-1&&this.list.splice(t,1)},qS.first.get=function(){return this.list.length>0?this.list[0]:void 0},Bl.prototype.forEach=function(e){return this.list.forEach(e),this},Bl.prototype.dispose=function(){return this.forEach(function(e){return e.dispose()})},Object.defineProperties(Bl.prototype,qS);var sE=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setParameters=function(n){return this.forEach(function(i){return i.setParameters(n)})},t.prototype.setVisibility=function(n){return this.forEach(function(i){return i.setVisibility(n)})},t.prototype.setSelection=function(n){return this.forEach(function(i){return i.setSelection(n)})},t.prototype.setColor=function(n){return this.forEach(function(i){return i.setColor(n)})},t.prototype.update=function(n){return this.forEach(function(i){return i.update(n)})},t.prototype.build=function(n){return this.forEach(function(i){return i.build(n)})},t.prototype.dispose=function(n){return this.forEach(function(i){return i.dispose()})},t}(Bl),F6=Object.assign({defaultStep:1,defaultTimeout:50,defaultInterpolateType:"",defaultInterpolateStep:5,defaultMode:"loop",defaultDirection:"forward",initialFrame:0},G_),N6=function(e){function t(i,r,o){var s=this;o===void 0&&(o={}),e.call(this,i,Object.assign({name:r.name},o)),this.trajectory=r,this.signals=Object.assign(this.signals,{frameChanged:new yt.Signal,playerChanged:new yt.Signal,countChanged:new yt.Signal,parametersChanged:new yt.Signal}),r.signals.frameChanged.add(function(a){s.signals.frameChanged.dispatch(a)}),r.signals.playerChanged.add(function(a){s.signals.playerChanged.dispatch(a)}),r.signals.countChanged.add(function(a){s.signals.countChanged.dispatch(a)}),o.initialFrame!==void 0&&this.setFrame(o.initialFrame)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultParameters:{configurable:!0},type:{configurable:!0}};return n.defaultParameters.get=function(){return F6},n.type.get=function(){return"trajectory"},t.prototype.setFrame=function(i){this.trajectory.setFrame(i)},t.prototype.setParameters=function(i){i===void 0&&(i={}),this.trajectory.setParameters(i),this.signals.parametersChanged.dispatch(i)},t.prototype.dispose=function(){this.trajectory.dispose(),e.prototype.dispose.call(this)},Object.defineProperties(t.prototype,n),t}(Dl),$_=function(e,t){this.name=e,this.path=t,this.coordinates=[],this.boxes=[],this.times=[],this.timeOffset=0,this.deltaTime=1},XS={type:{configurable:!0}};XS.type.get=function(){return"Frames"},Object.defineProperties($_.prototype,XS);var Qh=function(e,t){var n,i;if(this.A=new Yt(3,3),this.W=new Yt(1,3),this.U=new Yt(3,3),this.V=new Yt(3,3),this.VH=new Yt(3,3),this.R=new Yt(3,3),this.tmp=new Yt(3,3),this.c=new Yt(3,3),e instanceof ut)n=e.atomCount;else{if(!(e instanceof Float32Array))return;n=e.length/3}if(t instanceof ut)i=t.atomCount;else{if(!(t instanceof Float32Array))return;i=t.length/3}var r=Math.min(n,i),o=new Yt(3,r),s=new Yt(3,r);this.coords1t=new Yt(r,3),this.coords2t=new Yt(r,3),this.transformationMatrix=new De,this.c.data.set([1,0,0,0,1,0,0,0,-1]),this.prepCoords(e,o,r,!1),this.prepCoords(t,s,r,!1),this._superpose(o,s)};Qh.prototype._superpose=function(e,t){var n,i,r,o,s,a,c,l,u,h,f,p,m,y,v,d,g,b,x,_,S,w;this.mean1=Zx(e),this.mean2=Zx(t),Kx(e,this.mean1),Kx(t,this.mean2),io(this.coords1t,e),io(this.coords2t,t),vm(this.A,this.coords2t,this.coords1t),WT(this.A,this.W,this.U,this.V),n=this.V,i=this.VH,r=n.data,o=i.data,s=r[4],a=r[8],c=r[5],l=r[7],u=r[0],h=u*s,f=u*c,p=r[3],m=r[1],y=p*m,v=r[2],d=p*v,g=r[6],_=1/(h*a-f*l-y*a+d*l+(b=g*m)*c-(x=g*v)*s),o[0]=(s*a-c*l)*_,o[1]=-(m*a-v*l)*_,o[2]=-(-m*c+v*s)*_,o[3]=-(p*a-c*g)*_,o[4]=(u*a-x)*_,o[5]=-(f-d)*_,o[6]=-(-p*l+s*g)*_,o[7]=-(u*l-b)*_,o[8]=(h-y)*_,ly(this.R,this.U,this.VH),S=this.R,(w=S.data)[0]*w[4]*w[8]-w[0]*w[5]*w[7]-w[3]*w[1]*w[8]+w[3]*w[2]*w[7]+w[6]*w[1]*w[5]-w[6]*w[2]*w[4]<0&&(Pe&&de.log("R not a right handed system"),ly(this.tmp,this.c,this.VH),ly(this.R,this.U,this.tmp));var C=new Yt(4,4),A=new Yt(4,4),k=new Yt(4,4),L=new Yt(4,4),D=new Yt(4,4),F=new Yt(4,4),I=this.R.data,P=this.mean1,N=this.mean2;L.data.set([1,0,0,-P[0],0,1,0,-P[1],0,0,1,-P[2],0,0,0,1]),D.data.set([I[0],I[1],I[2],0,I[3],I[4],I[5],0,I[6],I[7],I[8],0,0,0,0,1]),F.data.set([1,0,0,N[0],0,1,0,N[1],0,0,1,N[2],0,0,0,1]),io(A,L),vm(C,D,A),io(k,C),vm(A,F,k),io(C,A),this.transformationMatrix.elements=C.data},Qh.prototype.prepCoords=function(e,t,n,i){var r=0,o=t.data,s=3,a=3*n;if(i&&(a=4*n,s=4),e instanceof ut)e.eachAtom(function(c){r<a&&(o[r+0]=c.x,o[r+1]=c.y,o[r+2]=c.z,i&&(o[r+3]=1),r+=s)});else if(e instanceof Float32Array)for(;r<a;r+=s)r<a&&(o[r]=e[r],o[r+1]=e[r+1],o[r+2]=e[r+2],i&&(o[r+3]=1));else de.warn("prepCoords: input type unknown")},Qh.prototype.transform=function(e){var t;if(e instanceof ut)t=e.atomCount;else{if(!(e instanceof Float32Array))return;t=e.length/3}var n=new Yt(4,t),i=new Yt(t,4);this.prepCoords(e,n,t,!0);var r=this.transformationMatrix,o=r.determinant();if(!o)return o;var s=new Yt(4,4);s.data=r.elements,function(p,m,y){for(var v=0,d=0,g=0,b=0,x=0,_=0,S=0,w=0,C=m.cols,A=m.rows,k=y.cols,L=m.data,D=y.data,F=p.data,I=0;v<A;b+=C,v++)for(S=0,d=0;d<k;w++,S++,d++){for(_=S,x=b,I=0,g=0;g<C;x++,_+=k,g++)I+=L[x]*D[_];F[w]=I}}(i,n,s);var a=0,c=i.data;if(e instanceof ut){e.eachAtom(function(p){p.x=c[a],p.y=c[a+1],p.z=c[a+2],a+=4});var l=new De;l.getInverse(r);var u=e.biomolDict;for(var h in u)u.hasOwnProperty(h)&&u[h].partList.forEach(function(p){p.matrixList.forEach(function(m){m.premultiply(r),m.multiply(l)})})}else if(e instanceof Float32Array)for(var f=4*t;a<f;a+=4)e[a]=c[a],e[a+1]=c[a+1],e[a+2]=c[a+2];else de.warn("transform: input type unknown");return this.transformationMatrix};var z6={step:1,timeout:50,start:0,end:0,interpolateType:"",interpolateStep:5,mode:"loop",direction:"forward"},Co=function(e,t){var n=this;t===void 0&&(t={}),this.signals={startedRunning:new yt.Signal,haltedRunning:new yt.Signal},this._run=!1,this._previousTime=0,this._currentTime=0,this._currentStep=1,e.signals.playerChanged.add(function(r){r!==n&&n.pause()},this);var i=O(e.frameCount,1);this.traj=e,this.parameters=br(t,z6),this.parameters.end=Math.min(O(t.end,i-1),i-1),this.parameters.step=O(t.step,Math.ceil((i+1)/100)),this._currentFrame=this.parameters.start,this._direction=this.parameters.direction==="bounce"?"forward":this.parameters.direction,e.signals.countChanged.add(function(r){n.parameters.end=Math.min(O(n.parameters.end,r-1),r-1)},this),this._animate=this._animate.bind(this)},YS={isRunning:{configurable:!0}};YS.isRunning.get=function(){return this._run},Co.prototype.setParameters=function(e){e===void 0&&(e={}),mT(this.parameters,e),e.direction!==void 0&&this.parameters.direction!=="bounce"&&(this._direction=this.parameters.direction)},Co.prototype._animate=function(){if(this._run){this._currentTime=window.performance.now();var e=this._currentTime-this._previousTime,t=this.parameters.interpolateType?this.parameters.interpolateStep:1,n=this.parameters.timeout/t,i=this.traj;if(i&&i.frameCount&&!i.inProgress&&e>=n)if(this.parameters.interpolateType)if(this._currentStep>this.parameters.interpolateStep&&(this._currentStep=1),this._currentStep===1&&(this._currentFrame=this._nextInterpolated()),i.hasFrame(this._currentFrame)){this._currentStep+=1;var r=this._currentStep/(this.parameters.interpolateStep+1),o=this._currentFrame,s=o[0],a=o[1],c=o[2],l=o[3];i.setFrameInterpolated(s,a,c,l,r,this.parameters.interpolateType),this._previousTime=this._currentTime}else i.loadFrame(this._currentFrame);else{var u=this._next();i.hasFrame(u)?(i.setFrame(u),this._previousTime=this._currentTime):i.loadFrame(u)}window.requestAnimationFrame(this._animate)}},Co.prototype._next=function(){var e,t=this.parameters;return((e=this._direction==="forward"?this.traj.currentFrame+t.step:this.traj.currentFrame-t.step)>t.end||e<t.start)&&(t.direction==="bounce"&&(this._direction==="forward"?this._direction="backward":this._direction="forward"),t.mode==="once"?(this.pause(),e=t.direction==="forward"?t.end:t.direction==="backward"||this._direction==="forward"?t.start:t.end):this._direction==="forward"?(e=t.start,t.interpolateType&&(e=Math.min(t.end,e+t.step))):(e=t.end,t.interpolateType&&(e=Math.max(t.start,e-t.step)))),e},Co.prototype._nextInterpolated=function(){var e,t,n,i=this.parameters,r=this._next();return this._direction==="forward"?(e=Math.max(i.start,r-i.step),t=Math.max(i.start,r-2*i.step),n=Math.max(i.start,r-3*i.step)):(e=Math.min(i.end,r+i.step),t=Math.min(i.end,r+2*i.step),n=Math.min(i.end,r+3*i.step)),[r,e,t,n]},Co.prototype.toggle=function(){this._run?this.pause():this.play()},Co.prototype.play=function(){if(!this._run){this.traj.player!==this&&this.traj.setPlayer(this),this._currentStep=1;var e=this.parameters,t=this.traj.currentFrame,n=Math.ceil(t/e.step)*e.step;e.direction==="forward"&&t>=e.end?n=e.start:e.direction==="backward"&&t<=e.start&&(n=e.end),this.traj.setFrame(n),this._run=!0,this._animate(),this.signals.startedRunning.dispatch()}},Co.prototype.pause=function(){this._run=!1,this.signals.haltedRunning.dispatch()},Co.prototype.stop=function(){this.pause(),this.traj.setFrame(this.parameters.start)},Object.defineProperties(Co.prototype,YS);var en=function(e,t,n){var i=this;n===void 0&&(n={}),this.signals={countChanged:new yt.Signal,frameChanged:new yt.Signal,playerChanged:new yt.Signal},this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this._frameCount=0,this._currentFrame=-1,this._disposed=!1,this.deltaTime=O(n.deltaTime,0),this.timeOffset=O(n.timeOffset,0),this.centerPbc=O(n.centerPbc,!1),this.removePbc=O(n.removePbc,!1),this.removePeriodicity=O(n.removePeriodicity,!1),this.superpose=O(n.superpose,!1),this.name=e.replace(/^.*[\\/]/,""),this.trajPath=e,this.selection=new Jt(O(n.sele,"backbone and not hydrogen")),this.selection.signals.stringChanged.add(function(){i.selectionIndices=i.structure.getAtomIndices(i.selection),i._resetCache(),i._saveInitialCoords(),i.setFrame(i._currentFrame)})},vy={frameCount:{configurable:!0},currentFrame:{configurable:!0}};vy.frameCount.get=function(){return this._frameCount},vy.currentFrame.get=function(){return this._currentFrame},en.prototype._init=function(e){this.setStructure(e),this._loadFrameCount(),this.setPlayer(new Co(this))},en.prototype._loadFrameCount=function(){},en.prototype.setStructure=function(e){this.structure=e,this.atomCount=e.atomCount,this.backboneIndices=this._getIndices(new Jt("backbone and not hydrogen")),this._makeAtomIndices(),this._saveStructureCoords(),this.selectionIndices=this._getIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)},en.prototype._saveInitialCoords=function(){var e=this;this.structure.hasCoords()?(this.initialCoords=new Float32Array(this.structureCoords),this._makeSuperposeCoords()):this.frameCache[0]?(this.initialCoords=new Float32Array(this.frameCache[0]),this._makeSuperposeCoords()):this.loadFrame(0,function(){return e._saveInitialCoords()})},en.prototype._saveStructureCoords=function(){this.structureCoords=this.structure.getAtomData({what:{position:!0}}).position},en.prototype.setSelection=function(e){return this.selection.setString(e),this},en.prototype._getIndices=function(e){var t=0,n=e.test,i=[];return n&&this.structure.eachAtom(function(r){n(r)&&i.push(t),t+=1}),i},en.prototype._makeSuperposeCoords=function(){var e=3*this.selectionIndices.length;this.coords1=new Float32Array(e),this.coords2=new Float32Array(e);for(var t=this.initialCoords,n=this.coords2,i=0;i<e;i+=3){var r=3*this.selectionIndices[i/3];n[i+0]=t[r+0],n[i+1]=t[r+1],n[i+2]=t[r+2]}},en.prototype._makeAtomIndices=function(){de.error("Trajectory._makeAtomIndices not implemented")},en.prototype._resetCache=function(){this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this.initialCoords=new Float32Array(0)},en.prototype.setParameters=function(e){e===void 0&&(e={});var t=!1;e.centerPbc!==void 0&&e.centerPbc!==this.centerPbc&&(this.centerPbc=e.centerPbc,t=!0),e.removePeriodicity!==void 0&&e.removePeriodicity!==this.removePeriodicity&&(this.removePeriodicity=e.removePeriodicity,t=!0),e.removePbc!==void 0&&e.removePbc!==this.removePbc&&(this.removePbc=e.removePbc,t=!0),e.superpose!==void 0&&e.superpose!==this.superpose&&(this.superpose=e.superpose,t=!0),this.deltaTime=O(e.deltaTime,this.deltaTime),this.timeOffset=O(e.timeOffset,this.timeOffset),t&&(this._resetCache(),this.setFrame(this._currentFrame))},en.prototype.hasFrame=function(e){var t=this;return Array.isArray(e)?e.every(function(n){return!!t.frameCache[n]}):!!this.frameCache[e]},en.prototype.setFrame=function(e,t){var n=this;return e===void 0||(this.inProgress=!0,e===-1||this.frameCache[e]?(this._updateStructure(e),t&&t()):this.loadFrame(e,function(){n._updateStructure(e),t&&t()})),this},en.prototype._interpolate=function(e,t,n,i,r,o){var s,a=this.frameCache;s=o==="spline"?function(c,l,u,h,f){for(var p=c.length,m=new Float32Array(p),y=0;y<p;y+=3){var v=y+1,d=y+2;m[y]=as(h[y],u[y],l[y],c[y],f,1),m[v]=as(h[v],u[v],l[v],c[v],f,1),m[d]=as(h[d],u[d],l[d],c[d],f,1)}return m}(a[e],a[t],a[n],a[i],r):function(c,l,u){for(var h=c.length,f=new Float32Array(h),p=0;p<h;p+=3){var m=p+1,y=p+2;f[p]=Tr(l[p],c[p],u),f[m]=Tr(l[m],c[m],u),f[y]=Tr(l[y],c[y],u)}return f}(a[e],a[t],r),this.structure.updatePosition(s),this._currentFrame=e,this.signals.frameChanged.dispatch(e)},en.prototype.setFrameInterpolated=function(e,t,n,i,r,o,s){var a=this;if(e===void 0)return this;var c=this.frameCache,l=[];return c[i]||l.push(i),c[n]||l.push(n),c[t]||l.push(t),c[e]||l.push(e),l.length?this.loadFrame(l,function(){a._interpolate(e,t,n,i,r,o),s&&s()}):(this._interpolate(e,t,n,i,r,o),s&&s()),this},en.prototype.loadFrame=function(e,t){var n=this;Array.isArray(e)?e.forEach(function(i){n.loadQueue[i]||n.frameCache[i]||(n.loadQueue[i]=!0,n._loadFrame(i,function(){delete n.loadQueue[i]}))}):this.loadQueue[e]||this.frameCache[e]||(this.loadQueue[e]=!0,this._loadFrame(e,function(){delete n.loadQueue[e],t&&t()}))},en.prototype._loadFrame=function(e,t){de.error("Trajectory._loadFrame not implemented",e,t)},en.prototype._updateStructure=function(e){this._disposed?console.error("updateStructure: traj disposed"):(e===-1?this.structureCoords&&this.structure.updatePosition(this.structureCoords):this.structure.updatePosition(this.frameCache[e]),this.structure.trajectory={name:this.trajPath,frame:e},this._currentFrame=e,this.inProgress=!1,this.signals.frameChanged.dispatch(e))},en.prototype._doSuperpose=function(e){for(var t=3*this.selectionIndices.length,n=this.coords1,i=this.coords2,r=0;r<t;r+=3){var o=3*this.selectionIndices[r/3];n[r+0]=e[o+0],n[r+1]=e[o+1],n[r+2]=e[o+2]}new Qh(n,i).transform(e)},en.prototype._process=function(e,t,n,i){if(this._setFrameCount(i),t){if(this.backboneIndices.length>0&&this.centerPbc){var r=[t[0],t[4],t[8]],o=function(a,c,l){return[Y1(c,l[0],3,0,a),Y1(c,l[1],3,1,a),Y1(c,l[2],3,2,a)]}(this.backboneIndices,n,r);(function(a,c,l){if(l[0]!==0&&l[8]!==0&&l[4]!==0)for(var u=a.length,h=l[0],f=l[1],p=l[2],m=-c[0]+h+h/2,y=-c[1]+f+f/2,v=-c[2]+p+p/2,d=0;d<u;d+=3)a[d+0]=(a[d+0]+m)%h,a[d+1]=(a[d+1]+y)%f,a[d+2]=(a[d+2]+v)%p})(n,o,r)}if(this.removePeriodicity){var s=function(a){return[dm(a,3,0),dm(a,3,1),dm(a,3,2)]}(n);(function(a,c,l){if(c[0]!==0&&c[8]!==0&&c[4]!==0)for(var u=a.length,h=3;h<u;h+=3)for(var f=0;f<3;++f){var p=(a[h+f]-l[f])/c[3*f+f];Math.abs(p)>.5&&(a[h+f]-=c[3*f+f]*Math.round(p))}})(n,t,s)}this.removePbc&&function(a,c){if(c[0]!==0&&c[8]!==0&&c[4]!==0)for(var l=a.length,u=3;u<l;u+=3)for(var h=0;h<3;++h){var f=a[u+h]-a[u-3+h];if(Math.abs(f)>.9*c[3*h+h])if(f>0)for(var p=0;p<3;++p)a[u+p]-=c[3*h+p];else for(var m=0;m<3;++m)a[u+m]+=c[3*h+m]}}(n,t)}this.selectionIndices.length>0&&this.coords1&&this.superpose&&this._doSuperpose(n),this.frameCache[e]=n,this.boxCache[e]=t,this.frameCacheSize+=1},en.prototype._setFrameCount=function(e){e!==this._frameCount&&(this._frameCount=e,this.signals.countChanged.dispatch(e))},en.prototype.dispose=function(){this._resetCache(),this._disposed=!0,this.player&&this.player.stop()},en.prototype.setPlayer=function(e){this.player=e,this.signals.playerChanged.dispatch(e)},en.prototype.getFrameTime=function(e){return this.timeOffset+e*this.deltaTime},Object.defineProperties(en.prototype,vy);var U6=function(e){function t(i,r,o){var s=o||{};s.timeOffset=O(s.timeOffset,i.timeOffset),s.deltaTime=O(s.deltaTime,i.deltaTime),e.call(this,"",r,s),this.name=i.name,this.path=i.path,this.frames=i.coordinates,this.boxes=i.boxes,this._init(r)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"frames"},t.prototype._makeAtomIndices=function(){this.structure.type==="StructureView"?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0},t.prototype._loadFrame=function(i,r){var o,s=this.frames[i];if(this.atomIndices){var a=this.atomIndices,c=a.length;o=new Float32Array(3*c);for(var l=0;l<c;++l){var u=3*l,h=3*a[l];o[u+0]=s[h+0],o[u+1]=s[h+1],o[u+2]=s[h+2]}}else o=new Float32Array(s);var f=this.boxes[i],p=this.frames.length;this._process(i,f,o,p),typeof r=="function"&&r()},t.prototype._loadFrameCount=function(){this.frames&&this._setFrameCount(this.frames.length)},Object.defineProperties(t.prototype,n),t}(en),G6=function(e){function t(i,r,o){e.call(this,"",r,o),this._init(r)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"structure"},t.prototype._makeAtomIndices=function(){this.structure.atomSet&&this.structure.atomSet.getSize()<this.structure.atomStore.count?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0},t.prototype._loadFrame=function(i,r){var o,s=this.structure,a=s.frames[i];if(this.atomIndices){var c=this.atomIndices,l=c.length;o=new Float32Array(3*l);for(var u=0;u<l;++u){var h=3*u,f=3*c[u];o[h+0]=a[f+0],o[h+1]=a[f+1],o[h+2]=a[f+2]}}else o=new Float32Array(a);var p=s.boxes[i],m=s.frames.length;this._process(i,p,o,m),typeof r=="function"&&r()},t.prototype._loadFrameCount=function(){this._setFrameCount(this.structure.frames.length)},Object.defineProperties(t.prototype,n),t}(en),$6=function(e){function t(i,r,o){e.call(this,i,r,o),this._init(r)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"remote"},t.prototype._makeAtomIndices=function(){var i=[];if(this.structure.type==="StructureView"){for(var r=this.structure.getAtomIndices(),o=r.length,s=r[0],a=r[0],c=1;c<o;++c){var l=r[c];a+1<l&&(i.push([s,a+1]),s=l),a=l}i.push([s,a+1])}else i.push([0,this.atomCount]);this.atomIndices=i},t.prototype._loadFrame=function(i,r){var o=this,s=new XMLHttpRequest,a=j1.getFrameUrl(this.trajPath,i),c=j1.getFrameParams(this.trajPath,this.atomIndices);s.open("POST",a,!0),s.responseType="arraybuffer",s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.addEventListener("load",function(){var l=s.response;if(l){var u=new Int32Array(l,0,1)[0],h=new Float32Array(l,8,9),f=new Float32Array(l,44);o._process(i,h,f,u),typeof r=="function"&&r()}else de.error("empty arrayBuffer for '"+a+"'")},!1),s.send(c)},t.prototype._loadFrameCount=function(){var i=this,r=new XMLHttpRequest,o=j1.getCountUrl(this.trajPath);r.open("GET",o,!0),r.addEventListener("load",function(){i._setFrameCount(parseInt(r.response))},!1),r.send()},Object.defineProperties(t.prototype,n),t}(en),V6=function(e){function t(i,r,o){e.call(this,"",r,o),this.requestCallback=i,this._init(r)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"callback"},t.prototype._makeAtomIndices=function(){var i=[];if(this.structure.type==="StructureView"){for(var r=this.structure.getAtomIndices(),o=r.length,s=r[0],a=r[0],c=1;c<o;++c){var l=r[c];a+1<l&&(i.push([s,a+1]),s=l),a=l}i.push([s,a+1])}else i.push([0,this.atomCount]);this.atomIndices=i},t.prototype._loadFrame=function(i,r){var o=this;this.requestCallback(function(s,a,c,l){o._process(s,a,c,l),typeof r=="function"&&r()},i,this.atomIndices)},t.prototype._loadFrameCount=function(){var i=this;this.requestCallback(function(r){return i._setFrameCount(r)})},Object.defineProperties(t.prototype,n),t}(en);ut.prototype.getView=function(e){return new aE(this,e)};var aE=function(e){function t(i,r){e.call(this),this.structure=i,this.selection=r,this.center=new T,this.boundingBox=new hn,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy(),this.selection&&this.selection.signals.stringChanged.add(this.refresh,this),this.structure.signals.refreshed.add(this.refresh,this),this.refresh()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},name:{configurable:!0},path:{configurable:!0},title:{configurable:!0},id:{configurable:!0},data:{configurable:!0},atomSetDict:{configurable:!0},biomolDict:{configurable:!0},entityList:{configurable:!0},unitcell:{configurable:!0},frames:{configurable:!0},boxes:{configurable:!0},validation:{configurable:!0},bondStore:{configurable:!0},backboneBondStore:{configurable:!0},rungBondStore:{configurable:!0},atomStore:{configurable:!0},residueStore:{configurable:!0},chainStore:{configurable:!0},modelStore:{configurable:!0},atomMap:{configurable:!0},residueMap:{configurable:!0},bondHash:{configurable:!0},spatialHash:{configurable:!0},_hasCoords:{configurable:!0}};return t.prototype.init=function(){},n.type.get=function(){return"StructureView"},n.name.get=function(){return this.structure.name},n.path.get=function(){return this.structure.path},n.title.get=function(){return this.structure.title},n.id.get=function(){return this.structure.id},n.data.get=function(){return this.structure.data},n.atomSetDict.get=function(){return this.structure.atomSetDict},n.biomolDict.get=function(){return this.structure.biomolDict},n.entityList.get=function(){return this.structure.entityList},n.unitcell.get=function(){return this.structure.unitcell},n.frames.get=function(){return this.structure.frames},n.boxes.get=function(){return this.structure.boxes},n.validation.get=function(){return this.structure.validation},n.bondStore.get=function(){return this.structure.bondStore},n.backboneBondStore.get=function(){return this.structure.backboneBondStore},n.rungBondStore.get=function(){return this.structure.rungBondStore},n.atomStore.get=function(){return this.structure.atomStore},n.residueStore.get=function(){return this.structure.residueStore},n.chainStore.get=function(){return this.structure.chainStore},n.modelStore.get=function(){return this.structure.modelStore},n.atomMap.get=function(){return this.structure.atomMap},n.residueMap.get=function(){return this.structure.residueMap},n.bondHash.get=function(){return this.structure.bondHash},n.spatialHash.get=function(){return this.structure.spatialHash},n._hasCoords.get=function(){return this.structure._hasCoords},n._hasCoords.set=function(i){this.structure._hasCoords=i},t.prototype.refresh=function(){Pe&&de.time("StructureView.refresh"),this.atomSetCache={};var i=this.structure;if(this.selection.isAllSelection()&&i!==this&&i.atomSet&&i.bondSet){for(var r in this.atomSet=i.atomSet.clone(),this.bondSet=i.bondSet.clone(),this.atomSetDict){var o=this.atomSetDict[r];this.atomSetCache["__"+r]=o.clone()}this.atomCount=i.atomCount,this.bondCount=i.bondCount,this.boundingBox.copy(i.boundingBox),this.center.copy(i.center)}else if(this.selection.isNoneSelection()&&i!==this&&i.atomSet&&i.bondSet){for(var s in this.atomSet=new gt(i.atomCount),this.bondSet=new gt(i.bondCount),this.atomSetDict)this.atomSetCache["__"+s]=new gt(i.atomCount);this.atomCount=0,this.bondCount=0,this.boundingBox.makeEmpty(),this.center.set(0,0,0)}else{for(var a in this.atomSet=this.getAtomSet(this.selection,!0),i.atomSet&&(this.atomSet=this.atomSet.intersection(i.atomSet)),this.bondSet=this.getBondSet(),this.atomSetDict){var c=this.atomSetDict[a];this.atomSetCache["__"+a]=c.makeIntersection(this.atomSet)}this.atomCount=this.atomSet.getSize(),this.bondCount=this.bondSet.getSize(),this.boundingBox=this.getBoundingBox(),this.center=this.boundingBox.getCenter(new T)}Pe&&de.timeEnd("StructureView.refresh"),this.signals.refreshed.dispatch()},t.prototype.setSelection=function(i){this.selection=i,this.refresh()},t.prototype.getSelection=function(i){var r=[];i&&i.string&&r.push(i.string);var o=this.structure.getSelection();o&&o.string&&r.push(o.string),this.selection&&this.selection.string&&r.push(this.selection.string);var s="";return r.length>0&&(s="( "+r.join(" ) AND ( ")+" )"),new Jt(s)},t.prototype.getStructure=function(){return this.structure.getStructure()},t.prototype.eachBond=function(i,r){this.structure.eachBond(i,this.getSelection(r))},t.prototype.eachAtom=function(i,r){var o=this.getAtomProxy(),s=this.getAtomSet(r),a=this.atomStore.count;if(s.getSize()<a)s.forEach(function(l){o.index=l,i(o)});else for(var c=0;c<a;++c)o.index=c,i(o)},t.prototype.eachResidue=function(i,r){this.structure.eachResidue(i,this.getSelection(r))},t.prototype.eachResidueN=function(i,r){console.error("StructureView.eachResidueN() not implemented")},t.prototype.eachChain=function(i,r){this.structure.eachChain(i,this.getSelection(r))},t.prototype.eachModel=function(i,r){this.structure.eachModel(i,this.getSelection(r))},t.prototype.getAtomSet=function(i,r){r===void 0&&(r=!1);var o=this.structure.getAtomSet(i);return!r&&this.atomSet&&(o=o.makeIntersection(this.atomSet)),o},t.prototype.getAtomIndices=function(i){return this.structure.getAtomIndices(this.getSelection(i))},t.prototype.refreshPosition=function(){return this.structure.refreshPosition()},t.prototype.dispose=function(){this.selection&&this.selection.signals.stringChanged.remove(this.refresh,this),this.structure.signals.refreshed.remove(this.refresh,this),this.structure=new e,delete this.atomSet,delete this.bondSet},Object.defineProperties(t.prototype,n),t}(ut),H6=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]];function ZS(e,t){var n,i=0,r={};return t.forEach(function(o){n=0;var s={};o.forEach(function(a){s[e[n++]]=a}),r[e[i++]]=s}),r}var j6={blosum62:ZS("ARNDCQEGHILKMFPSTWYVBZ?",[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]]),blosum62x:ZS("ACDEFGHIKLMNPQRSTVWY",H6)},dl=function(e,t,n,i,r){n===void 0&&(n=-10),i===void 0&&(i=-1),r===void 0&&(r="blosum62"),this.seq1=e,this.seq2=t,this.gapPenalty=n,this.gapExtensionPenalty=i,r&&(this.substMatrix=j6[r])};function W6(e,t,n,i,r){var o,s,a,c,l;if(n===void 0&&(n=!1),i===void 0&&(i=""),r===void 0&&(r=""),n){var u=e,h=t;i&&r&&(u=e.getView(new Jt(i)),h=t.getView(new Jt(r)));var f,p,m=u.getSequence(),y=h.getSequence(),v=new dl(m.join(""),y.join(""));v.calc(),v.trace(),o=0,s=0,a=v.ali1.length;for(var d=[],g=[],b=0;b<a;++b){var x=v.ali1[b],_=v.ali2[b];f=0,p=0,x==="-"?g[s]=!1:(g[s]=!0,f=1),_==="-"?d[o]=!1:(d[o]=!0,p=1),o+=f,s+=p}var S=[],w=[],C=u.getAtomProxy(),A=h.getAtomProxy();o=0,u.eachResidue(function(L){L.traceAtomIndex!==void 0&&L.traceAtomIndex===L.getAtomIndexByName("CA")&&(d[o]&&(C.index=L.getAtomIndexByName("CA"),S.push(C.x,C.y,C.z)),o+=1)}),o=0,h.eachResidue(function(L){L.traceAtomIndex!==void 0&&L.traceAtomIndex===L.getAtomIndexByName("CA")&&(g[o]&&(A.index=L.getAtomIndexByName("CA"),w.push(A.x,A.y,A.z)),o+=1)}),c=new Float32Array(S),l=new Float32Array(w)}else c=e.getView(new Jt(i+" and .CA")),l=t.getView(new Jt(r+" and .CA"));var k=new Qh(c,l).transform(e);return e.refreshPosition(),k}dl.prototype.initMatrices=function(){this.n=this.seq1.length,this.m=this.seq2.length,this.score=void 0,this.ali="",this.S=[],this.V=[],this.H=[];for(var e=0;e<=this.n;++e){this.S[e]=[],this.V[e]=[],this.H[e]=[];for(var t=0;t<=this.m;++t)this.S[e][t]=0,this.V[e][t]=0,this.H[e][t]=0}for(var n=0;n<=this.n;++n)this.S[n][0]=this.gap(0),this.H[n][0]=-1/0;for(var i=0;i<=this.m;++i)this.S[0][i]=this.gap(0),this.V[0][i]=-1/0;this.S[0][0]=0},dl.prototype.gap=function(e){return this.gapPenalty+e*this.gapExtensionPenalty},dl.prototype.makeScoreFn=function(){var e=this.seq1,t=this.seq2,n=this.substMatrix;return n?function(i,r){var o=e[i],s=t[r];try{return n[o][s]}catch{return-4}}:(de.warn("Alignment: no subst matrix"),function(i,r){return e[i]===t[r]?5:-3})},dl.prototype.calc=function(){Pe&&de.time("Alignment.calc"),this.initMatrices();for(var e,t,n,i,r,o=this.gap(0),s=this.makeScoreFn(),a=this.gapExtensionPenalty,c=this.V,l=this.H,u=this.S,h=this.n,f=this.m,p=1;p<=h;++p){t=u[p-1],e=c[p-1],n=c[p],i=l[p],r=u[p];for(var m=1;m<=f;++m)n[m]=Math.max(t[m]+o,e[m]+a),i[m]=Math.max(r[m-1]+o,i[m-1]+a),r[m]=Math.max(t[m-1]+s(p-1,m-1),n[m],i[m])}Pe&&de.timeEnd("Alignment.calc"),Pe&&de.log(this.S,this.V,this.H)},dl.prototype.trace=function(){Pe&&de.time("Alignment.trace"),this.ali1="",this.ali2="";var e,t=this.makeScoreFn(),n=this.n,i=this.m;for(this.S[n][i]>=this.V[n][i]?(e="S",this.score=this.S[n][i]):this.V[n][i]>=this.H[n][i]?(e="V",this.score=this.V[n][i]):(e="H",this.score=this.H[n][i]),Pe&&de.log("Alignment: SCORE",this.score),Pe&&de.log("Alignment: S, V, H",this.S[n][i],this.V[n][i],this.H[n][i]);n>0&&i>0;)e==="S"?this.S[n][i]===this.S[n-1][i-1]+t(n-1,i-1)?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--n,--i,e="S"):this.S[n][i]===this.V[n][i]?e="V":this.S[n][i]===this.H[n][i]?e="H":(--n,--i):e==="V"?this.V[n][i]===this.V[n-1][i]+this.gapExtensionPenalty?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n,e="V"):this.V[n][i]===this.S[n-1][i]+this.gap(0)?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n,e="S"):--n:e==="H"?this.H[n][i]===this.H[n][i-1]+this.gapExtensionPenalty?(this.ali1="-"+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--i,e="H"):this.H[n][i]===this.S[n][i-1]+this.gap(0)?(this.ali1="-"+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--i,e="S"):--i:de.error("Alignment: no matrix");for(;n>0;)this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n;for(;i>0;)this.ali1="-"+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--i;Pe&&de.timeEnd("Alignment.trace"),Pe&&de.log([this.ali1,this.ali2])};var q6=Object.assign({sele:"",defaultAssembly:""},oE),ab=function(e){function t(i,r,o){var s,a,c,l,u;o===void 0&&(o={}),e.call(this,i,r,Object.assign({name:r.name},o)),this.structure=r,this.trajList=[],this.signals=Object.assign(this.signals,{trajectoryAdded:new yt.Signal,trajectoryRemoved:new yt.Signal,defaultAssemblyChanged:new yt.Signal}),this.initSelection(this.parameters.sele),this.pickBuffer=(s=4,a=0,c=0,l=[],{has:function(h){return l.indexOf(h)!==-1},get:function(h){return l[h]},push:function(h){l[a]=h,a=(s+a+1)%s,++c},get count(){return c},get data(){return l.slice(0,Math.min(c,s))},clear:function(){c=0,a=0,l.length=0}}),this.pickDict=(u={},{has:function(h){return u[JSON.stringify(h)]!==void 0},add:function(h,f){u[JSON.stringify(h)]=f},del:function(h){delete u[JSON.stringify(h)]},get values(){return Object.keys(u).map(function(h){return u[h]})}}),this.spacefillRepresentation=this.addRepresentation("spacefill",{sele:"none",opacity:uh.opacity,color:uh.color,disablePicking:!0,radiusType:"data"},!0),this.distanceRepresentation=this.addRepresentation("distance",uh,!0),this.angleRepresentation=this.addRepresentation("angle",uh,!0),this.dihedralRepresentation=this.addRepresentation("dihedral",uh,!0),this.measureRepresentations=new sE([this.spacefillRepresentation,this.distanceRepresentation,this.angleRepresentation,this.dihedralRepresentation]),this.setDefaultAssembly(this.parameters.defaultAssembly)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultParameters:{configurable:!0},type:{configurable:!0}};return n.defaultParameters.get=function(){return q6},n.type.get=function(){return"structure"},t.prototype.initSelection=function(i){var r=this;this.selection=new Jt(i),this.structureView=new aE(this.structure,this.selection),this.selection.signals.stringChanged.add(function(){r.structureView.setSelection(r.selection),r.rebuildRepresentations(),r.rebuildTrajectories()})},t.prototype.setSelection=function(i){return this.parameters.sele=i,this.selection.setString(i),this},t.prototype.setDefaultAssembly=function(i){if(this.structure.biomolDict[i]===void 0&&(i=""),this.parameters.defaultAssembly!==i){var r={defaultAssembly:i};this.reprList.forEach(function(o){return o.setParameters(r)}),this.measureRepresentations.setParameters(r),this.parameters.defaultAssembly=i,this.signals.defaultAssemblyChanged.dispatch(i)}return this},t.prototype.rebuildRepresentations=function(){this.reprList.forEach(function(i){i.build()}),this.measureRepresentations.build()},t.prototype.rebuildTrajectories=function(){var i=this;this.trajList.forEach(function(r){r.trajectory.setStructure(i.structureView)})},t.prototype.updateRepresentations=function(i){e.prototype.updateRepresentations.call(this,i),this.measureRepresentations.update(i)},t.prototype.updateRepresentationMatrices=function(){e.prototype.updateRepresentationMatrices.call(this),this.measureRepresentations.setParameters({matrix:this.matrix})},t.prototype.addRepresentation=function(i,r,o){var s=this;r===void 0&&(r={}),o===void 0&&(o=!1),r.defaultAssembly=this.parameters.defaultAssembly;var a=this._addRepresentation(i,this.structureView,r,o);return o||a.signals.parametersChanged.add(function(){return s.measureUpdate()}),a},t.prototype.addTrajectory=function(i,r){var o=this;i===void 0&&(i=""),r===void 0&&(r={});var s=function(c,l,u){return c&&c instanceof $_?new U6(c,l,u):!c&&l.frames?new G6(c,l,u):c&&typeof c=="function"?new V6(c,l,u):new $6(c,l,u)}(i,this.structureView,r);s.signals.frameChanged.add(function(){o.updateRepresentations({position:!0})});var a=new N6(this.stage,s,r);return this.trajList.push(a),this.signals.trajectoryAdded.dispatch(a),a},t.prototype.removeTrajectory=function(i){var r=this.trajList.indexOf(i);r!==-1&&this.trajList.splice(r,1),i.dispose(),this.signals.trajectoryRemoved.dispatch(i)},t.prototype.dispose=function(){this.trajList.slice().forEach(function(i){return i.dispose()}),this.trajList.length=0,this.structure.dispose(),this.measureRepresentations.dispose(),e.prototype.dispose.call(this)},t.prototype.autoView=function(i,r){typeof i=="number"&&(r=i,i=""),this.stage.animationControls.zoomMove(this.getCenter(i),this.getZoom(i),O(r,0))},t.prototype.getBoxUntransformed=function(i){return i?this.structureView.getBoundingBox(new Jt(i)):this.structureView.boundingBox},t.prototype.getCenterUntransformed=function(i){return i&&typeof i=="string"?this.structure.atomCenter(new Jt(i)):this.structure.center},t.prototype.superpose=function(i,r,o,s){return W6(this.structureView,i.structureView,r,o,s),this.updateRepresentations({position:!0}),this},t.prototype.getMaxRepresentationRadius=function(i){var r=0,o=this.structure.getAtomProxy(i);return this.eachRepresentation(function(s){if(s.getVisibility()){var a=s.repr;r=Math.max(a.getAtomRadius(o),r)}}),r},t.prototype.measurePick=function(i){var r=this.pickBuffer.count;if(this.lastPick===i.index&&r>=1){if(r>1){var o=this.pickBuffer.data,s=this.pickBuffer.data.sort();this.pickDict.has(s)?this.pickDict.del(s):this.pickDict.add(s,o),r===2?this.distanceRepresentation.setParameters({atomPair:this.pickDict.values.filter(function(a){return a.length===2})}):r===3?this.angleRepresentation.setParameters({atomTriple:this.pickDict.values.filter(function(a){return a.length===3})}):r===4&&this.dihedralRepresentation.setParameters({atomQuad:this.pickDict.values.filter(function(a){return a.length===4})})}this.pickBuffer.clear(),this.lastPick=void 0}else this.pickBuffer.has(i.index)||this.pickBuffer.push(i.index),this.lastPick=i.index;this.measureUpdate()},t.prototype.measureClear=function(){this.pickBuffer.clear(),this.lastPick=void 0,this.spacefillRepresentation.setSelection("none")},t.prototype.measureBuild=function(){var i=this.measureData();this.distanceRepresentation.setParameters({atomPair:i.distance}),this.angleRepresentation.setParameters({atomTriple:i.angle}),this.dihedralRepresentation.setParameters({atomQuad:i.dihedral})},t.prototype.measureUpdate=function(){var i=this,r=this.pickBuffer.data,o={};r.forEach(function(s){var a=Math.max(.1,i.getMaxRepresentationRadius(s));o[s]=a*(2.3-_p(.1,2,a))}),this.spacefillRepresentation.setSelection(r.length?"@"+r.join(","):"none"),r.length&&this.spacefillRepresentation.setParameters({radiusData:o})},t.prototype.measureData=function(){var i=this.pickDict.values;return{distance:i.filter(function(r){return r.length===2}),angle:i.filter(function(r){return r.length===3}),dihedral:i.filter(function(r){return r.length===4})}},t.prototype.removeAllMeasurements=function(i){var r=this.pickDict,o=r.values,s=function(a){o.filter(function(c){return c.length===a}).forEach(function(c){return r.del(c.slice().sort())})};(!i||1&i)&&s(2),(!i||2&i)&&s(3),(!i||4&i)&&s(4),this.measureBuild()},t.prototype.removeMeasurement=function(i){this.pickDict.del(i.slice().sort()),this.measureBuild()},t.prototype.addMeasurement=function(i){if(!(i.length<2||i.length>4)){var r=i.slice().sort();this.pickDict.has(r)||this.pickDict.add(r,i),this.measureBuild()}},Object.defineProperties(t.prototype,n),t}(qt);Mu.add("structure",ab),Mu.add("structureview",ab);var cE=function(e){function t(i,r,o){o===void 0&&(o={}),e.call(this,i,r,Object.assign({name:r.name},o)),this.surface=r}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"surface"},t.prototype.addRepresentation=function(i,r){return r===void 0&&(r={}),this._addRepresentation(i,this.surface,r)},t.prototype.getBoxUntransformed=function(){return this.surface.boundingBox},t.prototype.getCenterUntransformed=function(){return this.surface.center},t.prototype.dispose=function(){this.surface.dispose(),e.prototype.dispose.call(this)},Object.defineProperties(t.prototype,n),t}(qt);Mu.add("surface",cE);var lE=function(e){function t(i,r,o){o===void 0&&(o={}),e.call(this,i,r,Object.assign({name:r.name},o)),this.volume=r}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"volume"},t.prototype.addRepresentation=function(i,r){return r===void 0&&(r={}),this._addRepresentation(i,this.volume,r)},t.prototype.getBoxUntransformed=function(){return this.volume.boundingBox},t.prototype.getCenterUntransformed=function(){return this.volume.center},t.prototype.dispose=function(){this.volume.dispose(),e.prototype.dispose.call(this)},Object.defineProperties(t.prototype,n),t}(qt);Mu.add("volume",lE);var KS=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addRepresentation=function(n,i){return this.forEach(function(r){return r.addRepresentation(n,i)})},t.prototype.autoView=function(n){return this.forEach(function(i){return i.autoView(n)})},t}(Bl);function QS(e,t){return e instanceof RegExp?t.name.match(e)!==null:t.name===e}var X6=new T,Y6={impostor:!0,quality:"medium",workerDefault:!0,sampleLevel:0,backgroundColor:"black",rotateSpeed:2,zoomSpeed:1.2,panSpeed:1,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",fogNear:50,fogFar:100,cameraFov:40,cameraEyeSep:.3,cameraType:"perspective",lightColor:14540253,lightIntensity:1,ambientColor:14540253,ambientIntensity:.2,hoverTimeout:0,tooltip:!0,mousePreset:"default"},Gt=function(e,t){t===void 0&&(t={}),this.signals={parametersChanged:new yt.Signal,fullscreenChanged:new yt.Signal,componentAdded:new yt.Signal,componentRemoved:new yt.Signal,clicked:new yt.Signal,hovered:new yt.Signal},this.tasks=new Eo,this.compList=[],this.defaultFileParams={},this.logList=[],this.viewer=new Mt(e),this.viewer.renderer&&(this.tooltip=document.createElement("div"),Object.assign(this.tooltip.style,{display:"none",position:"fixed",zIndex:"1000000",pointerEvents:"none",backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.viewer.container.appendChild(this.tooltip),this.mouseObserver=new bi(this.viewer.renderer.domElement),this.viewerControls=new _i(this),this.trackballControls=new or(this),this.pickingControls=new TT(this),this.animationControls=new Dn(this),this.mouseControls=new hl(this),this.keyControls=new fl(this),this.pickingBehavior=new bm(this),this.mouseBehavior=new Ys(this),this.animationBehavior=new nb(this),this.keyBehavior=new pl(this),this.spinAnimation=this.animationControls.spin([0,1,0],.005),this.spinAnimation.pause(!0),this.rockAnimation=this.animationControls.rock([0,1,0],.005),this.rockAnimation.pause(!0),this.parameters=br(t,Y6),this.setParameters(this.parameters),this.viewer.animate())};Gt.prototype.setParameters=function(e){e===void 0&&(e={}),mT(this.parameters,e);var t=e,n=this.parameters,i=this.viewer,r=this.trackballControls;return t.quality!==void 0&&this.setQuality(n.quality),t.impostor!==void 0&&this.setImpostor(n.impostor),t.rotateSpeed!==void 0&&(r.rotateSpeed=n.rotateSpeed),t.zoomSpeed!==void 0&&(r.zoomSpeed=n.zoomSpeed),t.panSpeed!==void 0&&(r.panSpeed=n.panSpeed),t.mousePreset!==void 0&&this.mouseControls.preset(n.mousePreset),this.mouseObserver.setParameters({hoverTimeout:n.hoverTimeout}),i.setClip(n.clipNear,n.clipFar,n.clipDist,n.clipMode,n.clipScale),i.setFog(void 0,n.fogNear,n.fogFar),i.setCamera(n.cameraType,n.cameraFov,n.cameraEyeSep),i.setSampling(n.sampleLevel),i.setBackground(n.backgroundColor),i.setLight(n.lightColor,n.lightIntensity,n.ambientColor,n.ambientIntensity),this.signals.parametersChanged.dispatch(this.getParameters()),this},Gt.prototype.log=function(e){console.log("STAGE LOG",e),this.logList.push(e)},Gt.prototype.getParameters=function(){return Object.assign({},this.parameters)},Gt.prototype.defaultFileRepresentation=function(e){if(e instanceof ab){var t,n,i;e.setSelection("/0");var r=e.structure;if(r.biomolDict.BU1){var o=r.biomolDict.BU1;t=o.getAtomCount(r),n=o.getResidueCount(r),i=o.getInstanceCount(),e.setDefaultAssembly("BU1")}else t=r.getModelProxy(0).atomCount,n=r.getModelProxy(0).residueCount,i=1;var s=t;ST&&(s*=4);var a=r.atomStore.count/r.residueStore.count<2;a&&(s*=10);var c="chainname",l="RdYlBu",u=!1;if(r.getChainnameCount(new Jt("polymer and /0"))===1&&(c="residueindex",l="Spectral",u=!0),Pe&&console.log(s,t,i,a),n/i<4)e.addRepresentation("ball+stick",{colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"});else if(i>5&&s>15e3||s>7e5){var h=Math.min(2,Math.max(.1,6e3/(s/i)));a&&(h=Math.min(h,.5)),e.addRepresentation("surface",{colorScheme:c,colorScale:l,colorReverse:u,sele:"polymer",surfaceType:"av",probeRadius:1.4,scaleFactor:h,useWorker:!1})}else s>25e4?e.addRepresentation("backbone",{colorScheme:c,colorScale:l,colorReverse:u,lineOnly:!0}):s>1e5?e.addRepresentation("backbone",{colorScheme:c,colorScale:l,colorReverse:u,quality:"low",disableImpostor:!0,radiusScale:2}):s>8e4?e.addRepresentation("backbone",{colorScheme:c,colorScale:l,colorReverse:u,radiusScale:2}):(e.addRepresentation("cartoon",{colorScheme:c,colorScale:l,colorReverse:u,radiusScale:.7,aspectRatio:5,quality:"auto"}),s<5e4&&e.addRepresentation("base",{colorScheme:c,colorScale:l,colorReverse:u,quality:"auto"}),e.addRepresentation("ball+stick",{sele:"ligand",colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"}));e.structure.frames.length&&e.addTrajectory()}else(e instanceof cE||e instanceof lE)&&e.addRepresentation("surface");this.tasks.onZeroOnce(this.autoView,this)},Gt.prototype.loadFile=function(e,t){var n=this;t===void 0&&(t={});var i=Object.assign({},this.defaultFileParams,t),r=Jn(e).name;this.tasks.increment(),this.log("loading file '"+r+"'");var o=O(i.ext,Jn(e).ext);return(ft.isTrajectory(o)?Promise.reject(new Error("loadFile: ext '"+o+"' is a trajectory and must be loaded into a structure component")):jx(e,i)).then(function(s){n.log("loaded '"+r+"'");var a=n.addComponentFromObject(s,i);return i.defaultRepresentation&&n.defaultFileRepresentation(a),n.tasks.decrement(),a},function(s){n.tasks.decrement();var a="error loading file: '"+s+"'";throw n.log(a),a})},Gt.prototype.loadScript=function(e){var t=this,n=Jn(e).name;return this.log("loading script '"+n+"'"),jx(e).then(function(i){t.tasks.increment(),t.log("running script '"+n+"'"),i.run(t).then(function(){t.tasks.decrement(),t.log("finished script '"+n+"'")}),t.log("called script '"+n+"'")},function(i){t.tasks.decrement();var r="errored script '"+n+`' "`+i+'"';throw t.log(r),r})},Gt.prototype.addComponent=function(e){e?(this.compList.push(e),this.signals.componentAdded.dispatch(e)):de.warn("Stage.addComponent: no component given")},Gt.prototype.addComponentFromObject=function(e,t){t===void 0&&(t={});var n=Mu.get(e.type);if(n){var i=new n(this,e,t);return this.addComponent(i),i}de.warn("no component for object type",e.type)},Gt.prototype.removeComponent=function(e){var t=this.compList.indexOf(e);t!==-1&&(this.compList.splice(t,1),e.dispose(),this.signals.componentRemoved.dispatch(e))},Gt.prototype.removeAllComponents=function(){var e=this;this.compList.slice().forEach(function(t){return e.removeComponent(t)})},Gt.prototype.handleResize=function(){this.viewer.handleResize()},Gt.prototype.setSize=function(e,t){var n=this.viewer.container;n!==document.body&&(e!==void 0&&(n.style.width=e),t!==void 0&&(n.style.height=t),this.handleResize())},Gt.prototype.toggleFullscreen=function(e){if(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled){var t=this;e=e||this.viewer.container,this.lastFullscreenElement=e,n()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(e.dataset.normalWidth=e.style.width||"",e.dataset.normalHeight=e.style.height||"",e.style.width=window.screen.width+"px",e.style.height=window.screen.height+"px",e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),document.addEventListener("fullscreenchange",i),document.addEventListener("mozfullscreenchange",i),document.addEventListener("webkitfullscreenchange",i),document.addEventListener("MSFullscreenChange",i),this.handleResize(),this.signals.fullscreenChanged.dispatch(!0),setTimeout(function(){t.handleResize()},100))}else de.log("fullscreen mode (currently) not possible");function n(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function i(){if(!n()&&t.lastFullscreenElement){var r=t.lastFullscreenElement;r.style.width=r.dataset.normalWidth||"",r.style.height=r.dataset.normalHeight||"",document.removeEventListener("fullscreenchange",i),document.removeEventListener("mozfullscreenchange",i),document.removeEventListener("webkitfullscreenchange",i),document.removeEventListener("MSFullscreenChange",i),t.handleResize(),t.signals.fullscreenChanged.dispatch(!1)}}},Gt.prototype.setSpin=function(e){e?(this.spinAnimation.resume(!0),this.rockAnimation.pause(!0)):this.spinAnimation.pause(!0)},Gt.prototype.setRock=function(e){e?(this.rockAnimation.resume(!0),this.spinAnimation.pause(!0)):this.rockAnimation.pause(!0)},Gt.prototype.toggleSpin=function(){this.setSpin(this.spinAnimation.paused)},Gt.prototype.toggleRock=function(){this.setRock(this.rockAnimation.paused)},Gt.prototype.getFocus=function(){var e=this.parameters;if(e.clipMode!=="scene")return 0;var t=e.clipNear;return e.clipScale==="absolute"&&(t=this.viewer.absoluteToRelative(t)),2*t},Gt.prototype.setFocus=function(e){var t,n,i,r;this.parameters.clipMode==="scene"&&(this.parameters.clipScale==="relative"?(i=50,r=function(o){return Vx(o,0,100)}(2*(n=100-(t=Vx(e/2,0,49.9)))-50)):(i=0,r=2*(n=t=this.viewer.relativeToAbsolute(e/2))),this.setParameters({clipNear:t,clipFar:n,fogNear:i,fogFar:r}))},Gt.prototype.getZoomForBox=function(e){var t=e.getSize(X6),n=Math.max(t.x,t.y,t.z),i=Math.min(t.x,t.y,t.z),r=n+Math.sqrt(i),o=Tn(this.viewer.perspectiveCamera.fov),s=this.viewer.width,a=this.viewer.height,c=a<s?1:s/a;return r=Math.abs(.5*r/c/Math.sin(o/2)),-(r+=this.parameters.clipDist)},Gt.prototype.getBox=function(){return this.viewer.boundingBox},Gt.prototype.getZoom=function(){return this.getZoomForBox(this.getBox())},Gt.prototype.getCenter=function(e){return this.getBox().getCenter(e||new T)},Gt.prototype.autoView=function(e){this.animationControls.zoomMove(this.getCenter(),this.getZoom(),O(e,0))},Gt.prototype.makeImage=function(e){var t=this;return e===void 0&&(e={}),new Promise(function(n,i){t.tasks.onZeroOnce(function(){t.tasks.increment(),t.viewer.makeImage(e).then(function(r){t.tasks.decrement(),n(r)}).catch(function(r){t.tasks.decrement(),i(r)})})})},Gt.prototype.setImpostor=function(e){this.parameters.impostor=e;var t=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation(function(n){if(t.includes(n.getType())){var i=n.getParameters();i.disableImpostor=!e,n.build(i)}})},Gt.prototype.setQuality=function(e){this.parameters.quality=e;var t=["tube","cartoon","ribbon","trace","rope"],n=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation(function(i){var r=i.getParameters();if(!t.includes(i.getType())){if(!n.includes(i.getType()))return;if(!r.disableImpostor)return void(i.repr.quality=e)}r.quality=e,i.build(r)})},Gt.prototype.eachComponent=function(e,t){this.compList.slice().forEach(function(n){t!==void 0&&t!==n.type||e(n)})},Gt.prototype.eachRepresentation=function(e,t){this.eachComponent(function(n){n.reprList.slice().forEach(function(i){t!==void 0&&t!==i.getType()||e(i,n)})})},Gt.prototype.getComponentsByName=function(e){var t=[];return this.eachComponent(function(n){(e===void 0||QS(e,n))&&t.push(n)}),new KS(t)},Gt.prototype.getComponentsByObject=function(e){var t=[];return this.eachComponent(function(n){n.object===e&&t.push(n)}),new KS(t)},Gt.prototype.getRepresentationsByName=function(e){var t=[];return this.eachRepresentation(function(n,i){(e===void 0||QS(e,n))&&t.push(n)}),new sE(t)},Gt.prototype.measureClear=function(){this.eachComponent(function(e){return e.measureClear()},"structure")},Gt.prototype.measureUpdate=function(){this.eachComponent(function(e){return e.measureUpdate()},"structure")},Gt.prototype.dispose=function(){this.tasks.dispose(),this.viewer.dispose(),this.mouseObserver.dispose()};var Z6=function(e){function t(i,r,o){o===void 0&&(o={}),e.call(this,i,r,Object.assign({name:r.name},o)),this.shape=r}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"shape"},t.prototype.addRepresentation=function(i,r){return r===void 0&&(r={}),this._addRepresentation(i,this.shape,r)},t.prototype.getBoxUntransformed=function(){return this.shape.boundingBox},t.prototype.getCenterUntransformed=function(){return this.shape.center},t.prototype.dispose=function(){this.shape.dispose(),e.prototype.dispose.call(this)},Object.defineProperties(t.prototype,n),t}(qt);function Qt(e,t,n,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,n):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}Mu.add("shape",Z6);var JS=function(e){function t(n){var i=this;e.call(this,n),n.scale||(this.parameters.scale="rainbow",this.parameters.reverse=O(n.reverse,!0)),this.scalePerModel={},n.structure.eachModel(function(r){i.parameters.domain=[r.atomOffset,r.atomEnd],i.scalePerModel[r.index]=i.getScale()})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){return this.scalePerModel[n.modelIndex](n.index)},t}(Ft);Qt([Kt],JS.prototype,"atomColor",null),Rt.add("atomindex",JS);var eM=function(e){function t(n){if(e.call(this,n),n.scale||(this.parameters.scale="OrRd"),!n.domain){var i,r=1/0,o=-1/0;n.sele&&(i=new Jt(n.sele)),n.structure.eachAtom(function(s){var a=s.bfactor;r=Math.min(r,a),o=Math.max(o,a)},i),this.parameters.domain=[r,o]}this.bfactorScale=this.getScale()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){return this.bfactorScale(n.bfactor)},t}(Ft);Qt([Kt],eM.prototype,"atomColor",null),Rt.add("bfactor",eM);var tM=function(e){function t(n){var i=this;e.call(this,n),this.chainidDictPerModel={},this.scalePerModel={},n.scale||(this.parameters.scale="Spectral"),n.structure.eachModel(function(r){var o=0,s={};r.eachChain(function(a){s[a.chainid]===void 0&&(s[a.chainid]=o,o+=1)}),i.parameters.domain=[0,o-1],i.chainidDictPerModel[r.index]=s,i.scalePerModel[r.index]=i.getScale()})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){var i=this.chainidDictPerModel[n.modelIndex];return this.scalePerModel[n.modelIndex](i[n.chainid])},t}(Ft);Qt([Kt],tM.prototype,"atomColor",null),Rt.add("chainid",tM);var nM=function(e){function t(n){var i=this;e.call(this,n),this.scalePerModel={},n.scale||(this.parameters.scale="Spectral"),n.structure.eachModel(function(r){i.parameters.domain=[r.chainOffset,r.chainEnd],i.scalePerModel[r.index]=i.getScale()})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){return this.scalePerModel[n.modelIndex](n.chainIndex)},t}(Ft);Qt([Kt],nM.prototype,"atomColor",null),Rt.add("chainindex",nM);var iM=function(e){function t(n){var i=this;e.call(this,n),this.chainnameDictPerModel={},this.scalePerModel={},n.scale||(this.parameters.scale="Spectral"),n.structure.eachModel(function(r){var o=0,s={};r.eachChain(function(a){s[a.chainname]===void 0&&(s[a.chainname]=o,o+=1)}),i.parameters.domain=[0,o-1],i.chainnameDictPerModel[r.index]=s,i.scalePerModel[r.index]=i.getScale()})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){var i=this.chainnameDictPerModel[n.modelIndex];return this.scalePerModel[n.modelIndex](i[n.chainname])},t}(Ft);Qt([Kt],iM.prototype,"atomColor",null),Rt.add("chainname",iM);var rM=function(e){function t(n){e.call(this,n),this.rsrzDict={},this.rsccDict={},n.scale||(this.parameters.scale="RdYlBu"),this.rsrzScale=this.getScale({domain:[2,0]}),this.rsccScale=this.getScale({domain:[.678,1]});var i=n.structure.validation;i&&(this.rsrzDict=i.rsrzDict,this.rsccDict=i.rsccDict)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){var i=n.resno+"";n.inscode&&(i+="^"+n.inscode),n.chainname&&(i+=":"+n.chainname),i+="/"+n.modelIndex;var r=this.rsrzDict[i];if(r!==void 0)return this.rsrzScale(r);var o=this.rsccDict[i];return o!==void 0?this.rsccScale(o):9474192},t}(Ft);Qt([Kt],rM.prototype,"atomColor",null),Rt.add("densityfit",rM);var xy={ARG:{CD:.1,CZ:.5,NE:-.1},ASN:{CG:.55,OD1:-.55},ASP:{CB:-.16,CG:.36,OD1:-.6,OD2:-.6},CYS:{CB:.19,SG:-.19},GLN:{CD:.55,OE1:-.55},GLU:{CD:.36,CG:-.16,OE1:-.6,OE2:-.6},HIS:{CB:.1,CD2:.2,CE1:.45,CG:.15,ND1:.05,NE2:.05},LYS:{CE:.25,NZ:.75},MET:{CE:.06,CG:.06,SD:-.12},PTR:{C:.55,CA:.1,CZ:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SEP:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SER:{CB:.25,OG:-.25},THR:{CB:.25,OG1:-.25},TPO:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,OG1:-1.1,O1P:-.85,O2P:-.85,O3P:-.85,P:1.4},TRP:{CD1:.06,CD2:.1,CE2:-.04,CE3:-.03,CG:-.03,NE1:-.06},TYR:{CZ:.25,OH:-.25},backbone:{C:.55,O:-.55,N:-.35,CA:.1}},oM=function(e){function t(n){var i=this;e.call(this,n),this.delta=new T,this.hCharges=[],n.scale||(this.parameters.scale="rwb"),n.domain||(this.parameters.domain=[-50,50]),this.scale=this.getScale(),this.charges=new Float32Array(n.structure.atomCount);var r=[];n.structure.eachAtom(function(s){var a;if(i.charges[s.index]=((a=s).partialCharge!==null?a.partialCharge:a.isProtein()&&(xy[a.resname]&&xy[a.resname][a.atomname]||xy.backbone[a.atomname])||0)*s.occupancy,s.atomname==="N"){if(s.bondCount>=3||s.bondToElementCount(1))return;var c=function(l,u){u===void 0&&(u=new T);var h=!1,f=!1,p=!1;return u.set(2*l.x,2*l.y,2*l.z),l.eachBondedAtom(function(m){if(!h)return m.atomname==="H"?(u.set(m.x,m.y,m.z),void(h=!0)):void(f||m.atomname!=="CA"?p||m.atomname!=="C"||(p=!0,u.sub(m)):(u.sub(m),f=!0))}),h?u:f&&p?(u.normalize(),u.multiplyScalar(1.04),u.add(l),u):void 0}(s);c!==void 0&&(r.push(c),i.hCharges.push(.25*s.occupancy))}});var o=n.structure.getBoundingBox();o.expandByScalar(1.04),this.hStore=function(s){for(var a=s.length,c=new Float32Array(a),l=new Float32Array(a),u=new Float32Array(a),h=0;h<s.length;h++){var f=s[h];c[h]=f.x,l[h]=f.y,u[h]=f.z}return{x:c,y:l,z:u,count:a}}(r),this.hHash=new Ec(this.hStore,o),this.hash=new Ec(n.structure.atomStore,o)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.positionColor=function(n){var i=this.charges,r=this.hCharges,o=0;return this.hash.eachWithin(n.x,n.y,n.z,12,function(s,a){var c=i[s];c!==0&&(o+=c/a)}),this.hHash.eachWithin(n.x,n.y,n.z,12,function(s,a){var c=r[s];c!==0&&(o+=c/a)}),this.scale(332*o)},t}(Ft);Qt([Kt],oM.prototype,"positionColor",null),Rt.add("electrostatic",oM);var sM={H:16777215,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215,D:16777152,T:16777120},aM=function(e){function t(n){n.value=O(n.value,sM.C),e.call(this,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){var i=n.element;return i==="C"?this.parameters.value:sM[i]||16777215},t}(Ft);Qt([Kt],aM.prototype,"atomColor",null),Rt.add("element",aM);var cM=function(e){function t(n){e.call(this,n),n.scale||(this.parameters.scale="Spectral"),n.domain||(this.parameters.domain=[0,n.structure.entityList.length-1]),this.entityindexScale=this.getScale()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){return this.entityindexScale(n.entityIndex)},t}(Ft);Qt([Kt],cM.prototype,"atomColor",null),Rt.add("entityindex",cM);var lM=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){var i=n.entity;switch(i?i.entityType:void 0){case 1:return 8374655;case 2:return 16629894;case 3:return 12496596;case 4:return 3697840;default:return 16777113}},t}(Ft);Qt([Kt],lM.prototype,"atomColor",null),Rt.add("entitytype",lM);var uM=function(e){function t(n){e.call(this,n),this.geoAtomDict={},this.geoDict={};var i=n.structure.validation;i&&(this.geoAtomDict=i.geoAtomDict,this.geoDict=i.geoDict)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){var i,r=n.resno+"";n.inscode&&(r+="^"+n.inscode),n.chainname&&(r+=":"+n.chainname),r+="/"+n.modelIndex;var o,s=this.geoAtomDict[r];if(s!==void 0){var a=s[n.atomname]||0;o=a,i=16843009*((o=(858993459&(o-=o>>1&1431655765))+(o>>2&858993459))+(o>>4)&252645135)>>24}else i=this.geoDict[r]||0;return i===0?2188972:i===1?16703627:i===2?16018755:i>=3?10813478:9474192},t}(Ft);Qt([Kt],uM.prototype,"atomColor",null),Rt.add("geoquality",uM);var hM=function(e){function t(n){e.call(this,n),this.resHF={},n.scale||(this.parameters.scale="RdYlGn");for(var i in wS)this.resHF[i]=wS[i][0];if(this.defaultResidueHydrophobicity=cN[0],!n.domain){var r=1/0,o=-1/0;for(var s in this.resHF){var a=this.resHF[s];r=Math.min(r,a),o=Math.max(o,a)}this.parameters.domain=[r,0,o]}this.hfScale=this.getScale()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){return this.hfScale(this.resHF[n.resname]||this.defaultResidueHydrophobicity)},t}(Ft);Qt([Kt],hM.prototype,"atomColor",null),Rt.add("hydrophobicity",hM);var fM=function(e){function t(n){e.call(this,n),n.scale||(this.parameters.scale="rainbow"),n.domain||(this.parameters.domain=[0,n.structure.modelStore.count]),this.modelindexScale=this.getScale()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){return this.modelindexScale(n.modelIndex)},t}(Ft);Qt([Kt],fM.prototype,"atomColor",null),Rt.add("modelindex",fM);var pM=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){switch(n.residueType.moleculeType){case 1:return 3697840;case 2:return 15729279;case 3:return 12496596;case 4:return 16629894;case 5:return 12540695;case 6:return 8374655;default:return 16777113}},t}(Ft);Qt([Kt],pM.prototype,"atomColor",null),Rt.add("moleculetype",pM);var dM=function(e){function t(n){e.call(this,n),n.scale||(this.parameters.scale="PuBu"),n.domain||(this.parameters.domain=[0,1]),this.occupancyScale=this.getScale()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){return this.occupancyScale(n.occupancy)},t}(Ft);Qt([Kt],dM.prototype,"atomColor",null),Rt.add("occupancy",dM);var mM=function(e){function t(n){e.call(this,n),n.scale||(this.parameters.scale="rwb"),n.domain||(this.parameters.domain=[-1,1]),this.partialchargeScale=this.getScale()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){return this.partialchargeScale(n.partialCharge||0)},t}(Ft);function by(){return 16777215*Math.random()}Qt([Kt],mM.prototype,"atomColor",null),Rt.add("partialcharge",mM);var Ud=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(){return by()},t.prototype.volumeColor=function(){return by()},t.prototype.positionColor=function(){return by()},t}(Ft);Qt([Kt],Ud.prototype,"atomColor",null),Qt([Kt],Ud.prototype,"volumeColor",null),Qt([Kt],Ud.prototype,"positionColor",null),Rt.add("random",Ud);var gM=function(e){function t(n){e.call(this,n),this.rciDict={},n.scale||(this.parameters.scale="RdYlBu"),this.rciScale=this.getScale({domain:[.6,0]});var i=n.structure.validation;i&&(this.rciDict=i.rciDict)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){var i="["+n.resname+"]"+n.resno;n.chainname&&(i+=":"+n.chainname);var r=this.rciDict[i];return r!==void 0?this.rciScale(r):9474192},t}(Ft);Qt([Kt],gM.prototype,"atomColor",null),Rt.add("randomcoilindex",gM);var yM=function(e){function t(n){var i=this;e.call(this,n),this.scalePerChain={},n.scale||(this.parameters.scale="rainbow",this.parameters.reverse=O(n.reverse,!0)),n.structure.eachChain(function(r){i.parameters.domain=[r.residueOffset,r.residueEnd],i.scalePerChain[r.index]=i.getScale()})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){return this.scalePerChain[n.chainIndex](n.residueIndex)},t}(Ft);Qt([Kt],yM.prototype,"atomColor",null),Rt.add("residueindex",yM);var K6={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935,ASH:16711935,GLH:16711935,A:14423100,G:3329330,I:10145074,X:8190976,C:16766720,T:4286945,U:4251856,D:35723,DA:14423100,DG:3329330,DI:10145074,DX:8190976,DC:16766720,DT:4286945,DU:4251856,DD:35723},vM=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){return K6[n.resname]||16711935},t}(Ft);Qt([Kt],vM.prototype,"atomColor",null),Rt.add("resname",vM);var Q6=16711808,J6=10485888,ez=6291584,tz=16762880,nz=6324479,iz=16777215,rz=11403518,oz=16580962,sz=10921722,xM=function(e){function t(n){e.call(this,n),this.residueProxy=n.structure.getResidueProxy()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){var i=n.sstruc,r=this.residueProxy;return i==="h"?Q6:i==="g"?J6:i==="i"?ez:i==="e"||i==="b"?tz:i==="t"?nz:(r.index=n.residueIndex,r.isDna()?rz:r.isRna()?oz:r.isSaccharide()?sz:r.isProtein()||i==="s"||i==="l"?iz:8421504)},t}(Ft);Qt([Kt],xM.prototype,"atomColor",null),Rt.add("sstruc",xM);var _y=function(e){function t(n){var i,r;e.call(this,n),n.scale||(this.parameters.scale="rwb"),this.atomData=(i=this.parameters.data)===null||i===void 0?void 0:i.atomData,this.bondData=(r=this.parameters.data)===null||r===void 0?void 0:r.bondData,this.scale=this.getScale(this.parameters)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(n){var i,r=(i=this.atomData)===null||i===void 0?void 0:i[n.index];return r!==void 0?this.scale(r):this.parameters.value},t.prototype.bondColor=function(n,i){var r,o=(r=this.bondData)===null||r===void 0?void 0:r[n.index];return o!==void 0?this.scale(o):this.atomProxy?(this.atomProxy.index=i?n.atomIndex1:n.atomIndex2,this.atomColor(this.atomProxy)):this.parameters.value},t}(Ft);Qt([Kt],_y.prototype,"atomColor",null),Qt([Kt],_y.prototype,"bondColor",null),Rt.add("structuredata",_y);var dh=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.atomColor=function(){return this.parameters.value},t.prototype.bondColor=function(){return this.parameters.value},t.prototype.valueColor=function(){return this.parameters.value},t.prototype.volumeColor=function(){return this.parameters.value},t}(Ft);Qt([Kt],dh.prototype,"atomColor",null),Qt([Kt],dh.prototype,"bondColor",null),Qt([Kt],dh.prototype,"valueColor",null),Qt([Kt],dh.prototype,"volumeColor",null),Rt.add("uniform",dh);var bM=function(e){function t(n){e.call(this,n),this.valueScale=this.getScale()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.volumeColor=function(n){return this.valueScale(this.parameters.volume.data[n])},t}(Ft);Qt([Kt],bM.prototype,"volumeColor",null),Rt.add("value",bM);var _M=function(e){function t(n){e.call(this,n),this.vec=new T,this.valueScale=this.getScale()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.positionColor=function(n){var i=this.parameters.volume;if(!i||!i.inverseMatrix)return this.parameters.value;var r=this.vec,o=i.data,s=i.nx,a=i.ny,c=s*a;r.copy(n),r.applyMatrix4(i.inverseMatrix);var l=Math.floor(r.x),u=Math.floor(r.y),h=Math.floor(r.z),f=(h*a+u)*s+l,p=f+1,m=f+s,y=f+c,v=m+1,d=y+1,g=m+c,b=g+1,x=o[f],_=o[p],S=o[m],w=o[y],C=o[v],A=o[d],k=o[g],L=o[b],D=r.x-l,F=r.y-u,I=r.z-h,P=Tr(x,_,D),N=Tr(w,A,D),$=Tr(S,C,D),B=Tr(k,L,D),q=Tr(P,$,F),ee=Tr(N,B,F),W=Tr(q,ee,I);return this.valueScale(W)},t}(Ft);Qt([Kt],_M.prototype,"positionColor",null),Rt.add("volume",_M);var yi=function(e){function t(i,r,o){var s=o||{};if(e.call(this,i,r,s),this.type="structure",this.parameters=Object.assign({radiusType:{type:"select",options:jo.types},radiusData:{type:"hidden"},radiusSize:{type:"number",precision:3,max:10,min:.001},radiusScale:{type:"number",precision:3,max:10,min:.001},assembly:null,defaultAssembly:{type:"hidden"}},this.parameters),this.selection=new Jt(s.sele),this.dataList=[],this.structure=i,this.structureView=this.structure.getView(this.selection),i.biomolDict){var a={default:"default","":i.unitcell?"AU":"FULL"};Object.keys(i.biomolDict).forEach(function(c){a[c]=c}),this.parameters.assembly={type:"select",options:a,rebuild:!0}}else this.parameters.assembly=null}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultScale:{configurable:!0}};return n.defaultScale.get=function(){return{vdw:1,covalent:1,bfactor:.01,sstruc:1}},t.prototype.init=function(i){var r=this,o=i||{};o.colorScheme=O(o.colorScheme,"element"),this.setRadius(o.radius,o),this.radiusType=O(o.radiusType,"vdw"),this.radiusData=O(o.radiusData,{}),this.radiusSize=O(o.radiusSize,1),this.radiusScale=O(o.radiusScale,1),this.assembly=O(o.assembly,"default"),this.defaultAssembly=O(o.defaultAssembly,""),o.quality==="auto"&&(o.quality=this.getQuality()),e.prototype.init.call(this,o),this.selection.signals.stringChanged.add(function(){r.build()}),this.build()},t.prototype.setRadius=function(i,r){var o=Object.keys(JT);return typeof i=="string"&&o.includes(i.toLowerCase())?r.radiusType=i:i!==void 0&&(r.radiusType="size",r.radiusSize=i),this},t.prototype.getAssembly=function(){var i=this.assembly==="default"?this.defaultAssembly:this.assembly;return this.structure.biomolDict[i]},t.prototype.getQuality=function(){var i,r=this.structureView,o=this.getAssembly();return i=o?o.getAtomCount(r):r.atomCount,ST&&(i*=4),r.atomStore.count/r.residueStore.count<2&&(i*=10),i<15e3?"high":i<8e4?"medium":"low"},t.prototype.create=function(){var i=this;if(this.structureView.atomCount!==0)if(this.structureView.hasCoords()){this.needsBuild=!1;var r=this.getAssembly();if(r)r.partList.forEach(function(s,a){var c=s.getView(i.structureView);if(c.atomCount!==0){var l=i.createData(c,a);l&&(l.sview=c,l.instanceList=s.getInstanceList(),i.dataList.push(l))}});else{var o=this.createData(this.structureView,0);o&&(o.sview=this.structureView,this.dataList.push(o))}}else this.needsBuild=!0},t.prototype.update=function(i){var r=this;!this.lazy||this.visible?this.needsBuild?this.build():this.dataList.forEach(function(o){o.bufferList.length>0&&r.updateData(i,o)},this):Object.assign(this.lazyProps.what,i)},t.prototype.updateData=function(i,r){this.build()},t.prototype.getColorParams=function(){return Object.assign(Object.assign({},e.prototype.getColorParams.call(this)),{structure:this.structure})},t.prototype.getRadiusParams=function(i){return{type:this.radiusType,scale:this.radiusScale,size:this.radiusSize,data:this.radiusData}},t.prototype.getAtomParams=function(i,r){return Object.assign({what:i,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},r)},t.prototype.getBondParams=function(i,r){return Object.assign({what:i,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},r)},t.prototype.getAtomRadius=function(i){return this.structureView.atomSet.isSet(i.index)?new jo(this.getRadiusParams()).atomRadius(i):0},t.prototype.setSelection=function(i,r){return this.selection.setString(i,r),this},t.prototype.setParameters=function(i,r,o){r===void 0&&(r={}),o===void 0&&(o=!1);var s=i||{};return this.setRadius(s.radius,s),s.radiusType===void 0&&s.radiusData===void 0&&s.radiusSize===void 0&&s.radiusScale===void 0||(r.radius=!0,Fo&&!this.disableImpostor||(o=!0)),s.defaultAssembly!==void 0&&s.defaultAssembly!==this.defaultAssembly&&(this.assembly==="default"&&s.assembly===void 0||s.assembly==="default")&&(o=!0),e.prototype.setParameters.call(this,s,r,o),this},t.prototype.getParameters=function(){return Object.assign(e.prototype.getParameters.call(this),{sele:this.selection?this.selection.string:void 0,defaultAssembly:this.defaultAssembly})},t.prototype.attach=function(i){var r=this.viewer,o=this.bufferList;this.dataList.forEach(function(s){s.bufferList.forEach(function(a){o.push(a),r.add(a,s.instanceList)})}),this.setVisibility(this.visible),i()},t.prototype.clear=function(){this.dataList.length=0,e.prototype.clear.call(this)},t.prototype.dispose=function(){this.structureView.dispose(),e.prototype.dispose.call(this)},Object.defineProperties(t.prototype,n),t}(Un),V_=function(e){function t(n,i,r){e.call(this,n,i,r),this.n=0,this.parameters=Object.assign({labelVisible:{type:"boolean"},labelSize:{type:"number",precision:3,max:10,min:.001},labelColor:{type:"color"},labelFontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:"fontFamily"},labelFontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:"fontStyle"},labelFontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:"fontWeight"},labelsdf:{type:"boolean",buffer:"sdf"},labelXOffset:{type:"number",precision:1,max:20,min:-20,buffer:"xOffset"},labelYOffset:{type:"number",precision:1,max:20,min:-20,buffer:"yOffset"},labelZOffset:{type:"number",precision:1,max:20,min:-20,buffer:"zOffset"},labelAttachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},labelBorder:{type:"boolean",buffer:"showBorder"},labelBorderColor:{type:"color",buffer:"borderColor"},labelBorderWidth:{type:"number",precision:2,max:.3,min:0,buffer:"borderWidth"},labelBackground:{type:"boolean",rebuild:!0},labelBackgroundColor:{type:"color",buffer:"backgroundColor"},labelBackgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},labelBackgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:"backgroundOpacity"},labelFixedSize:{type:"boolean",buffer:"fixedSize"},lineOpacity:{type:"range",min:0,max:1,step:.01},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters,{flatShaded:null})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};this.labelVisible=O(i.labelVisible,!0),this.labelSize=O(i.labelSize,2),this.labelColor=O(i.labelColor,16777215),this.labelFontFamily=O(i.labelFontFamily,"sans-serif"),this.labelFontStyle=O(i.labelFontstyle,"normal"),this.labelFontWeight=O(i.labelFontWeight,"bold"),this.labelsdf=O(i.labelsdf,_T==="Chrome"),this.labelXOffset=O(i.labelXOffset,0),this.labelYOffset=O(i.labelYOffset,0),this.labelZOffset=O(i.labelZOffset,.5),this.labelAttachment=O(i.labelAttachment,"bottom-left"),this.labelBorder=O(i.labelBorder,!1),this.labelBorderColor=O(i.labelBorderColor,"lightgrey"),this.labelBorderWidth=O(i.labelBorderWidth,.15),this.labelBackground=O(i.labelBackground,!1),this.labelBackgroundColor=O(i.labelBackgroundColor,"lightgrey"),this.labelBackgroundMargin=O(i.labelBackgroundMargin,.5),this.labelBackgroundOpacity=O(i.labelBackgroundOpacity,1),this.labelFixedSize=O(i.labelFixedSize,!1),this.lineOpacity=O(i.lineOpacity,1),this.linewidth=O(i.linewidth,2),e.prototype.init.call(this,i)},t.prototype.update=function(n){n.position?this.build():e.prototype.update.call(this,n)},t.prototype.updateData=function(n,i){var r={};if(n&&!n.labelSize||Object.assign(r,{size:yr(this.n,this.labelSize)}),!n||n.labelColor){var o=new Fe(this.labelColor);Object.assign(r,{color:tn(this.n,o.r,o.g,o.b)})}this.textBuffer.setAttributes(r)},t.prototype.setParameters=function(n,i,r){return i===void 0&&(i={}),r===void 0&&(r=!1),n&&n.labelSize&&(i.labelSize=!0),n&&(n.labelColor||n.labelColor===0)&&(i.labelColor=!0,r=!0),e.prototype.setParameters.call(this,n,i,r),n&&n.opacity!==void 0&&this.textBuffer.setParameters({opacity:1}),n&&n.labelVisible!==void 0&&this.setVisibility(this.visible),this},t.prototype.setVisibility=function(n,i){return e.prototype.setVisibility.call(this,n,!0),this.textBuffer&&this.textBuffer.setVisibility(this.labelVisible&&this.visible),i||this.viewer.requestRender(),this},t.prototype.getLabelBufferParams=function(n){return n===void 0&&(n={}),e.prototype.getBufferParams.call(this,Object.assign({fontFamily:this.labelFontFamily,fontStyle:this.labelFontStyle,fontWeight:this.labelFontWeight,sdf:this.labelsdf,xOffset:this.labelXOffset,yOffset:this.labelYOffset,zOffset:this.labelZOffset,attachment:this.labelAttachment,showBorder:this.labelBorder,borderColor:this.labelBorderColor,borderWidth:this.labelBorderWidth,showBackground:this.labelBackground,backgroundColor:this.labelBackgroundColor,backgroundMargin:this.labelBackgroundMargin,backgroundOpacity:this.labelBackgroundOpacity,fixedSize:this.labelFixedSize,disablePicking:!0,visible:this.labelVisible},n,{opacity:1}))},t.prototype.getAtomRadius=function(){return 0},t}(yi);function H_(e,t){var n=e.getAtomProxy(),i=new Jt,r=t.length;if(r===0)return new Float32Array(0);var o=t[0].length,s=e.getAtomSet(),a=new Float32Array(r*o*3),c=0;return t.forEach(function(l){for(var u=!1,h=0;h<o;h++){var f=l[h];if(typeof f=="number"&&Number.isInteger(f)){if(!s.get(f)){u=!0;break}n.index=f}else{i.setString(f);var p=e.getAtomIndices(i);if(!p.length){u=!0;break}n.index=p[0]}var m=c+3*h;a[m++]=n.x,a[m++]=n.y,a[m++]=n.z}u||(c+=3*o)}),a.subarray(0,c)}function Qr(e,t,n,i,r){var o=Math.cos(r),s=Math.sin(r);e[0]=t[0]+n[0]*o+i[0]*s,e[1]=t[1]+n[1]*o+i[1]*s,e[2]=t[2]+n[2]*o+i[2]*s}function wM(e,t,n,i,r,o,s){for(var a=0;a<t;a++){for(var c=0;c<n;c++)i[c]=e[c*t+a];SM(i,r,o,s,n);for(var l=0;l<n;l++)e[l*t+a]=r[l]}for(var u=0;u<n;u++){for(var h=0;h<t;h++)i[h]=e[u*t+h];SM(i,r,o,s,t);for(var f=0;f<t;f++)e[u*t+f]=Math.sqrt(r[f])}}function SM(e,t,n,i,r){n[0]=0,i[0]=Number.MIN_SAFE_INTEGER,i[1]=Number.MAX_SAFE_INTEGER;for(var o=1,s=0;o<r;o++){for(var a=(e[o]+o*o-(e[n[s]]+n[s]*n[s]))/(2*o-2*n[s]);a<=i[s];)s--,a=(e[o]+o*o-(e[n[s]]+n[s]*n[s]))/(2*o-2*n[s]);n[++s]=o,i[s]=a,i[s+1]=Number.MAX_SAFE_INTEGER}for(var c=0,l=0;c<r;c++){for(;i[l+1]<c;)l++;t[c]=(c-n[l])*(c-n[l])+e[n[l]]}}jt.add("shader/SDFFont.vert",`uniform float clipNear;
uniform float clipRadius;
uniform vec3 clipCenter;
uniform float xOffset;
uniform float yOffset;
uniform float zOffset;
uniform bool ortho;
uniform float canvasHeight;
uniform float pixelRatio;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
varying vec2 texCoord;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#endif
attribute vec2 mapping;
attribute vec2 inputTexCoord;
attribute float inputSize;
#include matrix_scale
#include common
void main(void){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
texCoord = inputTexCoord;
float scale = matrixScale( modelViewMatrix );
float _xOffset = xOffset * scale;
float _yOffset = yOffset * scale;
float _zOffset = zOffset * scale;
if( texCoord.x == 10.0 ){
_zOffset -= 0.001;
}
vec4 cameraPos = modelViewMatrix * vec4( position, 1.0 );
#ifdef FIXED_SIZE
if ( ortho ) {
scale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPosition.z) * 0.1;
} else {
scale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPos.z) * 0.1;
}
#endif
vec4 cameraCornerPos = vec4( cameraPos.xyz, 1.0 );
cameraCornerPos.xy += mapping * inputSize * 0.01 * scale;
cameraCornerPos.x += _xOffset;
cameraCornerPos.y += _yOffset;
if( ortho ){
cameraCornerPos.xyz += normalize( -cameraPosition ) * _zOffset;
} else {
cameraCornerPos.xyz += normalize( -cameraCornerPos.xyz ) * _zOffset;
}
gl_Position = projectionMatrix * cameraCornerPos;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
vViewPosition = -cameraCornerPos.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
#include radiusclip_vertex
}`),jt.add("shader/SDFFont.frag",`uniform sampler2D fontTexture;
uniform float opacity;
uniform bool showBorder;
uniform vec3 borderColor;
uniform float borderWidth;
uniform vec3 backgroundColor;
uniform float backgroundOpacity;
uniform float clipNear;
uniform float clipRadius;
varying vec3 vViewPosition;
varying vec2 texCoord;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
const vec3 vColor = vec3( 0.0 );
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#endif
const float gamma = 2.2 * 1.4142 / 128.0;
const float padding = 0.75;
void main(){
#include nearclip_fragment
#include radiusclip_fragment
if( texCoord.x > 1.0 ){
gl_FragColor = vec4( backgroundColor, backgroundOpacity );
}else{
float sdf = texture2D( fontTexture, texCoord ).a;
if( showBorder ) sdf += borderWidth;
float a = smoothstep(padding - gamma, padding + gamma, sdf);
if( a < 0.2 ) discard;
a *= opacity;
vec3 outgoingLight = vColor;
if( showBorder && sdf < ( padding + borderWidth ) ){
outgoingLight = borderColor;
}
gl_FragColor = vec4( outgoingLight, a );
}
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include encodings_fragment
#include fog_fragment
#endif
}`);var wy={},az={font:"sans-serif",size:36,style:"normal",variant:"normal",weight:"normal",outline:3,width:1024,height:1024},Mm=function(e){e===void 0&&(e={}),this.gamma=1,this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.25,this.parameters=br(e,az);var t=this.parameters;this.radius=t.size/8,this.padding=t.size/3;var n=this.lineHeight=t.size+2*t.outline+Math.round(t.size/4),i=this.maxWidth=t.width/4,r=this.canvas=document.createElement("canvas");r.width=i,r.height=n;var o=this.context=this.canvas.getContext("2d");o.font=t.style+" "+t.variant+" "+t.weight+" "+t.size+"px "+t.font,o.fillStyle="black",o.textAlign="left",o.textBaseline="bottom",o.lineJoin="round",this.gridOuter=new Float64Array(n*i),this.gridInner=new Float64Array(n*i),this.f=new Float64Array(Math.max(n,i)),this.d=new Float64Array(Math.max(n,i)),this.z=new Float64Array(Math.max(n,i)+1),this.v=new Int16Array(Math.max(n,i)),this.data=new Uint8Array(t.width*t.height*4),this.canvas2=document.createElement("canvas"),this.canvas2.width=t.width,this.canvas2.height=t.height,this.context2=this.canvas2.getContext("2d"),this.placeholder=this.map(String.fromCharCode(65533));for(var s=32;s<=126;++s)this.map(String.fromCharCode(s));this.map(String.fromCharCode(176)),this.map(String.fromCharCode(8491)),this.texture=new Of(this.canvas2),this.texture.flipY=!1,this.texture.needsUpdate=!0};Mm.prototype.map=function(e){var t=this.parameters;return this.mapped[e]===void 0&&(this.draw(e),this.currentX+this.scratchW>t.width&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>t.height&&console.warn("canvas to small"),this.mapped[e]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH},this.context2.drawImage(this.canvas,0,0,this.scratchW,this.scratchH,this.currentX,this.currentY,this.scratchW,this.scratchH),this.currentX+=this.scratchW),this.mapped[e]},Mm.prototype.get=function(e){return this.mapped[e]||this.placeholder},Mm.prototype.draw=function(e){var t=this.parameters,n=this.lineHeight,i=t.outline,r=this.context,o=this.maxWidth,s=i,a=n-t.outline,c=r.measureText(e),l=Math.min(o,Math.ceil(c.width+2*s+1)),u=l*n;r.clearRect(0,0,l,n),r.fillText(e,s,a);for(var h=r.getImageData(0,0,l,n),f=h.data,p=0;p<u;p++){var m=h.data[4*p+3]/255;this.gridOuter[p]=m===1?0:m===0?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-m),2),this.gridInner[p]=m===1?Number.MAX_SAFE_INTEGER:m===0?0:Math.pow(Math.max(0,m-.5),2)}wM(this.gridOuter,l,n,this.f,this.d,this.v,this.z),wM(this.gridInner,l,n,this.f,this.d,this.v,this.z);for(var y=0;y<u;y++){var v=this.gridOuter[y]-this.gridInner[y];f[4*y+3]=Math.max(0,Math.min(255,Math.round(255-255*(v/this.radius+this.cutoff))))}r.putImageData(h,0,0),this.scratchW=l,this.scratchH=n};var cz=Object.assign({fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"bold",fontSize:36,xOffset:0,yOffset:0,zOffset:.5,attachment:"bottom-left",showBorder:!1,borderColor:"lightgrey",borderWidth:.15,showBackground:!1,backgroundColor:"lightgrey",backgroundMargin:.5,backgroundOpacity:1,forceTransparent:!0,fixedSize:!1},Vi),lz=Object.assign({fontFamily:{uniform:!0},fontStyle:{uniform:!0},fontWeight:{uniform:!0},fontSize:{uniform:!0},xOffset:{uniform:!0},yOffset:{uniform:!0},zOffset:{uniform:!0},showBorder:{uniform:!0},borderColor:{uniform:!0},borderWidth:{uniform:!0},backgroundColor:{uniform:!0},backgroundOpacity:{uniform:!0},fixedSize:{updateShader:!0}},kc);function MM(e,t){for(var n=e.position.length/3,i=0,r=0;r<n;++r)i+=e.text[r].length;return t.showBackground&&(i+=n),i}var Nu=function(e){function t(i,r){r===void 0&&(r={}),e.call(this,{position:new Float32Array(3*MM(i,r)),color:new Float32Array(3*MM(i,r)),picking:new NN},r),this.parameterTypes=lz,this.alwaysTransparent=!0,this.hasWireframe=!1,this.isText=!0,this.vertexShader="SDFFont.vert",this.fragmentShader="SDFFont.frag",this.text=i.text,this.positionCount=i.position.length/3,this.addUniforms({fontTexture:{value:null},xOffset:{value:this.parameters.xOffset},yOffset:{value:this.parameters.yOffset},zOffset:{value:this.parameters.zOffset},ortho:{value:!1},showBorder:{value:this.parameters.showBorder},borderColor:{value:new Fe(this.parameters.borderColor)},borderWidth:{value:this.parameters.borderWidth},backgroundColor:{value:new Fe(this.parameters.backgroundColor)},backgroundOpacity:{value:this.parameters.backgroundOpacity},canvasHeight:{value:1},pixelRatio:{value:1}}),this.addAttributes({inputTexCoord:{type:"v2",value:null},inputSize:{type:"f",value:null}}),this.setAttributes(i),this.makeTexture(),this.makeMapping()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultParameters:{configurable:!0}};return n.defaultParameters.get=function(){return cz},t.prototype.makeMaterial=function(){e.prototype.makeMaterial.call(this);var i=this.texture,r=this.material;r.transparent=!0,r.extensions.derivatives=!0,r.lights=!1,r.uniforms.fontTexture.value=i,r.needsUpdate=!0;var o=this.wireframeMaterial;o.transparent=!0,o.extensions.derivatives=!0,o.lights=!1,o.uniforms.fontTexture.value=i,o.needsUpdate=!0;var s=this.pickingMaterial;s.extensions.derivatives=!0,s.lights=!1,s.uniforms.fontTexture.value=i,s.needsUpdate=!0},t.prototype.setAttributes=function(i){var r,o,s,a,c,l;i===void 0&&(i={});var u=this.text,h=this.geometry.attributes;i.position&&(r=i.position,a=h.position.array,h.position.needsUpdate=!0),i.size&&(o=i.size,c=h.inputSize.array,h.inputSize.needsUpdate=!0),i.color&&(s=i.color,l=h.color.array,h.color.needsUpdate=!0);for(var f,p,m,y,v=this.positionCount,d=0,g=0;g<v;++g)for(p=3*g,y=u[g].length,this.parameters.showBackground&&(y+=1),m=0;m<y;++m,++d)for(var b=0;b<4;b++)f=4*d*3+3*b,r&&(a[f]=r[p],a[f+1]=r[p+1],a[f+2]=r[p+2]),o&&(c[4*d+b]=o[g]),s&&(l[f]=s[p],l[f+1]=s[p+1],l[f+2]=s[p+2])},t.prototype.makeTexture=function(){var i,r;this.textAtlas=(i={font:this.parameters.fontFamily,style:this.parameters.fontStyle,weight:this.parameters.fontWeight,size:this.parameters.fontSize},r=JSON.stringify(i),wy[r]===void 0&&(wy[r]=new Mm(i)),wy[r]),this.texture=this.textAtlas.texture},t.prototype.makeMapping=function(){for(var i,r,o,s,a,c,l,u,h=this.textAtlas,f=this.text,p=this.parameters.attachment,m=h.lineHeight*this.parameters.backgroundMargin*.1-10,y=this.geometry.attributes,v=y.inputTexCoord.array,d=y.mapping.array,g=this.positionCount,b=0,x=0;x<g;++x){for(s=0,c=(o=f[x]).length,a=0;a<c;++a)s+=(i=h.get(o[a])).w-2*h.parameters.outline;for(u=p.startsWith("top")?h.lineHeight/1.25:p.startsWith("middle")?h.lineHeight/2.5:0,l=p.endsWith("right")?s:p.endsWith("center")?s/2:0,l+=h.parameters.outline,u+=h.parameters.outline,this.parameters.showBackground&&(d[(r=2*b*4)+0]=-h.lineHeight/6-l-m,d[r+1]=h.lineHeight-u+m,d[r+2]=-h.lineHeight/6-l-m,d[r+3]=0-u-m,d[r+4]=s+h.lineHeight/6-l+2*h.parameters.outline+m,d[r+5]=h.lineHeight-u+m,d[r+6]=s+h.lineHeight/6-l+2*h.parameters.outline+m,d[r+7]=0-u-m,v[r+0]=10,v[r+2]=10,v[r+4]=10,v[r+6]=10,b+=1),s=0,a=0;a<c;++a,++b){i=h.get(o[a]),d[(r=2*b*4)+0]=s-l,d[r+1]=i.h-u,d[r+2]=s-l,d[r+3]=0-u,d[r+4]=s+i.w-l,d[r+5]=i.h-u,d[r+6]=s+i.w-l,d[r+7]=0-u;var _=h.parameters.width,S=h.parameters.height,w=[i.x/_,i.y/S,i.x/_,(i.y+i.h)/S,(i.x+i.w)/_,i.y/S,(i.x+i.w)/_,(i.y+i.h)/S];v.set(w,r),s+=i.w-2*h.parameters.outline}}y.inputTexCoord.needsUpdate=!0,y.mapping.needsUpdate=!0},t.prototype.getDefines=function(i){var r=e.prototype.getDefines.call(this,i);return this.parameters.fixedSize&&(r.FIXED_SIZE=1),r},t.prototype.setUniforms=function(i){!i||i.fontFamily===void 0&&i.fontStyle===void 0&&i.fontWeight===void 0&&i.fontSize===void 0||(this.makeTexture(),this.makeMapping(),this.texture.needsUpdate=!0,i.fontTexture=this.texture),e.prototype.setUniforms.call(this,i)},Object.defineProperties(t.prototype,n),t}(z_);_r.add("text",Nu),jt.add("shader/WideLine.vert",`
uniform float clipNear;
uniform vec3 clipCenter;
uniform float linewidth;
uniform vec2 resolution;
uniform mat4 projectionMatrixInverse;
attribute vec2 mapping;
attribute vec3 position1;
attribute vec3 position2;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor;
varying vec3 vColor2;
varying float flag;
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
void trimSegment( const in vec4 start, inout vec4 end ) {
float a = projectionMatrix[ 2 ][ 2 ]; float b = projectionMatrix[ 3 ][ 2 ]; float nearEstimate = - 0.5 * b / a;
float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );
end.xyz = mix( start.xyz, end.xyz, alpha );
}
void main() {
float aspect = resolution.x / resolution.y;
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
flag = mapping.y;
vColor = color;
vColor2 = color2;
#endif
vec4 start = modelViewMatrix * vec4( position1, 1.0 );
vec4 end = modelViewMatrix * vec4( position2, 1.0 );
bool perspective = ( projectionMatrix[ 2 ][ 3 ] == -1.0 ); if ( perspective ) {
if ( start.z < 0.0 && end.z >= 0.0 ) {
trimSegment( start, end );
} else if ( end.z < 0.0 && start.z >= 0.0 ) {
trimSegment( end, start );
}
}
vec4 clipStart = projectionMatrix * start;
vec4 clipEnd = projectionMatrix * end;
vec2 ndcStart = clipStart.xy / clipStart.w;
vec2 ndcEnd = clipEnd.xy / clipEnd.w;
vec2 dir = ndcEnd - ndcStart;
dir.x *= aspect;
dir = normalize( dir );
vec2 offset = vec2( dir.y, - dir.x );
dir.x /= aspect;
offset.x /= aspect;
if ( mapping.x < 0.0 ) offset *= - 1.0;
offset *= linewidth;
offset /= resolution.y;
vec4 clip = ( mapping.y < 0.5 ) ? clipStart : clipEnd;
offset *= clip.w;
clip.xy += offset;
gl_Position = clip;
#ifndef PICKING
vViewPosition = ( projectionMatrixInverse * clip ).xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`),jt.add("shader/WideLine.frag",`uniform vec3 diffuse;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include fog_pars_fragment
varying vec3 vViewPosition;
varying vec3 vColor;
varying vec3 vColor2;
varying float flag;
#endif
void main() {
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 outgoingLight = vec3( 0.0 );
vec4 diffuseColor = vec4( diffuse, 1.0 );
if ( flag < 0.0 ) {
diffuseColor.rgb *= vColor;
} else {
diffuseColor.rgb *= vColor2;
}
#include alphatest_fragment
outgoingLight = diffuseColor.rgb;
gl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include encodings_fragment
#include fog_fragment
#endif
}`);var uz=Object.assign({linewidth:2},Vi),hz=Object.assign({linewidth:{uniform:!0}},kc),Ps=function(e){function t(i,r){r===void 0&&(r={}),e.call(this,i,r),this.parameterTypes=hz,this.vertexShader="WideLine.vert",this.fragmentShader="WideLine.frag",!i.color2&&i.color&&(i.color2=i.color),this.addUniforms({linewidth:{value:this.parameters.linewidth},resolution:{value:new Ee},projectionMatrixInverse:{value:new De}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null}}),this.setAttributes(i),this.makeMapping()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultParameters:{configurable:!0}};return n.defaultParameters.get=function(){return uz},t.prototype.setParameters=function(i){e.prototype.setParameters.call(this,i)},Object.defineProperties(t.prototype,n),t}(z_);_r.add("wideline",Ps);var fz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="angle",this.parameters=Object.assign({atomTriple:{type:"hidden",rebuild:!0},vectorVisible:{type:"boolean",default:!0},arcVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.side=O(i.side,"double"),i.opacity=O(i.opacity,.5),this.atomTriple=O(i.atomTriple,[]),this.arcVisible=O(i.arcVisible,!0),this.sectorVisible=O(i.sectorVisible,!0),this.vectorVisible=O(i.vectorVisible,!0),e.prototype.init.call(this,i)},t.prototype.createData=function(n){if(n.atomCount&&this.atomTriple.length){var i=function(c,l){return function(u){for(var h=[],f=u.length/9,p=0;p<f;p++){for(var m=!0,y=p;y<p+3;y+=3)u[y]===u[y+3]&&u[y+1]===u[y+4]&&u[y+2]===u[y+5]&&(m=!1);m&&h.push(p)}var v=new Float32Array(9*h.length),d=0;return h.forEach(function(g){Wn(u,v,9*g,9*d,9),d++}),v}(H_(c,l))}(n,this.atomTriple),r=function(c,l){l===void 0&&(l={});for(var u=O(l.angleStep,Math.PI/90),h=c.length/9,f=new Float32Array(h),p=new Float32Array(3*h),m=new Array(h),y=new Float32Array(6*h),v=new Float32Array(6*h),d=new Array(h),g=new Array(h),b=new Array(h),x=0,_=xt(),S=xt(),w=xt(),C=xt(),A=xt(),k=xt(),L=xt(),D=xt(),F=xt(),I=function(ce){var se=9*ce;Fi(_,c,se),Fi(S,c,se+3),Fi(w,c,se+6);var ue=6*ce;At(_,y,ue),At(S,v,ue),At(S,y,ue+3),At(w,v,ue+3),Sn(C,_,S),Sn(A,w,S),Pn(C,C),Pn(A,A),tr(k,C,A);var H=xa(k),j=qi(C,A),X=f[ce]=Math.atan2(H,j);m[ce]=(PT*X).toFixed(1)+String.fromCharCode(176),xa(k)===0&&(k[0]=1,k[1]=0,k[2]=0),tr(L,k,C),Pn(L,L),Qr(D,S,C,L,X/2),At(D,p,3*ce);var ie=Math.ceil(X/u),fe=new Float32Array(9*ie);b[ce]=fe;var me=new Float32Array(3*ie),ve=new Float32Array(3*ie);d[ce]=me,g[ce]=ve,to(F,S,C);for(var G=function(le,ne){var oe=9*ne,xe=3*ne;At(S,fe,oe),At(F,fe,oe+3),At(F,me,xe),Qr(F,S,C,L,le),At(F,fe,oe+6),At(F,ve,xe)},V=0,pe=u;pe<X;pe+=u)G(pe,V),V++;G(X,V),x+=ie},P=0;P<h;P++)I(P);for(var N=3*x,$=9*x,B=new Float32Array(N),q=new Float32Array(N),ee=new Float32Array($),W=0,Q=0,Z=0;Z<h;Z++){var re=d[Z],he=g[Z];Wn(re,B,0,Q,re.length),Wn(he,q,0,Q,he.length),Q+=re.length;var K=b[Z];Wn(K,ee,0,W,K.length),W+=K.length}return{labelPosition:p,labelText:m,vectorPosition1:y,vectorPosition2:v,arcPosition1:B,arcPosition2:q,sectorPosition:ee}}(i),o=this.n=r.labelPosition.length/3,s=new Fe(this.labelColor);this.textBuffer=new Nu({position:r.labelPosition,size:yr(o,this.labelSize),color:tn(o,s.r,s.g,s.b),text:r.labelText},this.getLabelBufferParams());var a=new Fe(this.colorValue);return this.vectorBuffer=new Ps(Yx({position1:r.vectorPosition1,position2:r.vectorPosition2,color:tn(2*o,a.r,a.g,a.b),color2:tn(2*o,a.r,a.g,a.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.vectorVisible,opacity:this.lineOpacity})),this.arcLength=r.arcPosition1.length/3,this.arcBuffer=new Ps(Yx({position1:r.arcPosition1,position2:r.arcPosition2,color:tn(this.arcLength,a.r,a.g,a.b),color2:tn(this.arcLength,a.r,a.g,a.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.arcVisible,opacity:this.lineOpacity})),this.sectorLength=r.sectorPosition.length/3,this.sectorBuffer=new Cs({position:r.sectorPosition,color:tn(this.sectorLength,a.r,a.g,a.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.vectorBuffer,this.arcBuffer,this.sectorBuffer]}}},t.prototype.updateData=function(n,i){e.prototype.updateData.call(this,n,i);var r={},o={},s={};if(n.color){var a=new Fe(this.colorValue);Object.assign(r,{color:tn(2*this.n,a.r,a.g,a.b),color2:tn(2*this.n,a.r,a.g,a.b)}),Object.assign(o,{color:tn(this.arcLength,a.r,a.g,a.b),color2:tn(this.arcLength,a.r,a.g,a.b)}),Object.assign(s,{color:tn(this.sectorLength,a.r,a.g,a.b)})}this.vectorBuffer.setAttributes(r),this.arcBuffer.setAttributes(o),this.sectorBuffer.setAttributes(s)},t.prototype.setParameters=function(n){return e.prototype.setParameters.call(this,n,{},!1),!n||n.vectorVisible===void 0&&n.arcVisible===void 0&&n.sectorVisible===void 0||this.setVisibility(this.visible),n&&n.lineOpacity&&(this.vectorBuffer.setParameters({opacity:n.lineOpacity}),this.arcBuffer.setParameters({opacity:n.lineOpacity})),n&&n.opacity!==void 0&&(this.vectorBuffer.setParameters({opacity:this.lineOpacity}),this.arcBuffer.setParameters({opacity:this.lineOpacity})),n&&n.linewidth&&(this.vectorBuffer.setParameters({linewidth:n.linewidth}),this.arcBuffer.setParameters({linewidth:n.linewidth})),this},t.prototype.setVisibility=function(n,i){return e.prototype.setVisibility.call(this,n,!0),this.vectorBuffer&&this.vectorBuffer.setVisibility(this.vectorVisible&&this.visible),this.arcBuffer&&this.arcBuffer.setVisibility(this.arcVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),i||this.viewer.requestRender(),this},t}(V_);yn.add("angle",fz);var AM=new T,Sy=new T,My=new T,pz=new T(0,1,0),j_=Object.assign({radialSegments:1,openEnded:!0},Vi);function CM(e){e===void 0&&(e={});var t=O(e.radialSegments,10),n=O(e.openEnded,!0),i=new De().makeRotationX(Math.PI/2),r=new _s(1,1,1,t,1,n);return r.applyMatrix4(i),r}var uE=function(e){function t(i,r){r===void 0&&(r={}),e.call(this,function(a,c){c===void 0&&(c={});var l=CM(c),u=a.position1.length,h=l.attributes.position.array.length/3,f=u/3,p=new Float32Array(2*f*h);return Wx(f,h,0,p),Wx(f,h,f*h,p),{position:new Float32Array(2*u),color:new Float32Array(2*u),primitiveId:p,picking:a.picking}}(i,r),r,CM(r)),this.updateNormals=!0;var o=i.position1.length,s=i.radius.length;this.__center=new Float32Array(o),this._position=new Float32Array(2*o),this._color=new Float32Array(2*o),this._from=new Float32Array(2*o),this._to=new Float32Array(2*o),this._radius=new Float32Array(2*s),this.setAttributes(i,!0)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultParameters:{configurable:!0}};return n.defaultParameters.get=function(){return j_},t.prototype.applyPositionTransform=function(i,r,o){Sy.fromArray(this._from,o),My.fromArray(this._to,o),i.lookAt(Sy,My,pz);var s=this._radius[r];AM.set(s,s,Sy.distanceTo(My)),i.scale(AM)},t.prototype.setAttributes=function(i,r){i===void 0&&(i={});var o={};i.position1&&i.position2&&(No(i.position1,i.position2,this.__center),No(i.position1,this.__center,this._position),No(this.__center,i.position2,this._position,i.position1.length),this._from.set(i.position1),this._from.set(this.__center,i.position1.length),this._to.set(this.__center),this._to.set(i.position2,this.__center.length),o.position=this._position),i.color&&i.color2&&(this._color.set(i.color),this._color.set(i.color2,i.color.length),o.color=this._color),i.radius&&(this._radius.set(i.radius),this._radius.set(i.radius,i.radius.length),o.radius=this._radius),e.prototype.setAttributes.call(this,o,r)},Object.defineProperties(t.prototype,n),t}(Oa);jt.add("shader/CylinderImpostor.vert",`
attribute vec3 mapping;
attribute vec3 position1;
attribute vec3 position2;
attribute float radius;
varying vec3 axis;varying vec4 base_radius;varying vec4 end_b;varying vec3 U;varying vec3 V;
varying vec4 w;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor1;
varying vec3 vColor2;
#endif
uniform mat4 modelViewMatrixInverse;
uniform float ortho;
#include matrix_scale
void main(){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
vColor1 = color;
vColor2 = color2;
#endif
base_radius.w = radius * matrixScale( modelViewMatrix );
vec3 center = position;
vec3 dir = normalize( position2 - position1 );
float ext = length( position2 - position1 ) / 2.0;
vec3 cam_dir;
if( ortho == 0.0 ){
cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;
}else{
cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;
}
cam_dir = normalize( cam_dir );
vec3 ldir;
float b = dot( cam_dir, dir );
end_b.w = b;
if( b < 0.0 )
ldir = -ext * dir;
else
ldir = ext * dir;
vec3 left = radius * normalize( cross( cam_dir, ldir ) );
vec3 up = radius * normalize( cross( left, ldir ) );
axis = normalize( normalMatrix * ldir );
U = normalize( normalMatrix * up );
V = normalize( normalMatrix * left );
vec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );
base_radius.xyz = base4.xyz / base4.w;
vec4 end4 = modelViewMatrix * vec4( center + ldir, 1.0 );
end_b.xyz = end4.xyz / end4.w;
w = modelViewMatrix * vec4(
center + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0
);
gl_Position = projectionMatrix * w;
gl_Position.z = 0.99;
}`),jt.add("shader/CylinderImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform mat4 projectionMatrix;
uniform float ortho;
varying vec3 axis;
varying vec4 base_radius;
varying vec4 end_b;
varying vec3 U;
varying vec3 V;
varying vec4 w;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
varying vec3 vColor1;
varying vec3 vColor2;
#include common
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool interior = false;
float distSq3( vec3 v3a, vec3 v3b ){
return (
( v3a.x - v3b.x ) * ( v3a.x - v3b.x ) +
( v3a.y - v3b.y ) * ( v3a.y - v3b.y ) +
( v3a.z - v3b.z ) * ( v3a.z - v3b.z )
);
}
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
float calcClip( vec3 cameraPos ){
return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
void main(){
vec3 ray_target = w.xyz / w.w;
vec3 base = base_radius.xyz; float vRadius = base_radius.w; vec3 end = end_b.xyz; float b = end_b.w;
vec3 ray_origin = vec3(0.0); vec3 ortho_ray_direction = vec3(0.0, 0.0, 1.0); vec3 persp_ray_direction = normalize(ray_origin - ray_target);
vec3 ray_direction = mix(persp_ray_direction, ortho_ray_direction, ortho);

mat3 basis = mat3( U, V, axis );
vec3 diff = ray_target - 0.5 * (base + end);

vec3 P = diff * basis;
float dz = dot( axis, ray_direction );
float radius2 = vRadius*vRadius;
vec3 D = vec3(dot(U, ray_direction),
dot(V, ray_direction),
dz);
float a0 = P.x*P.x + P.y*P.y - radius2;
float a1 = P.x*D.x + P.y*D.y;
float a2 = D.x*D.x + D.y*D.y;
float d = a1*a1 - a0*a2;
if (d < 0.0) {
discard;
}
float dist = (-a1 + sqrt(d)) / a2;
vec3 surface_point = ray_target + dist * ray_direction;
vec3 base_to_surface = surface_point - base;
vec3 _normal = normalize( base_to_surface - axis * dot(base_to_surface, axis) );
float base_cap_test = dot( base_to_surface, axis );
float end_cap_test = dot((surface_point - end), axis);
#ifndef CAP
vec3 new_point2 = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
vec3 tmp_point2 = new_point2 - base;
#endif
if (base_cap_test < 0.0) {
float dNV;
float near;
vec3 front_point;
if ( ortho == 1.0 ) {
front_point = ray_target;
} else {
dNV = dot(-axis, ray_direction);
near = dot(-axis, (base)) / dNV;
front_point = ray_direction * near + ray_origin;
}
if (dot(front_point - base, front_point-base) > radius2) {
discard;
}
#ifdef CAP
surface_point = front_point;
_normal = axis;
#else
surface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
dNV = dot(-axis, ray_direction);
near = dot(axis, end) / dNV;
new_point2 = ray_direction * near + ray_origin;
if (dot(new_point2 - end, new_point2-base) < radius2) {
discard;
}
interior = true;
#endif
}
if( end_cap_test > 0.0 )
{
float dNV;
float near;
vec3 end_point;
if ( ortho == 1.0 ) {
end_point = ray_target;
} else {
dNV = dot(axis, ray_direction);
if (dNV < 0.0) {
discard;
}
near = dot(axis, end) / dNV;
end_point = ray_direction * near + ray_origin;
}

if( dot(end_point - end, end_point-base) > radius2 ) {
discard;
}
#ifdef CAP
surface_point = end_point;
_normal = axis;
#else
surface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
dNV = dot(-axis, ray_direction);
near = dot(-axis, (base)) / dNV;
new_point2 = ray_direction * near + ray_origin;
if (dot(new_point2 - base, new_point2-base) < radius2) {
discard;
}
interior = true;
#endif
}
gl_FragDepthEXT = calcDepth( surface_point );

#ifdef NEAR_CLIP
if( calcClip( surface_point ) > 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
surface_point = ray_target + dist * ray_direction;
if( calcClip( surface_point ) > 0.0 ) {
discard;
}
interior = true;
gl_FragDepthEXT = calcDepth( surface_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );
}
}else if( gl_FragDepthEXT <= 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
surface_point = ray_target + dist * ray_direction;
interior = true;
gl_FragDepthEXT = calcDepth( surface_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
}
#else
if( gl_FragDepthEXT <= 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
surface_point = ray_target + dist * ray_direction;
interior = true;
gl_FragDepthEXT = calcDepth( surface_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
}
#endif
if (gl_FragDepthEXT < 0.0) {
discard;
}
if (gl_FragDepthEXT > 1.0) {
discard;
}
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vViewPosition = -surface_point;
vec3 vNormal = _normal;
vec3 vColor;
if( distSq3( surface_point, end ) < distSq3( surface_point, base ) ){
if( b < 0.0 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
}else{
if( b > 0.0 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
}
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
vec3 normal = normalize( vNormal );
vec3 geometryNormal = normal;
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include encodings_fragment
#include fog_fragment
#endif
}`);var dz=new Float32Array([-1,1,-1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]),mz=new Uint16Array([0,1,2,1,4,2,2,4,3,4,5,3]),gz=function(e){function t(i,r){r===void 0&&(r={}),e.call(this,"v3",i,r)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={mapping:{configurable:!0},mappingIndices:{configurable:!0},mappingIndicesSize:{configurable:!0},mappingSize:{configurable:!0},mappingItemSize:{configurable:!0}};return n.mapping.get=function(){return dz},n.mappingIndices.get=function(){return mz},n.mappingIndicesSize.get=function(){return 12},n.mappingSize.get=function(){return 6},n.mappingItemSize.get=function(){return 3},Object.defineProperties(t.prototype,n),t}(N_),hE=Object.assign({openEnded:!1},Vi),yz=Object.assign({openEnded:{updateShader:!0}},kc),vz=function(e){function t(i,r){r===void 0&&(r={}),e.call(this,i,r),this.parameterTypes=yz,this.isImpostor=!0,this.vertexShader="CylinderImpostor.vert",this.fragmentShader="CylinderImpostor.frag",this.addUniforms({modelViewMatrixInverse:{value:new De},ortho:{value:0}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null}}),this.setAttributes(i),this.makeMapping()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultParameters:{configurable:!0}};return n.defaultParameters.get=function(){return hE},t.prototype.getDefines=function(i){var r=e.prototype.getDefines.call(this,i);return this.parameters.openEnded||(r.CAP=1),r},Object.defineProperties(t.prototype,n),t}(gz);Object.assign({disableImpostor:!1},j_,hE);var Ls=function(e,t){return t===void 0&&(t={}),!e.color2&&e.color&&(e.color2=e.color),!Fo||t&&t.disableImpostor?new uE(e,t):new vz(e,t)};_r.add("cylinder",Ls);var xz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="axes",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0,showAxes:{type:"boolean",rebuild:!0},showBox:{type:"boolean",rebuild:!0}},this.parameters,{assembly:null}),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.radiusSize=O(i.radiusSize,.5),i.colorValue=O(i.colorValue,"lightgreen"),i.useInteriorColor=O(i.useInteriorColor,!0),this.showAxes=O(i.showAxes,!0),this.showBox=O(i.showBox,!1),e.prototype.init.call(this,i)},t.prototype.getPrincipalAxes=function(){var n,i=this.getAssembly();return i&&(n=i.partList[0].getSelection()),this.structureView.getPrincipalAxes(n)},t.prototype.getAxesData=function(n){var i=this.getPrincipalAxes(),r=new Fe(this.colorValue),o=0,s=0;this.showAxes&&(o+=6,s+=3),this.showBox&&(o+=8,s+=12);var a=new Float32Array(3*o),c=tn(o,r.r,r.g,r.b),l=yr(o,this.radiusSize),u=new Float32Array(3*s),h=new Float32Array(3*s),f=tn(s,r.r,r.g,r.b),p=yr(s,this.radiusSize),m=0;if(this.showAxes){var y=function(F,I){F.toArray(a,2*m),I.toArray(a,2*m+3),F.toArray(u,m),I.toArray(h,m),m+=3};y(i.begA,i.endA),y(i.begB,i.endB),y(i.begC,i.endC)}if(this.showBox){var v=new T,d=i.getProjectedScaleForAtoms(n),g=d.d1a,b=d.d2a,x=d.d3a,_=d.d1b,S=d.d2b,w=d.d3b,C=2*m,A=function(F,I,P){v.copy(i.center).addScaledVector(i.normVecA,F).addScaledVector(i.normVecB,I).addScaledVector(i.normVecC,P),v.toArray(a,C),C+=3};A(g,b,x),A(g,b,w),A(g,S,w),A(g,S,x),A(_,S,w),A(_,S,x),A(_,b,x),A(_,b,w);var k=m,L=function(F,I){v.fromArray(a,2*m+3*F).toArray(u,k),v.fromArray(a,2*m+3*I).toArray(h,k),k+=3};L(0,1),L(0,3),L(0,6),L(1,2),L(1,7),L(2,3),L(2,4),L(3,5),L(4,5),L(4,7),L(5,6),L(6,7)}var D=new IN(i);return{vertex:{position:a,color:c,radius:l,picking:D},edge:{position1:u,position2:h,color:f,color2:f,radius:p,picking:D}}},t.prototype.create=function(){var n=this.getAxesData(this.structureView);this.sphereBuffer=new ka(n.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new Ls(n.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})},t.prototype.createData=function(n){},t.prototype.updateData=function(n,i){var r=this.getAxesData(i.sview),o={},s={};n&&!n.position||(Object.assign(o,{position:r.vertex.position}),Object.assign(s,{position1:r.edge.position1,position2:r.edge.position2})),n&&!n.color||(Object.assign(o,{color:r.vertex.color}),Object.assign(s,{color:r.edge.color,color2:r.edge.color})),n&&!n.radius||(Object.assign(o,{radius:r.vertex.radius}),Object.assign(s,{radius:r.edge.radius})),this.sphereBuffer.setAttributes(o),this.cylinderBuffer.setAttributes(s)},t}(yi);yn.add("axes",xz);var T0=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="ball+stick",this.parameters=Object.assign({sphereDetail:!0,radialSegments:!0,openEnded:!0,disableImpostor:!0,aspectRatio:{type:"number",precision:1,max:10,min:1},lineOnly:{type:"boolean",rebuild:!0},cylinderOnly:{type:"boolean",rebuild:!0},multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondScale:{type:"number",precision:2,max:1,min:.01},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.radiusType=O(i.radiusType,"size"),i.radiusSize=O(i.radiusSize,.15),i.useInteriorColor=O(i.useInteriorColor,!0),this.aspectRatio=O(i.aspectRatio,2),this.lineOnly=O(i.lineOnly,!1),this.cylinderOnly=O(i.cylinderOnly,!1),this.multipleBond=O(i.multipleBond,"off"),this.bondSpacing=O(i.bondSpacing,1),this.bondScale=O(i.bondScale,.4),this.linewidth=O(i.linewidth,2),e.prototype.init.call(this,i)},t.prototype.getAtomRadius=function(n){return this.aspectRatio*e.prototype.getAtomRadius.call(this,n)},t.prototype.getAtomParams=function(n,i){var r=e.prototype.getAtomParams.call(this,n,i);return r.radiusParams.scale*=this.aspectRatio,r},t.prototype.getAtomData=function(n,i,r){return n.getAtomData(this.getAtomParams(i,r))},t.prototype.getBondParams=function(n,i){return i=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,bondScale:this.bondScale},i),e.prototype.getBondParams.call(this,n,i)},t.prototype.getBondData=function(n,i,r){return n.getBondData(this.getBondParams(i,r))},t.prototype.createData=function(n){var i=[];if(this.lineOnly)this.lineBuffer=new Ps(this.getBondData(n,{position:!0,color:!0,picking:!0}),this.getBufferParams({linewidth:this.linewidth})),i.push(this.lineBuffer);else{var r=new Ls(this.getBondData(n),this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}));if(i.push(r),!this.cylinderOnly){var o=new ka(this.getAtomData(n),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));i.push(o)}}return{bufferList:i}},t.prototype.updateData=function(n,i){this.multipleBond!=="off"&&n&&n.radius&&(n.position=!0);var r=this.getBondData(i.sview,n);if(this.lineOnly){var o={};n&&!n.position||Object.assign(o,{position1:r.position1,position2:r.position2}),n&&!n.color||Object.assign(o,{color:r.color,color2:r.color2}),i.bufferList[0].setAttributes(o)}else{var s={};if(n&&!n.position||Object.assign(s,{position1:r.position1,position2:r.position2}),n&&!n.color||Object.assign(s,{color:r.color,color2:r.color2}),n&&!n.radius||Object.assign(s,{radius:r.radius}),i.bufferList[0].setAttributes(s),!this.cylinderOnly){var a=this.getAtomData(i.sview,n),c={};n&&!n.position||Object.assign(c,{position:a.position}),n&&!n.color||Object.assign(c,{color:a.color}),n&&!n.radius||Object.assign(c,{radius:a.radius}),i.bufferList[1].setAttributes(c)}}},t.prototype.setParameters=function(n){n===void 0&&(n={});var i=!1,r={};return(n.aspectRatio||n.bondSpacing||n.bondScale)&&(Object.assign(r,{radius:!0}),Fo&&!this.disableImpostor||(i=!0)),e.prototype.setParameters.call(this,n,r,i),this},t}(yi);yn.add("ball+stick",T0);var bz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="backbone",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null}),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.aspectRatio=O(i.aspectRatio,1),i.radiusSize=O(i.radiusSize,.25),e.prototype.init.call(this,i)},t.prototype.getAtomRadius=function(n){return n.isTrace()?e.prototype.getAtomRadius.call(this,n):0},t.prototype.getAtomData=function(n,i,r){return n.getBackboneAtomData(this.getAtomParams(i,r))},t.prototype.getBondData=function(n,i,r){return n.getBackboneBondData(this.getBondParams(i,r))},t}(T0);yn.add("backbone",bz);var _z=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="base",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.aspectRatio=O(i.aspectRatio,1),i.radiusSize=O(i.radiusSize,.3),e.prototype.init.call(this,i)},t.prototype.getAtomData=function(n,i,r){return n.getRungAtomData(this.getAtomParams(i,r))},t.prototype.getBondData=function(n,i,r){var o=this.getBondParams(i,r);return Object.assign(o.colorParams,{rung:!0}),n.getRungBondData(o)},t}(T0);yn.add("base",_z);var ri=function(e,t){this.m=e,this.tension=t,this.dt=1/this.m,this.delta=1e-4,this.vec1=new T,this.vec2=new T,this.vDir=new T,this.vTan=new T,this.vNorm=new T,this.vBin=new T,this.m2=Math.ceil(this.m/2)};ri.prototype.interpolateToArr=function(e,t,n,i,r,o,s){o[s+0]=as(e.x,t.x,n.x,i.x,r,this.tension),o[s+1]=as(e.y,t.y,n.y,i.y,r,this.tension),o[s+2]=as(e.z,t.z,n.z,i.z,r,this.tension)},ri.prototype.interpolateToVec=function(e,t,n,i,r,o){o.x=as(e.x,t.x,n.x,i.x,r,this.tension),o.y=as(e.y,t.y,n.y,i.y,r,this.tension),o.z=as(e.z,t.z,n.z,i.z,r,this.tension)},ri.prototype.interpolatePosition=function(e,t,n,i,r,o){for(var s=0;s<this.m;++s){var a=o+3*s,c=this.dt*s;this.interpolateToArr(e,t,n,i,c,r,a)}},ri.prototype.interpolateTangent=function(e,t,n,i,r,o){for(var s=0;s<this.m;++s){var a=this.dt*s,c=a-this.delta,l=a+this.delta,u=o+3*s;c<0&&(c=0),l>1&&(l=1),this.interpolateToVec(e,t,n,i,c,this.vec1),this.interpolateToVec(e,t,n,i,l,this.vec2),this.vec2.sub(this.vec1).normalize(),this.vec2.toArray(r,u)}},ri.prototype.vectorSubdivide=function(e,t,n,i,r){for(var o,s=t.next(),a=t.next(),c=t.next(),l=t.size,u=l-1,h=i||0,f=0;f<u;++f)o=s,s=a,a=c,c=t.next(),e.apply(this,[o,s,a,c,n,h]),h+=3*this.m;r&&(o=t.get(l-2),s=t.get(l-1),a=t.get(0),c=t.get(1),e.apply(this,[o,s,a,c,n,h]),h+=3*this.m)},ri.prototype.getPosition=function(e,t,n,i){e.reset(),this.vectorSubdivide(this.interpolatePosition,e,t,n,i);var r=e.size-1,o=r*this.m*3;i&&(o+=3*this.m);var s=e.get(i?0:r);t[o]=s.x,t[o+1]=s.y,t[o+2]=s.z},ri.prototype.getTangent=function(e,t,n,i){e.reset(),this.vectorSubdivide(this.interpolateTangent,e,t,n,i);var r=(e.size-1)*this.m*3;i&&(r+=3*this.m),Wn(t,t,r-3,r,3)},ri.prototype.interpolateNormalDir=function(e,t,n,i,r,o,s,a,c,l,u,h,f){for(var p=0;p<this.m;++p){var m=h+3*p;f&&(m+=3*this.m2);var y=this.dt*p;this.interpolateToVec(e,t,n,i,y,this.vec1),this.interpolateToVec(r,o,s,a,y,this.vec2),this.vDir.subVectors(this.vec2,this.vec1).normalize(),this.vTan.fromArray(c,m),this.vBin.crossVectors(this.vDir,this.vTan).normalize(),this.vBin.toArray(u,m),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(l,m)}},ri.prototype.interpolateNormal=function(e,t,n,i,r){for(var o=0;o<this.m;++o){var s=r+3*o;e.copy(this.vNorm),this.vTan.fromArray(t,s),this.vBin.crossVectors(e,this.vTan).normalize(),this.vBin.toArray(i,s),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(n,s)}},ri.prototype.getNormal=function(e,t,n,i,r,o){this.vNorm.set(0,0,1);for(var s=e-1,a=r||0,c=0;c<s;++c)this.interpolateNormal(this.vDir,t,n,i,a),a+=3*this.m;o&&(this.interpolateNormal(this.vDir,t,n,i,a),a+=3*this.m),this.vBin.toArray(i,a),this.vNorm.toArray(n,a)},ri.prototype.getNormalDir=function(e,t,n,i,r,o,s,a){e.reset(),t.reset();var c=new T,l=new T,u=new T,h=new T,f=new T,p=new T().copy(e.next()),m=new T().copy(e.next()),y=new T().copy(e.next()),v=new T,d=new T().copy(t.next()),g=new T().copy(t.next()),b=new T().copy(t.next());this.vNorm.set(0,0,1);for(var x=e.size,_=x-1,S=o||0,w=0;w<_;++w)f.copy(p),p.copy(m),m.copy(y),y.copy(e.next()),v.copy(d),d.copy(g),g.copy(b),b.copy(t.next()),w===0?(c.subVectors(v,f),l.subVectors(d,p),c.dot(l)<0&&(l.multiplyScalar(-1),d.addVectors(p,l)),u.subVectors(g,m),l.dot(u)<0&&(u.multiplyScalar(-1),g.addVectors(m,u))):u.copy(h),h.subVectors(b,y),u.dot(h)<0&&(h.multiplyScalar(-1),b.addVectors(y,h)),this.interpolateNormalDir(f,p,m,y,v,d,g,b,n,i,r,S,a),S+=3*this.m;if(s&&(f.copy(e.get(x-2)),p.copy(e.get(x-1)),m.copy(e.get(0)),y.copy(e.get(1)),v.copy(t.get(x-2)),d.copy(t.get(x-1)),g.copy(t.get(0)),b.copy(t.get(1)),u.copy(h),h.subVectors(b,y),u.dot(h)<0&&(h.multiplyScalar(-1),b.addVectors(y,h)),this.interpolateNormalDir(f,p,m,y,v,d,g,b,n,i,r,S,a),S+=3*this.m),a){this.vBin.fromArray(r,3*this.m2),this.vNorm.fromArray(i,3*this.m2);for(var C=0;C<this.m2;++C)this.vBin.toArray(r,3*C),this.vNorm.toArray(i,3*C)}else this.vBin.toArray(r,S),this.vNorm.toArray(i,S)},ri.prototype.interpolateColor=function(e,t,n,i,r){var o,s;for(o=0;o<this.m2;++o)s=r+3*o,n.apply(this,[e,i,s]);for(o=this.m2;o<this.m;++o)s=r+3*o,n.apply(this,[t,i,s])},ri.prototype.getColor=function(e,t,n,i,r){var o;e.reset(),e.next();for(var s=e.next(),a=e.size,c=a-1,l=i||0,u=0;u<c;++u)o=s,s=e.next(),this.interpolateColor(o,s,t,n,l),l+=3*this.m;r&&(o=e.get(a-1),s=e.get(0),this.interpolateColor(o,s,t,n,l),l+=3*this.m),n[l]=n[l-3],n[l+1]=n[l-2],n[l+2]=n[l-1]},ri.prototype.interpolatePicking=function(e,t,n,i,r){var o;for(o=0;o<this.m2;++o)i[r+o]=n.apply(this,[e]);for(o=this.m2;o<this.m;++o)i[r+o]=n.apply(this,[t])},ri.prototype.getPicking=function(e,t,n,i,r){var o;e.reset(),e.next();for(var s=e.next(),a=e.size,c=a-1,l=i||0,u=0;u<c;++u)o=s,s=e.next(),this.interpolatePicking(o,s,t,n,l),l+=this.m;r&&(o=e.get(a-1),s=e.get(0),this.interpolatePicking(o,s,t,n,l),l+=this.m),n[l]=n[l-1]},ri.prototype.interpolateSize=function(e,t,n,i,r){for(var o=n.apply(this,[e]),s=n.apply(this,[t]),a=0;a<this.m;++a){var c=a/this.m;i[r+a]=(1-c)*o+c*s}},ri.prototype.getSize=function(e,t,n,i,r){var o;e.reset(),e.next();for(var s=e.next(),a=e.size,c=a-1,l=i||0,u=0;u<c;++u)o=s,s=e.next(),this.interpolateSize(o,s,t,n,l),l+=this.m;r&&(o=e.get(a-1),s=e.get(0),this.interpolateSize(o,s,t,n,l),l+=this.m),n[l]=n[l-1]};var ki=function(e,t){this.polymer=e,this.size=e.residueCount;var n=t||{};this.directional=n.directional||!1,this.positionIterator=n.positionIterator||!1,this.subdiv=n.subdiv||1,this.smoothSheet=n.smoothSheet||!1,n.tension?this.tension=n.tension:this.tension=this.polymer.isNucleic()?.5:.9,this.interpolator=new ri(this.subdiv,this.tension)};ki.prototype.getAtomIterator=function(e,t){var n=this.polymer,i=n.structure,r=n.residueCount,o=0,s=-1,a=[i.getAtomProxy(),i.getAtomProxy(),i.getAtomProxy(),i.getAtomProxy()],c=[new T,new T,new T,new T],l=i.getAtomProxy(),u=i.getAtomProxy();function h(f){var p=a[o%4];if(p.index=n.getAtomIndexByType(f,e),t&&f>0&&f<r&&p.sstruc==="e"){var m=c[o%4];return l.index=n.getAtomIndexByType(f+1,e),u.index=n.getAtomIndexByType(f-1,e),m.addVectors(l,u).add(p).add(p).multiplyScalar(.25),o+=1,m}return o+=1,p}return{size:r,next:function(){var f=h(s);return s+=1,f},get:h,reset:function(){o=0,s=-1}}},ki.prototype.getSubdividedColor=function(e){var t=this.subdiv,n=this.polymer,i=(n.residueCount-1)*t*3+3;n.isCyclic&&(i+=3*t);var r=new Float32Array(i),o=this.getAtomIterator("trace"),s=e||{};s.structure=n.structure;var a=Rt.getScheme(s);return this.interpolator.getColor(o,function(c,l,u){a.atomColorToArray(c,l,u)},r,0,n.isCyclic),{color:r}},ki.prototype.getSubdividedPicking=function(){var e=this.subdiv,t=this.polymer,n=(t.residueCount-1)*e+1;t.isCyclic&&(n+=e);var i=t.structure,r=this.getAtomIterator("trace"),o=new Float32Array(n);return this.interpolator.getPicking(r,function(s){return s.index},o,0,t.isCyclic),{picking:new Oc(o,i)}},ki.prototype.getSubdividedPosition=function(){return{position:this.getPosition()}},ki.prototype.getSubdividedOrientation=function(){var e=this.getTangent(),t=this.getNormals(e);return{tangent:e,normal:t.normal,binormal:t.binormal}},ki.prototype.getSubdividedSize=function(e){var t=this.subdiv,n=this.polymer,i=(n.residueCount-1)*t+1;n.isCyclic&&(i+=t);var r=new Float32Array(i),o=this.getAtomIterator("trace"),s=new jo(e);return this.interpolator.getSize(o,function(a){return s.atomRadius(a)},r,0,n.isCyclic),{size:r}},ki.prototype.getPosition=function(){var e=this.subdiv,t=this.polymer,n=(t.residueCount-1)*e*3+3;t.isCyclic&&(n+=3*e);var i=new Float32Array(n),r=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getPosition(r,i,0,t.isCyclic),i},ki.prototype.getTangent=function(){var e=this.subdiv,t=this.polymer,n=(this.size-1)*e*3+3;t.isCyclic&&(n+=3*e);var i=new Float32Array(n),r=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getTangent(r,i,0,t.isCyclic),i},ki.prototype.getNormals=function(e){var t=this.subdiv,n=this.polymer,i=n.isProtein(),r=this.size,o=(r-1)*t*3+3;n.isCyclic&&(o+=3*t);var s=new Float32Array(o),a=new Float32Array(o);if(this.directional&&!this.polymer.isCg()){var c=this.getAtomIterator("direction1"),l=this.getAtomIterator("direction2");this.interpolator.getNormalDir(c,l,e,s,a,0,n.isCyclic,i)}else this.interpolator.getNormal(r,e,s,a,0,n.isCyclic);return{normal:s,binormal:a}};var PM=new T,Gd=new T,wz=Object.assign({radialSegments:4,capped:!1,aspectRatio:1},Vi),Sz=function(e){function t(i,r){r===void 0&&(r={}),e.call(this,function(o,s){s===void 0&&(s={});var a=O(s.radialSegments,4),c=O(s.capped,!1),l=c?a:0,u=c?a-2:0,h=o.position.length/3,f=h*a*3+2*l*3,p=2*(h-1)*a*3+2*u*3;return{position:new Float32Array(f),color:new Float32Array(f),index:Ho(p,f/3),normal:new Float32Array(f),picking:o.picking}}(i,r),r),this.capVertices=this.parameters.capped?this.parameters.radialSegments:0,this.capTriangles=this.parameters.capped?this.parameters.radialSegments-2:0,this.size2=i.position.length/3,i.primitiveId=Du(this.size2),this.setAttributes(i),this.makeIndex()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultParameters:{configurable:!0}};return n.defaultParameters.get=function(){return wz},t.prototype.setAttributes=function(i){i===void 0&&(i={});var r,o,s,a,c,l,u,h,f,p,m,y,v,d=this.parameters.aspectRatio,g=this.size2,b=g-1,x=this.parameters.radialSegments,_=this.geometry.attributes;i.position&&(r=i.position,o=i.normal,s=i.binormal,a=i.tangent,l=i.size,h=_.position.array,p=_.normal.array,_.position.needsUpdate=!0,_.normal.needsUpdate=!0),i.color&&(c=i.color,f=_.color.array,_.color.needsUpdate=!0),i.primitiveId&&(u=i.primitiveId,m=_.primitiveId.array,_.primitiveId.needsUpdate=!0);var S=0,w=0,C=0,A=0,k=0,L=0,D=0,F=0,I=0,P=0,N=[],$=[],B=[],q=[],ee=[],W=[];if(r)for(var Q=0;Q<x;++Q){var Z=Q/x*2*Math.PI;N[Q]=d*Math.cos(Z),$[Q]=Math.sin(Z),B[Q]=d*Math.cos(Z-.01),q[Q]=Math.sin(Z-.01),ee[Q]=d*Math.cos(Z+.01),W[Q]=Math.sin(Z+.01)}for(var re=0;re<g;++re){v=(y=3*re)*x,r&&a&&o&&s&&l&&(PM.set(a[y],a[y+1],a[y+2]),w=o[y],C=o[y+1],A=o[y+2],k=s[y],L=s[y+1],D=s[y+2],F=r[y],I=r[y+1],P=r[y+2],S=l[re]);for(var he=0;he<x;++he){var K=v+3*he;if(r){var ce=-S*N[he],se=S*$[he],ue=-S*B[he],H=S*q[he],j=-S*ee[he],X=S*W[he];h[K]=F+ce*w+se*k,h[K+1]=I+ce*C+se*L,h[K+2]=P+ce*A+se*D,Gd.set(j*w+X*k-(ue*w+H*k),j*C+X*L-(ue*C+H*L),j*A+X*D-(ue*A+H*D)).cross(PM),p[K]=Gd.x,p[K+1]=Gd.y,p[K+2]=Gd.z}c&&(f[K]=c[y],f[K+1]=c[y+1],f[K+2]=c[y+2]),u&&(m[re*x+he]=u[re])}}y=0,v=3*g*x;for(var ie=0;ie<x;++ie){var fe=y+3*ie,me=v+3*ie;r&&a&&(h[me]=h[fe],h[me+1]=h[fe+1],h[me+2]=h[fe+2],p[me]=a[y],p[me+1]=a[y+1],p[me+2]=a[y+2]),c&&(f[me]=f[fe],f[me+1]=f[fe+1],f[me+2]=f[fe+2]),u&&(m[g*x+ie]=m[0+ie])}y=3*(g-1)*x,v=3*(g+1)*x;for(var ve=0;ve<x;++ve){var G=y+3*ve,V=v+3*ve;r&&a&&(h[V]=h[G],h[V+1]=h[G+1],h[V+2]=h[G+2],p[V]=a[3*b],p[V+1]=a[3*b+1],p[V+2]=a[3*b+2]),c&&(f[V]=f[G],f[V+1]=f[G+1],f[V+2]=f[G+2]),u&&(m[(g+1)*x+ve]=m[(g-1)*x+ve])}},t.prototype.makeIndex=function(){var i=this.geometry.getIndex();if(i){for(var r,o,s=i.array,a=this.size2,c=a-1,l=this.capTriangles,u=this.parameters.radialSegments,h=this.parameters.radialSegments+1,f=0;f<c;++f)for(var p=f*u*3*2,m=f*u,y=(f+1)*u,v=0;v<u;++v)s[o=p+3*v*2]=m+v,s[o+1]=m+(v+1)%u,s[o+2]=y+v,s[o+3]=y+v,s[o+4]=m+(v+1)%u,s[o+5]=y+(v+1)%u;for(var d=[0],g=1;g<h/2;++g)d.push(g),u-g!==g&&d.push(u-g);o=c*u*3*2,r=a*u;for(var b=0;b<d.length-2;++b)b%2==0?(s[o+3*b+0]=r+d[b+0],s[o+3*b+1]=r+d[b+1],s[o+3*b+2]=r+d[b+2]):(s[o+3*b+0]=r+d[b+2],s[o+3*b+1]=r+d[b+1],s[o+3*b+2]=r+d[b+0]);o=c*u*3*2+3*l,r=a*u+u;for(var x=0;x<d.length-2;++x)x%2==0?(s[o+3*x+0]=r+d[x+0],s[o+3*x+1]=r+d[x+1],s[o+3*x+2]=r+d[x+2]):(s[o+3*x+0]=r+d[x+2],s[o+3*x+1]=r+d[x+1],s[o+3*x+2]=r+d[x+0])}else de.error("Index is null")},Object.defineProperties(t.prototype,n),t}(Cs),W_=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="cartoon",this.parameters=Object.assign({aspectRatio:{type:"number",precision:1,max:10,min:1,rebuild:!0},subdiv:{type:"integer",max:50,min:1,rebuild:!0},radialSegments:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},capped:{type:"boolean",rebuild:!0},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.colorScheme=O(i.colorScheme,"chainname"),i.colorScale=O(i.colorScale,"RdYlBu"),i.radiusType=O(i.radiusType,"sstruc"),i.radiusScale=O(i.radiusScale,.7),i.useInteriorColor=O(i.useInteriorColor,!0),this.aspectRatio=O(i.aspectRatio,5),this.tension=O(i.tension,NaN),this.capped=O(i.capped,!0),this.smoothSheet=O(i.smoothSheet,!1),i.quality==="low"?(this.subdiv=3,this.radialSegments=6):i.quality==="medium"?this.subdiv=6:i.quality==="high"?this.subdiv=12:this.subdiv=O(i.subdiv,6),e.prototype.init.call(this,i)},t.prototype.getSplineParams=function(n){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:this.aspectRatio!==1,smoothSheet:this.smoothSheet},n)},t.prototype.getSpline=function(n){return new ki(n,this.getSplineParams())},t.prototype.getAspectRatio=function(n){return n.isCg()?1:this.aspectRatio},t.prototype.getAtomRadius=function(n){return n.isTrace()?e.prototype.getAtomRadius.call(this,n):0},t.prototype.createData=function(n){var i=this,r=[],o=[];return this.structure.eachPolymer(function(s){if(!(s.residueCount<4)){o.push(s);var a=i.getSpline(s),c=i.getAspectRatio(s),l=a.getSubdividedPosition(),u=a.getSubdividedOrientation(),h=a.getSubdividedColor(i.getColorParams()),f=a.getSubdividedPicking(),p=a.getSubdividedSize(i.getRadiusParams());r.push(new Sz(Object.assign({},l,u,h,f,p),i.getBufferParams({radialSegments:i.radialSegments,aspectRatio:c,capped:i.capped})))}},n.getSelection()),{bufferList:r,polymerList:o}},t.prototype.updateData=function(n,i){Pe&&de.time(this.type+" repr update"),n=n||{};for(var r=0,o=i.polymerList.length;r<o;++r){var s={},a=i.polymerList[r],c=this.getSpline(a),l=this.getAspectRatio(a);if(Object.assign(i.bufferList[r],{aspectRatio:l}),n.position||n.radius){var u=c.getSubdividedPosition(),h=c.getSubdividedOrientation(),f=c.getSubdividedSize(this.getRadiusParams(l));s.position=u.position,s.normal=h.normal,s.binormal=h.binormal,s.tangent=h.tangent,s.size=f.size}if(n.color){var p=c.getSubdividedColor(this.getColorParams());s.color=p.color}if(n.picking){var m=c.getSubdividedPicking();s.picking=m.picking}i.bufferList[r].setAttributes(s)}Pe&&de.timeEnd(this.type+" repr update")},t.prototype.setParameters=function(n){var i={};return n&&n.aspectRatio&&(i.radius=!0),n&&n.tension&&(i.position=!0),e.prototype.setParameters.call(this,n,i,!1),this},t}(yi);yn.add("cartoon",W_);var Mz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="contact",this.parameters=Object.assign({hydrogenBond:{type:"boolean",rebuild:!0},weakHydrogenBond:{type:"boolean",rebuild:!0},waterHydrogenBond:{type:"boolean",rebuild:!0},backboneHydrogenBond:{type:"boolean",rebuild:!0},hydrophobic:{type:"boolean",rebuild:!0},halogenBond:{type:"boolean",rebuild:!0},ionicInteraction:{type:"boolean",rebuild:!0},metalCoordination:{type:"boolean",rebuild:!0},cationPi:{type:"boolean",rebuild:!0},piStacking:{type:"boolean",rebuild:!0},filterSele:{type:"text",rebuild:!0},labelVisible:{type:"boolean",rebuild:!0},labelFixedSize:{type:"boolean",buffer:"fixedSize"},labelSize:{type:"number",precision:3,max:10,min:.001,rebuild:!0},labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},maxHydrophobicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondSulfurDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondAccAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondDonAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondAccPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxHbondDonPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxPiStackingDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingAngle:{type:"integer",max:180,min:0,rebuild:!0},maxCationPiDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxCationPiOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxIonicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondAngle:{type:"integer",max:180,min:0,rebuild:!0},maxMetalDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},refineSaltBridges:{type:"boolean",rebuild:!0},masterModelIndex:{type:"integer",max:1e3,min:-1,rebuild:!0},lineOfSightDistFactor:{type:"number",precision:1,max:10,min:0,rebuild:!0},radialSegments:!0,disableImpostor:!0},this.parameters),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.radiusSize=O(i.radiusSize,.05),i.useInteriorColor=O(i.useInteriorColor,!0),this.hydrogenBond=O(i.hydrogenBond,!0),this.weakHydrogenBond=O(i.weakHydrogenBond,!1),this.waterHydrogenBond=O(i.waterHydrogenBond,!1),this.backboneHydrogenBond=O(i.backboneHydrogenBond,!1),this.hydrophobic=O(i.hydrophobic,!1),this.halogenBond=O(i.halogenBond,!0),this.ionicInteraction=O(i.ionicInteraction,!0),this.metalCoordination=O(i.metalCoordination,!0),this.cationPi=O(i.cationPi,!0),this.piStacking=O(i.piStacking,!0),this.filterSele=O(i.filterSele,""),this.labelVisible=O(i.labelVisible,!1),this.labelFixedSize=O(i.labelFixedSize,!1),this.labelSize=O(i.labelSize,2),this.labelUnit=O(i.labelUnit,""),this.maxHydrophobicDist=O(i.maxHydrophobicDist,4),this.maxHbondDist=O(i.maxHbondDist,3.5),this.maxHbondSulfurDist=O(i.maxHbondSulfurDist,4.1),this.maxHbondAccAngle=O(i.maxHbondAccAngle,45),this.maxHbondDonAngle=O(i.maxHbondDonAngle,45),this.maxHbondAccPlaneAngle=O(i.maxHbondAccPlaneAngle,90),this.maxHbondDonPlaneAngle=O(i.maxHbondDonPlaneAngle,30),this.maxPiStackingDist=O(i.maxPiStackingDist,5.5),this.maxPiStackingOffset=O(i.maxPiStackingOffset,2),this.maxPiStackingAngle=O(i.maxPiStackingAngle,30),this.maxCationPiDist=O(i.maxCationPiDist,6),this.maxCationPiOffset=O(i.maxCationPiOffset,2),this.maxIonicDist=O(i.maxIonicDist,5),this.maxHalogenBondDist=O(i.maxHalogenBondDist,3.5),this.maxHalogenBondAngle=O(i.maxHalogenBondAngle,30),this.maxMetalDist=O(i.maxMetalDist,3),this.refineSaltBridges=O(i.refineSaltBridges,!0),this.masterModelIndex=O(i.masterModelIndex,-1),this.lineOfSightDistFactor=O(i.lineOfSightDistFactor,1),e.prototype.init.call(this,i)},t.prototype.getAtomRadius=function(){return 0},t.prototype.getContactData=function(n){var i={maxHydrophobicDist:this.maxHydrophobicDist,maxHbondDist:this.maxHbondDist,maxHbondSulfurDist:this.maxHbondSulfurDist,maxHbondAccAngle:this.maxHbondAccAngle,maxHbondDonAngle:this.maxHbondDonAngle,maxHbondAccPlaneAngle:this.maxHbondAccPlaneAngle,maxHbondDonPlaneAngle:this.maxHbondDonPlaneAngle,maxPiStackingDist:this.maxPiStackingDist,maxPiStackingOffset:this.maxPiStackingOffset,maxPiStackingAngle:this.maxPiStackingAngle,maxCationPiDist:this.maxCationPiDist,maxCationPiOffset:this.maxCationPiOffset,maxIonicDist:this.maxIonicDist,maxHalogenBondDist:this.maxHalogenBondDist,maxHalogenBondAngle:this.maxHalogenBondAngle,maxMetalDist:this.maxMetalDist,refineSaltBridges:this.refineSaltBridges,masterModelIndex:this.masterModelIndex,lineOfSightDistFactor:this.lineOfSightDistFactor},r={hydrogenBond:this.hydrogenBond,weakHydrogenBond:this.weakHydrogenBond,waterHydrogenBond:this.waterHydrogenBond,backboneHydrogenBond:this.backboneHydrogenBond,hydrophobic:this.hydrophobic,halogenBond:this.halogenBond,ionicInteraction:this.ionicInteraction,metalCoordination:this.metalCoordination,cationPi:this.cationPi,piStacking:this.piStacking,radius:this.radiusSize*this.radiusScale,filterSele:this.filterSele};return PN(MN(n,i),n,r)},t.prototype.createData=function(n){var i=this.getContactData(n),r=[new Ls(QF(i),this.getBufferParams({sphereDetail:1,dullInterior:!0,disableImpostor:this.disableImpostor}))];if(this.labelVisible){var o={size:this.labelSize,unit:this.labelUnit};r.push(new Nu(function(s,a){for(var c=No(s.position1,s.position2),l=[],u=v0(s.position1,s.position2),h=u.length/3,f=0;f<h;f++){var p=3*f,m=Math.sqrt(Math.pow(u[p],2)+Math.pow(u[p+1],2)+Math.pow(u[p+2],2));switch(a.unit){case"angstrom":l[f]=m.toFixed(2)+" "+String.fromCharCode(8491);break;case"nm":l[f]=(m/10).toFixed(2)+" nm";break;default:l[f]=m.toFixed(2)}}return{position:c,size:yr(c.length/3,a.size),color:s.color,text:l}}(i,o),this.getBufferParams({fixedSize:this.labelFixedSize})))}return{bufferList:r}},t}(yi);yn.add("contact",Mz);var Az=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="dihedral",this.parameters=Object.assign({atomQuad:{type:"hidden",rebuild:!0},extendLine:{type:"boolean",rebuild:!0,default:!0},lineVisible:{type:"boolean",default:!0},planeVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.side=O(i.side,"double"),i.opacity=O(i.opacity,.5),this.atomQuad=O(i.atomQuad,[]),this.extendLine=O(i.extendLine,!0),this.lineVisible=O(i.lineVisible,!0),this.planeVisible=O(i.planeVisible,!0),this.sectorVisible=O(i.sectorVisible,!0),e.prototype.init.call(this,i)},t.prototype.createData=function(n){if(n.atomCount&&this.atomQuad.length){var i=function(c,l){l===void 0&&(l={});for(var u=O(l.angleStep,Math.PI/90),h=c.length,f=c.length/12,p=new Float32Array(f),m=new Float32Array(3*f),y=new Array(f),v=new Array(f),d=new Array(f),g=new Array(f),b=new Array(f),x=0,_=0,S=0,w=xt(),C=xt(),A=xt(),k=xt(),L=xt(),D=xt(),F=xt(),I=xt(),P=xt(),N=xt(),$=xt(),B=xt(),q=xt(),ee=xt(),W=xt(),Q=0,Z=function(V){if(Fi(w,c,V),Fi(C,c,V+3),Fi(A,c,V+6),Fi(k,c,V+9),Sn(L,w,C),Sn(D,A,C),xa(D)!==0){Sn(F,k,A),rn(I,D,.5),to(P,C,I),Pn(L,L),Pn(D,D),Pn(F,F),Sn(I,w,P);var pe=qi(I,D)>0;Sn(I,k,P);var le=qi(I,D)<0;if(rn(I,D,qi(D,L)),Sn(N,L,I),rn(I,D,qi(D,F)),Sn($,F,I),xa(N)!==0&&xa($)!==0){Pn(N,N),Pn($,$);var ne=p[Q]=function(it,et){var mt=it[0],vt=it[1],lt=it[2],qe=et[0],Ct=et[1],tt=et[2],Ve=vt*tt-lt*Ct,Pt=lt*qe-mt*tt,Be=mt*Ct-vt*qe,$e=Math.sqrt(Ve*Ve+Pt*Pt+Be*Be),Je=mt*qe+vt*Ct+lt*tt;return Math.atan2($e,Je)}(N,$);y[Q]=(PT*ne).toFixed(1)+String.fromCharCode(176),tr(ee,N,D),Pn(ee,ee),qi(ee,$)<0&&b0(ee,ee),Qr(I,P,N,ee,ne/2),At(I,m,3*Q);var oe=Math.ceil(ne/u),xe=oe+(l.extendLine?4:2),Ae=l.extendLine?36:0,ge=new Float32Array(3*xe),Me=new Float32Array(3*xe),be=new Float32Array(9*oe),Oe=new Float32Array(Ae);v[Q]=ge,d[Q]=Me,g[Q]=be,b[Q]=Oe,l.extendLine&&(pe?(Sn(I,w,A),Pn(I,I),rn(B,I,1/qi(N,I)),to(B,B,A)):(rn(B,L,1/qi(N,L)),to(B,B,C)),le?(Sn(I,k,C),Pn(I,I),rn(q,I,1/qi($,I)),to(q,q,C)):(rn(q,F,1/qi($,F)),to(q,q,A))),to(W,P,N);var Te=0;l.extendLine?(At(w,ge,Te),At(B,Me,Te),At(B,ge,Te+=3),At(W,Me,Te),Te+=3,At(B,Oe,0),At(W,Oe,3),At(pe?A:C,Oe,6),At(pe?A:C,Oe,9),At(W,Oe,12),At(P,Oe,15)):(At(P,ge,Te),At(W,Me,Te),Te+=3);for(var Ce=function(it,et){var mt=9*et;At(P,be,mt),At(W,be,mt+3),At(W,ge,Te),Qr(W,P,N,ee,it),At(W,be,mt+6),At(W,Me,Te),Te+=3},Ge=0,at=u;at<ne;at+=u)Ce(at,Ge++);Ce(ne,Ge++),l.extendLine?(At(W,ge,3*(xe-2)),At(q,Me,3*(xe-2)),At(q,ge,3*(xe-1)),At(k,Me,3*(xe-1)),At(q,Oe,18),At(W,Oe,21),At(le?C:A,Oe,24),At(le?C:A,Oe,27),At(W,Oe,30),At(P,Oe,33)):(At(W,ge,Te),At(P,Me,Te),Te+=3),x+=3*xe,_+=9*oe,S+=Ae,Q+=1}}},re=0;re<h;re+=12)Z(re);for(var he=Q,K=new Float32Array(x),ce=new Float32Array(x),se=new Float32Array(_),ue=new Float32Array(S),H=0,j=0,X=0,ie=0;ie<he;ie++){var fe=v[ie],me=d[ie],ve=g[ie],G=b[ie];Wn(fe,K,0,H,fe.length),Wn(me,ce,0,H,me.length),Wn(ve,se,0,j,ve.length),Wn(G,ue,0,X,G.length),H+=fe.length,j+=ve.length,X+=G.length}return{labelPosition:m.subarray(0,3*he),labelText:y.slice(0,he),linePosition1:K,linePosition2:ce,planePosition:ue,sectorPosition:se}}(H_(n,this.atomQuad),{extendLine:this.extendLine}),r=this.n=i.labelText.length,o=new Fe(this.labelColor);this.textBuffer=new Nu({position:i.labelPosition,size:yr(r,this.labelSize),color:tn(r,o.r,o.g,o.b),text:i.labelText},this.getLabelBufferParams());var s=new Fe(this.colorValue);this.lineLength=i.linePosition1.length/3;var a=tn(this.lineLength,s.r,s.g,s.b);return this.lineBuffer=new Ps(Yx({position1:i.linePosition1,position2:i.linePosition2,color:a,color2:a}),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),this.planeLength=i.planePosition.length/3,this.planeBuffer=new Cs({position:i.planePosition,color:tn(this.planeLength,s.r,s.g,s.b)},this.getBufferParams({visible:this.planeVisible})),this.sectorLength=i.sectorPosition.length/3,this.sectorBuffer=new Cs({position:i.sectorPosition,color:tn(this.sectorLength,s.r,s.g,s.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.lineBuffer,this.planeBuffer,this.sectorBuffer]}}},t.prototype.updateData=function(n,i){e.prototype.updateData.call(this,n,i);var r={},o={},s={};if(n.color){var a=new Fe(this.colorValue);Object.assign(r,{color:tn(this.lineLength,a.r,a.g,a.b),color2:tn(this.lineLength,a.r,a.g,a.b)}),Object.assign(o,{color:tn(this.planeLength,a.r,a.g,a.b)}),Object.assign(s,{color:tn(this.sectorLength,a.r,a.g,a.b)})}this.lineBuffer.setAttributes(r),this.planeBuffer.setAttributes(o),this.sectorBuffer.setAttributes(s)},t.prototype.setParameters=function(n){return e.prototype.setParameters.call(this,n,{},!1),!n||n.lineVisible===void 0&&n.sectorVisible===void 0&&n.planeVisible===void 0||this.setVisibility(this.visible),n&&n.lineOpacity&&this.lineBuffer.setParameters({opacity:n.lineOpacity}),n&&n.opacity!==void 0&&this.lineBuffer.setParameters({opacity:this.lineOpacity}),n&&n.linewidth&&this.lineBuffer.setParameters({linewidth:n.linewidth}),this},t.prototype.setVisibility=function(n,i){return e.prototype.setVisibility.call(this,n,!0),this.lineBuffer&&this.lineBuffer.setVisibility(this.lineVisible&&this.visible),this.planeBuffer&&this.planeBuffer.setVisibility(this.planeVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),i||this.viewer.requestRender(),this},t}(V_);yn.add("dihedral",Az);function Ay(e,t){function n(o,s){return s in o}var i=Object.assign({},e);for(var r in i)n(i,r)&&n(t,r)&&(i[r]=O(t[r],i[r]));return i}function qr(e,t){var n=new Fe(e),i=new Float32Array(3*t);return tn(t,n.r,n.g,n.b,i),i}var Cz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="dihedral-histogram",this.parameters=Object.assign({histogramsData:{type:"hidden",rebuild:!0},histogramBinBorderVisible:{type:"boolean",default:!0},scaleBinToSectorArea:{type:"boolean",rebuild:!0,default:!1}},this.parameters),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{},r=Ay({histogramBinBorderColor:"grey",adjacentBondArrowColor:"black",distantBondArrowColor:"magenta",frontHistogramColor:"green",backHistogramColor:"blue",opaqueMiddleDiscColor:"white"},i);Object.assign(this,r);var o=Ay({histogramsData:[],histogramOpacity:1,opaqueMiddleDiscVisible:!0,opaqueMiddleDiscOpacity:1,histogramBinBorderVisible:!0,histogramBinBorderWidth:1,histogramBinBorderOpacity:.5,bondArrowVisible:!0,bondArrowWidth:2,bondArrowOpacity:1,scaleBinToSectorArea:!1},i);Object.assign(this,o),this.histogramsData.forEach(function(s){var a=Ay(r,s);Object.assign(s,a)}),i.side=O(i.side,"double"),i.opacity=O(i.opacity,.5),i.radiusType=O(i.radiusType,"size"),i.radiusSize=O(i.radiusSize,.15),e.prototype.init.call(this,i)},t.prototype.getHistogramBinBorderBufferParameters=function(){return this.getBufferParams({linewidth:this.histogramBinBorderWidth,visible:this.histogramBinBorderVisible,opacity:this.histogramBinBorderOpacity})},t.prototype.getBondArrowsBufferParameters=function(){return this.getBufferParams({linewidth:this.bondArrowWidth,visible:this.bondArrowVisible,opacity:this.bondArrowOpacity})},t.prototype.getOpaqueMiddleDiscBufferParameters=function(){return this.getBufferParams({visible:this.opaqueMiddleDiscVisible,opacity:this.opaqueMiddleDiscOpacity})},t.prototype.getHistogramBufferParameters=function(){return this.getBufferParams({visible:!0,opacity:this.histogramOpacity,side:"double"})},t.prototype.createData=function(n){if(n.atomCount&&this.histogramsData.length){this.histogramsData.forEach(function(h){return h.atomPositions=H_(n,[h.atomQuad])});var i=this.scaleBinToSectorArea?function(h){return Math.sqrt(h)}:function(h){return h};this.histogramsData.forEach(function(h){return h.histogram360Scaled=h.histogram360.map(i)});for(var r=[],o=0;o<this.histogramsData.length;o++){var s=void 0,a=this.histogramsData[o];a.histogram360.length>=3&&(s=Pz(a)),s!==void 0&&r.push(s)}return this.frontHistogramBinBordersBuffer=l(r.map(function(h){return h.frontHistogramBinBorders}),this.getHistogramBinBorderBufferParameters()),this.backHistogramBinBordersBuffer=l(r.map(function(h){return h.backHistogramBinBorders}),this.getHistogramBinBorderBufferParameters()),this.adjacentBondArrowsBuffer=l(r.map(function(h){return h.adjacentBondArrows}),this.getBondArrowsBufferParameters()),this.distantBondArrowsBuffer=l(r.map(function(h){return h.distantBondArrows}),this.getBondArrowsBufferParameters()),this.opaqueMiddleDiscBuffer=u(r.map(function(h){return h.opaqueMiddleDisc}),this.getOpaqueMiddleDiscBufferParameters()),this.frontHistogramBuffer=u(r.map(function(h){return h.frontHistogram}),this.getHistogramBufferParameters()),this.backHistogramBuffer=u(r.map(function(h){return h.backHistogram}),this.getHistogramBufferParameters()),{bufferList:[].concat(this.frontHistogramBinBordersBuffer,this.backHistogramBinBordersBuffer,this.adjacentBondArrowsBuffer,this.distantBondArrowsBuffer,this.opaqueMiddleDiscBuffer,this.frontHistogramBuffer,this.backHistogramBuffer)}}function c(h){for(var f=h.map(function(v){return v.length}),p=new Float32Array(L_(f)),m=0,y=0;y<h.length;y++)p.set(h[y],m),m+=h[y].length;return p}function l(h,f){return new Ps({position1:c(h.map(function(p){return p.startPoints})),position2:c(h.map(function(p){return p.endPoints})),color:c(h.map(function(p){return p.startColors})),color2:c(h.map(function(p){return p.endColors}))},f)}function u(h,f){return new Cs({position:c(h.map(function(p){return p.triangles})),color:c(h.map(function(p){return p.triangleColors}))},f)}},t.prototype.setParameters=function(n){return e.prototype.setParameters.call(this,n,{},!1),n&&n.histogramBinBorderVisible!==void 0&&this.setVisibility(this.visible),this},t.prototype.setVisibility=function(n,i){return e.prototype.setVisibility.call(this,n,!0),this.frontHistogramBinBordersBuffer&&this.frontHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),this.backHistogramBinBordersBuffer&&this.backHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),i||this.viewer.requestRender(),this},t}(yi);function Pz(e){for(var t=e.atomPositions,n=e.histogram360Scaled,i=n.length<=180?360:2*n.length,r={triangles:new Float32Array(3*i*3),triangleColors:qr(e.opaqueMiddleDiscColor,3*i)},o={triangles:new Float32Array(3*n.length*3),triangleColors:qr(e.frontHistogramColor,3*n.length)},s={triangles:new Float32Array(3*n.length*3),triangleColors:qr(e.backHistogramColor,3*n.length)},a={startPoints:new Float32Array(3*n.length),endPoints:new Float32Array(3*n.length),startColors:qr(e.histogramBinBorderColor,n.length),endColors:qr(e.histogramBinBorderColor,n.length)},c={startPoints:new Float32Array(3*n.length),endPoints:new Float32Array(3*n.length),startColors:qr(e.histogramBinBorderColor,n.length),endColors:qr(e.histogramBinBorderColor,n.length)},l={startPoints:new Float32Array(6),endPoints:new Float32Array(6),startColors:qr(e.adjacentBondArrowColor,n.length),endColors:qr(e.adjacentBondArrowColor,n.length)},u={startPoints:new Float32Array(6),endPoints:new Float32Array(6),startColors:qr(e.distantBondArrowColor,n.length),endColors:qr(e.distantBondArrowColor,n.length)},h=xt(),f=xt(),p=xt(),m=xt(),y=xt(),v=xt(),d=xt(),g=xt(),b=xt(),x=xt(),_=xt(),S=xt(),w=xt(),C=xt(),A=xt(),k=xt(),L=[h,f,p,m],D=0;D<L.length;D++)Fi(L[D],t,3*D);if(Sn(y,h,f),Sn(v,p,f),Sn(g,m,p),xa(v)!==0&&(rn(A,v,.5),to(b,f,A),Pn(y,y),Pn(v,v),Pn(g,g),b0(d,v),rn(A,d,qi(d,y)),Sn(x,y,A),rn(A,v,qi(v,g)),Sn(_,g,A),xa(x)!==0&&xa(_)!==0)){Pn(x,x),Pn(_,_);var F=Math.acos(qi(x,_));tr(S,d,x),tr(w,v,_),Pn(S,S),Pn(w,w);var I=F;qi(S,_)<0&&(I=-F),to(C,b,x);for(var P=Math.max.apply(null,n),N=2*Math.PI/n.length,$=2*Math.PI/i,B=0;B<i;B++){var q=3*B*3;At(b,r.triangles,q),Qr(C,b,x,S,B*$),At(C,r.triangles,q+3),Qr(C,b,x,S,(B+1)*$),At(C,r.triangles,q+6)}return rn(A,v,-.01),to(b,b,A),W(o,a,0,x,S),rn(A,v,.02),to(b,b,A),W(s,c,1,_,w),{opaqueMiddleDisc:r,frontHistogram:o,backHistogram:s,frontHistogramBinBorders:a,backHistogramBinBorders:c,adjacentBondArrows:l,distantBondArrows:u}}function ee(Q,Z,re,he,K){var ce=3*Z*3;At(b,Q,ce);var se=Number(n[Z])/P;rn(A,re,se),rn(k,he,se),Qr(C,b,A,k,Z*K),At(C,Q,ce+3),Qr(C,b,A,k,(Z+1)*K),At(C,Q,ce+6)}function W(Q,Z,re,he,K){Wn(b,l.startPoints,0,3*re,b.length),Qr(A,b,he,K,0+0*N),Wn(A,l.endPoints,0,3*re,b.length),Wn(b,u.startPoints,0,3*re,b.length),Qr(A,b,he,K,I),Wn(A,u.endPoints,0,3*re,b.length);for(var ce=0;ce<n.length;ce++)Wn(b,Z.startPoints,0,3*ce,b.length),Qr(A,b,he,K,0+N*ce),Wn(A,Z.endPoints,0,3*ce,A.length);for(var se=0;se<n.length;se++)ee(Q.triangles,se,he,K,N)}}yn.add("dihedral-histogram",Cz);var Tz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="distance",this.parameters=Object.assign({radialSegments:!0,openEnded:!0,disableImpostor:!0,labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},useCylinder:{type:"boolean",rebuild:!0},atomPair:{type:"hidden",rebuild:!0}},this.parameters),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.linewidth=O(i.linewidth,5),i.radiusType=O(i.radiusType,"size"),i.radiusSize=O(i.radiusSize,.2),this.labelUnit=O(i.labelUnit,""),this.useCylinder=O(i.useCylinder,!1),this.atomPair=O(i.atomPair,[]),e.prototype.init.call(this,i)},t.prototype.getDistanceData=function(n,i){var r=this,o=i.length,s=new Array(o),a=new Float32Array(3*o),c=new Jt,l=new Jt,u=new wm,h=n.getAtomProxy(),f=n.getAtomProxy(),p=0,m=n.getAtomSet();i.forEach(function(v,d){var g=v[0],b=v[1];if(typeof g=="number"&&Number.isInteger(g)&&typeof b=="number"&&Number.isInteger(b)){if(!m.get(g)||!m.get(b))return void(p+=1);h.index=g,f.index=b}else{c.setString(g),l.setString(b);var x=n.getAtomIndices(c),_=n.getAtomIndices(l);if(!x.length||!_.length)return void(p+=1);h.index=x[0],f.index=_[0]}u.addBond(h,f,1),d-=p;var S=h.distanceTo(f);switch(r.labelUnit){case"angstrom":s[d]=S.toFixed(2)+" "+String.fromCharCode(8491);break;case"nm":s[d]=(S/10).toFixed(2)+" nm";break;default:s[d]=S.toFixed(2)}var w=3*d;a[w+0]=(h.x+f.x)/2,a[w+1]=(h.y+f.y)/2,a[w+2]=(h.z+f.z)/2}),p>0&&(o-=p,a=a.subarray(0,3*o));var y=new gt(u.count,!0);return{text:s,position:a,bondSet:y,bondStore:u}},t.prototype.getBondData=function(n,i,r){var o=n.getBondData(this.getBondParams(i,r));return o.picking&&(o.picking=new kN(o.picking.array,o.picking.structure,r.bondStore)),o},t.prototype.createData=function(n){if(n.atomCount&&this.atomPair.length){var i=this.atomPair.length,r=new Fe(this.labelColor),o=this.getDistanceData(n,this.atomPair);this.textBuffer=new Nu({position:o.position,size:yr(i,this.labelSize),color:tn(i,r.r,r.g,r.b),text:o.text},this.getLabelBufferParams());var s={bondSet:o.bondSet,bondStore:o.bondStore},a=this.getBondData(n,{position:!0,color:!0,picking:!0,radius:this.useCylinder},s);return this.useCylinder?this.distanceBuffer=new Ls(a,this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})):this.distanceBuffer=new Ps(RT(a),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),{bondSet:o.bondSet,bondStore:o.bondStore,position:o.position,bufferList:[this.textBuffer,this.distanceBuffer]}}},t.prototype.updateData=function(n,i){e.prototype.updateData.call(this,n,i);var r={bondSet:i.bondSet,bondStore:i.bondStore},o=this.getBondData(i.sview,n,r),s={};n&&!n.color||Object.assign(s,{color:o.color,color2:o.color2}),n&&!n.radius||Object.assign(s,{radius:o.radius}),this.distanceBuffer.setAttributes(s)},t.prototype.setParameters=function(n){return e.prototype.setParameters.call(this,n,{},!1),this.useCylinder||(n&&n.lineOpacity&&this.distanceBuffer.setParameters({opacity:n.lineOpacity}),n&&n.opacity!==void 0&&this.distanceBuffer.setParameters({opacity:this.lineOpacity}),n&&n.linewidth&&this.distanceBuffer.setParameters({linewidth:n.linewidth})),this},t}(V_);function Cy(e){return 2*(e.position.length/3)*3}yn.add("distance",Tz);var Ez=Object.assign({scale:1,color:"grey"},Vi),TM=function(e){function t(i,r){r===void 0&&(r={}),e.call(this,{position:new Float32Array(Cy(i)),color:new Float32Array(Cy(i))},r),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag";var o=new Fe(this.parameters.color),s=this.geometry.attributes;tn(Cy(i)/3,o.r,o.g,o.b,s.color.array),this.setAttributes(i)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultParameters:{configurable:!0}};return n.defaultParameters.get=function(){return Ez},t.prototype.setAttributes=function(i){i===void 0&&(i={});var r,o,s,a=this.geometry.attributes;i.position&&i.vector&&(r=i.position,o=i.vector,s=a.position.array,a.position.needsUpdate=!0);var c=this.size/2,l=this.parameters.scale;if(r&&o)for(var u=0;u<c;u++){var h=2*u*3,f=3*u;s[h+0]=r[f+0],s[h+1]=r[f+1],s[h+2]=r[f+2],s[h+3]=r[f+0]+o[f+0]*l,s[h+4]=r[f+1]+o[f+1]*l,s[h+5]=r[f+2]+o[f+2]*l}},Object.defineProperties(t.prototype,n),t}(Bt),Iz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="helixorient",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.colorScheme=O(i.colorScheme,"sstruc"),i.radiusType=O(i.radiusType,"size"),i.radiusSize=O(i.radiusSize,.15),i.radiusScale=O(i.radiusScale,1),i.useInteriorColor=O(i.useInteriorColor,!0),e.prototype.init.call(this,i)},t.prototype.createData=function(n){var i=this,r=[],o=[];return this.structure.eachPolymer(function(s){if(!(s.residueCount<4)){o.push(s);var a=new ls(s),c=a.getPosition(),l=a.getColor(i.getColorParams()),u=a.getSize(i.getRadiusParams()),h=a.getPicking();r.push(new ka({position:c.center,color:l.color,radius:u.size,picking:h.picking},i.getBufferParams({sphereDetail:i.sphereDetail,disableImpostor:i.disableImpostor,dullInterior:!0})),new TM({position:c.center,vector:c.axis},i.getBufferParams({color:"skyblue",scale:1})),new TM({position:c.center,vector:c.resdir},i.getBufferParams({color:"lightgreen",scale:1})))}},n.getSelection()),{bufferList:r,polymerList:o}},t.prototype.updateData=function(n,i){Pe&&de.time(this.type+" repr update"),n=n||{};for(var r=0,o=i.polymerList.length;r<o;++r){var s=3*r,a={},c=i.polymerList[r],l=new ls(c);if(n.position){var u=l.getPosition();Object.assign(a,{position:u.center}),i.bufferList[s+1].setAttributes({position:u.center,vector:u.axis}),i.bufferList[s+2].setAttributes({position:u.center,vector:u.resdir})}i.bufferList[s].setAttributes(a)}Pe&&de.timeEnd(this.type+" repr update")},t}(yi);yn.add("helixorient",Iz);var fE=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="licorice",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.aspectRatio=1,e.prototype.init.call(this,i)},t}(T0);yn.add("licorice",fE),jt.add("shader/HyperballStickImpostor.vert",`
attribute vec3 mapping;
attribute float radius;
attribute float radius2;
attribute vec3 position1;
attribute vec3 position2;
varying mat4 matrix_near;
varying vec4 prime1;
varying vec4 prime2;
varying float vRadius;
varying float vRadius2;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor1;
varying vec3 vColor2;
#endif
uniform float shrink;
uniform mat4 modelViewProjectionMatrix;
uniform mat4 modelViewProjectionMatrixInverse;
void main(){
vRadius = radius;
vRadius2 = radius2;
vec4 spaceposition;
vec3 position_atom1;
vec3 position_atom2;
vec4 vertex_position;
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
vColor1 = color;
vColor2 = color2;
#endif
float radius1 = radius;
position_atom1 = position1;
position_atom2 = position2;
float distance = distance( position_atom1, position_atom2 );
spaceposition.z = mapping.z * distance;
if (radius1 > radius2) {
spaceposition.y = mapping.y * 1.5 * radius1;
spaceposition.x = mapping.x * 1.5 * radius1;
} else {
spaceposition.y = mapping.y * 1.5 * radius2;
spaceposition.x = mapping.x * 1.5 * radius2;
}
spaceposition.w = 1.0;
vec4 e3 = vec4( 1.0 );
vec3 e1, e1_temp, e2, e2_temp;
e3.xyz = normalize(position_atom1-position_atom2);
if (e3.z == 0.0) { e3.z = 0.0000000000001;}
if ( (position_atom1.x - position_atom2.x) == 0.0) { position_atom1.x += 0.001;}
if ( (position_atom1.y - position_atom2.y) == 0.0) { position_atom1.y += 0.001;}
if ( (position_atom1.z - position_atom2.z) == 0.0) { position_atom1.z += 0.001;}
vec4 focus = vec4( 1.0 );
focus.x = ( position_atom1.x*position_atom1.x - position_atom2.x*position_atom2.x +
( radius2*radius2 - radius1*radius1 )*e3.x*e3.x/shrink )/(2.0*(position_atom1.x - position_atom2.x));
focus.y = ( position_atom1.y*position_atom1.y - position_atom2.y*position_atom2.y +
( radius2*radius2 - radius1*radius1 )*e3.y*e3.y/shrink )/(2.0*(position_atom1.y - position_atom2.y));
focus.z = ( position_atom1.z*position_atom1.z - position_atom2.z*position_atom2.z +
( radius2*radius2 - radius1*radius1 )*e3.z*e3.z/shrink )/(2.0*(position_atom1.z - position_atom2.z));
e1.x = 1.0;
e1.y = 1.0;
e1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;
e1_temp = e1 - focus.xyz;
e1 = normalize(e1_temp);
e2_temp = e1.yzx * e3.zxy - e1.zxy * e3.yzx;
e2 = normalize(e2_temp);
mat3 R= mat3( e1.xyz, e2.xyz, e3.xyz );
vertex_position.xyz = R * spaceposition.xyz;
vertex_position.w = 1.0;
vertex_position.x += (position_atom1.x+position_atom2.x) / 2.0;
vertex_position.y += (position_atom1.y+position_atom2.y) / 2.0;
vertex_position.z += (position_atom1.z+position_atom2.z) / 2.0;
gl_Position = modelViewProjectionMatrix * vertex_position;
vec4 i_near, i_far;
vec4 near = gl_Position;
near.z = 0.0 ;
near = modelViewProjectionMatrixInverse * near;
i_near = near;
vec4 far = gl_Position;
far.z = far.w ;
i_far = modelViewProjectionMatrixInverse * far;
prime1 = vec4( position_atom1 - (position_atom1 - focus.xyz)*shrink, 1.0 );
prime2 = vec4( position_atom2 - (position_atom2 - focus.xyz)*shrink, 1.0 );
float Rsquare = (radius1*radius1/shrink) - (
(position_atom1.x - focus.x)*(position_atom1.x - focus.x) +
(position_atom1.y - focus.y)*(position_atom1.y - focus.y) +
(position_atom1.z - focus.z)*(position_atom1.z - focus.z)
);
focus.w = Rsquare;
matrix_near = mat4( i_near, i_far, focus, e3 );
gl_Position.z = 1.0;
}`),jt.add("shader/HyperballStickImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform float shrink;
uniform mat4 modelViewMatrix;
uniform mat4 modelViewProjectionMatrix;
uniform mat4 modelViewMatrixInverseTranspose;
uniform mat4 projectionMatrix;
varying mat4 matrix_near;
varying vec4 prime1;
varying vec4 prime2;
varying float vRadius;
varying float vRadius2;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
varying vec3 vColor1;
varying vec3 vColor2;
#include common
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool interior = false;
float calcClip( vec4 cameraPos ){
return dot( cameraPos, vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
float calcClip( vec3 cameraPos ){
return calcClip( vec4( cameraPos, 1.0 ) );
}
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
struct Ray {
vec3 origin ;
vec3 direction ;
};
bool cutoff_plane (vec3 M, vec3 cutoff, vec3 x3){
float a = x3.x;
float b = x3.y;
float c = x3.z;
float d = -x3.x*cutoff.x-x3.y*cutoff.y-x3.z*cutoff.z;
float l = a*M.x+b*M.y+c*M.z+d;
if (l<0.0) {return true;}
else{return false;}
}
vec3 isect_surf(Ray r, mat4 matrix_coef){
vec4 direction = vec4(r.direction, 0.0);
vec4 origin = vec4(r.origin, 1.0);
float a = dot(direction,(matrix_coef*direction));
float b = dot(origin,(matrix_coef*direction));
float c = dot(origin,(matrix_coef*origin));
float delta =b*b-a*c;
gl_FragColor.a = 1.0;
if (delta<0.0){
discard;
}
float t1 =(-b-sqrt(delta))/a;
return r.origin+t1*r.direction;
}
vec3 isect_surf2(Ray r, mat4 matrix_coef){
vec4 direction = vec4(r.direction, 0.0);
vec4 origin = vec4(r.origin, 1.0);
float a = dot(direction,(matrix_coef*direction));
float b = dot(origin,(matrix_coef*direction));
float c = dot(origin,(matrix_coef*origin));
float delta =b*b-a*c;
gl_FragColor.a = 1.0;
if (delta<0.0){
discard;
}
float t2 =(-b+sqrt(delta))/a;
return r.origin+t2*r.direction;
}
Ray primary_ray(vec4 near1, vec4 far1){
vec3 near=near1.xyz/near1.w;
vec3 far=far1.xyz/far1.w;
return Ray(near,far-near);
}
float update_z_buffer(vec3 M, mat4 ModelViewP){
float depth1;
vec4 Ms=(ModelViewP*vec4(M,1.0));
return depth1=(1.0+Ms.z/Ms.w)/2.0;
}
void main(){
float radius = max( vRadius, vRadius2 );
vec4 i_near, i_far, focus;
vec3 e3, e1, e1_temp, e2;
i_near = vec4(matrix_near[0][0],matrix_near[0][1],matrix_near[0][2],matrix_near[0][3]);
i_far = vec4(matrix_near[1][0],matrix_near[1][1],matrix_near[1][2],matrix_near[1][3]);
focus = vec4(matrix_near[2][0],matrix_near[2][1],matrix_near[2][2],matrix_near[2][3]);
e3 = vec3(matrix_near[3][0],matrix_near[3][1],matrix_near[3][2]);
e1.x = 1.0;
e1.y = 1.0;
e1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;
e1_temp = e1 - focus.xyz;
e1 = normalize(e1_temp);
e2 = normalize(cross(e1,e3));
vec4 equation = focus;
float shrinkfactor = shrink;
float t1 = -1.0/(1.0-shrinkfactor);
float t2 = 1.0/(shrinkfactor);
vec4 colonne1, colonne2, colonne3, colonne4;
mat4 mat;
vec3 equation1 = vec3(t2,t2,t1);
float A1 = - e1.x*equation.x - e1.y*equation.y - e1.z*equation.z;
float A2 = - e2.x*equation.x - e2.y*equation.y - e2.z*equation.z;
float A3 = - e3.x*equation.x - e3.y*equation.y - e3.z*equation.z;
float A11 = equation1.x*e1.x*e1.x + equation1.y*e2.x*e2.x + equation1.z*e3.x*e3.x;
float A21 = equation1.x*e1.x*e1.y + equation1.y*e2.x*e2.y + equation1.z*e3.x*e3.y;
float A31 = equation1.x*e1.x*e1.z + equation1.y*e2.x*e2.z + equation1.z*e3.x*e3.z;
float A41 = equation1.x*e1.x*A1 + equation1.y*e2.x*A2 + equation1.z*e3.x*A3;
float A22 = equation1.x*e1.y*e1.y + equation1.y*e2.y*e2.y + equation1.z*e3.y*e3.y;
float A32 = equation1.x*e1.y*e1.z + equation1.y*e2.y*e2.z + equation1.z*e3.y*e3.z;
float A42 = equation1.x*e1.y*A1 + equation1.y*e2.y*A2 + equation1.z*e3.y*A3;
float A33 = equation1.x*e1.z*e1.z + equation1.y*e2.z*e2.z + equation1.z*e3.z*e3.z;
float A43 = equation1.x*e1.z*A1 + equation1.y*e2.z*A2 + equation1.z*e3.z*A3;
float A44 = equation1.x*A1*A1 + equation1.y*A2*A2 + equation1.z*A3*A3 - equation.w;
colonne1 = vec4(A11,A21,A31,A41);
colonne2 = vec4(A21,A22,A32,A42);
colonne3 = vec4(A31,A32,A33,A43);
colonne4 = vec4(A41,A42,A43,A44);
mat = mat4(colonne1,colonne2,colonne3,colonne4);
Ray ray = primary_ray(i_near,i_far) ;
vec3 M;
M = isect_surf(ray, mat);
if (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }
vec4 M1 = vec4(M,1.0);
vec4 M2 = mat*M1;
vec3 _normal = ( modelViewMatrixInverseTranspose * M2 ).xyz;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
#ifdef NEAR_CLIP
if( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 ){
M = isect_surf2(ray, mat);
if( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 )
discard;
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / radius ) );
}
}else if( gl_FragDepthEXT <= 0.0 ){
M = isect_surf2(ray, mat);
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix);
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );
}
}
#else
if( gl_FragDepthEXT <= 0.0 ){
M = isect_surf2(ray, mat);
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );
}
}
#endif
if (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }
if (gl_FragDepthEXT < 0.0)
discard;
if (gl_FragDepthEXT > 1.0)
discard;
float distance_ratio = ((M.x-prime2.x)*e3.x + (M.y-prime2.y)*e3.y +(M.z-prime2.z)*e3.z) /
distance(prime2.xyz,prime1.xyz);
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vViewPosition = -( modelViewMatrix * vec4( M, 1.0 ) ).xyz;
vec3 vNormal = _normal;
vec3 vColor;
if( distance_ratio>0.5 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
vec3 normal = normalize( vNormal );
vec3 geometryNormal = normal;
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include encodings_fragment
#include fog_fragment
#endif
}`);var Lz=new Float32Array([-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1]),Rz=new Uint16Array([0,1,2,0,2,3,1,5,6,1,6,2,4,6,5,4,7,6,0,7,4,0,3,7,0,5,1,0,4,5,3,2,6,3,6,7]),Oz=function(e){function t(i,r){r===void 0&&(r={}),e.call(this,"v3",i,r)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={mapping:{configurable:!0},mappingIndices:{configurable:!0},mappingIndicesSize:{configurable:!0},mappingSize:{configurable:!0},mappingItemSize:{configurable:!0}};return n.mapping.get=function(){return Lz},n.mappingIndices.get=function(){return Rz},n.mappingIndicesSize.get=function(){return 36},n.mappingSize.get=function(){return 8},n.mappingItemSize.get=function(){return 3},Object.defineProperties(t.prototype,n),t}(N_),pE=Object.assign({shrink:.14},Vi),kz=Object.assign({shrink:{uniform:!0}},kc),Dz=function(e){function t(i,r){r===void 0&&(r={}),e.call(this,i,r),this.parameterTypes=kz,this.isImpostor=!0,this.vertexShader="HyperballStickImpostor.vert",this.fragmentShader="HyperballStickImpostor.frag",this.addUniforms({modelViewProjectionMatrix:{value:new De},modelViewProjectionMatrixInverse:{value:new De},modelViewMatrixInverseTranspose:{value:new De},shrink:{value:this.parameters.shrink}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null},radius2:{type:"f",value:null}}),this.setAttributes(i),this.makeMapping()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultParameters:{configurable:!0}};return n.defaultParameters.get=function(){return pE},Object.defineProperties(t.prototype,n),t}(Oz);Object.assign({disableImpostor:!1},j_,pE);var Bz=function(e,t){return t===void 0&&(t={}),!Fo||t&&t.disableImpostor?(e.radius=function(n,i){for(var r=n.length,o=new Float32Array(r),s=0;s<r;s++)o[s]=Math.min(n[s],i[s]);return o}(e.radius,e.radius2),new uE(e,t)):new Dz(e,t)},Fz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="hyperball",this.parameters=Object.assign({shrink:{type:"number",precision:3,max:1,min:.001,buffer:!0}},this.parameters,{multipleBond:null,bondSpacing:null})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.radiusScale=O(i.radiusScale,.2),i.radiusType=O(i.radiusType,"vdw"),i.useInteriorColor=O(i.useInteriorColor,!0),this.shrink=O(i.shrink,.12),e.prototype.init.call(this,i)},t.prototype.getBondParams=function(n,i){return n&&!n.radius||(i=Object.assign({radius2:!0},i)),e.prototype.getBondParams.call(this,n,i)},t.prototype.createData=function(n){var i=new ka(n.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));return this.__center=new Float32Array(3*n.bondCount),{bufferList:[i,new Bz(n.getBondData(this.getBondParams()),this.getBufferParams({shrink:this.shrink,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))]}},t.prototype.updateData=function(n,i){var r=i.sview.getAtomData(this.getAtomParams()),o=i.sview.getBondData(this.getBondParams()),s={},a={};if(!n||n.position){Object.assign(s,{position:r.position});var c=o.position1,l=o.position2;Object.assign(a,{position:No(c,l,this.__center),position1:c,position2:l})}n&&!n.color||(Object.assign(s,{color:r.color}),Object.assign(a,{color:o.color,color2:o.color2})),n&&!n.radius||(Object.assign(s,{radius:r.radius}),Object.assign(a,{radius:o.radius,radius2:o.radius2})),i.bufferList[0].setAttributes(s),i.bufferList[1].setAttributes(a)},t}(fE);yn.add("hyperball",Fz);var Wg=function(e,t,n){t===void 0&&(t={}),n===void 0&&(n=""),this.type=e,this.text=t,this.format=n,this.errorLogged=!1};Wg.prototype.atomLabel=function(e){var t;switch(this.type){case"atomname":t=e.atomname;break;case"atomindex":t=""+e.index;break;case"occupancy":t=e.occupancy.toFixed(2);break;case"bfactor":t=e.bfactor.toFixed(2);break;case"serial":t=""+e.serial;break;case"element":t=e.element;break;case"atom":t=e.atomname+"|"+e.index;break;case"resname":t=e.resname;break;case"resno":t=""+e.resno;break;case"res":t=""+($g[e.resname.toUpperCase()]||e.resname)+e.resno;break;case"residue":var n=$g[e.resname.toUpperCase()];t=n&&!e.inscode?""+n+e.resno:"["+e.resname+"]"+e.resno+e.inscode;break;case"text":t=this.text[e.index];break;case"format":try{t=Bi.sprintf(this.format,e)}catch(i){this.errorLogged||(this.errorLogged=!0,console.log(i.message))}break;default:t=e.qualifiedName()}return t===void 0?"":t},Wg.types={"":"",atomname:"atom name",atomindex:"atom index",occupancy:"occupancy",bfactor:"b-factor",serial:"serial",element:"element",atom:"atom name + index",resname:"residue name",resno:"residue no",res:"one letter code + no",residue:"[residue name] + no + inscode",text:"text",format:"format",qualified:"qualified name"};var Nz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="label",this.parameters=Object.assign({labelType:{type:"select",options:Wg.types,rebuild:!0},labelText:{type:"hidden",rebuild:!0},labelFormat:{type:"text",rebuild:!0},labelGrouping:{type:"select",options:{atom:"atom",residue:"residue"},rebuild:!0},fontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:!0},fontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:!0},fontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:!0},xOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},yOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},zOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},attachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},showBorder:{type:"boolean",buffer:!0},borderColor:{type:"color",buffer:!0},borderWidth:{type:"number",precision:2,max:.3,min:0,buffer:!0},showBackground:{type:"boolean",rebuild:!0},backgroundColor:{type:"color",buffer:!0},backgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},backgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:!0},fixedSize:{type:"boolean",buffer:!0}},this.parameters,{side:null,flatShaded:null,wireframe:null,linewidth:null,roughness:null,metalness:null,diffuse:null}),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};this.labelType=O(i.labelType,"res"),this.labelText=O(i.labelText,{}),this.labelFormat=O(i.labelFormat,""),this.labelGrouping=O(i.labelGrouping,"atom"),this.fontFamily=O(i.fontFamily,"sans-serif"),this.fontStyle=O(i.fontStyle,"normal"),this.fontWeight=O(i.fontWeight,"bold"),this.xOffset=O(i.xOffset,0),this.yOffset=O(i.yOffset,0),this.zOffset=O(i.zOffset,.5),this.attachment=O(i.attachment,"bottom-left"),this.showBorder=O(i.showBorder,!1),this.borderColor=O(i.borderColor,"lightgrey"),this.borderWidth=O(i.borderWidth,.15),this.showBackground=O(i.showBackground,!1),this.backgroundColor=O(i.backgroundColor,"lightgrey"),this.backgroundMargin=O(i.backgroundMargin,.5),this.backgroundOpacity=O(i.backgroundOpacity,1),this.fixedSize=O(i.fixedSize,!1),e.prototype.init.call(this,i)},t.prototype.getTextData=function(n,i){var r,o,s,a,c,l,u,h=this.getAtomParams(i),f=new Wg(this.labelType,this.labelText,this.labelFormat);if(this.labelGrouping==="atom"){var p=n.getAtomData(h);r=p.position,o=p.radius,s=p.color,i&&!i.text||(a=[],n.eachAtom(function(g){return a.push(f.atomLabel(g))}))}else if(this.labelGrouping==="residue"){i&&!i.position||(c=[]),i&&!i.color||(u=[]),i&&!i.radius||(l=[]),i&&!i.text||(a=[]),h.colorParams&&(h.colorParams.structure=n.getStructure());var m=Rt.getScheme(h.colorParams),y=new jo(h.radiusParams),v=n.getAtomProxy(),d=0;n.eachResidue(function(g){var b=3*d;g.isProtein()||g.isNucleic()?(v.index=g.traceAtomIndex,i&&!i.position||v.positionToArray(c,b)):(v.index=g.atomOffset,i&&!i.position||g.positionToArray(c,b)),i&&!i.color||m.atomColorToArray(v,u,b),i&&!i.radius||(l[d]=y.atomRadius(v)),i&&!i.text||a.push(f.atomLabel(v)),++d}),i&&!i.position||(r=new Float32Array(c)),i&&!i.color||(s=new Float32Array(u)),i&&!i.radius||(o=new Float32Array(l))}return{position:r,size:o,color:s,text:a}},t.prototype.createData=function(n){return{bufferList:[new Nu(this.getTextData(n,{position:!0,color:!0,radius:!0,text:!0}),this.getBufferParams({fontFamily:this.fontFamily,fontStyle:this.fontStyle,fontWeight:this.fontWeight,xOffset:this.xOffset,yOffset:this.yOffset,zOffset:this.zOffset,attachment:this.attachment,showBorder:this.showBorder,borderColor:this.borderColor,borderWidth:this.borderWidth,showBackground:this.showBackground,backgroundColor:this.backgroundColor,backgroundMargin:this.backgroundMargin,backgroundOpacity:this.backgroundOpacity,fixedSize:this.fixedSize}))]}},t.prototype.updateData=function(n,i){i.bufferList[0].setAttributes(this.getTextData(i.sview,n))},t.prototype.getAtomRadius=function(){return 0},t}(yi);yn.add("label",Nz);var zz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="line",this.parameters=Object.assign({multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0},lines:{type:"boolean",rebuild:!0},crosses:{type:"select",rebuild:!0,options:{off:"off",lone:"lone",all:"all"}},crossSize:{type:"number",precision:2,max:2,min:.1}},this.parameters,{flatShaded:null,side:null,wireframe:null,roughness:null,metalness:null}),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};this.multipleBond=O(i.multipleBond,"off"),this.bondSpacing=O(i.bondSpacing,1),this.linewidth=O(i.linewidth,2),this.lines=O(i.lines,!0),this.crosses=O(i.crosses,"lone"),this.crossSize=O(i.crossSize,.4),e.prototype.init.call(this,i)},t.prototype.getAtomRadius=function(n){return .1},t.prototype.getBondParams=function(n,i){return i=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,radiusParams:{type:"size",size:.1,scale:1}},i),e.prototype.getBondParams.call(this,n,i)},t.prototype._crossData=function(n,i){if(!n||n.position||n.color){var r,o,s,a,c={};this.crosses==="lone"&&Object.assign(c,{atomSet:(r=i,o=r.getAtomSet(),s=r.getBondSet(),a=r.getBondProxy(),s.forEach(function(I){a.index=I,o.clear(a.atomIndex1),o.clear(a.atomIndex2)}),o)});var l=i.getAtomData(this.getAtomParams(n,c)),u={},h=l.position,f=l.color,p=l.picking,m=(h||f).length,y=3*m,v=new Float32Array(0),d=new Float32Array(0),g=new Float32Array(0),b=new Float32Array(0),x=0,_=new Float32Array(0);n&&!n.position||(v=u.position1=new Float32Array(y),d=u.position2=new Float32Array(y),x=this.crossSize/2),n&&!n.color||(g=u.color=new Float32Array(y),b=u.color2=new Float32Array(y)),n&&!n.picking||(_=new Float32Array(3*l.picking.array.length));for(var S=0;S<m;S++){var w=3*S,C=3*w;if(!n||n.position){var A=h[w],k=h[w+1],L=h[w+2];v[C]=A-x,v[C+1]=k,v[C+2]=L,d[C]=A+x,d[C+1]=k,d[C+2]=L,v[C+3]=A,v[C+4]=k-x,v[C+5]=L,d[C+3]=A,d[C+4]=k+x,d[C+5]=L,v[C+6]=A,v[C+7]=k,v[C+8]=L-x,d[C+6]=A,d[C+7]=k,d[C+8]=L+x}if(!n||n.color)for(var D=C+9,F=C;F<D;F+=3)g[F]=b[F]=f[w],g[F+1]=b[F+1]=f[w+1],g[F+2]=b[F+2]=f[w+2];n&&!n.picking||(_[w]=_[w+1]=_[w+2]=p.array[S])}return n&&!n.picking||(u.picking=new Oc(_,p.structure)),u}},t.prototype.createData=function(n){var i={position:!0,color:!0,picking:!0},r=[];if(this.lines){var o=n.getBondData(this.getBondParams(i)),s=new Ps(o,this.getBufferParams({linewidth:this.linewidth}));r.push(s)}if(this.crosses!=="off"){var a=new Ps(this._crossData(i,n),this.getBufferParams({linewidth:this.linewidth}));r.push(a)}return{bufferList:r}},t.prototype.updateData=function(n,i){var r=0;if(this.lines){var o=i.sview.getBondData(this.getBondParams(n)),s={};n&&!n.position||Object.assign(s,{position1:o.position1,position2:o.position2}),n&&!n.color||Object.assign(s,{color:o.color,color2:o.color2}),i.bufferList[r++].setAttributes(s)}if(this.crosses!=="off"){var a=this._crossData(n,i.sview),c={};n&&!n.position||Object.assign(c,{position1:a.position1,position2:a.position2}),n&&!n.color||Object.assign(c,{color:a.color,color2:a.color2}),i.bufferList[r++].setAttributes(c)}},t.prototype.setParameters=function(n){var i={};return n&&(n.bondSpacing||n.crossSize)&&Object.assign(i,{position:!0}),e.prototype.setParameters.call(this,n,i,!1),this},t}(yi);function dE(e,t,n,i,r){var o=new(i=i||Int32Array)(e*t*n*(r=r||1));function s(a,c,l){return((a*t+c)*n+l)*r}return{data:o,index:s,set:function(a,c,l){for(var u=[],h=arguments.length-3;h-- >0;)u[h]=arguments[h+3];for(var f=s(a,c,l),p=0;p<r;++p)o[f+p]=u[p]},toArray:function(a,c,l,u,h){u===void 0&&(u=[]),h===void 0&&(h=0);for(var f=s(a,c,l),p=0;p<r;++p)u[h+p]=o[f+p]},fromArray:function(a,c,l,u,h){h===void 0&&(h=0);for(var f=s(a,c,l),p=0;p<r;++p)o[f+p]=u[h+p]},copy:function(a){o.set(a.data)}}}function Am(e,t,n){var i=XT(t),r=ip(e);e.length===0&&(r[0].set([0,0,0]),r[1].set([0,0,0]));var o,s,a,c,l,u,h,f,p,m,y,v,d,g,b,x=r[0],_=r[1];function S(I,P,N,$,B){o=P||1.4,s=N||2,v=B||!0;var q=0;for(var ee in i)q=Math.max(q,ee);var W=ap(x,_,q,s,I?o:0);c=W.dim[0],l=W.dim[1],u=W.dim[2],h=W.matrix,f=W.tran,s=W.scaleFactor,p={},m={},C(I),y=o*s,a=$||o/s,d=new Uint8Array(c*l*u),I&&(g=new Float64Array(c*l*u)),v&&(b=new Int32Array(c*l*u))}var w=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];function C(I){var P,N,$,B,q,ee,W,Q,Z,re;for(var he in i)if(P=parseFloat(he),!p[he]){for(ee=(W=I?(P+o)*s+.5:P*s+.5)*W,Q=Math.floor(W)+1,Z=new Int32Array(Q*Q),re=0,N=0;N<Q;++N)for($=0;$<Q;++$)(B=N*N+$*$)>ee?Z[re]=-1:(q=Math.sqrt(ee-B),Z[re]=Math.floor(q)),++re;m[he]=Q,p[he]=Z}}function A(I){var P,N,$,B,q,ee,W,Q,Z,re,he,K,ce,se,ue,H,j,X,ie=3*I,fe=I;P=Math.floor(.5+s*(e[ie]+f[0])),N=Math.floor(.5+s*(e[ie+1]+f[1])),$=Math.floor(.5+s*(e[ie+2]+f[2]));var me,ve=t[fe],G=p[ve],V=0,pe=l*u,le=m[ve];for(re=0;re<le;++re)for(he=0;he<le;++he){if((me=G[V])!==-1){for(H=-1;H<2;++H)for(j=-1;j<2;++j)for(X=-1;X<2;++X)if(H!==0&&j!==0&&X!==0){for(W=H*re,Z=X*he,K=0;K<=me;++K)if(se=N+(Q=K*j),ue=$+Z,!((ce=P+W)<0||se<0||ue<0||ce>=c||se>=l||ue>=u)){var ne=ce*pe+se*u+ue;if(v)if(1&d[ne]){if(1&d[ne]){var oe=b[ne];oe!==ie&&W*W+Q*Q+Z*Z<(B=P+W-Math.floor(.5+s*(e[oe]+f[0])))*B+(q=N+Q-Math.floor(.5+s*(e[oe+1]+f[1])))*q+(ee=$+Z-Math.floor(.5+s*(e[oe+2]+f[2])))*ee&&(b[ne]=I)}}else d[ne]|=1,b[ne]=I;else d[ne]|=1}}}V++}}function k(I){var P,N;for(console.time("EDTSurface fillvoxels"),P=0,N=d.length;P<N;++P)d[P]=0,I&&(g[P]=-1),v&&(b[P]=-1);for(P=0,N=e.length/3;P<N;++P)A(P);for(P=0,N=d.length;P<N;++P)1&d[P]&&(d[P]|=2);console.timeEnd("EDTSurface fillvoxels")}function L(I){var P,N,$,B,q,ee,W,Q,Z,re,he,K,ce,se,ue,H,j,X,ie,fe=3*I,me=I,ve=0;P=Math.floor(.5+s*(e[fe]+f[0])),N=Math.floor(.5+s*(e[fe+1]+f[1])),$=Math.floor(.5+s*(e[fe+2]+f[2]));var G=t[me],V=l*u;for(ce=0,ie=m[G];ce<ie;++ce)for(se=0;se<ie;++se){if(p[G][ve]!==-1){for(H=-1;H<2;++H)for(j=-1;j<2;++j)for(X=-1;X<2;++X)if(H!==0&&j!==0&&X!==0){for(W=H*ce,Z=X*se,ue=0;ue<=p[G][ve];++ue)if(he=N+(Q=ue*j),K=$+Z,!((re=P+W)<0||he<0||K<0||re>=c||he>=l||K>=u)){var pe=re*V+he*u+K;if(2&d[pe]){if(v){var le=b[pe];W*W+Q*Q+Z*Z<(B=Math.floor(.5+s*(e[le]+f[0])))*B+(q=Math.floor(.5+s*(e[le+1]+f[1])))*q+(ee=Math.floor(.5+s*(e[le+2]+f[2])))*ee&&(b[pe]=I)}}else d[pe]|=2,v&&(b[pe]=I)}}}ve++}}function D(){var I,P,N,$;console.time("EDTSurface fastdistancemap");var B,q=dE(c,l,u,Uint16Array,3),ee=l*u,W=y*y,Q=0;for(I=0;I<c;++I)for(P=0;P<l;++P)for(N=0;N<u;++N)d[B=I*ee+P*u+N]&=-3,1&d[B]&&4&d[B]&&(q.set(I,P,N,I,P,N),g[B]=0,d[B]|=2,Q+=1);var Z=new Int32Array(3*Q),re=0,he=new Int32Array(3*Q),K=0;for(I=0;I<c;++I)for(P=0;P<l;++P)for(N=0;N<u;++N)4&d[B=I*ee+P*u+N]&&(Z[re]=I,Z[re+1]=P,Z[re+2]=N,re+=3,d[B]&=-5);do for(K=F(Z,q,re,he),re=0,I=0,$=K;I<$;I+=3)B=ee*he[I]+u*he[I+1]+he[I+2],d[B]&=-5,g[B]<=1.0404*W&&(Z[re]=he[I],Z[re+1]=he[I+1],Z[re+2]=he[I+2],re+=3);while(re>0);var ce,se=a*a,ue=new Uint16Array(3);for(I=0;I<c;++I)for(P=0;P<l;++P)for(N=0;N<u;++N)d[B=I*ee+P*u+N]&=-5,1&d[B]&&(2&d[B]&&!(2&d[B]&&g[B]>=se)||(d[B]|=4,v&&2&d[B]&&(q.toArray(I,P,N,ue),ce=ue[0]*ee+ue[1]*u+ue[2],b[B]=b[ce])));console.timeEnd("EDTSurface fastdistancemap")}function F(I,P,N,$){var B,q,ee,W,Q,Z,re,he,K,ce,se,ue,H=new Uint16Array(3),j=0;if(N===0)return j;var X=-1,ie=-1,fe=-1,me=l*u;for(re=0,K=N;re<K;re+=3)for(B=I[re],q=I[re+1],ee=I[re+2],P.toArray(B,q,ee,H),he=0;he<6;++he)X=B+(ue=w[he])[0],ie=q+ue[1],fe=ee+ue[2],X<c&&X>-1&&ie<l&&ie>-1&&fe<u&&fe>-1&&(1&d[se=X*me+u*ie+fe]&&!(2&d[se])?(P.fromArray(X,ie,fe,H),ce=(W=X-H[0])*W+(Q=ie-H[1])*Q+(Z=fe-H[2])*Z,g[se]=ce,d[se]|=2,d[se]|=4,$[j]=X,$[j+1]=ie,$[j+2]=fe,j+=3):1&d[se]&&2&d[se]&&(ce=(W=X-H[0])*W+(Q=ie-H[1])*Q+(Z=fe-H[2])*Z)<g[se]&&(P.fromArray(X,ie,fe,H),g[se]=ce,4&d[se]||(d[se]|=4,$[j]=X,$[j+1]=ie,$[j+2]=fe,j+=3)));for(re=0,K=N;re<K;re+=3)for(B=I[re],q=I[re+1],ee=I[re+2],P.toArray(B,q,ee,H),he=6;he<18;he++)X=B+(ue=w[he])[0],ie=q+ue[1],fe=ee+ue[2],X<c&&X>-1&&ie<l&&ie>-1&&fe<u&&fe>-1&&(1&d[se=X*me+u*ie+fe]&&!(2&d[se])?(P.fromArray(X,ie,fe,H),ce=(W=X-H[0])*W+(Q=ie-H[1])*Q+(Z=fe-H[2])*Z,g[se]=ce,d[se]|=2,d[se]|=4,$[j]=X,$[j+1]=ie,$[j+2]=fe,j+=3):1&d[se]&&2&d[se]&&(ce=(W=X-H[0])*W+(Q=ie-H[1])*Q+(Z=fe-H[2])*Z)<g[se]&&(P.fromArray(X,ie,fe,H),g[se]=ce,4&d[se]||(d[se]|=4,$[j]=X,$[j+1]=ie,$[j+2]=fe,j+=3)));for(re=0,K=N;re<K;re+=3)for(B=I[re],q=I[re+1],ee=I[re+2],P.toArray(B,q,ee,H),he=18;he<26;he++)X=B+(ue=w[he])[0],ie=q+ue[1],fe=ee+ue[2],X<c&&X>-1&&ie<l&&ie>-1&&fe<u&&fe>-1&&(1&d[se=X*me+u*ie+fe]&&!(2&d[se])?(P.fromArray(X,ie,fe,H),ce=(W=X-H[0])*W+(Q=ie-H[1])*Q+(Z=fe-H[2])*Z,g[se]=ce,d[se]|=2,d[se]|=4,$[j]=X,$[j+1]=ie,$[j+2]=fe,j+=3):1&d[se]&&2&d[se]&&(ce=(W=X-H[0])*W+(Q=ie-H[1])*Q+(Z=fe-H[2])*Z)<g[se]&&(P.fromArray(X,ie,fe,H),g[se]=ce,4&d[se]||(d[se]|=4,$[j]=X,$[j+1]=ie,$[j+2]=fe,j+=3)));return j}this.getVolume=function(I,P,N,$,B){console.time("EDTSurface.getVolume");var q=I!=="vws";S(q,P,N,$,B),k(q),function(){var Q,Z,re,he=l*u;for(Q=0;Q<c;++Q)for(Z=0;Z<u;++Z)for(re=0;re<l;++re){var K=Q*he+re*u+Z;if(1&d[K])for(var ce=0;ce<26;){var se=Q+w[ce][0],ue=Z+w[ce][2],H=re+w[ce][1];if(se>-1&&se<c&&H>-1&&H<l&&ue>-1&&ue<u&&!(1&d[se*he+H*u+ue])){d[K]|=4;break}ce++}}}(),I!=="ms"&&I!=="ses"||D(),I==="ses"&&(C(!1),function(){var Q,Z;for(Q=0,Z=d.length;Q<Z;++Q)d[Q]&=-3;for(Q=0,Z=e.length/3;Q<Z;++Q)L(Q)}()),function(Q){var Z,re=d.length;if(Q==="vws")for(Z=0;Z<re;++Z)d[Z]&=-5,d[Z]=2&d[Z]?1:0;else if(Q==="ms")for(Z=0;Z<re;++Z)d[Z]&=-3,4&d[Z]&&(d[Z]|=2),d[Z]&=-5,d[Z]=2&d[Z]?1:0;else if(Q==="ses")for(Z=0;Z<re;++Z)4&d[Z]&&2&d[Z]?d[Z]&=-5:4&d[Z]&&!(2&d[Z])&&(d[Z]|=2),d[Z]=2&d[Z]?1:0;else if(Q==="sas")for(Z=0;Z<re;++Z)d[Z]&=-5,d[Z]=2&d[Z]?1:0}(I);for(var ee=0,W=b.length;ee<W;++ee)b[ee]=n[b[ee]];return console.timeEnd("EDTSurface.getVolume"),{data:d,nx:u,ny:l,nz:c,atomindex:b}},this.getSurface=function(I,P,N,$,B,q,ee){var W=this.getVolume(I,P,N,$,B);return new ba(W.data,W.nx,W.ny,W.nz,W.atomindex).getSurface(1,q,void 0,h,ee)}}function mE(e,t,n,i,r,o,s){s=Math.max(.1,s);var a=e.length,c=r[0],l=r[1],u=r[2],h=o[0],f=o[1],p=o[2];function m(q,ee){return Math.floor((q-ee)/s)}for(var y,v,d,g=m(h,c)+1,b=m(f,l)+1,x=m(p,u)+1,_=g*b*x,S=b*x,w=[],C=0;C<a;C++){var A=(y=e[C],v=t[C],d=n[C],(m(y,c)*b+m(v,l))*x+m(d,u));w[A]===void 0?w[A]=[C]:w[A].push(C)}var k=new Uint32Array(_),L=new Uint16Array(_),D=new Uint32Array(a),F=0,I=0;for(C=0;C<_;C++){var P=k[C]=F,N=w[C];if(N!==void 0)for(var $=0;$<N.length;$++)D[F]=N[$],F++;var B=F-P;L[C]=B,B>I&&(I=B)}return{neighbourListLength:27*I+1,withinRadii:function(q,ee,W,Q,Z){for(var re=0,he=m(q,c),K=m(ee,l),ce=m(W,u),se=Math.max(0,he-1),ue=Math.max(0,K-1),H=Math.max(0,ce-1),j=Math.min(g,he+2),X=Math.min(b,K+2),ie=Math.min(x,ce+2),fe=se;fe<j;++fe)for(var me=fe*S,ve=ue;ve<X;++ve)for(var G=ve*x,V=H;V<ie;++V)for(var pe=me+G+V,le=k[pe],ne=le+L[pe],oe=le;oe<ne;oe++){var xe=D[oe],Ae=e[xe]-q,ge=t[xe]-ee,Me=n[xe]-W,be=i[xe]+Q;Ae*Ae+ge*ge+Me*Me<=be*be&&(Z[re++]=D[oe])}Z[re]=-1}}}function Cm(e,t,n){for(var i=t.length,r=new Float32Array(i),o=new Float32Array(i),s=new Float32Array(i),a=0;a<i;a++){var c=3*a;r[a]=e[c],o[a]=e[c+1],s[a]=e[c+2]}var l=ip(e);e.length===0&&(l[0].set([0,0,0]),l[1].set([0,0,0]));var u,h,f,p,m,y,v,d,g,b,x,_,S,w,C,A,k,L,D,F=l[0],I=l[1],P=-1,N=new Float32Array([0,0,0]),$=new Float32Array([0,0,0]),B=new Float32Array([0,0,0]),q=new Float32Array([0,0,0]);function ee(ce,se,ue,H){p=O(ce,1.4),m=O(se,2),y=O(ue,!0),v=O(H,30),u=new Float32Array(i),h=new Float32Array(i);for(var j=0;j<u.length;++j){var X=t[j]+p;u[j]=X,h[j]=X*X}f=0;for(var ie=0;ie<u.length;++ie)u[ie]>f&&(f=u[ie]);var fe;fe=ap(F,I,f,m,0),m=fe.scaleFactor,d=fe.dim,g=fe.matrix,D=Math.max(5,2+Math.floor(p*m)),b=yr(d[0]*d[1]*d[2],-1001),x=new Int32Array(b.length),_=new Float32Array(d[0]),S=new Float32Array(d[1]),w=new Float32Array(d[2]),W(_,F[0],1/m),W(S,F[1],1/m),W(w,F[2],1/m),function(){var me=0,ve=2*Math.PI/v;A=new Float32Array(v),C=new Float32Array(v);for(var G=0;G<v;G++)A[G]=Math.cos(me),C[G]=Math.sin(me),me+=ve}(),k=mE(r,o,s,u,F,I,2.01*f),L=new Int32Array(k.neighbourListLength),P=-1}function W(ce,se,ue){for(var H=0;H<ce.length;H++)ce[H]=se+ue*H}function Q(ce,se,ue,H,j){var X;if(P!==-1){if((X=P)!==H&&X!==j&&Z(X,ce,se,ue))return X;P=-1}var ie=0;for(X=L[ie];X>=0;){if(X!==H&&X!==j&&Z(X,ce,se,ue))return P=X,X;X=L[++ie]}return P=-1,-1}function Z(ce,se,ue,H){var j=3*ce,X=h[ce],ie=e[j]-se,fe=e[j+1]-ue,me=e[j+2]-H;return ie*ie+fe*fe+me*me<X}function re(){for(var ce=0;ce<i;ce++){var se=r[ce],ue=o[ce],H=s[ce],j=u[ce],X=h[ce];k.withinRadii(se,ue,H,j,L);for(var ie=Math.ceil(j*m),fe=Math.floor(m*(se-F[0])),me=Math.floor(m*(ue-F[1])),ve=Math.floor(m*(H-F[2])),G=Math.max(0,fe-ie),V=Math.max(0,me-ie),pe=Math.max(0,ve-ie),le=Math.min(d[0],fe+ie+2),ne=Math.min(d[1],me+ie+2),oe=Math.min(d[2],ve+ie+2),xe=G;xe<le;xe++)for(var Ae=_[xe]-se,ge=d[1]*d[2]*xe,Me=V;Me<ne;Me++)for(var be=S[Me]-ue,Oe=Ae*Ae+be*be,Te=ge+d[2]*Me,Ce=pe;Ce<oe;Ce++){var Ge=w[Ce]-H,at=Oe+Ge*Ge;if(at<X){var it=Ce+Te;b[it]<0&&(b[it]=-b[it]);var et=Math.sqrt(at),mt=j/et,vt=Ae*mt,lt=be*mt,qe=Ge*mt;if(Q(vt+=se,lt+=ue,qe+=H,ce,-1)===-1){var Ct=j-et;Ct<b[it]&&(b[it]=Ct,y&&(x[it]=ce))}}}}}function he(ce,se){var ue=u[ce],H=u[se],j=N[0]=r[se]-r[ce],X=N[1]=o[se]-o[ce],ie=N[2]=s[se]-s[ce],fe=j*j+X*X+ie*ie,me=Math.sqrt(fe),ve=ue*((ue*ue+me*me-H*H)/(2*ue*me));Pn(N,N),function(Be,$e){Be[0]=Be[1]=Be[2]=1,$e[0]!==0?Be[0]=($e[1]+$e[2])/-$e[0]:$e[1]!==0?Be[1]=($e[0]+$e[2])/-$e[1]:$e[2]!==0&&(Be[2]=($e[0]+$e[1])/-$e[2])}(B,N),Pn(B,B),tr(q,N,B),Pn(q,q);var G=Math.sqrt(ue*ue-ve*ve);rn(B,B,G),rn(q,q,G),rn(N,N,ve),$[0]=N[0]+r[ce],$[1]=N[1]+o[ce],$[2]=N[2]+s[ce],P=-1;for(var V=D,pe=0;pe<v;pe++){var le=A[pe],ne=C[pe],oe=$[0]+le*B[0]+ne*q[0],xe=$[1]+le*B[1]+ne*q[1],Ae=$[2]+le*B[2]+ne*q[2];if(Q(oe,xe,Ae,ce,se)===-1)for(var ge=Math.floor(m*(oe-F[0])),Me=Math.floor(m*(xe-F[1])),be=Math.floor(m*(Ae-F[2])),Oe=Math.max(0,ge-V),Te=Math.max(0,Me-V),Ce=Math.max(0,be-V),Ge=Math.min(d[0],ge+V+2),at=Math.min(d[1],Me+V+2),it=Math.min(d[2],be+V+2),et=Oe;et<Ge;et++){j=oe-_[et];for(var mt=d[1]*d[2]*et,vt=Te;vt<at;vt++)for(var lt=j*j+(X=xe-S[vt])*X,qe=mt+d[2]*vt,Ct=Ce;Ct<it;Ct++){fe=lt+(ie=Ae-w[Ct])*ie;var tt=Ct+qe,Ve=b[tt];if(Ve>0&&fe<Ve*Ve&&(b[tt]=Math.sqrt(fe),y)){var Pt=j*N[0]+X*N[1]+ie*N[2];x[tt]=Pt<0?se:ce}}}}}function K(ce,se,ue){console.time("AVSurface.getVolume"),console.time("AVSurface.init"),ee(ce,se,ue),console.timeEnd("AVSurface.init"),console.time("AVSurface.projectPoints"),re(),console.timeEnd("AVSurface.projectPoints"),console.time("AVSurface.projectTorii"),function(){for(var H=0;H<i;H++){k.withinRadii(r[H],o[H],s[H],u[H],L);for(var j=0,X=L[j];X>=0;)H<X&&he(H,X),X=L[++j]}}(),console.timeEnd("AVSurface.projectTorii"),function(){for(var H=0;H<b.length;H++)b[H]<0&&(b[H]=0)}(),function(){for(var H=0;H<x.length;H++)x[H]=n[x[H]]}(),console.timeEnd("AVSurface.getVolume")}this.getSurface=function(ce,se,ue,H,j,X,ie){return K(se,ue,j),new ba(b,d[2],d[1],d[0],x).getSurface(se,!1,void 0,g,ie)}}yn.add("line",zz),Object.assign(Am,{__deps:[ap,XT,ba,ip,dE]}),Object.assign(Cm,{__deps:[ap,ba,yr,ip,rn,tr,Pn,mE,O]}),tp.add("molsurf",function(e,t){var n=e.data.args,i=e.data.params;if(n&&i){var r=new(i.type==="av"?Cm:Am)(n.coordList,n.radiusList,n.indexList).getSurface(i.type,i.probeRadius,i.scaleFactor,i.cutoff,!0,i.smooth,i.contour),o=[r.position.buffer,r.index.buffer];r.normal&&o.push(r.normal.buffer),r.atomindex&&o.push(r.atomindex.buffer),t({sd:r,p:i},o)}},[Am,Cm]);var ml=function(e){this.structure=e};ml.prototype._getAtomData=function(e){return this.structure.getAtomData({what:{position:!0,radius:!0,index:!0},radiusParams:O(e.radiusParams,{type:"vdw",scale:1})})},ml.prototype._makeSurface=function(e,t){var n=new Si(t.name,"",e);return n.info.type=t.type,n.info.probeRadius=t.probeRadius,n.info.scaleFactor=t.scaleFactor,n.info.smooth=t.smooth,n.info.cutoff=t.cutoff,n},ml.prototype.getSurface=function(e){var t=e||{},n=this._getAtomData(e),i=n.position,r=n.radius,o=n.index,s=new(t.type==="av"?Cm:Am)(i,r,o).getSurface(t.type,t.probeRadius,t.scaleFactor,t.cutoff,!0,t.smooth,t.contour);return this._makeSurface(s,t)},ml.prototype.getSurfaceWorker=function(e,t){var n=this,i=Object.assign({},e);if(window.hasOwnProperty("Worker")){this.worker===void 0&&(this.worker=new Ug("molsurf"));var r=this._getAtomData(e),o=r.position,s=r.radius,a=r.index,c={args:{coordList:o,radiusList:s,indexList:a},params:i},l=[o.buffer,s.buffer,a.buffer];this.worker.post(c,l,function(h){t(n._makeSurface(h.data.sd,i))},function(h){console.warn("MolecularSurface.getSurfaceWorker error - trying without worker",h),n.worker.terminate(),n.worker=void 0;var f=n.getSurface(i);t(f)})}else{var u=this.getSurface(i);t(u)}},ml.prototype.dispose=function(){this.worker&&this.worker.terminate()};var Uz=function(e){function t(n,i,r){var o=this;e.call(this,n,i,r),this.type="surface",this.parameters=Object.assign({surfaceType:{type:"select",rebuild:!0,options:{vws:"vws",sas:"sas",ms:"ms",ses:"ses",av:"av"}},probeRadius:{type:"number",precision:1,max:20,min:0,rebuild:!0},smooth:{type:"integer",precision:1,max:10,min:0,rebuild:!0},scaleFactor:{type:"number",precision:1,max:5,min:0,rebuild:!0},cutoff:{type:"number",precision:2,max:50,min:0,rebuild:!0},contour:{type:"boolean",rebuild:!0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},filterSele:{type:"text",rebuild:!0},colorVolume:{type:"hidden"},useWorker:{type:"boolean",rebuild:!0}},this.parameters,{radius:null,scale:null}),this.__infoList=[],this.structure.signals.refreshed.add(function(){o.__forceNewMolsurf=!0}),this.toBePrepared=!0,this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.colorScheme=O(i.colorScheme,"uniform"),i.colorValue=O(i.colorValue,14540253),i.disablePicking=O(i.disablePicking,!0),this.surfaceType=O(i.surfaceType,"ms"),this.probeRadius=O(i.probeRadius,1.4),this.smooth=O(i.smooth,2),this.scaleFactor=O(i.scaleFactor,2),this.cutoff=O(i.cutoff,0),this.contour=O(i.contour,!1),this.background=O(i.background,!1),this.opaqueBack=O(i.opaqueBack,!0),this.filterSele=O(i.filterSele,""),this.colorVolume=O(i.colorVolume,void 0),this.useWorker=O(i.useWorker,!0),e.prototype.init.call(this,n)},t.prototype.prepareData=function(n,i,r){var o=this.__infoList[i];if(o||(o={},this.__infoList[i]=o),o.molsurf&&o.sele===n.selection.string)r(i);else{if(this.filterSele){var s=n.structure.getView(new Jt(this.filterSele)),a=s.boundingBox.getSize(new T),c=Math.max(a.x,a.y,a.z),l=n.getAtomSetWithinPoint(s.center,c/2+6);if((n=n.getView(new Jt(n.getAtomSetWithinSelection(l,3).toSeleString()))).atomCount===0)return void r(i)}o.sele=n.selection.string,o.molsurf=new ml(n);var u=this.getSurfaceParams(),h=function(f){o.surface=f,r(i)};this.useWorker?o.molsurf.getSurfaceWorker(u,h):h(o.molsurf.getSurface(u))}},t.prototype.prepare=function(n){var i=this;if((this.__forceNewMolsurf||this.__sele!==this.selection.string||this.__surfaceParams!==JSON.stringify(this.getSurfaceParams()))&&(this.__infoList.forEach(function(a){a&&a.molsurf&&a.molsurf.dispose()}),this.__infoList.length=0),this.structureView.atomCount!==0){var r=function(){i.__sele=i.selection.string,i.__surfaceParams=JSON.stringify(i.getSurfaceParams()),i.__forceNewMolsurf=!1,n()},o=this.assembly==="default"?this.defaultAssembly:this.assembly,s=this.structure.biomolDict[o];s?s.partList.forEach(function(a,c){var l=a.getView(i.structureView);i.prepareData(l,c,function(u){u===s.partList.length-1&&r()})}):this.prepareData(this.structureView,0,r)}else n()},t.prototype.createData=function(n,i){var r=this.__infoList[i],o=r.surface;if(o){var s={position:o.getPosition(),color:o.getColor(this.getColorParams()),index:o.getFilteredIndex(this.filterSele,n)},a=[];if(o.contour){var c=new ZT(s,this.getBufferParams({wireframe:!1}));a.push(c)}else{Object.assign(s,{normal:o.getNormal(),picking:o.getPicking(n.getStructure())});var l=new YT(s,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));if(this.getBufferParams().side=="double"){var u=new Cr(l);a.push(u)}else a.push(l)}return{bufferList:a,info:r}}},t.prototype.updateData=function(n,i){var r={};if(n.position||n.radius)return this.__forceNewMolsurf=!0,void this.build();n.color&&(r.color=i.info.surface.getColor(this.getColorParams())),n.index&&(r.index=i.info.surface.getFilteredIndex(this.filterSele,i.sview)),i.bufferList[0].setAttributes(r)},t.prototype.setParameters=function(n,i,r){return i===void 0&&(i={}),n&&n.filterSele&&(i.index=!0),n&&n.colorVolume!==void 0&&(i.color=!0),n&&n.wireframe&&(n.contour||n.contour===void 0&&this.contour)&&(n.wireframe=!1),e.prototype.setParameters.call(this,n,i,r),this},t.prototype.getSurfaceParams=function(n){return n===void 0&&(n={}),Object.assign({type:this.surfaceType,probeRadius:this.probeRadius,scaleFactor:this.scaleFactor,smooth:this.smooth&&!this.contour,cutoff:this.cutoff,contour:this.contour,useWorker:this.useWorker,radiusParams:this.getRadiusParams()},n)},t.prototype.getColorParams=function(){var n=e.prototype.getColorParams.call(this);return n.volume=this.colorVolume,n},t.prototype.getAtomRadius=function(){return 0},t.prototype.clear=function(){e.prototype.clear.call(this)},t.prototype.dispose=function(){this.__infoList.forEach(function(n){n&&n.molsurf&&n.molsurf.dispose()}),this.__infoList.length=0,e.prototype.dispose.call(this)},t}(yi);yn.add("surface",Uz);var Gz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="point",this.parameters=Object.assign({pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{flatShaded:null,wireframe:null,linewidth:null,side:null,roughness:null,metalness:null}),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};this.pointSize=O(i.pointSize,1),this.sizeAttenuation=O(i.sizeAttenuation,!0),this.sortParticles=O(i.sortParticles,!1),this.useTexture=O(i.useTexture,!1),this.alphaTest=O(i.alphaTest,.5),this.forceTransparent=O(i.forceTransparent,!1),this.edgeBleach=O(i.edgeBleach,0),e.prototype.init.call(this,i)},t.prototype.createData=function(n){var i=n.getAtomData(this.getAtomParams({position:!0,color:!0,picking:!0}));return{bufferList:[new U_(i,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach}))]}},t.prototype.updateData=function(n,i){var r=i.sview.getAtomData(this.getAtomParams(n)),o={};n&&!n.position||Object.assign(o,{position:r.position}),n&&!n.color||Object.assign(o,{color:r.color}),i.bufferList[0].setAttributes(o)},t.prototype.getAtomRadius=function(){return .1},t}(yi);yn.add("point",Gz),jt.add("shader/Ribbon.vert",`#define STANDARD
uniform float clipNear;
uniform vec3 clipCenter;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
attribute vec3 dir;
attribute float size;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#endif
#include common
void main(void){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#include beginnormal_vertex
#include defaultnormal_vertex
#ifndef FLAT_SHADED
vNormal = normalize( transformedNormal );
#endif
#endif
#include begin_vertex
transformed += normalize( dir ) * size;
#include project_vertex
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`);var $z=new Uint16Array([0,1,2,1,3,2]);function mh(e){return 3*(4*(e.position.length/3-1))}var Vz=function(e){function t(n,i){i===void 0&&(i={}),e.call(this,{position:new Float32Array(mh(n)),color:new Float32Array(mh(n)),index:Ho(mh(n),mh(n)/3),normal:new Float32Array(mh(n)),picking:n.picking},i),this.vertexShader="Ribbon.vert";var r=n.position.length/3-1,o=4*r,s=3*o;this.addAttributes({dir:{type:"v3",value:new Float32Array(s)}}),this.addAttributes({size:{type:"f",value:new Float32Array(o)}}),n.primitiveId=Du(r),this.setAttributes(n),this.makeIndex()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setAttributes=function(n){n===void 0&&(n={});var i,r,o,s,a,c,l,u,h,f,p,m,y,v,d,g,b,x,_,S=this.size/4,w=this.geometry.attributes;n.position&&(i=n.position,l=w.position.array,w.position.needsUpdate=!0),n.normal&&(r=n.normal,u=w.normal.array,w.normal.needsUpdate=!0),n.size&&(o=n.size,h=w.size.array,w.size.needsUpdate=!0),n.dir&&(s=n.dir,f=w.dir.array,w.dir.needsUpdate=!0),n.color&&(a=n.color,p=w.color.array,w.color.needsUpdate=!0),n.primitiveId&&(c=n.primitiveId,m=w.primitiveId.array,w.primitiveId.needsUpdate=!0);var C=o?o[0]:null;for(y=0;y<S;++y){for(x=3*y,d=3*y*4,b=4*y,i&&(l[d]=l[d+3]=i[x],l[d+1]=l[d+4]=i[x+1],l[d+2]=l[d+5]=i[x+2],l[d+6]=l[d+9]=i[x+3],l[d+7]=l[d+10]=i[x+4],l[d+8]=l[d+11]=i[x+5]),r&&(u[d]=u[d+3]=-r[x],u[d+1]=u[d+4]=-r[x+1],u[d+2]=u[d+5]=-r[x+2],u[d+6]=u[d+9]=-r[x+3],u[d+7]=u[d+10]=-r[x+4],u[d+8]=u[d+11]=-r[x+5]),v=0;v<4;++v)g=d+3*v,a&&(p[g]=a[x],p[g+1]=a[x+1],p[g+2]=a[x+2]),c&&(m[b+v]=c[y]);o&&(_=o[y],C!==o[y]?(h[b]=C,h[b+1]=C,h[b+2]=_,h[b+3]=_):(h[b]=_,h[b+1]=_,h[b+2]=_,h[b+3]=_),C=_),s&&(f[d]=s[x],f[d+1]=s[x+1],f[d+2]=s[x+2],f[d+3]=-s[x],f[d+4]=-s[x+1],f[d+5]=-s[x+2],f[d+6]=s[x+3],f[d+7]=s[x+4],f[d+8]=s[x+5],f[d+9]=-s[x+3],f[d+10]=-s[x+4],f[d+11]=-s[x+5])}},t.prototype.makeIndex=function(){var n=this.geometry.getIndex();if(n)for(var i=n.array,r=i.length/4/3,o=0;o<r;++o){var s=6*o,a=4*o;i.set($z,s);for(var c=0;c<6;++c)i[s+c]+=a}else de.error("Index is null")},t}(Cs),Hz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="ribbon",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{side:null,wireframe:null,linewidth:null}),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.colorScheme=O(i.colorScheme,"chainname"),i.colorScale=O(i.colorScale,"RdYlBu"),i.radiusType=O(i.radiusType,"sstruc"),i.radiusScale=O(i.radiusScale,4),i.quality==="low"?this.subdiv=3:i.quality==="medium"?this.subdiv=6:i.quality==="high"?this.subdiv=12:this.subdiv=O(i.subdiv,6),this.tension=O(i.tension,NaN),this.smoothSheet=O(i.smoothSheet,!1),e.prototype.init.call(this,i)},t.prototype.getSplineParams=function(n){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!0,smoothSheet:this.smoothSheet},n)},t.prototype.getAtomRadius=function(n){return n.isTrace()?e.prototype.getAtomRadius.call(this,n):0},t.prototype.createData=function(n){var i=this,r=[],o=[];return this.structure.eachPolymer(function(s){if(!(s.residueCount<4)){o.push(s);var a=new ki(s,i.getSplineParams()),c=a.getSubdividedPosition(),l=a.getSubdividedOrientation(),u=a.getSubdividedColor(i.getColorParams()),h=a.getSubdividedPicking(),f=a.getSubdividedSize(i.getRadiusParams());r.push(new Vz({position:c.position,normal:l.binormal,dir:l.normal,color:u.color,size:f.size,picking:h.picking},i.getBufferParams()))}},n.getSelection()),{bufferList:r,polymerList:o}},t.prototype.updateData=function(n,i){n=n||{};var r=0,o=i.polymerList.length;for(r=0;r<o;++r){var s={},a=new ki(i.polymerList[r],this.getSplineParams());if(n.position){var c=a.getSubdividedPosition(),l=a.getSubdividedOrientation();Object.assign(s,{position:c.position,normal:l.binormal,dir:l.normal})}if(n.radius||n.scale){var u=a.getSubdividedSize(this.getRadiusParams());Object.assign(s,{size:u.size})}if(n.color){var h=a.getSubdividedColor(this.getColorParams());Object.assign(s,{color:h.color})}i.bufferList[r].setAttributes(s)}},t.prototype.setParameters=function(n){var i={};return n&&n.tension&&Object.assign(i,{position:!0}),e.prototype.setParameters.call(this,n,i,!1),this},t}(yi);yn.add("ribbon",Hz);var jz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="rocket",this.parameters=Object.assign({localAngle:{type:"integer",max:180,min:0,rebuild:!0},centerDist:{type:"number",precision:1,max:10,min:0,rebuild:!0},ssBorder:{type:"boolean",rebuild:!0},radialSegments:!0,openEnded:!0,disableImpostor:!0},this.parameters),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.colorScheme=O(i.colorScheme,"sstruc"),i.radiusSize=O(i.radiusSize,1.5),i.radiusScale=O(i.radiusScale,1),i.openEnded=O(i.openEnded,!1),i.useInteriorColor=O(i.useInteriorColor,!0),this.localAngle=O(i.localAngle,30),this.centerDist=O(i.centerDist,2.5),this.ssBorder=O(i.ssBorder,!1),e.prototype.init.call(this,i)},t.prototype.createData=function(n){var i=this,r=0,o=[],s=[];this.structure.eachPolymer(function(u){if(!(u.residueCount<4||u.isNucleic())){var h=new B_(u),f=h.getAxis(i.localAngle,i.centerDist,i.ssBorder,i.getColorParams(),i.getRadiusParams());r+=f.size.length,o.push(f),s.push(h)}},n.getSelection());var a={begin:new Float32Array(3*r),end:new Float32Array(3*r),size:new Float32Array(r),color:new Float32Array(3*r),picking:{}},c=new Float32Array(r),l=0;return o.forEach(function(u){a.begin.set(u.begin,3*l),a.end.set(u.end,3*l),a.size.set(u.size,l),a.color.set(u.color,3*l),c.set(u.picking.array,l),l+=u.size.length}),r&&(a.picking=new Oc(c,n.getStructure())),{bufferList:[new Ls({position1:a.begin,position2:a.end,color:a.color,color2:a.color,radius:a.size,picking:a.picking},this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))],axisList:o,helixbundleList:s,axisData:a}},t.prototype.updateData=function(n,i){var r=this;if((n=n||{}).position)this.build();else{var o={};if(n.color||n.radius){var s=0;i.helixbundleList.forEach(function(a){var c=a.getAxis(r.localAngle,r.centerDist,r.ssBorder,r.getColorParams(),r.getRadiusParams());n.color&&i.axisData.color.set(c.color,3*s),(n.radius||n.scale)&&i.axisData.size.set(c.size,s),s+=c.size.length}),n.color&&Object.assign(o,{color:i.axisData.color,color2:i.axisData.color}),(n.radius||n.scale)&&Object.assign(o,{radius:i.axisData.size})}i.bufferList[0].setAttributes(o)}},t}(yi);yn.add("rocket",jz);var Wz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="rope",this.parameters=Object.assign({smooth:{type:"integer",max:15,min:0,rebuild:!0}},this.parameters,{aspectRatio:null,smoothSheet:null})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.aspectRatio=1,i.tension=O(i.tension,.5),i.radiusScale=O(i.radiusScale,5),i.smoothSheet=!1,this.smooth=O(i.smooth,2),e.prototype.init.call(this,i)},t.prototype.getSpline=function(n){var i=new ls(n);return new ki(n,this.getSplineParams({directional:!1,positionIterator:i.getCenterIterator(this.smooth)}))},t}(W_);yn.add("rope",Wz);var qz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="spacefill",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.useInteriorColor=O(i.useInteriorColor,!0),e.prototype.init.call(this,i)},t.prototype.createData=function(n){return{bufferList:[new ka(n.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,dullInterior:!0,disableImpostor:this.disableImpostor}))]}},t.prototype.updateData=function(n,i){var r=i.sview.getAtomData(this.getAtomParams(n)),o={};n&&!n.position||Object.assign(o,{position:r.position}),n&&!n.color||Object.assign(o,{color:r.color}),n&&!n.radius||Object.assign(o,{radius:r.radius}),i.bufferList[0].setAttributes(o)},t}(yi);function EM(e){return 3*(e.position.length/3-1)*2}yn.add("spacefill",qz);var Xz=function(e){function t(n,i){i===void 0&&(i={}),e.call(this,{position:new Float32Array(EM(n)),color:new Float32Array(EM(n))},i),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag",this.setAttributes(n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setAttributes=function(n){var i,r,o,s,a=this.geometry.attributes;if(n.position&&(i=n.position,o=a.position.array,a.position.needsUpdate=!0),n.color&&(r=n.color,s=a.color.array,a.color.needsUpdate=!0),i||r)for(var c,l,u=this.size-1,h=0;h<u;++h)c=3*h,l=3*h*2,i&&(o[l]=i[c],o[l+1]=i[c+1],o[l+2]=i[c+2],o[l+3]=i[c+3],o[l+4]=i[c+4],o[l+5]=i[c+5]),r&&(s[l]=r[c],s[l+1]=r[c+1],s[l+2]=r[c+2],s[l+3]=r[c+3],s[l+4]=r[c+4],s[l+5]=r[c+5]);else de.warn("TraceBuffer.prototype.setAttributes no data")},t}(Bt),Yz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="trace",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null}),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.colorScheme=O(i.colorScheme,"chainname"),i.colorScale=O(i.colorScale,"RdYlBu"),i.quality==="low"?this.subdiv=3:i.quality==="medium"?this.subdiv=6:i.quality==="high"?this.subdiv=12:this.subdiv=O(i.subdiv,6),this.tension=O(i.tension,NaN),this.smoothSheet=O(i.smoothSheet,!1),e.prototype.init.call(this,i)},t.prototype.getSplineParams=function(n){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!1,smoothSheet:this.smoothSheet},n)},t.prototype.getAtomRadius=function(n){return n.isTrace()?.1:0},t.prototype.createData=function(n){var i=this,r=[],o=[];return this.structure.eachPolymer(function(s){if(!(s.residueCount<4)){o.push(s);var a=new ki(s,i.getSplineParams()),c=a.getSubdividedPosition(),l=a.getSubdividedColor(i.getColorParams());r.push(new Xz(Object.assign({},c,l),i.getBufferParams()))}},n.getSelection()),{bufferList:r,polymerList:o}},t.prototype.updateData=function(n,i){n=n||{};var r=0,o=i.polymerList.length;for(r=0;r<o;++r){var s={},a=new ki(i.polymerList[r],this.getSplineParams());if(n.position){var c=a.getSubdividedPosition();Object.assign(s,{position:c.position})}if(n.color){var l=a.getSubdividedColor(this.getColorParams());Object.assign(s,{color:l.color})}i.bufferList[r].setAttributes(s)}},t.prototype.setParameters=function(n){var i={};return n&&n.tension&&Object.assign(i,{position:!0}),e.prototype.setParameters.call(this,n,i,!1),this},t}(yi);yn.add("trace",Yz);var Zz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="tube",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.aspectRatio=1,i.radiusScale=O(i.radiusScale,2),i.quality==="low"&&(this.radialSegments=5),e.prototype.init.call(this,i)},t.prototype.getSplineParams=function(){return e.prototype.getSplineParams.call(this,{directional:!1})},t}(W_);yn.add("tube",Zz);var Kz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="unitcell",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0},this.parameters,{assembly:null}),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{},r=.5;this.structure.unitcell&&(r=Math.cbrt(this.structure.unitcell.volume)/200),i.radiusSize=O(i.radiusSize,r),i.colorValue=O(i.colorValue,"orange"),i.useInteriorColor=O(i.useInteriorColor,!0),e.prototype.init.call(this,i)},t.prototype.getUnitcellData=function(n){return n.unitcell.getData(n)},t.prototype.create=function(){var n=this.structureView.getStructure();if(n.unitcell){var i=this.getUnitcellData(n);this.sphereBuffer=new ka(i.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new Ls(i.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}},t.prototype.createData=function(n){},t.prototype.updateData=function(n,i){var r=i.sview.getStructure();if(r.unitcell){var o=this.getUnitcellData(r),s={},a={};n&&!n.position||(Object.assign(s,{position:o.vertex.position}),Object.assign(a,{position1:o.edge.position1,position2:o.edge.position2})),n&&!n.color||(Object.assign(s,{color:o.vertex.color}),Object.assign(a,{color:o.edge.color,color2:o.edge.color2})),n&&!n.radius||(Object.assign(s,{radius:o.vertex.radius}),Object.assign(a,{radius:o.edge.radius})),this.sphereBuffer.setAttributes(s),this.cylinderBuffer.setAttributes(a)}},t}(yi);yn.add("unitcell",Kz);var Qz=function(e){function t(n,i,r){e.call(this,n,i,r),this.type="validation",this.parameters=Object.assign({},this.parameters,{radiusType:null,radiusSize:null,radiusScale:null}),this.init(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(n){var i=n||{};i.colorValue=O(i.colorValue,"#f0027f"),i.useInteriorColor=O(i.useInteriorColor,!0),e.prototype.init.call(this,i)},t.prototype.createData=function(n){if(n.validation){var i=n.validation.getClashData({structure:n,color:this.colorValue});return{bufferList:[new Ls(i,this.getBufferParams({openEnded:!1}))]}}},t}(yi);yn.add("validation",Qz);var IM=new T,Py=new T,Ty=new T,Jz=new T(0,1,0),e8=Object.assign({radialSegments:60,openEnded:!1},Vi),gE=function(e){function t(i,r){r===void 0&&(r={}),e.call(this,{position:new Float32Array(i.position1.length),color:i.color,picking:i.picking},r,function(o){o===void 0&&(o={});var s=new Vf(1,1,O(o.radialSegments,60),1,O(o.openEnded,!1));return s.applyMatrix4(new De().makeRotationX(-Math.PI/2)),s}(r)),this.updateNormals=!0,this._position=new Float32Array(i.position1.length),this.setAttributes(i,!0)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultParameters:{configurable:!0}};return n.defaultParameters.get=function(){return e8},t.prototype.applyPositionTransform=function(i,r,o){Py.fromArray(this._position1,o),Ty.fromArray(this._position2,o),i.lookAt(Py,Ty,Jz);var s=this._radius[r];IM.set(s,s,Py.distanceTo(Ty)),i.scale(IM)},t.prototype.setAttributes=function(i,r){i===void 0&&(i={}),i.position1&&i.position2&&(No(i.position1,i.position2,this._position),this._position1=i.position1,this._position2=i.position2,i.position=this._position),i.radius&&(this._radius=i.radius),e.prototype.setAttributes.call(this,i,r)},Object.defineProperties(t.prototype,n),t}(Oa);_r.add("cone",gE);var yE=function(e){e===void 0&&(e=[]),this.geometryList=e};yE.prototype.computeBoundingBox=function(){var e=this;this.boundingBox?this.boundingBox.empty():this.boundingBox=new hn,this.geometryList.forEach(function(t){t.boundingBox||t.computeBoundingBox(),e.boundingBox.union(t.boundingBox)})};var t8=Object.assign({aspectRatio:1.5,radialSegments:50,openEnded:!1,disableImpostor:!1},Vi),bo=function(e,t){t===void 0&&(t={}),this.group=new nn,this.wireframeGroup=new nn,this.pickingGroup=new nn,this.visible=!0,this.parameters=br(t,this.defaultParameters),this.splitPosition=new Float32Array(e.position1.length),this.cylinderRadius=new Float32Array(e.radius.length);var n=this.makeAttributes(e),i={radialSegments:this.parameters.radialSegments,openEnded:this.parameters.openEnded,disableImpostor:this.parameters.disableImpostor};this.cylinderBuffer=new Ls(n.cylinder,i),this.coneBuffer=new gE(n.cone,i),this.geometry=new yE([this.cylinderBuffer.geometry,this.coneBuffer.geometry]),this.matrix=O(t.matrix,new De),this.picking=e.picking},gh={defaultParameters:{configurable:!0},matrix:{configurable:!0},pickable:{configurable:!0}};gh.defaultParameters.get=function(){return t8},gh.matrix.set=function(e){Bt.prototype.setMatrix.call(this,e)},gh.matrix.get=function(){return this.group.matrix.clone()},gh.pickable.get=function(){return!!this.picking},bo.prototype.makeAttributes=function(e){e===void 0&&(e={});var t,n,i=this.splitPosition,r=this.cylinderRadius,o=this.parameters.aspectRatio,s={},a={};if(e.radius){for(t=0,n=r.length;t<n;++t)r[t]=e.radius[t]/o;s.radius=r,a.radius=e.radius}if(e.position1&&e.position2){var c=new T,l=new T,u=new T,h=new T;for(t=0,n=i.length;t<n;t+=3){c.fromArray(e.position1,t),l.fromArray(e.position2,t),u.subVectors(c,l);var f=u.length(),p=r[t/3]*o*2,m=Math.min(f,p);u.setLength(m),h.copy(l).add(u),h.toArray(i,t)}s.position1=e.position1,s.position2=i,a.position1=i,a.position2=e.position2}return e.color&&(s.color=e.color,s.color2=e.color,a.color=e.color),{cylinder:s,cone:a}},bo.prototype.getMesh=function(){return new nn().add(this.cylinderBuffer.getMesh(),this.coneBuffer.getMesh())},bo.prototype.getWireframeMesh=function(){return new nn().add(this.cylinderBuffer.getWireframeMesh(),this.coneBuffer.getWireframeMesh())},bo.prototype.getPickingMesh=function(){return new nn().add(this.cylinderBuffer.getPickingMesh(),this.coneBuffer.getPickingMesh())},bo.prototype.setAttributes=function(e){e===void 0&&(e={});var t=this.makeAttributes(e);this.cylinderBuffer.setAttributes(t.cylinder),this.coneBuffer.setAttributes(t.cone)},bo.prototype.setParameters=function(e){e===void 0&&(e={}),(e=Object.assign({},e))&&e.matrix!==void 0&&(this.matrix=e.matrix),delete e.matrix,e&&e.wireframe!==void 0&&(this.parameters.wireframe=e.wireframe,this.setVisibility(this.visible)),this.cylinderBuffer.setParameters(e),this.coneBuffer.setParameters(e)},bo.prototype.setVisibility=function(e){Bt.prototype.setVisibility.call(this,e)},bo.prototype.dispose=function(){this.cylinderBuffer.dispose(),this.coneBuffer.dispose()},Object.defineProperties(bo.prototype,gh),_r.add("arrow",bo);var LM=new T,Ey=new T,Iy=new T,n8=new T(0,0,0),i8=function(e){function t(n,i){i===void 0&&(i={}),e.call(this,n,i,new vp(1,1,1)),this.updateNormals=!0,this.setAttributes(n,!0)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.applyPositionTransform=function(n,i,r){Ey.fromArray(this._heightAxis,r),Iy.fromArray(this._depthAxis,r),n.lookAt(n8,Ey,Iy),LM.set(this._size[i],Iy.length(),Ey.length()),n.scale(LM)},t.prototype.setAttributes=function(n,i){n===void 0&&(n={}),n.size&&(this._size=n.size),n.heightAxis&&(this._heightAxis=n.heightAxis),n.depthAxis&&(this._depthAxis=n.depthAxis),e.prototype.setAttributes.call(this,n,i)},t}(Oa);_r.add("box",i8);var RM=new T,Ly=new T,Ry=new T,r8=new T(0,0,0),o8=Object.assign({sphereDetail:2},Vi),s8=function(e){function t(i,r){r===void 0&&(r={}),e.call(this,i,r,new Mc(1,O(r.sphereDetail,2))),this.updateNormals=!0,this.setAttributes(i,!0)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultParameters:{configurable:!0}};return n.defaultParameters.get=function(){return o8},t.prototype.applyPositionTransform=function(i,r,o){Ly.fromArray(this._majorAxis,o),Ry.fromArray(this._minorAxis,o),i.lookAt(r8,Ly,Ry),RM.set(this._radius[r],Ry.length(),Ly.length()),i.scale(RM)},t.prototype.setAttributes=function(i,r){i===void 0&&(i={}),i.radius&&(this._radius=i.radius),i.majorAxis&&(this._majorAxis=i.majorAxis),i.minorAxis&&(this._minorAxis=i.minorAxis),e.prototype.setAttributes.call(this,i,r)},Object.defineProperties(t.prototype,n),t}(Oa);_r.add("ellipsoid",s8);var OM=new T,Oy=new T,ky=new T,a8=new T(0,0,0),c8=function(e){function t(n,i){i===void 0&&(i={}),e.call(this,n,i,new Sc(1,0)),this.updateNormals=!0,this.setAttributes(n,!0)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.applyPositionTransform=function(n,i,r){Oy.fromArray(this._heightAxis,r),ky.fromArray(this._depthAxis,r),n.lookAt(a8,Oy,ky),OM.set(this._size[i],ky.length(),Oy.length()),n.scale(OM)},t.prototype.setAttributes=function(n,i){n===void 0&&(n={}),n.size&&(this._size=n.size),n.heightAxis&&(this._heightAxis=n.heightAxis),n.depthAxis&&(this._depthAxis=n.depthAxis),e.prototype.setAttributes.call(this,n,i)},t}(Oa);_r.add("octahedron",c8);var kM=new T,Dy=new T,By=new T,l8=new T(0,0,0),u8=function(e){function t(n,i){i===void 0&&(i={}),e.call(this,n,i,new au(1,0)),this.updateNormals=!0,this.setAttributes(n,!0)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.applyPositionTransform=function(n,i,r){Dy.fromArray(this._heightAxis,r),By.fromArray(this._depthAxis,r),n.lookAt(l8,Dy,By),kM.set(this._size[i],By.length(),Dy.length()),n.scale(kM)},t.prototype.setAttributes=function(n,i){n===void 0&&(n={}),n.size&&(this._size=n.size),n.heightAxis&&(this._heightAxis=n.heightAxis),n.depthAxis&&(this._depthAxis=n.depthAxis),e.prototype.setAttributes.call(this,n,i)},t}(Oa);_r.add("tetrahedron",u8);var DM=new T,BM=new T,FM=new T,h8=new T(0,0,0),f8=Object.assign({radiusRatio:.2,radialSegments:16,tubularSegments:32},Vi),p8=function(e){function t(i,r){r===void 0&&(r={}),e.call(this,i,r,new lu(1,O(r.radiusRatio,.2),O(r.radialSegments,16),O(r.tubularSegments,32))),this.updateNormals=!0,this.setAttributes(i,!0)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultParameters:{configurable:!0}};return n.defaultParameters.get=function(){return f8},t.prototype.applyPositionTransform=function(i,r,o){BM.fromArray(this._majorAxis,o),FM.fromArray(this._minorAxis,o),i.lookAt(h8,BM,FM);var s=this._radius[r];DM.set(s,s,s),i.scale(DM)},t.prototype.setAttributes=function(i,r){i===void 0&&(i={}),i.radius&&(this._radius=i.radius),i.majorAxis&&(this._majorAxis=i.majorAxis),i.minorAxis&&(this._minorAxis=i.minorAxis),e.prototype.setAttributes.call(this,i,r)},Object.defineProperties(t.prototype,n),t}(Oa);_r.add("torus",p8);var Ci=function(e,t){var n=t||{};this.streamer=e,this.name=O(n.name,""),this.path=O(n.path,"")},tl={type:{configurable:!0},__objName:{configurable:!0},isBinary:{configurable:!0},isJson:{configurable:!0},isXml:{configurable:!0}};tl.type.get=function(){return""},tl.__objName.get=function(){return""},tl.isBinary.get=function(){return!1},tl.isJson.get=function(){return!1},tl.isXml.get=function(){return!1},Ci.prototype.parse=function(){var e=this;return this.streamer.read().then(function(){return e._beforeParse(),e._parse(),e._afterParse(),e[e.__objName]})},Ci.prototype._parse=function(){},Ci.prototype._beforeParse=function(){},Ci.prototype._afterParse=function(){Pe&&de.log(this[this.__objName])},Object.defineProperties(Ci.prototype,tl);var Rs=function(e){function t(i,r){var o=r||{};e.call(this,i,o),this.firstModelOnly=O(o.firstModelOnly,!1),this.asTrajectory=O(o.asTrajectory,!1),this.cAlphaOnly=O(o.cAlphaOnly,!1),this.structure=new ut(this.name,this.path),this.structureBuilder=new Sm(this.structure)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},__objName:{configurable:!0}};return n.type.get=function(){return"structure"},n.__objName.get=function(){return"structure"},Object.defineProperties(t.prototype,n),t}(Ci),Jr=function(e,t,n,i,r){n===void 0&&(n=""),r===void 0&&(r=[]),this.structure=e,this.index=t,this.description=n,this.entityType=function(o){switch(o=o.toLowerCase()){case"polymer":return 1;case"non-polymer":return 2;case"macrolide":return 3;case"water":return 4;default:return 0}}(i||""),this.chainIndexList=r,r.forEach(function(o){e.chainStore.entityIndex[o]=t})},NM={type:{configurable:!0}};NM.type.get=function(){return function(e){switch(e){case 1:return"polymer";case 2:return"non-polymer";case 3:return"macrolide";case 4:return"water";default:return}}(this.entityType)},Jr.prototype.getEntityType=function(){return this.entityType},Jr.prototype.isPolymer=function(){return this.entityType===1},Jr.prototype.isNonPolymer=function(){return this.entityType===2},Jr.prototype.isMacrolide=function(){return this.entityType===3},Jr.prototype.isWater=function(){return this.entityType===4},Jr.prototype.eachChain=function(e){var t=this.structure.getChainProxy();this.chainIndexList.forEach(function(n){t.index=n,e(t)})},Object.defineProperties(Jr.prototype,NM);var d8={a:1,b:1,c:1,alpha:90,beta:90,gamma:90,spacegroup:"P 1"},uc=function(e){e===void 0&&(e=d8),this.cartToFrac=new De,this.fracToCart=new De,this.a=e.a,this.b=e.b,this.c=e.c,this.alpha=e.alpha,this.beta=e.beta,this.gamma=e.gamma,this.spacegroup=e.spacegroup;var t=Tn(this.alpha),n=Tn(this.beta),i=Tn(this.gamma),r=Math.cos(t),o=Math.cos(n),s=Math.cos(i),a=Math.sin(n),c=Math.sin(i);if(this.volume=this.a*this.b*this.c*Math.sqrt(1-r*r-o*o-s*s+2*r*o*s),e.cartToFrac===void 0){var l=this.a*this.b*c/this.volume,u=(o*s-r)/(a*c);this.fracToCart.set(this.a,0,0,0,this.b*s,this.b*c,0,0,this.c*o,-this.c*a*u,1/l,0,0,0,0,1).transpose(),this.cartToFrac.getInverse(this.fracToCart)}else this.cartToFrac.copy(e.cartToFrac),this.fracToCart.getInverse(this.cartToFrac)};uc.prototype.getPosition=function(e){var t=new Float32Array(24);if(e.unitcell){var n=e.unitcell,i=e.center.clone().applyMatrix4(n.cartToFrac).floor(),r=new T,o=0,s=function(a,c,l){r.set(a,c,l).add(i).applyMatrix4(n.fracToCart).toArray(t,o),o+=3};s(0,0,0),s(1,0,0),s(0,1,0),s(0,0,1),s(1,1,0),s(1,0,1),s(0,1,1),s(1,1,1)}return t},uc.prototype.getCenter=function(e){return function(t,n){n===void 0&&(n=new T);for(var i=t.length,r=0;r<i;r+=3)n.x+=t[r],n.y+=t[r+1],n.z+=t[r+2];return n.divideScalar(i/3),n}(this.getPosition(e))},uc.prototype.getData=function(e,t){t===void 0&&(t={});var n=O(t.colorValue,"orange"),i=O(t.radius,Math.cbrt(this.volume)/200),r=new Fe(n),o=new T,s=this.getPosition(e),a=tn(8,r.r,r.g,r.b),c=yr(8,i),l=new Float32Array(36),u=new Float32Array(36),h=tn(12,r.r,r.g,r.b),f=yr(12,i),p=0;function m(v,d){o.fromArray(s,3*v).toArray(l,p),o.fromArray(s,3*d).toArray(u,p),p+=3}m(0,1),m(0,2),m(0,3),m(1,4),m(1,5),m(2,6),m(3,5),m(4,7),m(5,7),m(2,4),m(7,6),m(3,6);var y=new HN(this,e);return{vertex:{position:s,color:a,radius:c,picking:y},edge:{position1:l,position2:u,color:h,color2:h,radius:f,picking:y}}};var qg={1:"h",2:"h",3:"i",4:"h",5:"g",6:"h",7:"h",8:"h",9:"h",10:"h",0:"h"},m8=["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"],g8=["MOL_ID","MOLECULE","CHAIN","FRAGMENT","SYNONYM","EC","ENGINEERED","MUTATION","OTHER_DETAILS"],zM=/\s+/;function UM(e,t,n){var i=""+e;return t&&(i+=":"+t),n&&(i+="^"+n),i}var Jh=function(e){function t(i,r){var o=r||{};e.call(this,i,o),this.hex=O(o.hex,!1)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"pdb"},t.prototype._parse=function(){Pe&&de.time("PdbParser._parse "+this.name);var i=!1,r=this.streamer.peekLines(1)[0],o=r.substr(62,4),s=r.substr(72,4);o===s&&s.trim()&&(i=!0);var a,c,l,u,h,f,p,m,y,v,d,g,b,x,_,S,w,C,A,k,L,D,F,I,P,N,$,B,q,ee,W,Q,Z,re,he=this.type==="pqr",K=this.type==="pdbqt",ce=this.structure,se=this.structureBuilder,ue=this.hex,H=10,j=10,X=this.firstModelOnly,ie=this.asTrajectory,fe=this.cAlphaOnly,me=ce.frames,ve=ce.boxes,G=!1,V=ce.biomolDict,pe={},le={},ne={},oe=[],xe={},Ae={},ge={},Me={},be={helices:[],sheets:[]},Oe=be.helices,Te=be.sheets,Ce=ce.atomMap,Ge=ce.atomStore;Ge.resize(Math.round(this.streamer.data.length/80)),(he||K)&&Ge.addField("partialCharge",1,"float32"),he&&Ge.addField("radius",1,"float32");var at=ce.getAtomProxy(),it=ce.getAtomProxy(),et=0,mt=0,vt=!0;this.streamer.eachChunkOfLines(function(Ve){(function(Pt,Be,$e){for(var Je,Y=Pt;Y<Be;++Y)if(f=$e[Y],(p=f.substr(0,6))==="ATOM  "||p==="HETATM"){if(vt&&(ie?(G?(a=new Float32Array(3*Ge.count),me.push(a)):a=[],c=0):X||(pe={}),B=($=1).toString(),q=!0,vt=!1),X&&mt>0)continue;var Se=void 0,ye=void 0,M=void 0,E=void 0,R=0;if(he){if(R=(E=f.split(zM)).length===10?1:0,x=E[2],fe&&x!=="CA")continue;Se=parseFloat(E[6-R]),ye=parseFloat(E[7-R]),M=parseFloat(E[8-R])}else{if(x=f.substr(12,4).trim(),fe&&x!=="CA")continue;Se=parseFloat(f.substr(30,8)),ye=parseFloat(f.substr(38,8)),M=parseFloat(f.substr(46,8))}if(ie){var z=3*c;if(a[z+0]=Se,a[z+1]=ye,a[z+2]=M,c+=1,G)continue}var U=void 0;he?(m=parseInt(E[1]),U="",_=f[0]==="H"?1:0,y=R?"":E[4],v=parseInt(E[5-R]),b="",d=E[3],w="",g=1):(m=parseInt(f.substr(6,5),H),ue&&m===99999&&(H=16),_=f[0]==="H"?1:0,y=f[21].trim(),v=parseInt(f.substr(22,4),j),ue&&v===9999&&(j=16),b=f[26].trim(),d=f.substr(17,4).trim()||"MOL",S=parseFloat(f.substr(60,6)),w=f[16].trim(),g=parseFloat(f.substr(54,6)),i||(K?(U=f.substr(76,3).trim())in SS&&(U=SS[U]):(U=f.substr(76,2).trim(),y||(y=f.substr(72,4).trim())),C=parseInt((f.substr(79,1)+f.substr(78,1)).trim()))),Ge.growIfFull(),Ge.atomTypeId[et]=Ce.add(x,U),Ge.x[et]=Se,Ge.y[et]=ye,Ge.z[et]=M,Ge.serial[et]=m,Ge.altloc[et]=w.charCodeAt(0),Ge.occupancy[et]=isNaN(g)?0:g,he?(Ge.partialCharge[et]=parseFloat(E[9-R]),Ge.radius[et]=parseFloat(E[10-R])):(Ge.bfactor[et]=isNaN(S)?0:S,K&&(Ge.partialCharge[et]=parseFloat(f.substr(70,6))),isFinite(C)&&(Ge.formalCharge||Ge.addField("formalCharge",1,"int8"),Ge.formalCharge[et]=C));var J=UM(v,y,b);!_||Ae[J]||m8.includes(d)?q||ee===y||(B=($+=1).toString()):ee===y&&Q===d&&(Vg.includes(d)||W===v&&Z===b)||(B=($+=1).toString(),W=v,Q=d,Z=b),se.addAtom(mt,y,B,d,v,_,void 0,b),pe[m]=et,et+=1,q=!1,ee=y}else if(p==="CONECT"){var te=pe[parseInt(f.substr(6,5))],ae=[11,16,21,26],we={};if(te===void 0)continue;for(var _e=0;_e<4;++_e){var Ie=parseInt(f.substr(ae[_e],5));if(!Number.isNaN(Ie)&&(Ie=pe[Ie])!==void 0)if(te<Ie?(at.index=te,it.index=Ie):(at.index=Ie,it.index=te),we[Ie]!==void 0)ce.bondStore.bondOrder[we[Ie]]+=1;else{var Ue=at.index+"|"+it.index;ne[Ue]===void 0&&(ne[Ue]=!0,we[Ie]=ce.bondStore.count,ce.bondStore.addBond(at,it,1))}}}else if(p==="HELIX "){A=f[19].trim(),k=parseInt(f.substr(21,4)),L=f[25].trim(),D=f[31].trim(),F=parseInt(f.substr(33,4)),I=f[37].trim();var Re=parseInt(f.substr(39,1));Re=(qg[Re]||qg[0]).charCodeAt(0),Oe.push([A,k,L,D,F,I,Re])}else if(p==="SHEET ")A=f[21].trim(),k=parseInt(f.substr(22,4)),L=f[26].trim(),D=f[32].trim(),F=parseInt(f.substr(33,4)),I=f[37].trim(),Te.push([A,k,L,D,F,I]);else if(p==="HETNAM")xe[f.substr(11,3)]=f.substr(15).trim();else if(p==="SEQRES"){var ke=f[11].trim();ke!==re&&(Me[ke]=[],re=ke),(Je=Me[ke]).push.apply(Je,f.substr(19).trim().split(zM))}else if(p==="MODRES"){var ze=f.substr(12,3).trim(),Ze=f[16].trim(),nt=f[22].trim(),Qe=parseInt(f.substr(18,4).trim()),cn=UM(Qe,Ze,nt);Ae[cn]={resname:ze,chainname:Ze,inscode:nt,resno:Qe}}else if(p==="COMPND"){var zt=f.substr(10,70).trim(),Ii=zt.indexOf(":"),nr=zt.substring(0,Ii),wt=void 0;g8.includes(nr)?(N=nr,wt=zt.substring(Ii+2)):wt=zt,wt=wt.replace(/;$/,""),N==="MOL_ID"?(P={chainList:[],name:""},oe.push(P)):N==="MOLECULE"?(P.name&&(P.name+=" "),P.name+=wt):N==="CHAIN"&&Array.prototype.push.apply(P.chainList,wt.split(/\s*,\s*/))}else if(f.startsWith("TER")){var Le=ce.getChainProxy(ce.chainStore.count-1);ge[Le.chainname]=Le.index,B=($+=1).toString(),q=!0}else if(p==="REMARK"&&f.substr(7,3)==="350"){if(f.substr(11,12)==="BIOMOLECULE:"){var Ye=f.substr(23).trim();/^(0|[1-9][0-9]*)$/.test(Ye)&&(Ye="BU"+Ye),l=new fi(Ye),V[Ye]=l}else if(f.substr(13,5)==="BIOMT"){var St=f.split(/\s+/),Ot=parseInt(f[18])-1;Ot===0&&(h=new De,u.matrixList.push(h));var pt=h.elements;pt[0+Ot]=parseFloat(St[4]),pt[4+Ot]=parseFloat(St[5]),pt[8+Ot]=parseFloat(St[6]),pt[12+Ot]=parseFloat(St[7])}else if(f.substr(11,30)==="APPLY THE FOLLOWING TO CHAINS:"||f.substr(11,30)==="                   AND CHAINS:"){f.substr(11,5)==="APPLY"&&(u=l.addPart());for(var kt=f.substr(41,30).split(","),Lt=0,Zt=kt.length;Lt<Zt;++Lt){var Vn=kt[Lt].trim();Vn&&u.chainList.push(Vn)}}}else if(p==="HEADER")ce.id=f.substr(62,4);else if(p==="TITLE ")ce.title+=(ce.title?" ":"")+f.substr(10,70).trim();else if(p==="MODEL ")vt=!0;else if(p==="ENDMDL"||f.trim()==="END"){if(vt)continue;ie&&!G&&(me.push(new Float32Array(a)),G=!0),mt+=1,vt=!0}else if(f.substr(0,5)==="MTRIX"){if(f[59]==="1")continue;l&&l.name==="NCS"||(l=new fi("NCS"),V.NCS=l,u=l.addPart());var Tt=f.split(/\s+/),fn=parseInt(f[5])-1;fn===0&&(h=new De,u.matrixList.push(h));var Wo=h.elements;Wo[0+fn]=parseFloat(Tt[2]),Wo[4+fn]=parseFloat(Tt[3]),Wo[8+fn]=parseFloat(Tt[4]),Wo[12+fn]=parseFloat(Tt[5])}else if(f.substr(0,5)==="ORIGX"){le.origx||(le.origx=new De);var Gr=f.split(/\s+/),Os=parseInt(f[5])-1,uo=le.origx.elements;uo[0+Os]=parseFloat(Gr[1]),uo[4+Os]=parseFloat(Gr[2]),uo[8+Os]=parseFloat(Gr[3]),uo[12+Os]=parseFloat(Gr[4])}else if(f.substr(0,5)==="SCALE"){le.scale||(le.scale=new De);var ho=f.split(/\s+/),fo=parseInt(f[5])-1,po=le.scale.elements;po[0+fo]=parseFloat(ho[1]),po[4+fo]=parseFloat(ho[2]),po[8+fo]=parseFloat(ho[3]),po[12+fo]=parseFloat(ho[4])}else if(p==="CRYST1"){var ks=parseFloat(f.substr(6,9)),Ds=parseFloat(f.substr(15,9)),Uu=parseFloat(f.substr(24,9)),Da=parseFloat(f.substr(33,7)),Ba=parseFloat(f.substr(40,7)),Fa=parseFloat(f.substr(47,7)),Na=f.substr(55,11).trim(),mo=new Float32Array(9);mo[0]=ks,mo[4]=Ds,mo[8]=Uu,ve.push(mo),mt===0&&(le.a=ks,le.b=Ds,le.c=Uu,le.alpha=Da,le.beta=Ba,le.gamma=Fa,le.spacegroup=Na)}})(0,Ve.length,Ve)}),se.finalize();var lt=oe.length;if(lt){ce.eachChain(function(Ve){Ve.entityIndex=lt}),oe.forEach(function(Ve,Pt){var Be=Ve.chainList.map(function($e){return ge[$e]});ce.entityList.push(new Jr(ce,Pt,Ve.name,"polymer",Be))});var qe=oe.length,Ct=ce.getResidueProxy(),tt={};ce.eachChain(function(Ve){Ve.entityIndex===lt&&(Ct.index=Ve.residueOffset,tt[Ct.resname]||(tt[Ct.resname]=[]),tt[Ct.resname].push(Ve.index))}),Object.keys(tt).forEach(function(Ve){var Pt=tt[Ve],Be="non-polymer",$e=xe[Ve]||Ve;Vg.includes(Ve)&&($e="water",Be="water"),ce.entityList.push(new Jr(ce,qe,$e,Be,Pt)),qe+=1})}le.a!==void 0?ce.unitcell=new uc(le):ce.unitcell=void 0,(Oe.length||Te.length)&&iE(ce,be),ce.finalizeAtoms(),i||P0(ce),Hg(ce),ce.finalizeBonds(),Oe.length||Te.length||C0(ce),jg(ce),Pe&&de.timeEnd("PdbParser._parse "+this.name)},Object.defineProperties(t.prototype,n),t}(Rs);ft.add("pdb",Jh),ft.add("pdb1",Jh),ft.add("ent",Jh);var y8=/\s+/,GM=/'((?:(?!'\s).)*)'|"((?:(?!"\s).)*)"|(\S+)/g,yh=/"/g,vh=/^['"]+|['"]+$/g;function $M(e){return!e||e[0]!==e[e.length-1]||e[0]!=="'"&&e[0]!=='"'?e:e.substring(1,e.length-1)}function ji(e,t){Array.isArray(e[t])||Object.keys(e).forEach(function(n){e[n]=[e[n]]})}function sr(e){return e!=="?"}function $d(e,t){return sr(e)?e:t}function VM(e){switch(e.toLowerCase()){case"?":case"sing":return 1;case"doub":return 2;case"trip":return 3;case"quad":return 4}return 0}var Fy=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"cif"},t.prototype._parse=function(){de.time("CifParser._parse "+this.name);var i,r,o,s,a,c,l,u,h,f,p,m,y,v,d,g,b,x,_,S,w,C,A=this.structure,k=this.structureBuilder,L=this.firstModelOnly,D=this.asTrajectory,F=this.cAlphaOnly,I=A.frames,P={},N={},$={},B=!1,q=null,ee=!1,W=!1,Q=!1,Z=[],re=null,he=null,K=null,ce=null,se=[],ue=A.atomMap,H=A.atomStore;H.resize(this.streamer.data.length/100);var j,X=0,ie=0;if(this.streamer.eachChunkOfLines(function(pe){(function(le,ne,oe){for(var xe=le;xe<ne;++xe)if(o=oe[xe],((s=o.trim())||B||W)&&s[0]!=="#")if(s.substring(0,5)==="data_")P.data=s.substring(5).trim();else if(s[0]===";")B?(W?(re===Z.length&&(re=0),Z[re].push(q),re+=1):K===!1?P[he]=q:P[he][K]=q,B=!1,q=null):(B=!0,q=s.substring(1));else if(s==="loop_")W=!0,Q=!0,Z.length=0,se.length=0,re=0;else if(s[0]==="_"){var Ae,ge,Me;if(W&&!Q&&(W=!1),W)ge=(Ae=s.split("."))[0].substring(1),Me=Ae[1],Ae.length===1?(Me=!1,P[ge]||(P[ge]=[]),Z.push(P[ge])):(P[ge]||(P[ge]={}),P[ge][Me]?Pe&&de.warn(ge,Me,"already exists"):(P[ge][Me]=[],Z.push(P[ge][Me]),se.push(Me))),he=ge,K=Me,ce=!0;else{var be=s.match(GM),Oe=be[0],Te=be[1];ge=(Ae=Oe.split("."))[0].substring(1),Me=Ae[1],Ae.length===1?(Me=!1,P[ge]=Te):(P[ge]||(P[ge]={}),P[ge][Me]?Pe&&de.warn(ge,Me,"already exists"):P[ge][Me]=Te),Te||(ee=!0),he=ge,K=Me}}else if(B)q+=o;else if(W){if(!s)continue;if(he==="atom_site"){var Ce=s.split(y8);ce&&(a=se.indexOf("auth_asym_id"),c=se.indexOf("auth_seq_id"),l=se.indexOf("label_seq_id"),u=se.indexOf("label_atom_id"),h=se.indexOf("label_comp_id"),f=se.indexOf("label_asym_id"),p=se.indexOf("label_entity_id"),m=se.indexOf("label_alt_id"),x=se.indexOf("Cartn_x"),_=se.indexOf("Cartn_y"),S=se.indexOf("Cartn_z"),v=se.indexOf("id"),d=se.indexOf("type_symbol"),y=se.indexOf("group_PDB"),w=se.indexOf("B_iso_or_equiv"),g=se.indexOf("pdbx_PDB_model_num"),b=se.indexOf("pdbx_PDB_ins_code"),C=se.indexOf("occupancy"),ce=!1,j=parseInt(Ce[g]),D&&(i=[],r=0));var Ge=parseInt(Ce[g]);if(j!==Ge&&(D&&(ie===0&&I.push(new Float32Array(i)),i=new Float32Array(3*H.count),I.push(i),r=0),ie+=1),j=Ge,L&&ie>0)continue;var at=Ce[u].replace(yh,"");if(F&&at!=="CA")continue;var it=parseFloat(Ce[x]),et=parseFloat(Ce[_]),mt=parseFloat(Ce[S]);if(D){var vt=3*r;if(i[vt+0]=it,i[vt+1]=et,i[vt+2]=mt,r+=1,ie>0)continue}var lt=Ce[h],qe=parseInt(Ce[c!==-1?c:l]),Ct=Ce[b];Ct=Ct==="?"?"":Ct;var tt=Ce[a],Ve=Ce[f],Pt=Ce[y][0]==="H"?1:0,Be=Ce[d],$e=parseFloat(Ce[w]),Je=parseFloat(Ce[C]),Y=Ce[m];if(Y=Y==="."?"":Y,H.growIfFull(),H.atomTypeId[X]=ue.add(at,Be),H.x[X]=it,H.y[X]=et,H.z[X]=mt,H.serial[X]=parseInt(Ce[v]),H.bfactor[X]=isNaN($e)?0:$e,H.occupancy[X]=isNaN(Je)?0:Je,H.altloc[X]=Y.charCodeAt(0),k.addAtom(ie,tt,Ve,lt,qe,Pt,void 0,Ct),Pe){var Se=N[Ve];Se!==void 0&&Se!==tt&&Pe&&de.warn(Se,tt)}N[Ve]=tt;var ye=Ce[p];$[ye]||($[ye]=new Set),$[ye].add(A.chainStore.count-1),X+=1}else{var M=s.match(GM),E=M.length;re===Z.length&&(re=0);for(var R=0;R<E;++R)Z[re+R].push(M[R]);re+=E}Q=!1}else if(s[0]==="'"&&s[s.length-1]==="'"){var z=s.substring(1,s.length-1);K===!1?P[he]=z:P[he][K]=z}else ee?K===!1?P[he]=s:P[he][K]=s:Pe&&de.log("CifParser._parse: unknown state",s);else B=!1,W=!1,ee=!1,Z.length=0,re=null,he=null,K=null,ce=null,se.length=0})(0,pe.length,pe)}),P.chem_comp&&P.chem_comp_atom)(function(pe,le,ne){var oe,xe,Ae=le.atomStore,ge=le.atomMap,Me=pe.chem_comp,be=pe.chem_comp_atom,Oe=pe.chem_comp_bond;Me&&(Me.name&&(le.title=Me.name.trim().replace(vh,"")),Me.id&&(le.id=Me.id.trim().replace(vh,"")));var Te={};if(be){var Ce,Ge,at,it;for(ji(be,"comp_id"),xe=be.comp_id.length,oe=0;oe<xe;++oe)Ae.growIfFull(),Ce=be.atom_id[oe].replace(yh,""),Ge=be.type_symbol[oe],Te[Ce]=oe,Ae.atomTypeId[oe]=ge.add(Ce,Ge),Ae.x[oe]=be.model_Cartn_x[oe],Ae.y[oe]=be.model_Cartn_y[oe],Ae.z[oe]=be.model_Cartn_z[oe],Ae.serial[oe]=oe,at=be.pdbx_component_comp_id[oe],it=be.pdbx_residue_numbering?be.pdbx_residue_numbering[oe]:1,ne.addAtom(0,"","",at,it,!0);for(oe=0;oe<xe;++oe){var et=oe+xe;Ae.growIfFull(),Ce=be.atom_id[oe].replace(yh,""),Ge=be.type_symbol[oe],Ae.atomTypeId[et]=ge.add(Ce,Ge),Ae.x[et]=be.pdbx_model_Cartn_x_ideal[oe],Ae.y[et]=be.pdbx_model_Cartn_y_ideal[oe],Ae.z[et]=be.pdbx_model_Cartn_z_ideal[oe],Ae.serial[et]=et,at=be.pdbx_component_comp_id[oe],it=be.pdbx_residue_numbering?be.pdbx_residue_numbering[oe]:1,ne.addAtom(1,"","",at,it,!0)}}if(be&&Oe){var mt,vt,lt;ji(Oe,"comp_id"),xe=Oe.comp_id.length;var qe=be.comp_id.length,Ct=le.getAtomProxy(),tt=le.getAtomProxy();for(oe=0;oe<xe;++oe)mt=Oe.atom_id_1[oe].replace(yh,""),vt=Oe.atom_id_2[oe].replace(yh,""),lt=VM(Oe.value_order[oe]),Ct.index=Te[mt],tt.index=Te[vt],le.bondStore.growIfFull(),le.bondStore.addBond(Ct,tt,lt),Ct.index+=qe,tt.index+=qe,le.bondStore.growIfFull(),le.bondStore.addBond(Ct,tt,lt)}})(P,A,k),k.finalize(),A.finalizeAtoms(),A.finalizeBonds(),Ic(A);else if(P.atom_site_type_symbol&&P.atom_site_label&&P.atom_site_fract_x)(function(pe,le,ne){var oe=le.atomStore,xe=le.atomMap;pe.data&&(le.id=pe.data,le.name=pe.data),le.unitcell=new uc({a:parseFloat(pe.cell_length_a),b:parseFloat(pe.cell_length_b),c:parseFloat(pe.cell_length_c),alpha:parseFloat(pe.cell_angle_alpha),beta:parseFloat(pe.cell_angle_beta),gamma:parseFloat(pe.cell_angle_gamma),spacegroup:$M(pe["symmetry_space_group_name_H-M"])});for(var Ae=new T,ge=new T,Me=pe.atom_site_type_symbol.length,be=0;be<Me;++be){oe.growIfFull();var Oe=pe.atom_site_label[be],Te=pe.atom_site_type_symbol[be];oe.atomTypeId[be]=xe.add(Oe,Te),Ae.set(pe.atom_site_fract_x[be],pe.atom_site_fract_y[be],pe.atom_site_fract_z[be]),Ae.applyMatrix4(le.unitcell.fracToCart),ge.add(Ae),oe.x[be]=Ae.x,oe.y[be]=Ae.y,oe.z[be]=Ae.z,pe.atom_site_occupancy&&(oe.occupancy[be]=parseFloat(pe.atom_site_occupancy[be])),oe.serial[be]=be,ne.addAtom(0,"","","HET",1,!0)}ge.divideScalar(Me),le.center=ge,jg(le);var Ce=new T,Ge=new T,at=le.biomolDict.SUPERCELL.partList[0].matrixList,it=Me;function et(qe){return xe.get(oe.atomTypeId[qe]).covalent}for(var mt=new De,vt=function(qe){var Ct=et(qe);Ae.set(oe.x[qe],oe.y[qe],oe.z[qe]),at.forEach(function(tt){if(!mt.equals(tt)){Ce.copy(Ae),Ce.applyMatrix4(tt);for(var Ve=0;Ve<Me;++Ve){Ge.set(oe.x[Ve],oe.y[Ve],oe.z[Ve]);var Pt=Ce.distanceToSquared(Ge),Be=et(Ve)+Ct,$e=Be+.3,Je=Be-.5;if(Pt<$e*$e&&Pt>Je*Je)return oe.growIfFull(),oe.atomTypeId[it]=oe.atomTypeId[qe],oe.x[it]=Ce.x,oe.y[it]=Ce.y,oe.z[it]=Ce.z,oe.occupancy[it]=oe.occupancy[qe],oe.serial[it]=it,oe.altloc[it]="A".charCodeAt(0),ne.addAtom(0,"","","HET",1,!0),void(it+=1)}}})},lt=0;lt<Me;++lt)vt(lt)})(P,A,k),k.finalize(),A.finalizeAtoms(),Hg(A),A.finalizeBonds();else{var fe=function(pe,le,ne){var oe,xe,Ae,ge,Me=[],be=[],Oe=pe.struct_conf;if(Oe)for(ji(Oe,"id"),oe=0,xe=Oe.beg_auth_seq_id.length;oe<xe;++oe){var Te=parseInt(Oe.pdbx_PDB_helix_class[oe]);Number.isNaN(Te)||(Ae=Oe.pdbx_beg_PDB_ins_code[oe],ge=Oe.pdbx_end_PDB_ins_code[oe],Me.push([ne[Oe.beg_label_asym_id[oe]],parseInt(Oe.beg_auth_seq_id[oe]),$d(Ae,""),ne[Oe.end_label_asym_id[oe]],parseInt(Oe.end_auth_seq_id[oe]),$d(ge,""),(qg[Te]||qg[0]).charCodeAt(0)]))}var Ce=pe.struct_sheet_range;if(Ce)for(ji(Ce,"id"),oe=0,xe=Ce.beg_auth_seq_id.length;oe<xe;++oe)Ae=Ce.pdbx_beg_PDB_ins_code[oe],ge=Ce.pdbx_end_PDB_ins_code[oe],be.push([ne[Ce.beg_label_asym_id[oe]],parseInt(Ce.beg_auth_seq_id[oe]),$d(Ae,""),ne[Ce.end_label_asym_id[oe]],parseInt(Ce.end_auth_seq_id[oe]),$d(ge,"")]);return!(!Oe&&!Ce)&&{helices:Me,sheets:be}}(P,0,N);if(function(pe,le,ne){var oe={},xe=le.biomolDict;if(pe.pdbx_struct_oper_list){var Ae=pe.pdbx_struct_oper_list;ji(Ae,"id"),Ae.id.forEach(function(Pt,Be){var $e=new De,Je=$e.elements;Je[0]=parseFloat(Ae["matrix[1][1]"][Be]),Je[1]=parseFloat(Ae["matrix[1][2]"][Be]),Je[2]=parseFloat(Ae["matrix[1][3]"][Be]),Je[4]=parseFloat(Ae["matrix[2][1]"][Be]),Je[5]=parseFloat(Ae["matrix[2][2]"][Be]),Je[6]=parseFloat(Ae["matrix[2][3]"][Be]),Je[8]=parseFloat(Ae["matrix[3][1]"][Be]),Je[9]=parseFloat(Ae["matrix[3][2]"][Be]),Je[10]=parseFloat(Ae["matrix[3][3]"][Be]),Je[3]=parseFloat(Ae["vector[1]"][Be]),Je[7]=parseFloat(Ae["vector[2]"][Be]),Je[11]=parseFloat(Ae["vector[3]"][Be]),$e.transpose(),oe[Pt]=$e})}if(pe.pdbx_struct_assembly_gen){var ge=pe.pdbx_struct_assembly_gen;ji(ge,"assembly_id");var Me=function(Pt){var Be={};return Pt.replace(/[()']/g,"").split(",").forEach(function($e){if($e.includes("-"))for(var Je=$e.split("-"),Y=parseInt(Je[0]),Se=parseInt(Je[1]);Y<=Se;++Y)Be[Y]=oe[Y];else Be[$e]=oe[$e]}),Be};ge.assembly_id.forEach(function(Pt,Be){var $e={},Je=ge.oper_expression[Be].replace(/['"]\(|['"]/g,"");if(Je.includes(")(")||Je.indexOf("(")>0){Je=Je.split("(");var Y=Me(Je[0]),Se=Me(Je[1]);Object.keys(Y).forEach(function(J){Object.keys(Se).forEach(function(te){var ae=new De;ae.multiplyMatrices(Y[J],Se[te]),$e[J+"x"+te]=ae})})}else $e=Me(Je);var ye=[];for(var M in $e)ye.push($e[M]);var E=Pt;/^(0|[1-9][0-9]*)$/.test(E)&&(E="BU"+E);for(var R=ge.asym_id_list[Be].split(","),z=0,U=R.length;z<U;++z)R[z]=ne[R[z]];xe[E]===void 0&&(xe[E]=new fi(E)),xe[E].addPart(ye,R)})}if(pe.struct_ncs_oper){var be=pe.struct_ncs_oper;ji(be,"id");var Oe="NCS";xe.NCS=new fi(Oe);var Te=xe.NCS.addPart();be.id.forEach(function(Pt,Be){if(be.code[Be]!=="given"){var $e=new De,Je=$e.elements;Je[0]=parseFloat(be["matrix[1][1]"][Be]),Je[1]=parseFloat(be["matrix[1][2]"][Be]),Je[2]=parseFloat(be["matrix[1][3]"][Be]),Je[4]=parseFloat(be["matrix[2][1]"][Be]),Je[5]=parseFloat(be["matrix[2][2]"][Be]),Je[6]=parseFloat(be["matrix[2][3]"][Be]),Je[8]=parseFloat(be["matrix[3][1]"][Be]),Je[9]=parseFloat(be["matrix[3][2]"][Be]),Je[10]=parseFloat(be["matrix[3][3]"][Be]),Je[3]=parseFloat(be["vector[1]"][Be]),Je[7]=parseFloat(be["vector[2]"][Be]),Je[11]=parseFloat(be["vector[3]"][Be]),$e.transpose(),Te.matrixList.push($e)}}),Te.matrixList.length===0&&delete xe.NCS}var Ce={};if(pe.cell){var Ge=pe.cell,at=parseFloat(Ge.length_a),it=parseFloat(Ge.length_b),et=parseFloat(Ge.length_c),mt=new Float32Array(9);mt[0]=at,mt[4]=it,mt[8]=et,le.boxes.push(mt),Ce.a=at,Ce.b=it,Ce.c=et,Ce.alpha=parseFloat(Ge.angle_alpha),Ce.beta=parseFloat(Ge.angle_beta),Ce.gamma=parseFloat(Ge.angle_gamma)}pe.symmetry&&(Ce.spacegroup=$M(pe.symmetry["space_group_name_H-M"]));var vt=new De;if(pe.database_PDB_matrix){var lt=pe.database_PDB_matrix,qe=vt.elements;qe[0]=parseFloat(lt["origx[1][1]"]),qe[1]=parseFloat(lt["origx[1][2]"]),qe[2]=parseFloat(lt["origx[1][3]"]),qe[4]=parseFloat(lt["origx[2][1]"]),qe[5]=parseFloat(lt["origx[2][2]"]),qe[6]=parseFloat(lt["origx[2][3]"]),qe[8]=parseFloat(lt["origx[3][1]"]),qe[9]=parseFloat(lt["origx[3][2]"]),qe[10]=parseFloat(lt["origx[3][3]"]),qe[3]=parseFloat(lt["origx_vector[1]"]),qe[7]=parseFloat(lt["origx_vector[2]"]),qe[11]=parseFloat(lt["origx_vector[3]"]),vt.transpose(),Ce.origx=vt}var Ct=new De;if(pe.atom_sites){var tt=pe.atom_sites,Ve=Ct.elements;Ve[0]=parseFloat(tt["fract_transf_matrix[1][1]"]),Ve[1]=parseFloat(tt["fract_transf_matrix[1][2]"]),Ve[2]=parseFloat(tt["fract_transf_matrix[1][3]"]),Ve[4]=parseFloat(tt["fract_transf_matrix[2][1]"]),Ve[5]=parseFloat(tt["fract_transf_matrix[2][2]"]),Ve[6]=parseFloat(tt["fract_transf_matrix[2][3]"]),Ve[8]=parseFloat(tt["fract_transf_matrix[3][1]"]),Ve[9]=parseFloat(tt["fract_transf_matrix[3][2]"]),Ve[10]=parseFloat(tt["fract_transf_matrix[3][3]"]),Ve[3]=parseFloat(tt["fract_transf_vector[1]"]),Ve[7]=parseFloat(tt["fract_transf_vector[2]"]),Ve[11]=parseFloat(tt["fract_transf_vector[3]"]),Ct.transpose(),Ce.scale=Ct}Ce.a!==void 0?le.unitcell=new uc(Ce):le.unitcell=void 0}(P,A,N),function(pe,le,ne){var oe=pe.struct_conn;if(oe){ji(oe,"id");for(var xe=/"/g,Ae=le.getAtomProxy(),ge=le.getAtomProxy(),Me={},be=0,Oe=oe.id.length;be<Oe;++be){var Te=oe.conn_type_id[be];if(Te!=="hydrog"&&Te!=="mismat"&&Te!=="saltbr"&&oe.ptnr1_symmetry[be]==="1_555"&&oe.ptnr2_symmetry[be]==="1_555"){var Ce=oe.pdbx_ptnr1_PDB_ins_code[be],Ge=oe.pdbx_ptnr1_label_alt_id[be],at=oe.ptnr1_auth_seq_id[be]+(sr(Ce)?"^"+Ce:"")+":"+ne[oe.ptnr1_label_asym_id[be]]+"."+oe.ptnr1_label_atom_id[be].replace(xe,"")+(sr(Ge)?"%"+Ge:""),it=Me[at];if(!it){var et=new Jt(at);if(et.selection.error){Pe&&de.warn("invalid selection for connection",at);continue}it=le.getAtomIndices(et),Me[at]=it}var mt=oe.pdbx_ptnr2_PDB_ins_code[be],vt=oe.pdbx_ptnr2_label_alt_id[be],lt=oe.ptnr2_auth_seq_id[be]+(sr(mt)?"^"+mt:"")+":"+ne[oe.ptnr2_label_asym_id[be]]+"."+oe.ptnr2_label_atom_id[be].replace(xe,"")+(sr(vt)?"%"+vt:""),qe=Me[lt];if(!qe){var Ct=new Jt(lt);if(Ct.selection.error){Pe&&de.warn("invalid selection for connection",lt);continue}qe=le.getAtomIndices(Ct),Me[lt]=qe}var tt=it.length,Ve=qe.length;if(tt>Ve){var Pt=tt;tt=Ve,Ve=Pt;var Be=it;it=qe,qe=Be}if(tt!==0&&Ve!==0)for(var $e=0;$e<Ve;++$e)Ae.index=it[$e%tt],ge.index=qe[$e],Ae&&ge?le.bondStore.addBond(Ae,ge,VM(oe.pdbx_value_order[be])):de.log("atoms for connection not found");else Pe&&de.warn("no atoms found for",at,lt)}}}}(P,A,N),function(pe,le,ne){if(pe.entity){ji(pe.entity,"id");for(var oe=pe.entity,xe=oe.id.length,Ae=0;Ae<xe;++Ae){var ge=oe.pdbx_description[Ae],Me=oe.type[Ae],be=Array.from(ne[oe.id[Ae]]);le.entityList[Ae]=new Jr(le,Ae,ge,Me,be)}}}(P,A,$),P.struct&&P.struct.title&&(A.title=P.struct.title.trim().replace(vh,"")),P.entry&&P.entry.id&&(A.id=P.entry.id.trim().replace(vh,"")),P.pdbx_audit_revision_history){if(P.pdbx_audit_revision_history.revision_date){ji(P.pdbx_audit_revision_history,"revision_date");var me=P.pdbx_audit_revision_history.revision_date.filter(sr);me.length&&(A.header.releaseDate=me[0])}if(P.pdbx_database_status.recvd_initial_deposition_date){ji(P.pdbx_database_status,"recvd_initial_deposition_date");var ve=P.pdbx_database_status.recvd_initial_deposition_date.filter(sr);ve.length&&(A.header.depositionDate=ve[0])}}else if(P.database_PDB_rev){if(P.database_PDB_rev.date){ji(P.database_PDB_rev,"date");var G=P.database_PDB_rev.date.filter(sr);G.length&&(A.header.releaseDate=G[0])}if(P.database_PDB_rev.date_original){ji(P.database_PDB_rev,"date_original");var V=P.database_PDB_rev.date_original.filter(sr);V.length&&(A.header.depositionDate=V[0])}}P.reflns&&P.reflns.d_resolution_high?sr(P.reflns.d_resolution_high)&&(A.header.resolution=parseFloat(P.reflns.d_resolution_high)):P.refine&&P.refine.ls_d_res_high&&sr(P.refine.ls_d_res_high)&&(A.header.resolution=parseFloat(P.refine.ls_d_res_high)),P.refine&&P.refine.ls_R_factor_R_free&&sr(P.refine.ls_R_factor_R_free)&&(A.header.rFree=parseFloat(P.refine.ls_R_factor_R_free)),P.refine&&P.refine.ls_R_factor_R_work&&sr(P.refine.ls_R_factor_R_work)&&(A.header.rWork=parseFloat(P.refine.ls_R_factor_R_work)),P.exptl&&P.exptl.method&&(ji(P.exptl,"method"),A.header.experimentalMethods=P.exptl.method.map(function(pe){return pe.replace(vh,"")})),k.finalize(),A.finalizeAtoms(),Hg(A),A.finalizeBonds(),fe?iE(A,fe):C0(A),jg(A),A.extraData.cif=P}Pe&&de.timeEnd("CifParser._parse "+this.name)},Object.defineProperties(t.prototype,n),t}(Rs);ft.add("cif",Fy),ft.add("mcif",Fy),ft.add("mmcif",Fy);var v8=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"gro"},t.prototype._parse=function(){Pe&&de.time("GroParser._parse "+this.name);var i,r,o=this.structure,s=this.structureBuilder,a=this.firstModelOnly,c=this.asTrajectory,l=this.cAlphaOnly,u=o.frames,h=o.boxes,f=this.streamer.peekLines(3);o.title=f[0].trim();var p,m,y,v,d=5+(f[2].length-f[2].lastIndexOf(".")-1),g=20+d,b=20+2*d,x=parseInt(f[1]),_=x+3,S=o.atomMap,w=o.atomStore;w.resize(x);var C=0,A=0,k=0;this.streamer.eachChunkOfLines(function(L){(function(D,F,I){for(var P=D;P<F;++P){var N=++k-1,$=I[P];if($){if(N%_==0)c&&(i=new Float32Array(3*x),u.push(i),r=0);else if(N%_!=1)if(N%_==_-1){var B=$.trim().split(/\s+/),q=new Float32Array(9);if(q[0]=10*parseFloat(B[0]),q[4]=10*parseFloat(B[1]),q[8]=10*parseFloat(B[2]),h.push(q),a)return!0;A+=1}else{if(p=$.substr(10,5).trim(),l&&p!=="CA")continue;var ee=10*parseFloat($.substr(20,d)),W=10*parseFloat($.substr(g,d)),Q=10*parseFloat($.substr(b,d));if(c){var Z=3*r;if(i[Z+0]=ee,i[Z+1]=W,i[Z+2]=Q,r+=1,N>_)continue}m=$.substr(5,5).trim(),y=parseInt($.substr(0,5)),v=parseInt($.substr(15,5)),w.growIfFull(),w.atomTypeId[C]=S.add(p),w.x[C]=ee,w.y[C]=W,w.z[C]=Q,w.serial[C]=v,s.addAtom(A,"","",m,y,0,"l"),C+=1}}}})(0,L.length,L)}),s.finalize(),o.finalizeAtoms(),P0(o),Hg(o),o.finalizeBonds(),C0(o),Pe&&de.timeEnd("GroParser._parse "+this.name)},Object.defineProperties(t.prototype,n),t}(Rs);ft.add("gro",v8);var x8=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"].concat(["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"]);function Mp(e,t,n){return t?new e(t.buffer,t.byteOffset,t.byteLength/(n||1)):void 0}function cb(e){return Mp(DataView,e)}function Ny(e){return Mp(Int8Array,e)}function Xg(e){return Mp(Int32Array,e,4)}function xh(e,t){var n=e.length/2;t||(t=new Int16Array(n));for(var i=0,r=0;i<n;++i,r+=2)t[i]=e[r]<<8^e[r+1]<<0;return t}function _o(e,t){var n=e.length/4;t||(t=new Int32Array(n));for(var i=0,r=0;i<n;++i,r+=4)t[i]=e[r]<<24^e[r+1]<<16^e[r+2]<<8^e[r+3]<<0;return t}function Yg(e,t,n){var i=e.length,r=1/t;n||(n=new Float32Array(i));for(var o=0;o<i;++o)n[o]=e[o]*r;return n}function Vd(e,t){var n,i;if(!t){var r=0;for(n=0,i=e.length;n<i;n+=2)r+=e[n+1];t=new e.constructor(r)}var o=0;for(n=0,i=e.length;n<i;n+=2)for(var s=e[n],a=e[n+1],c=0;c<a;++c)t[o]=s,++o;return t}function vE(e,t){var n=e.length;t||(t=new e.constructor(n)),n&&(t[0]=e[0]);for(var i=1;i<n;++i)t[i]=e[i]+t[i-1];return t}function Zg(e,t){var n,i,r=e instanceof Int8Array?127:32767,o=-r-1,s=e.length;if(!t){var a=0;for(n=0;n<s;++n)e[n]<r&&e[n]>o&&++a;t=new Int32Array(a)}for(n=0,i=0;n<s;){for(var c=0;e[n]===r||e[n]===o;)c+=e[n],++n;c+=e[n],++n,t[i]=c,++i}return t}function HM(e,t,n){return Yg(Zg(e,Xg(n)),t,n)}function b8(e,t,n){var i=Zg(e,Xg(n));return function(r,o,s){return Yg(vE(r,Xg(s)),o,s)}(i,t,Mp(Float32Array,i,4))}function xE(e){var t=0,n=new DataView(e.buffer);function i(c){for(var l={},u=0;u<c;u++)l[a()]=a();return l}function r(c){var l=e.subarray(t,t+c);return t+=c,l}function o(c){var l=e.subarray(t,t+c);t+=c;var u=65535;if(c>u){for(var h=[],f=0;f<l.length;f+=u)h.push(String.fromCharCode.apply(null,l.subarray(f,f+u)));return h.join("")}return String.fromCharCode.apply(null,l)}function s(c){for(var l=new Array(c),u=0;u<c;u++)l[u]=a();return l}function a(){var c,l,u=e[t];if(!(128&u))return t++,u;if((240&u)==128)return t++,i(l=15&u);if((240&u)==144)return t++,s(l=15&u);if((224&u)==160)return t++,o(l=31&u);if((224&u)==224)return c=n.getInt8(t),t++,c;switch(u){case 192:return t++,null;case 194:return t++,!1;case 195:return t++,!0;case 196:return l=n.getUint8(t+1),t+=2,r(l);case 197:return l=n.getUint16(t+1),t+=3,r(l);case 198:return l=n.getUint32(t+1),t+=5,r(l);case 202:return c=n.getFloat32(t+1),t+=5,c;case 203:return c=n.getFloat64(t+1),t+=9,c;case 204:return c=e[t+1],t+=2,c;case 205:return c=n.getUint16(t+1),t+=3,c;case 206:return c=n.getUint32(t+1),t+=5,c;case 208:return c=n.getInt8(t+1),t+=2,c;case 209:return c=n.getInt16(t+1),t+=3,c;case 210:return c=n.getInt32(t+1),t+=5,c;case 217:return l=n.getUint8(t+1),t+=2,o(l);case 218:return l=n.getUint16(t+1),t+=3,o(l);case 219:return l=n.getUint32(t+1),t+=5,o(l);case 220:return l=n.getUint16(t+1),t+=3,s(l);case 221:return l=n.getUint32(t+1),t+=5,s(l);case 222:return l=n.getUint16(t+1),t+=3,i(l);case 223:return l=n.getUint32(t+1),t+=5,i(l)}throw new Error("Unknown type 0x"+u.toString(16))}return a()}function _8(e,t,n,i){switch(e){case 1:return function(o,s){var a=o.length;s||(s=new Float32Array(a/4));for(var c=cb(s),l=cb(o),u=0,h=0,f=a/4;u<f;++u,h+=4)c.setFloat32(h,l.getFloat32(h),!0);return s}(t);case 2:return Ny(t);case 3:return xh(t);case 4:return _o(t);case 5:return Mp(Uint8Array,t);case 6:return Vd(_o(t),new Uint8Array(n));case 7:return Vd(_o(t));case 8:return vE(Vd(_o(t)),r);case 9:return function(o,s,a){return Yg(Vd(o,Xg(a)),s,a)}(_o(t),_o(i)[0]);case 10:return b8(xh(t),_o(i)[0]);case 11:return Yg(xh(t),_o(i)[0]);case 12:return HM(xh(t),_o(i)[0]);case 13:return HM(Ny(t),_o(i)[0]);case 14:return Zg(xh(t));case 15:return Zg(Ny(t))}var r}function w8(e,t){var n=(t=t||{}).ignoreFields,i={};return x8.forEach(function(r){var o,s,a,c,l,u=!!n&&n.indexOf(r)!==-1,h=e[r];u||h===void 0||(h instanceof Uint8Array?i[r]=_8.apply(null,(s=cb(o=h),a=s.getInt32(0),c=s.getInt32(4),l=o.subarray(8,12),[a,o=o.subarray(12),c,l])):i[r]=h)}),i}var S8={0:"i".charCodeAt(0),1:"s".charCodeAt(0),2:"h".charCodeAt(0),3:"e".charCodeAt(0),4:"g".charCodeAt(0),5:"b".charCodeAt(0),6:"t".charCodeAt(0),7:"l".charCodeAt(0),"-1":"".charCodeAt(0)},M8=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},isBinary:{configurable:!0}};return n.type.get=function(){return"mmtf"},n.isBinary.get=function(){return!0},t.prototype._parse=function(){var i,r,o,s,a;Pe&&de.time("MmtfParser._parse "+this.name);var c,l,u,h,f,p,m=this.structure,y=w8(xE(this.streamer.data));if(["depositionDate","releaseDate","resolution","rFree","rWork","experimentalMethods"].forEach(function(Ce){y[Ce]!==void 0&&(m.header[Ce]=y[Ce])}),m.id=y.structureId,m.title=y.title,m.atomStore.addField("formalCharge",1,"int8"),this.firstModelOnly||this.asTrajectory){for(f=1,u=0,i=0,r=h=y.chainsPerModel[0];i<r;++i)u+=y.groupsPerChain[i];for(l=0,i=0,r=u;i<r;++i)l+=(a=y.groupList[y.groupTypeList[i]]).atomNameList.length;c=y.numBonds,p=[h]}else c=y.numBonds,l=y.numAtoms,u=y.numGroups,h=y.numChains,f=y.numModels,p=y.chainsPerModel;if(c+=u,this.asTrajectory)for(i=0,r=y.numModels;i<r;++i){var v=new Float32Array(3*l),d=l*i;for(o=0;o<l;++o){var g=3*o,b=o+d;v[g]=y.xCoordList[b],v[g+1]=y.yCoordList[b],v[g+2]=y.zCoordList[b]}m.frames.push(v)}var x=new Uint32Array(c),_=new Uint32Array(c),S=new Uint8Array(c),w=new Uint32Array(l),C=new Int8Array(l),A=new Uint32Array(u),k=new Uint32Array(u),L=new Uint16Array(u),D=new Uint16Array(h),F=new Uint32Array(h),I=new Uint32Array(h),P=new Uint32Array(f),N=new Uint32Array(f),$=0;for(i=0,r=f;i<r;++i){var B=p[i];for(P[i]=$,N[i]=B,o=0;o<B;++o)D[o+$]=i;$+=B}var q=y.groupsPerChain,ee=0;for(i=0,r=h;i<r;++i){var W=q[i];for(F[i]=ee,I[i]=W,o=0;o<W;++o)A[o+ee]=i;ee+=W}var Q=0,Z=0;for(i=0,r=u;i<r;++i){var re=(a=y.groupList[y.groupTypeList[i]]).atomNameList.length,he=a.formalChargeList,K=a.bondAtomList,ce=a.bondOrderList;for(o=0,s=ce.length;o<s;++o)x[Z]=Q+K[2*o],_[Z]=Q+K[2*o+1],S[Z]=ce[o],Z+=1;for(k[i]=Q,L[i]=re,o=0;o<re;++o)w[Q]=i,C[Q]=he[o],Q+=1}var se=y.bondAtomList;if(se)for(y.bondOrderList&&S.set(y.bondOrderList,Z),i=0,r=se.length;i<r;i+=2){var ue=se[i],H=se[i+1];ue<l&&H<l&&(x[Z]=ue,_[Z]=H,Z+=1)}m.bondStore.length=S.length,m.bondStore.count=Z,m.bondStore.atomIndex1=x,m.bondStore.atomIndex2=_,m.bondStore.bondOrder=S,m.atomStore.length=l,m.atomStore.count=l,m.atomStore.residueIndex=w,m.atomStore.atomTypeId=new Uint16Array(l),m.atomStore.x=y.xCoordList.subarray(0,l),m.atomStore.y=y.yCoordList.subarray(0,l),m.atomStore.z=y.zCoordList.subarray(0,l),m.atomStore.serial=y.atomIdList.subarray(0,l),m.atomStore.bfactor=y.bFactorList.subarray(0,l),m.atomStore.altloc=y.altLocList.subarray(0,l),m.atomStore.occupancy=y.occupancyList.subarray(0,l),m.atomStore.formalCharge=C,m.residueStore.length=u,m.residueStore.count=u,m.residueStore.chainIndex=A,m.residueStore.residueTypeId=y.groupTypeList,m.residueStore.atomOffset=k,m.residueStore.atomCount=L,m.residueStore.resno=y.groupIdList.subarray(0,u),m.residueStore.sstruc=y.secStructList.subarray(0,u),m.residueStore.inscode=y.insCodeList.subarray(0,u),m.chainStore.length=h,m.chainStore.count=h,m.chainStore.entityIndex=new Uint16Array(h),m.chainStore.modelIndex=D,m.chainStore.residueOffset=F,m.chainStore.residueCount=I,m.chainStore.chainname=y.chainNameList.subarray(0,4*h),m.chainStore.chainid=y.chainIdList.subarray(0,4*h),m.modelStore.length=f,m.modelStore.count=f,m.modelStore.chainOffset=P,m.modelStore.chainCount=N;var j={};for(i=0,r=y.groupList.length;i<r;++i){var X=y.groupList[i],ie=[];for(o=0,s=X.atomNameList.length;o<s;++o){var fe=X.elementList[o].toUpperCase(),me=X.atomNameList[o];ie.push(m.atomMap.add(me,fe))}var ve=X.chemCompType.toUpperCase(),G=iN.includes(ve),V=X.bondOrderList.length,pe=new Array(V),le=new Array(V);for(o=0;o<V;++o)pe[o]=X.bondAtomList[2*o],le[o]=X.bondAtomList[2*o+1];var ne={atomIndices1:pe,atomIndices2:le,bondOrders:X.bondOrderList};j[i]=m.residueMap.add(X.groupName,ie,G,ve,ne)}for(i=0,r=u;i<r;++i)m.residueStore.residueTypeId[i]=j[m.residueStore.residueTypeId[i]];for(i=0,r=m.atomStore.count;i<r;++i){var oe=m.atomStore.residueIndex[i],xe=m.residueMap.list[m.residueStore.residueTypeId[oe]],Ae=m.residueStore.atomOffset[oe];m.atomStore.atomTypeId[i]=xe.atomTypeIdList[i-Ae]}if(y.secStructList){var ge=y.secStructList.length;for(i=0,r=m.residueStore.count;i<r;++i){var Me=S8[m.residueStore.sstruc[i%ge]];Me!==void 0&&(m.residueStore.sstruc[i]=Me)}}if(y.entityList&&y.entityList.forEach(function(Ce,Ge){m.entityList[Ge]=new Jr(m,Ge,Ce.description,Ce.type,Ce.chainIndexList)}),y.bioAssemblyList&&y.bioAssemblyList.forEach(function(Ce,Ge){var at=Ge+1,it=new fi(""+at);m.biomolDict["BU"+at]=it;var et={};Ce.transformList.forEach(function(mt){var vt=new De().fromArray(mt.matrix).transpose(),lt=mt.chainIndexList.map(function(Ct){for(var tt="",Ve=0;Ve<4;++Ve){var Pt=y.chainNameList[4*Ct+Ve];if(!Pt)break;tt+=String.fromCharCode(Pt)}return tt}),qe=et[lt.toString()];qe?qe.matrixList.push(vt):et[lt.toString()]=it.addPart([vt],lt)})}),y.ncsOperatorList){var be=new fi("NCS"),Oe=be.addPart();y.ncsOperatorList.forEach(function(Ce){var Ge=new De().fromArray(Ce).transpose();Oe.matrixList.push(Ge)}),Oe.matrixList.length>0&&(m.biomolDict.NCS=be)}var Te=y.unitCell;Te&&Array.isArray(Te)&&Te[0]?m.unitcell=new uc({a:Te[0],b:Te[1],c:Te[2],alpha:Te[3],beta:Te[4],gamma:Te[5],spacegroup:y.spaceGroup}):m.unitcell=void 0,Fu(m,!0),Bu(m,!0),m.finalizeAtoms(),m.finalizeBonds(),jg(m),Pe&&de.timeEnd("MmtfParser._parse "+this.name)},Object.defineProperties(t.prototype,n),t}(Rs);ft.add("mmtf",M8);var zy=/\s+/,A8={1:1,2:2,3:3,am:1,ar:1,du:1,un:1,nc:0},C8=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"mol2"},t.prototype._parse=function(){Pe&&de.time("Mol2Parser._parse "+this.name);var i,r,o=this.structure,s=this.structureBuilder,a=this.firstModelOnly,c=this.asTrajectory,l=o.frames,u=!1,h=o.atomMap,f=o.atomStore;f.resize(Math.round(this.streamer.data.length/60)),f.addField("partialCharge",1,"float32");var p=0,m=0,y=0,v=-1,d=0,g=0,b=o.getAtomProxy(),x=o.getAtomProxy();this.streamer.eachChunkOfLines(function(_){(function(S,w,C){for(var A=S;A<w;++A){var k=C[A].trim();if(k!==""&&k[0]!=="#"){if(k[0]==="@")k==="@<TRIPOS>MOLECULE"?(g=1,m=0,++v):k==="@<TRIPOS>ATOM"?(g=2,y=f.count,c&&(r=0,i=new Float32Array(3*d),l.push(i),v>0&&(u=!0))):g=k==="@<TRIPOS>BOND"?3:0;else if(g===1){if(m===0)o.title=k,o.id=k;else if(m===1){var L=k.split(zy);d=parseInt(L[0])}++m}else if(g===2){var D=k.split(zy);if(a&&v>0)continue;var F=parseFloat(D[2]),I=parseFloat(D[3]),P=parseFloat(D[4]);if(c){var N=3*r;if(i[N+0]=F,i[N+1]=I,i[N+2]=P,r+=1,u)continue}var $=D[0],B=D[1],q=D[5].split(".")[0],ee=D[6]?parseInt(D[6]):1,W=D[7]?D[7]:"",Q=D[8]?parseFloat(D[8]):0;f.growIfFull(),f.atomTypeId[p]=h.add(B,q),f.x[p]=F,f.y[p]=I,f.z[p]=P,f.serial[p]=$,f.partialCharge[p]=Q,s.addAtom(v,"","",W,ee,1),p+=1}else if(g===3){if(a&&v>0||c&&v>0)continue;var Z=k.split(zy);b.index=parseInt(Z[1])-1+y,x.index=parseInt(Z[2])-1+y;var re=A8[Z[3]];o.bondStore.addBond(b,x,re)}}}})(0,_.length,_)}),s.finalize(),o.finalizeAtoms(),P0(o),Bu(o,!0),Fu(o,!0),o.finalizeBonds(),Ic(o),C0(o),Pe&&de.timeEnd("Mol2Parser._parse "+this.name)},Object.defineProperties(t.prototype,n),t}(Rs);ft.add("mol2",C8);var P8=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"pdbqt"},Object.defineProperties(t.prototype,n),t}(Jh);ft.add("pdbqt",P8);var T8=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"pqr"},Object.defineProperties(t.prototype,n),t}(Jh);ft.add("pqr",T8);var E8=/> +<(.+)>/,Uy=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"sdf"},t.prototype._parse=function(){Pe&&de.time("SdfParser._parse "+this.name);var i=this.structure,r=this.structureBuilder,o=this.firstModelOnly,s=this.asTrajectory,a=this.streamer.peekLines(2);i.id=a[0].trim(),i.title=a[1].trim();var c,l,u=i.frames,h=!1,f=i.atomMap,p=i.atomStore;p.resize(Math.round(this.streamer.data.length/50)),p.addField("formalCharge",1,"int8");var m,y,v,d,g,b,x,_,S,w,C,A,k,L,D=i.getAtomProxy(),F=i.getAtomProxy(),I=0,P=0,N=0,$=0,B=[],q=!1,ee={};i.extraData.sdf=B;var W=!1,Q=!1,Z=!1,re=[],he=[],K=new Map;this.streamer.eachChunkOfLines(function(ce){(function(se,ue,H){for(var j=se;j<ue;++j){var X=H[j];if(W&&X&&(re=X.substring(7).split(" "),he.length&&(re=he.concat(re),he=[]),re[re.length-1]==="-"))re.pop(),he=re;else{if(X.substr(0,4)==="$$$$")P=-1,++N,$=p.count,B.push(ee),ee={},q=!1,W=!1;else if(P===3)(W=X.indexOf(" V3000")>-1)?K.clear():(y=parseInt(X.substr(0,3)),v=parseInt(X.substr(3,3)),x=(b=g=(d=4)+y)+v,s&&(l=0,c=new Float32Array(3*y),u.push(c),N>0&&(h=!0)));else if(W&&re[0]==="COUNTS")y=parseInt(re[1]),s&&(l=0,c=new Float32Array(3*y),u.push(c),N>0&&(h=!0));else if(W&&re.length==2)re[1]==="ATOM"?re[0]==="BEGIN"?Q=!0:re[0]==="END"&&(Q=!1):re[1]==="BOND"&&(re[0]==="BEGIN"?Z=!0:re[0]==="END"&&(Z=!1));else if(Q||!W&&P>=d&&P<g){if(o&&N>0)continue;var ie=0;if(W){if(_=parseFloat(re[2]),S=parseFloat(re[3]),w=parseFloat(re[4]),A=re[1],k=parseInt(re[0]),K.set(k,I),C=A+k,re.length>6){var fe=re.slice(6).find(function(ne){return ne.indexOf("CHG=")===0});fe&&(ie=parseInt(fe.substring(4)))}}else _=parseFloat(X.substr(0,10)),S=parseFloat(X.substr(10,10)),w=parseFloat(X.substr(20,10)),A=X.substr(31,3).trim(),C=A+(I-$+1);if(s){var me=3*l;if(c[me+0]=_,c[me+1]=S,c[me+2]=w,l+=1,h)continue}p.growIfFull(),p.atomTypeId[I]=f.add(C,A),p.x[I]=_,p.y[I]=S,p.z[I]=w,p.serial[I]=W?k:I,p.formalCharge[I]=ie,r.addAtom(N,"","","HET",1,1),I+=1}else if(Z||!W&&P>=b&&P<x){if(o&&N>0||s&&N>0)continue;W?(D.index=K.get(parseInt(re[2])),F.index=K.get(parseInt(re[3])),L=parseInt(re[1])):(D.index=parseInt(X.substr(0,3))-1+$,F.index=parseInt(X.substr(3,3))-1+$,L=parseInt(X.substr(6,3))),i.bondStore.addBond(D,F,L)}else if(X.substr(0,6)==="M  CHG")for(var ve=parseInt(X.substr(6,3)),G=0,V=10;G<ve;++G,V+=8){var pe=parseInt(X.substr(V,3))-1+$,le=parseInt(X.substr(V+4,3));p.formalCharge[pe]=le}else X.charAt(0)===">"&&(m=X.match(E8))?(q=m[1],ee[q]=[]):q!==!1&&X&&ee[q].push(X);++P}}})(0,ce.length,ce)}),r.finalize(),i.finalizeAtoms(),i.finalizeBonds(),Ic(i),Pe&&de.timeEnd("SdfParser._parse "+this.name)},t.prototype._postProcess=function(){Ic(this.structure)},Object.defineProperties(t.prototype,n),t}(Rs);ft.add("sdf",Uy),ft.add("sd",Uy),ft.add("mol",Uy);function bh(e,t,n){return parseInt(e.substr(t,n).trim())}var jM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"prmtop"},t.prototype._parse=function(){Pe&&de.time("PrmtopParser._parse "+this.name);var i=this.structure,r=this.structureBuilder,o=i.atomMap,s=i.atomStore;s.addField("partialCharge",1,"float32"),s.addField("radius",1,"float32");var a,c,l,u,h,f=[],p={},m=["NATOM","NTYPES","NBONH","MBONA","NTHETH","MTHETA","NPHIH","MPHIA","NHPARM","NPARM","NNB","NRES","NBONA","NTHETA","NPHIA","NUMBND","NUMANG","NPTRA","NATYP","NPHB","IFPERT","NBPER","NGPER","NDPER","MBPER","MGPER","MDPER","IFBOX","NMXRS","IFCAP","NUMEXTRA","NCOPY"];m.forEach(function(k){p[k]=0});var y,v,d,g,b,x=new Uint8Array(0);this.streamer.eachChunkOfLines(function(k){(function(L,D,F){for(var I=L;I<D;++I){var P=F[I],N=P.trim();if(N&&!P.startsWith("%FORMAT")){if(P.startsWith("%FLAG")){var $=P.substr(5).trim();g=0,$==="TITLE"?d=0:$==="POINTERS"?d=1:$==="ATOM_NAME"?d=2:$==="CHARGE"?d=3:$==="MASS"?d=4:$==="RESIDUE_LABEL"?d=5:$==="RESIDUE_POINTER"?d=6:$==="BONDS_INC_HYDROGEN"?(b=0,d=7):$==="BONDS_WITHOUT_HYDROGEN"?(b=p.NBONH,d=8):d=$==="RADII"?9:void 0}else if(d===0)f.push(N);else if(d===1){for(var B=Math.min(g+10,32),q=0;g<B;++q,++g)p[m[g]]=parseInt(P.substr(8*q,8).trim());a=new Array(p.NATOM),c=new Float32Array(p.NATOM),l=new Float32Array(p.NATOM),s.resize(p.NATOM);var ee=p.NBONH+p.MBONA;u=new Uint32Array(ee),h=new Uint32Array(ee),x=new Uint8Array(ee),y=new Array(p.NRES),v=new Uint32Array(p.NRES)}else if(d===2)for(var W=Math.min(g+20,p.NATOM),Q=0;g<W;++Q,++g)a[g]=P.substr(4*Q,4).trim();else if(d===3)for(var Z=Math.min(g+5,p.NATOM),re=0;g<Z;++re,++g)c[g]=parseFloat(P.substr(16*re,16))/18.2223;else if(d!==4){if(d===5)for(var he=Math.min(g+20,p.NRES),K=0;g<he;++K,++g)y[g]=P.substr(4*K,4).trim();else if(d===6)for(var ce=Math.min(g+10,p.NRES),se=0;g<ce;++se,++g)v[g]=bh(P,8*se,8);else if(d===7)for(var ue=Math.min(g+10,3*p.NBONH),H=0;g<ue;++H,++g){var j=g%3;j===0&&(u[b]=bh(P,8*H,8)/3),j===1&&(h[b]=bh(P,8*H,8)/3,x[b]=1,++b)}else if(d===8)for(var X=Math.min(g+10,3*p.MBONA),ie=0;g<X;++ie,++g){var fe=g%3;fe===0&&(u[b]=bh(P,8*ie,8)/3),fe===1&&(h[b]=bh(P,8*ie,8)/3,x[b]=1,++b)}else if(d===9)for(var me=Math.min(g+5,p.NATOM),ve=0;g<me;++ve,++g)l[g]=parseFloat(P.substr(16*ve,16))}}}})(0,k.length,k)}),i.title=f.join(" ");for(var _=p.NATOM,S=0,w=y[0],C=1,A=0;A<_;++A)A+1===v[S+1]&&(++S,w=y[S],C=S+1),s.atomTypeId[A]=o.add(a[A]),s.serial[A]=A+1,r.addAtom(0,"","",w,C);s.partialCharge.set(c),s.radius.set(l),i.bondStore.length=x.length,i.bondStore.count=x.length,i.bondStore.atomIndex1=u,i.bondStore.atomIndex2=h,i.bondStore.bondOrder=x,r.finalize(),i.finalizeAtoms(),i.finalizeBonds(),Bu(i,!0),Fu(i,!0,!0),P0(i,!0),Ic(i),Pe&&de.timeEnd("PrmtopParser._parse "+this.name)},Object.defineProperties(t.prototype,n),t}(Rs);ft.add("prmtop",jM),ft.add("parm7",jM);var Hd=/\s+/,I8=/(^\*|REMARK)*/,L8=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"psf"},t.prototype._parse=function(){Pe&&de.time("PsfParser._parse "+this.name);var i=this.structure,r=this.structureBuilder,o=i.atomMap,s=i.atomStore;s.addField("partialCharge",1,"float32");var a,c,l,u,h,f,p=[],m=0,y=0,v=0;this.streamer.eachChunkOfLines(function(d){(function(g,b,x){for(var _=g;_<b;++_){var S=x[_].trim();if(S){if(a===2){var w=S.split(Hd),C=parseInt(w[0]),A=w[1],k=parseInt(w[2]),L=w[3],D=w[4],F=parseFloat(w[6]);A!==l&&(c=cp(y),++y),s.growIfFull(),s.atomTypeId[m]=o.add(D),s.serial[m]=C,s.partialCharge[m]=F,r.addAtom(0,c,c,L,k),m+=1,l=A}else if(a===3)for(var I=S.split(Hd),P=0,N=I.length;P<N;P+=2)u[v]=parseInt(I[P])-1,h[v]=parseInt(I[P+1])-1,f[v]=1,v+=1;else if(a===1)p.push(S.replace(I8,"").trim());else if(a!==4){if(a!==5){if(a!==6)if(S.includes("!NATOM")){a=2;var $=parseInt(S.split(Hd)[0]);s.resize($)}else if(S.includes("!NBOND")){a=3;var B=parseInt(S.split(Hd)[0]);u=new Uint32Array(B),h=new Uint32Array(B),f=new Uint8Array(B)}else S.includes("!NTITLE")?a=1:S.includes("!NTHETA")?a=4:S.includes("!NPHI")?a=5:S.includes("!NIMPHI")&&(a=6)}}}else a=void 0}})(0,d.length,d)}),i.title=p.join(" "),i.bondStore.length=f.length,i.bondStore.count=v,i.bondStore.atomIndex1=u,i.bondStore.atomIndex2=h,i.bondStore.bondOrder=f,r.finalize(),i.finalizeAtoms(),i.finalizeBonds(),Bu(i,!0),Fu(i,!0,!0),Ic(i),Pe&&de.timeEnd("PsfParser._parse "+this.name)},Object.defineProperties(t.prototype,n),t}(Rs);ft.add("psf",L8);var R8=/\[ (.+) \]/,jd=/\s+/,O8=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"top"},t.prototype._parse=function(){Pe&&de.time("TopParser._parse "+this.name);var i=this.structure,r=this.structureBuilder,o=i.atomMap,s=i.bondStore,a=i.atomStore;a.addField("partialCharge",1,"float32");var c,l,u=[],h={};this.streamer.eachChunkOfLines(function(_){(function(S,w,C){for(var A=S;A<w;++A){var k=C[A],L=k.trim();if(L&&L[0]!=="*"&&L[0]!==";"){if(L.startsWith("#include"))throw new Error("TopParser: #include statements not allowed");var D=k.match(R8);if(D===null){var F=L.indexOf(";");if(F!==-1&&(L=L.substring(0,F).trim()),l===2){var I=L.split(jd)[0];h[I]=c}else if(l===3){var P=L.split(jd);c.atoms.push([parseInt(P[2]),P[3],P[4],parseFloat(P[6])])}else if(l===4){var N=L.split(jd);c.bonds.push([parseInt(N[0]),parseInt(N[1])])}else if(l===0)i.title=L;else if(l===1){var $=L.split(jd);u.push([$[0],parseInt($[1])])}}else{var B=D[1];B==="moleculetype"?(l=2,c={atoms:[],bonds:[]}):l=B==="atoms"?3:B==="bonds"?4:B==="system"?0:B==="molecules"?1:void 0}}}})(0,_.length,_)});var f=0,p=0;u.forEach(function(_){var S=_[0],w=_[1],C=h[S];f+=w*C.atoms.length,p+=w*C.bonds.length}),a.resize(f),s.resize(p);var m,y=0,v=0,d=0,g=0,b=0,x=0;u.forEach(function(_){for(var S=_[0],w=_[1],C=h[S],A=cp(g),k=function(D){m=-1;var F=Vg.includes(S)?A:cp(d);C.atoms.forEach(function(I){var P=I[0],N=I[1],$=I[2],B=I[3];P!==m&&++v,a.atomTypeId[y]=o.add($),a.serial[y]=y+1,a.partialCharge[y]=B,r.addAtom(0,A,F,N,v+1),++y,m=P}),C.bonds.forEach(function(I){s.atomIndex1[b]=x+I[0]-1,s.atomIndex2[b]=x+I[1]-1,++b}),++d,x+=C.atoms.length},L=0;L<w;++L)k();++g}),s.count=p,r.finalize(),i.finalizeAtoms(),i.finalizeBonds(),Bu(i,!0),Fu(i,!0,!0),Ic(i),Pe&&de.timeEnd("TopParser._parse "+this.name)},Object.defineProperties(t.prototype,n),t}(Rs);ft.add("top",O8);var E0=function(e){function t(i,r){e.call(this,i,r),this.frames=new $_(this.name,this.path)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},__objName:{configurable:!0}};return n.type.get=function(){return"trajectory"},n.__objName.get=function(){return"frames"},Object.defineProperties(t.prototype,n),t}(Ci),k8=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},isBinary:{configurable:!0}};return n.type.get=function(){return"dcd"},n.isBinary.get=function(){return!0},t.prototype._parse=function(){Pe&&de.time("DcdParser._parse "+this.name);var i=ku(this.streamer.data),r=new DataView(i),o=this.frames,s=o.coordinates,a=o.boxes,c={},l=0,u=new Int32Array(i,0,23),h=u[0]!==r.getInt32(0);if(u[0]!==84)for(var f=i.byteLength,p=0;p<f;p+=4)r.setFloat32(p,r.getFloat32(p),!0);u[0]!==84&&de.error("dcd bad format, header block start"),String.fromCharCode(r.getUint8(4),r.getUint8(5),r.getUint8(6),r.getUint8(7))!=="CORD"&&de.error("dcd bad format, format string");var m=!1,y=!1,v=!1;u[22]!==0&&(m=!0,u[12]!==0&&(y=!0),u[13]===1&&(v=!0)),c.NSET=u[2],c.ISTART=u[3],c.NSAVC=u[4],c.NAMNF=u[10],c.DELTA=m?r.getFloat32(44,h):r.getFloat64(44,h),u[22]!==84&&de.error("dcd bad format, header block end"),l=l+84+8;var d=r.getInt32(l,h),g=l+1;if((d-4)%80!=0&&de.error("dcd bad format, title block start"),c.TITLE=Bg(new Uint8Array(i,g,d)),r.getInt32(g+d+4-1,h)!==d&&de.error("dcd bad format, title block end"),l=l+d+8,r.getInt32(l,h)!==4&&de.error("dcd bad format, natom block start"),c.NATOM=r.getInt32(l+4,h),r.getInt32(l+8,h)!==4&&de.error("dcd bad format, natom block end"),l=l+4+8,c.NAMNF>0)de.error("dcd format with fixed atoms unsupported, aborting");else{for(var b=c.NATOM,x=4*b,_=0,S=c.NSET;_<S;++_){if(y){l+=4;var w=new Float32Array(9);w[0]=r.getFloat64(l,h),w[4]=r.getFloat64(l+16,h),w[8]=r.getFloat64(l+40,h),a.push(w),l+=48,l+=4}for(var C=new Float32Array(3*b),A=0;A<3;++A){r.getInt32(l,h)!==x&&de.error("dcd bad format, coord block start",_,A),l+=4;for(var k=new Float32Array(i,l,b),L=0;L<b;++L)C[3*L+A]=k[L];l+=x,r.getInt32(l,h)!==x&&de.error("dcd bad format, coord block end",_,A),l+=4}s.push(C),v&&(l+=4+r.getInt32(l,h)+4)}c.DELTA&&(o.deltaTime=20.45482949774598*c.DELTA),c.ISTART>=1&&(o.timeOffset=(c.ISTART-1)*o.deltaTime),Pe&&de.timeEnd("DcdParser._parse "+this.name)}},Object.defineProperties(t.prototype,n),t}(E0);function lr(e,t){if(e)throw new TypeError("Not a valid NetCDF v3.x file: "+t)}function bE(e){e.offset%4!=0&&e.skip(4-e.offset%4)}function lb(e){var t=e.readUint32(),n=e.readChars(t);return bE(e),n}ft.add("dcd",k8);var I0=1,L0=2,R0=3,O0=4,k0=5,D0=6;function _E(e){switch(Number(e)){case I0:return"byte";case L0:return"char";case R0:return"short";case O0:return"int";case k0:return"float";case D0:return"double";default:return"undefined"}}function WM(e){switch(Number(e)){case I0:case L0:return 1;case R0:return 2;case O0:case k0:return 4;case D0:return 8;default:return-1}}function qM(e){switch(String(e)){case"byte":return I0;case"char":return L0;case"short":return R0;case"int":return O0;case"float":return k0;case"double":return D0;default:return-1}}function Wd(e,t){if(e!==1){for(var n=new Array(e),i=0;i<e;i++)n[i]=t();return n}return t()}function ub(e,t,n){switch(t){case I0:return e.readBytes(n);case L0:return function(i){return i.charCodeAt(i.length-1)===0?i.substring(0,i.length-1):i}(e.readChars(n));case R0:return Wd(n,e.readInt16.bind(e));case O0:return Wd(n,e.readInt32.bind(e));case k0:return Wd(n,e.readFloat32.bind(e));case D0:return Wd(n,e.readFloat64.bind(e));default:return void lr(!0,"non valid type "+t)}}function D8(e,t){var n={recordDimension:{length:e.readUint32()}};n.version=t;var i=function(o){var s,a,c,l=o.readUint32();if(l===0)return lr(o.readUint32()!==0,"wrong empty tag for list of dimensions"),[];lr(l!==10,"wrong tag for list of dimensions");var u=o.readUint32();s=new Array(u);for(var h=0;h<u;h++){var f=lb(o),p=o.readUint32();p===0&&(a=h,c=f),s[h]={name:f,size:p}}return{dimensions:s,recordId:a,recordName:c}}(e);n.recordDimension.id=i.recordId,n.recordDimension.name=i.recordName,n.dimensions=i.dimensions,n.globalAttributes=XM(e);var r=function(o,s,a){var c,l=o.readUint32(),u=0;if(l===0)return lr(o.readUint32()!==0,"wrong empty tag for list of variables"),[];lr(l!==11,"wrong tag for list of variables");var h=o.readUint32();c=new Array(h);for(var f=0;f<h;f++){for(var p=lb(o),m=o.readUint32(),y=new Array(m),v=0;v<m;v++)y[v]=o.readUint32();var d=XM(o),g=o.readUint32();lr(g<1&&g>6,"non valid type "+g);var b=o.readUint32(),x=o.readUint32();a===2&&(lr(x>0,"offsets larger than 4GB not supported"),x=o.readUint32()),y[0]===s&&(u+=b),c[f]={name:p,dimensions:y,attributes:d,type:_E(g),size:b,offset:x,record:y[0]===s}}return{variables:c,recordStep:u}}(e,i.recordId,t);return n.variables=r.variables,n.recordDimension.recordStep=r.recordStep,n}function XM(e){var t,n=e.readUint32();if(n===0)return lr(e.readUint32()!==0,"wrong empty tag for list of attributes"),[];lr(n!==12,"wrong tag for list of attributes");var i=e.readUint32();t=new Array(i);for(var r=0;r<i;r++){var o=lb(e),s=e.readUint32();lr(s<1||s>6,"non valid type "+s);var a=e.readUint32(),c=ub(e,s,a);bE(e),t[r]={name:o,type:_E(s),value:c}}return t}var ef=function(e){var t=new Et(e);t.setBigEndian(),lr(t.readChars(3)!=="CDF","should start with CDF");var n=t.readByte();lr(n>2,"unknown version"),this.header=D8(t,n),this.buffer=t},nl={version:{configurable:!0},recordDimension:{configurable:!0},dimensions:{configurable:!0},globalAttributes:{configurable:!0},variables:{configurable:!0}};nl.version.get=function(){return this.header.version===1?"classic format":"64-bit offset format"},nl.recordDimension.get=function(){return this.header.recordDimension},nl.dimensions.get=function(){return this.header.dimensions},nl.globalAttributes.get=function(){return this.header.globalAttributes},nl.variables.get=function(){return this.header.variables},ef.prototype.hasDataVariable=function(e){return this.header.variables.findIndex(function(t){return t.name===e})!==-1},ef.prototype.getDataVariable=function(e){var t;return lr((t=typeof e=="string"?this.header.variables.find(function(n){return n.name===e}):e)===void 0,"variable not found"),this.buffer.seek(t.offset),t.record?function(n,i,r){for(var o=qM(i.type),s=i.size?i.size/WM(o):1,a=r.length,c=new Array(a),l=r.recordStep,u=0;u<a;u++){var h=n.offset;c[u]=ub(n,o,s),n.seek(h+l)}return c}(this.buffer,t,this.header.recordDimension):function(n,i){for(var r=qM(i.type),o=i.size/WM(r),s=new Array(o),a=0;a<o;a++)s[a]=ub(n,r,1);return s}(this.buffer,t)},Object.defineProperties(ef.prototype,nl);var Gy=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},isBinary:{configurable:!0}};return n.type.get=function(){return"nctraj"},n.isBinary.get=function(){return!0},t.prototype._parse=function(){Pe&&de.time("NctrajParser._parse "+this.name);var i=new ef(this.streamer.data),r=this.frames,o=r.coordinates,s=r.boxes,a=r.times;i.getDataVariable("coordinates").forEach(function(c){o.push(new Float32Array(c))}),i.hasDataVariable("cell_lengths")&&i.getDataVariable("cell_lengths").forEach(function(c){s.push(new Float32Array(c))}),i.hasDataVariable("time")&&i.getDataVariable("time").forEach(function(c){a.push(c)}),a.length>=1&&(r.timeOffset=a[0]),a.length>=2&&(r.deltaTime=a[1]-a[0]),Pe&&de.timeEnd("NctrajParser._parse "+this.name)},Object.defineProperties(t.prototype,n),t}(E0);ft.add("nctraj",Gy),ft.add("ncdf",Gy),ft.add("nc",Gy);var B8=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},isBinary:{configurable:!0}};return n.type.get=function(){return"trr"},n.isBinary.get=function(){return!0},t.prototype._parse=function(){Pe&&de.time("TrrParser._parse "+this.name);for(var i=ku(this.streamer.data),r=new DataView(i),o=this.frames,s=o.coordinates,a=o.boxes,c=o.times,l=0;;){l+=8;var u=r.getInt32(l);l+=4,l+=u;var h=r.getInt32(l+8),f=r.getInt32(l+12),p=r.getInt32(l+16),m=r.getInt32(l+28),y=r.getInt32(l+32),v=r.getInt32(l+36),d=r.getInt32(l+40);l+=52;var g=h/9,b=3*d;if(g===8?c.push(r.getFloat64(l)):c.push(r.getFloat32(l)),l+=2*g,h){var x=new Float32Array(9);if(g===8)for(var _=0;_<9;++_)x[_]=10*r.getFloat64(l),l+=8;else for(var S=0;S<9;++S)x[S]=10*r.getFloat32(l),l+=4;a.push(x)}if(l+=f,l+=p,m){var w=void 0;if(g===8){w=new Float32Array(b);for(var C=0;C<b;++C)w[C]=10*r.getFloat64(l),l+=8}else{for(var A=new Uint32Array(i,l,b),k=0;k<b;++k){var L=A[k];A[k]=(255&L)<<24|(65280&L)<<8|L>>8&65280|L>>24&255}w=new Float32Array(i,l,b);for(var D=0;D<b;++D)w[D]*=10,l+=4}s.push(w)}if(l+=y,(l+=v)>=i.byteLength)break}c.length>=1&&(o.timeOffset=c[0]),c.length>=2&&(o.deltaTime=c[1]-c[0]),Pe&&de.timeEnd("TrrParser._parse "+this.name)},Object.defineProperties(t.prototype,n),t}(E0);ft.add("trr",B8);var il=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]);function $y(e){for(var t=1,n=0;e>=t&&n<32;)n++,t<<=1;return n}var _h=new Uint8Array(32);function F8(e,t){var n=1,i=0;_h[0]=1;for(var r=0;r<e;r++){var o=void 0,s=0;for(o=0;o<n;o++)s+=_h[o]*t[r],_h[o]=255&s,s>>=8;for(;s!==0;)_h[o++]=255&s,s>>=8;n=o}var a=1;for(n--;_h[n]>=a;)i++,a*=2;return i+8*n}function Qa(e,t,n,i){for(var r=(1<<n)-1,o=i[1],s=i[2],a=e[0],c=0;n>=8;)c|=(s=s<<8|t[a++])>>o<<n-8,n-=8;return n>0&&(o<n&&(o+=8,s=s<<8|t[a++]),c|=s>>(o-=n)&(1<<n)-1),c&=r,e[0]=a,e[1]=o,e[2]=s,c}var Xr=new Int32Array(32);function YM(e,t,n,i,r,o,s){var a=0;for(Xr[1]=0,Xr[2]=0,Xr[3]=0;i>8;)Xr[a++]=Qa(e,t,8,s),i-=8;i>0&&(Xr[a++]=Qa(e,t,i,s));for(var c=n-1;c>0;c--){for(var l=0,u=a-1;u>=0;u--){var h=(l=l<<8|Xr[u])/r[c]|0;Xr[u]=h,l-=h*r[c]}o[c]=l}o[0]=Xr[0]|Xr[1]<<8|Xr[2]<<16|Xr[3]<<24}var N8=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},isBinary:{configurable:!0}};return n.type.get=function(){return"xtc"},n.isBinary.get=function(){return!0},t.prototype._parse=function(){Pe&&de.time("XtcParser._parse "+this.name);for(var i=ku(this.streamer.data),r=new DataView(i),o=this.frames,s=o.coordinates,a=o.boxes,c=o.times,l=new Int32Array(6),u=new Int32Array(3),h=new Int32Array(3),f=new Uint32Array(3),p=new Float32Array(3),m=new Float32Array(3),y=0,v=new Int32Array(3),d=new Uint32Array(v.buffer);;){var g=void 0,b=r.getInt32(y+4);y+=12;var x=3*b;c.push(r.getFloat32(y)),y+=4;for(var _=new Float32Array(9),S=0;S<9;++S)_[S]=10*r.getFloat32(y),y+=4;if(a.push(_),b<=9){g=new Float32Array(b);for(var w=0;w<b;++w)g[w]=r.getFloat32(y),y+=4}else{v[0]=v[1]=v[2]=0,u[0]=u[1]=u[2]=0,f[0]=f[1]=f[2]=0,h[0]=h[1]=h[2]=0,p[0]=p[1]=p[2]=0,m[0]=m[1]=m[2]=0,g=new Float32Array(x);var C=0,A=r.getInt32(y);y+=4;var k=r.getFloat32(y);y+=4,l[0]=r.getInt32(y),l[1]=r.getInt32(y+4),l[2]=r.getInt32(y+8),l[3]=r.getInt32(y+12),l[4]=r.getInt32(y+16),l[5]=r.getInt32(y+20),u[0]=l[3]-l[0]+1,u[1]=l[4]-l[1]+1,u[2]=l[5]-l[2]+1,y+=24;var L=void 0;(u[0]|u[1]|u[2])>16777215?(h[0]=$y(u[0]),h[1]=$y(u[1]),h[2]=$y(u[2]),L=0):L=F8(3,u);var D=r.getInt32(y);y+=4;var F=D-1,I=il[F=9>F?9:F]/2|0,P=il[D]/2|0;f[0]=f[1]=f[2]=il[D];var N=4*Math.ceil(r.getInt32(y)/4);y+=4;var $=1/k,B=0,q=0,ee=new Uint8Array(i,y);for(p[0]=p[1]=p[2]=0;q<A;){L===0?(p[0]=Qa(v,ee,h[0],d),p[1]=Qa(v,ee,h[1],d),p[2]=Qa(v,ee,h[2],d)):YM(v,ee,3,L,u,p,d),q++,p[0]+=l[0],p[1]+=l[1],p[2]+=l[2],m[0]=p[0],m[1]=p[1],m[2]=p[2];var W=0;if(Qa(v,ee,1,d)===1&&(B=Qa(v,ee,5,d),B-=W=B%3,W--),B>0){p[0]=p[1]=p[2]=0;for(var Q=0;Q<B;Q+=3){if(YM(v,ee,3,D,f,p,d),q++,p[0]+=m[0]-P,p[1]+=m[1]-P,p[2]+=m[2]-P,Q===0){var Z=p[0];p[0]=m[0],m[0]=Z,Z=p[1],p[1]=m[1],m[1]=Z,Z=p[2],p[2]=m[2],m[2]=Z,g[C++]=m[0]*$,g[C++]=m[1]*$,g[C++]=m[2]*$}else m[0]=p[0],m[1]=p[1],m[2]=p[2];g[C++]=p[0]*$,g[C++]=p[1]*$,g[C++]=p[2]*$}}else g[C++]=p[0]*$,g[C++]=p[1]*$,g[C++]=p[2]*$;if(D+=W,W<0?(P=I,I=D>9?il[D-1]/2|0:0):W>0&&(I=P,P=il[D]/2|0),f[0]=f[1]=f[2]=il[D],f[0]===0||f[1]===0||f[2]===0)return void console.error("(xdrfile error) Undefined error.")}y+=N}for(var re=0;re<x;re++)g[re]*=10;if(s.push(g),y>=i.byteLength)break}c.length>=1&&(o.timeOffset=c[0]),c.length>=2&&(o.deltaTime=c[1]-c[0]),Pe&&de.timeEnd("XtcParser._parse "+this.name)},Object.defineProperties(t.prototype,n),t}(E0);ft.add("xtc",N8);var Ap=function(e){function t(i,r){var o=r||{};e.call(this,i,o),this.volume=new Xt(this.name,this.path),this.voxelSize=O(o.voxelSize,1)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},__objName:{configurable:!0}};return n.type.get=function(){return"volume"},n.__objName.get=function(){return"volume"},t.prototype._afterParse=function(){this.volume.setMatrix(this.getMatrix()),e.prototype._afterParse.call(this)},t.prototype.getMatrix=function(){return new De},Object.defineProperties(t.prototype,n),t}(Ci),z8=/\s+/,U8=/-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?/g,ZM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"cube"},t.prototype._parse=function(){Pe&&de.time("CubeParser._parse "+this.name);var i=this.volume,r=this.streamer.peekLines(6),o={},s=.529177210859*this.voxelSize;function a(f,p){var m=r[f].trim().split(z8)[p];return parseFloat(m)}o.atomCount=Math.abs(a(2,0)),o.originX=.529177210859*a(2,1),o.originY=.529177210859*a(2,2),o.originZ=.529177210859*a(2,3),o.NVX=a(3,0),o.NVY=a(4,0),o.NVZ=a(5,0),o.basisX=new T(a(3,1),a(3,2),a(3,3)).multiplyScalar(s),o.basisY=new T(a(4,1),a(4,2),a(4,3)).multiplyScalar(s),o.basisZ=new T(a(5,1),a(5,2),a(5,3)).multiplyScalar(s);var c=new Float32Array(o.NVX*o.NVY*o.NVZ),l=0,u=0,h=a(2,0)>0?0:1;this.streamer.eachChunkOfLines(function(f){(function(p,m,y){for(var v=p;v<m;++v){var d=y[v].trim();if(d!==""&&u>=o.atomCount+6+h)for(var g=d.match(U8),b=0,x=g.length;b<x;++b)c[l]=parseFloat(g[b]),++l;++u}})(0,f.length,f)}),i.header=o,i.setData(c,o.NVZ,o.NVY,o.NVX),Pe&&de.timeEnd("CubeParser._parse "+this.name)},t.prototype.getMatrix=function(){var i=this.volume.header,r=new De;return r.multiply(new De().makeTranslation(i.originX,i.originY,i.originZ)),r.multiply(new De().makeBasis(i.basisZ,i.basisY,i.basisX)),r},Object.defineProperties(t.prototype,n),t}(Ap);ft.add("cub",ZM),ft.add("cube",ZM);var KM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},isBinary:{configurable:!0}};return n.type.get=function(){return"dsn6"},n.isBinary.get=function(){return!0},t.prototype._parse=function(){Pe&&de.time("Dsn6Parser._parse "+this.name);var i,r,o=this.volume,s={},a=ku(this.streamer.data),c=new Int16Array(a),l=new Uint8Array(a),u=String.fromCharCode.apply(null,l.subarray(0,512));if(u.startsWith(":-)"))s.xStart=parseInt(u.substr(10,5)),s.yStart=parseInt(u.substr(15,5)),s.zStart=parseInt(u.substr(20,5)),s.xExtent=parseInt(u.substr(32,5)),s.yExtent=parseInt(u.substr(38,5)),s.zExtent=parseInt(u.substr(42,5)),s.xRate=parseInt(u.substr(52,5)),s.yRate=parseInt(u.substr(58,5)),s.zRate=parseInt(u.substr(62,5)),s.xlen=parseFloat(u.substr(73,10))*this.voxelSize,s.ylen=parseFloat(u.substr(83,10))*this.voxelSize,s.zlen=parseFloat(u.substr(93,10))*this.voxelSize,s.alpha=parseFloat(u.substr(103,10)),s.beta=parseFloat(u.substr(113,10)),s.gamma=parseFloat(u.substr(123,10)),i=parseFloat(u.substr(138,12))/100,r=parseInt(u.substr(155,8)),s.sigma=100*parseFloat(u.substr(170,12));else{if(c[18]!==100)for(var h=0,f=c.length;h<f;++h){var p=c[h];c[h]=(255&p)<<8|p>>8&255}s.xStart=c[0],s.yStart=c[1],s.zStart=c[2],s.xExtent=c[3],s.yExtent=c[4],s.zExtent=c[5],s.xRate=c[6],s.yRate=c[7],s.zRate=c[8];var m=1/c[17],y=m*this.voxelSize;s.xlen=c[9]*y,s.ylen=c[10]*y,s.zlen=c[11]*y,s.alpha=c[12]*m,s.beta=c[13]*m,s.gamma=c[14]*m,i=c[15]/100,r=c[16],s.gamma=c[14]*m}o.header=s,Pe&&de.log(s,i,r);for(var v=new Float32Array(s.xExtent*s.yExtent*s.zExtent),d=512,g=Math.ceil(s.xExtent/8),b=Math.ceil(s.yExtent/8),x=Math.ceil(s.zExtent/8),_=0;_<x;++_)for(var S=0;S<b;++S)for(var w=0;w<g;++w)for(var C=0;C<8;++C)for(var A=8*_+C,k=0;k<8;++k)for(var L=8*S+k,D=0;D<8;++D){var F=8*w+D;if(!(F<s.xExtent&&L<s.yExtent&&A<s.zExtent)){d+=8-D;break}v[(F*s.yExtent+L)*s.zExtent+A]=(l[d]-r)/i,++d}o.setData(v,s.zExtent,s.yExtent,s.xExtent),s.sigma&&o.setStats(void 0,void 0,void 0,s.sigma),Pe&&de.timeEnd("Dsn6Parser._parse "+this.name)},t.prototype.getMatrix=function(){var i=this.volume.header,r=[i.xlen,0,0],o=[i.ylen*Math.cos(Math.PI/180*i.gamma),i.ylen*Math.sin(Math.PI/180*i.gamma),0],s=[i.zlen*Math.cos(Math.PI/180*i.beta),i.zlen*(Math.cos(Math.PI/180*i.alpha)-Math.cos(Math.PI/180*i.gamma)*Math.cos(Math.PI/180*i.beta))/Math.sin(Math.PI/180*i.gamma),0];s[2]=Math.sqrt(i.zlen*i.zlen*Math.sin(Math.PI/180*i.beta)*Math.sin(Math.PI/180*i.beta)-s[1]*s[1]);var a=[[],r,o,s],c=[0,i.xRate,i.yRate,i.zRate],l=[0,1,2,3],u=new De;return u.set(a[l[1]][0]/c[l[1]],a[l[2]][0]/c[l[2]],a[l[3]][0]/c[l[3]],0,a[l[1]][1]/c[l[1]],a[l[2]][1]/c[l[2]],a[l[3]][1]/c[l[3]],0,a[l[1]][2]/c[l[1]],a[l[2]][2]/c[l[2]],a[l[3]][2]/c[l[3]],0,0,0,0,1),u.multiply(new De().makeRotationY(Tn(90))),u.multiply(new De().makeTranslation(-i.zStart,i.yStart,i.xStart)),u.multiply(new De().makeScale(-1,1,1)),u},Object.defineProperties(t.prototype,n),t}(Ap);ft.add("dsn6",KM),ft.add("brix",KM);var qd=/\s+/,wE=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"dx"},t.prototype._parse=function(){Pe&&de.time("DxParser._parse "+this.name);var i=this.volume,r=this.streamer.peekLines(30),o=this.parseHeaderLines(r),s=this.volume.header,a=o.dataLineStart,c=s.nx*s.ny*s.nz,l=new Float32Array(c),u=0,h=0;this.streamer.eachChunkOfLines(function(f){(function(p,m,y){for(var v=p;v<m;++v){if(u<c&&h>a){var d=y[v].trim();if(d!=="")for(var g=d.split(qd),b=0,x=g.length;b<x;++b)l[u]=parseFloat(g[b]),++u}++h}})(0,f.length,f)}),i.setData(l,s.nz,s.ny,s.nx),Pe&&de.timeEnd("DxParser._parse "+this.name)},t.prototype.parseHeaderLines=function(i){for(var r={},o=i.length,s=0,a=0,c=0,l=0;l<o;++l){var u=void 0,h=i[l];if(h.startsWith("object 1"))u=h.split(qd),r.nx=parseInt(u[5]),r.ny=parseInt(u[6]),r.nz=parseInt(u[7]);else if(h.startsWith("origin"))u=h.split(qd),r.xmin=parseFloat(u[1]),r.ymin=parseFloat(u[2]),r.zmin=parseFloat(u[3]);else if(h.startsWith("delta"))u=h.split(qd),c===0?r.hx=parseFloat(u[1])*this.voxelSize:c===1?r.hy=parseFloat(u[2])*this.voxelSize:c===2&&(r.hz=parseFloat(u[3])*this.voxelSize),c+=1;else if(h.startsWith("object 3")){s=l,a+=h.length+1;break}a+=h.length+1}return this.volume.header=r,{dataLineStart:s,headerByteCount:a}},t.prototype.getMatrix=function(){var i=this.volume.header,r=new De;return r.multiply(new De().makeRotationY(Tn(90))),r.multiply(new De().makeTranslation(-i.zmin,i.ymin,i.xmin)),r.multiply(new De().makeScale(-i.hz,i.hy,i.hx)),r},Object.defineProperties(t.prototype,n),t}(Ap);ft.add("dx",wE);var G8=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},isBinary:{configurable:!0}};return n.type.get=function(){return"dxbin"},n.isBinary.get=function(){return!0},t.prototype._parse=function(){Pe&&de.time("DxbinParser._parse "+this.name);for(var i=ku(this.streamer.data),r=function(f,p,m){p===void 0&&(p=10485760),m===void 0&&(m=`
`);for(var y="",v=[],d=0;d<f.length;d+=p){var g=Bg(f.subarray(d,d+p)),b=g.lastIndexOf(m);if(b===-1)y+=g;else{var x=y+g.substr(0,b);v=v.concat(x.split(m)),y=b===g.length-m.length?"":g.substr(b+m.length)}}return y!==""&&v.push(y),v}(new Uint8Array(i,0,1e3)),o=this.parseHeaderLines(r),s=this.volume.header,a=o.headerByteCount,c=s.nx*s.ny*s.nz,l=new DataView(i),u=new Float32Array(c),h=0;h<c;++h)u[h]=l.getFloat64(8*h+a,!0);this.volume.setData(u,s.nz,s.ny,s.nx),Pe&&de.timeEnd("DxbinParser._parse "+this.name)},Object.defineProperties(t.prototype,n),t}(wE);ft.add("dxbin",G8);var Vy=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},isBinary:{configurable:!0}};return n.type.get=function(){return"mrc"},n.isBinary.get=function(){return!0},t.prototype._parse=function(){Pe&&de.time("MrcParser._parse "+this.name);var i,r=this.volume,o={},s=ku(this.streamer.data),a=new Int32Array(s,0,56),c=new Float32Array(s,0,56),l=new DataView(s);if(o.MAP=String.fromCharCode(l.getUint8(208),l.getUint8(209),l.getUint8(210),l.getUint8(211)),o.MACHST=[l.getUint8(212),l.getUint8(213)],o.MACHST[0]===17&&o.MACHST[1]===17)for(var u=s.byteLength,h=0;h<u;h+=4)l.setFloat32(h,l.getFloat32(h),!0);if(o.NX=a[0],o.NY=a[1],o.NZ=a[2],o.MODE=a[3],o.NXSTART=a[4],o.NYSTART=a[5],o.NZSTART=a[6],o.MX=a[7],o.MY=a[8],o.MZ=a[9],o.xlen=c[10]*this.voxelSize,o.ylen=c[11]*this.voxelSize,o.zlen=c[12]*this.voxelSize,o.alpha=c[13],o.beta=c[14],o.gamma=c[15],o.MAPC=a[16],o.MAPR=a[17],o.MAPS=a[18],o.DMIN=c[19],o.DMAX=c[20],o.DMEAN=c[21],o.ISPG=a[22],o.NSYMBT=a[23],o.LSKFLG=a[24],o.originX=c[49],o.originY=c[50],o.originZ=c[51],o.ARMS=c[54],r.header=o,o.MODE===2)i=new Float32Array(s,1024+o.NSYMBT,o.NX*o.NY*o.NZ);else if(o.MODE===0){if(i=new Float32Array(new Int8Array(s,1024+o.NSYMBT,o.NX*o.NY*o.NZ)),a[39]===-128&&a[40]===127)for(var f=(o.DMAX-o.DMIN)/255,p=.5*(o.DMIN+o.DMAX+f),m=0,y=i.length;m<y;++m)i[m]=f*i[m]+p}else de.error("MrcParser unknown mode",o.MODE);r.setData(i,o.NX,o.NY,o.NZ),o.ARMS!==0&&r.setStats(o.DMIN,o.DMAX,o.DMEAN,o.ARMS),Pe&&de.timeEnd("MrcParser._parse "+this.name)},t.prototype.getMatrix=function(){var i=this.volume.header,r=[i.xlen,0,0],o=[i.ylen*Math.cos(Math.PI/180*i.gamma),i.ylen*Math.sin(Math.PI/180*i.gamma),0],s=[i.zlen*Math.cos(Math.PI/180*i.beta),i.zlen*(Math.cos(Math.PI/180*i.alpha)-Math.cos(Math.PI/180*i.gamma)*Math.cos(Math.PI/180*i.beta))/Math.sin(Math.PI/180*i.gamma),0];s[2]=Math.sqrt(i.zlen*i.zlen*Math.sin(Math.PI/180*i.beta)*Math.sin(Math.PI/180*i.beta)-s[1]*s[1]);var a=[[],r,o,s],c=[0,i.MX,i.MY,i.MZ],l=[0,i.MAPC,i.MAPR,i.MAPS],u=new De;return u.set(a[l[1]][0]/c[l[1]],a[l[2]][0]/c[l[2]],a[l[3]][0]/c[l[3]],0,a[l[1]][1]/c[l[1]],a[l[2]][1]/c[l[2]],a[l[3]][1]/c[l[3]],0,a[l[1]][2]/c[l[1]],a[l[2]][2]/c[l[2]],a[l[3]][2]/c[l[3]],0,0,0,0,1),u.setPosition(new T(i.originX,i.originY,i.originZ)),u.multiply(new De().makeTranslation(i.NXSTART,i.NYSTART,i.NZSTART)),u},Object.defineProperties(t.prototype,n),t}(Ap);ft.add("mrc",Vy),ft.add("ccp4",Vy),ft.add("map",Vy);var $8=/\s+/;function Hy(e){return e.trim().split($8).map(parseFloat)}var QM=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"xplor"},t.prototype._parse=function(){Pe&&de.time("XplorParser._parse "+this.name);var i,r=this.volume,o=this.streamer.peekLines(8),s={},a=(i=o[2].startsWith("REMARKS")?parseInt(o[1].substring(0,8))+2:5)+3,c=Hy(o[i]);s.NA=c[0],s.AMIN=c[1],s.AMAX=c[2],s.NB=c[3],s.BMIN=c[4],s.BMAX=c[5],s.NC=c[6],s.CMIN=c[7],s.CMAX=c[8];var l=Hy(o[i+1]);s.a=l[0]*this.voxelSize,s.b=l[1]*this.voxelSize,s.c=l[2]*this.voxelSize,s.alpha=l[3],s.beta=l[4],s.gamma=l[5];var u=s.AMAX-s.AMIN+1,h=s.BMAX-s.BMIN+1,f=s.CMAX-s.CMIN+1,p=u*h*f,m=new Float32Array(p),y=Math.ceil(1+u*h/6),v=0,d=0;this.streamer.eachChunkOfLines(function(g){(function(b,x,_){for(var S=b;S<x;++S){var w=_[S];if(d>=a&&(d-a)%y!=0&&v<p)for(var C=0;C<6;++C){var A=parseFloat(w.substr(12*C,12));if(isNaN(A))break;m[v++]=A}else if(v===p){var k=w.trim();if(k&&k!=="-9999"){var L=Hy(w);s.RAVE=L[0],s.RSIGMA=L[1]}}++d}})(0,g.length,g)}),r.header=s,r.setData(m,u,h,f),s.RAVE!==0&&s.RSIGMA!==1&&r.setStats(void 0,void 0,s.RAVE,s.RSIGMA),Pe&&de.timeEnd("XplorParser._parse "+this.name)},t.prototype.getMatrix=function(){var i=this.volume.header,r=[i.a,0,0],o=[i.b*Math.cos(Math.PI/180*i.gamma),i.b*Math.sin(Math.PI/180*i.gamma),0],s=[i.c*Math.cos(Math.PI/180*i.beta),i.c*(Math.cos(Math.PI/180*i.alpha)-Math.cos(Math.PI/180*i.gamma)*Math.cos(Math.PI/180*i.beta))/Math.sin(Math.PI/180*i.gamma),0];s[2]=Math.sqrt(i.c*i.c*Math.sin(Math.PI/180*i.beta)*Math.sin(Math.PI/180*i.beta)-s[1]*s[1]);var a=[[],r,o,s],c=[0,i.NA,i.NB,i.NC],l=[0,1,2,3],u=new De;return u.set(a[l[1]][0]/c[l[1]],a[l[2]][0]/c[l[2]],a[l[3]][0]/c[l[3]],0,a[l[1]][1]/c[l[1]],a[l[2]][1]/c[l[2]],a[l[3]][1]/c[l[3]],0,a[l[1]][2]/c[l[1]],a[l[2]][2]/c[l[2]],a[l[3]][2]/c[l[3]],0,0,0,0,1),u.multiply(new De().makeTranslation(i.AMIN,i.BMIN,i.CMIN)),u},Object.defineProperties(t.prototype,n),t}(Ap);function vn(e,t,n){var i,r,o;e/=360,t/=100,n/=100;var s=Math.floor(6*e),a=6*e-s,c=n*(1-t),l=n*(1-a*t),u=n*(1-(1-a)*t);switch(s%6){case 0:i=n,r=u,o=c;break;case 1:i=l,r=n,o=c;break;case 2:i=c,r=n,o=u;break;case 3:i=c,r=l,o=n;break;case 4:i=u,r=c,o=n;break;case 5:i=n,r=c,o=l}return[i,r,o]}ft.add("xplor",QM),ft.add("cns",QM);var hb={red:vn(0,100,100),orange:vn(20,100,100),gold:vn(40,100,100),yellow:vn(60,100,100),lime:vn(80,100,100),green:vn(120,80,100),sea:vn(150,100,100),cyan:vn(180,100,85),sky:vn(210,75,95),blue:vn(240,70,100),purple:vn(275,75,100),magenta:vn(300,95,100),hotpink:vn(335,100,100),pink:vn(350,55,100),peach:vn(25,75,100),lilac:vn(275,55,100),pinktint:vn(340,30,100),peachtint:vn(25,50,100),yellowtint:vn(60,50,100),greentint:vn(135,40,100),bluetint:vn(220,40,100),lilactint:vn(275,35,100),white:vn(0,0,100),gray:vn(0,0,50),brown:vn(20,45,75),deadwhite:[1,1,1],deadblack:[0,0,0],invisible:[0,0,0]},V8=/[\s,]+/,SE=/[^{}\s]*{[^{}]+}|[^{}\s]+/g,fb=/^{+|}+$/g,H8=/^['"]+|['"]+$/g,ME=/\s*=\s*/g;function Xd(e){for(var t,n,i,r=[],o=(e=e.replace(ME,"=")).match(SE),s=1;s<o.length;++s){var a=o[s];if(a[0]==="{")t=a.substring(1,a.length-1);else{var c=a.split("=");c.length===2&&(c[0]==="color"?n=hb[c[1]]:c[0]==="width"?i=parseInt(c[1]):c[0]==="master"&&r.push(c[1].replace(fb,"")))}}return{listName:t,listColor:n,listMasters:r,listWidth:i}}function Yd(e){for(var t,n,i,r=(e=e.trim()).indexOf("{"),o=e.indexOf("}"),s=e.substr(o+1).split(V8),a=e.substr(r+1,o-1),c=[parseFloat(s[s.length-3]),parseFloat(s[s.length-2]),parseFloat(s[s.length-1])],l=!1,u=!1,h=4;h<=s.length;h++){var f=s[s.length-h];f in hb&&(t=hb[s[s.length-h]]),f.startsWith("width")&&(n=parseInt(f.substring(5))),f.startsWith("r=")&&(i=parseFloat(f.split("=")[1])),f.startsWith("P")&&(l=!0),f.startsWith("X")&&(u=!0)}return{label:a,position:c,color:t,radius:i,width:n,isLineBreak:l,isTriangleBreak:u}}function jy(e){var t=e.indexOf("{"),n=e.indexOf("}");return e.substring(t!==-1?t+1:0,n!==-1?n:void 0).trim()}function j8(e){var t=e.indexOf("}");return t===-1?void 0:e.substr(t+1).trim()}function Wy(e){for(var t="",n=[],i={},r=(e=e.replace(ME,"=")).match(SE),o=1;o<r.length;++o){var s=r[o];if(s[0]==="{")t=s.substring(1,s.length-1);else{var a=s.split("=");a.length===2?a[0]==="master"?n.push(a[1].replace(fb,"")):i[a[0]]=a[1].replace(fb,""):i[a[0]]=!0}}return{groupName:t,groupFlags:i,groupMasters:n}}var W8=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},__objName:{configurable:!0}};return n.type.get=function(){return"kin"},n.__objName.get=function(){return"kinemage"},t.prototype._parse=function(){Pe&&de.time("KinParser._parse "+this.name);var i,r,o={kinemage:void 0,onewidth:void 0,"1viewid":void 0,pdbfile:void 0,texts:[],text:"",captions:[],caption:"",groupDict:{},subgroupDict:{},masterDict:{},pointmasterDict:{},dotLists:[],vectorLists:[],ballLists:[],ribbonLists:[]};this.kinemage=o;var s,a,c,l,u,h,f,p,m,y,v,d,g,b,x,_,S,w,C,A,k,L,D=!1,F="",I=!1,P="",N=null,$=null,B=!1,q="",ee=!1,W="",Q=!1,Z=!1;if(this.streamer.eachChunkOfLines(function(he){(function(K,ce,se){for(var ue=K;ue<ce;++ue){var H=se[ue];if(H[0]==="@"&&(D=!1,I=!1,B=!1,ee=!1,Q=!1,Z=!1),H)if(H.startsWith("@dotlist")){var j=Xd(H),X=j.listColor,ie=j.listName,fe=j.listMasters;D=!0,F="",a=[],c=[],l=[],s=X,i&&(fe=fe.concat(i)),r&&(fe=fe.concat(r)),o.dotLists.push({name:ie,masterArray:fe,labelArray:a,positionArray:c,colorArray:l})}else if(H.startsWith("@vectorlist")){var me=Xd(H),ve=me.listMasters,G=me.listName,V=me.listWidth,pe=me.listColor;ve&&ve.forEach(function(nt){o.masterDict[nt]||(o.masterDict[nt]={indent:!1,visible:!1})}),I=!0,P="",N=null,$=null,f=[],p=[],m=[],y=[],v=[],d=[],u=pe,h=[],V&&h.push(V),i&&(ve=ve.concat(i)),r&&(ve=ve.concat(r)),o.vectorLists.push({name:G,masterArray:ve,label1Array:f,label2Array:p,position1Array:m,position2Array:y,color1Array:v,color2Array:d,width:h})}else if(H.startsWith("@balllist")){var le=Xd(H),ne=le.listName,oe=le.listColor,xe=le.listMasters;xe&&xe.forEach(function(nt){o.masterDict[nt]||(o.masterDict[nt]={indent:!1,visible:!1})}),B=!0,q="",x=[],g=[],_=[],S=[],b=oe,i&&(xe=xe.concat(i)),r&&(xe=xe.concat(r)),o.ballLists.push({name:ne,masterArray:xe,labelArray:x,radiusArray:g,positionArray:_,colorArray:S})}else if(H.startsWith("@ribbonlist")||H.startsWith("@trianglelist")){var Ae=Xd(H),ge=Ae.listMasters,Me=Ae.listName,be=Ae.listColor;ge&&ge.forEach(function(nt){o.masterDict[nt]||(o.masterDict[nt]={indent:!1,visible:!1})}),ee=!0,W="",C=[],A=[],k=[],L=[],w=be,i&&(ge=ge.concat(i)),r&&(ge=ge.concat(r)),o.ribbonLists.push({name:Me,masterArray:ge,labelArray:C,positionArray:A,breakArray:k,colorArray:L})}else if(H.startsWith("@text"))Q=!0,o.texts.push(H.substr(5));else if(H.startsWith("@caption"))Z=!0,o.captions.push(H.substr(8));else if(D){var Oe=Yd(H),Te=Oe.label,Ce=Oe.color,Ge=Oe.position;Te==='"'?Te=F:F=Te,Ce===void 0&&(Ce=s),a.push(Te),c.push.apply(c,Ge),l.push.apply(l,Ce)}else if(I)for(var at=H.replace(/(?!^){/g,`
{`).split(/\n/),it=0;it<at.length;it++){var et=Yd(at[it]),mt=et.label,vt=et.color,lt=et.width,qe=et.position,Ct=et.isLineBreak;mt==='"'?mt=P:P=mt,vt===void 0&&(vt=u),Ct||N!==null&&(lt&&h.push(lt),f.push(P),m.push.apply(m,N),v.push.apply(v,$),p.push(mt),y.push.apply(y,qe),d.push.apply(d,vt)),P=mt,N=qe,$=vt}else if(B){var tt=Yd(H),Ve=tt.label,Pt=tt.radius,Be=tt.color,$e=tt.position;Ve==='"'?Ve=q:q=Ve,Pt===void 0&&(Pt=1),Be===void 0&&(Be=b),x.push(Ve),g.push(Pt),_.push.apply(_,$e),S.push.apply(S,Be)}else if(ee){var Je=Yd(H),Y=Je.label,Se=Je.color,ye=Je.position,M=Je.isTriangleBreak;Y==='"'?Y=W:W=Y,Se===void 0&&(Se=w),C.push(Y),A.push.apply(A,ye),k.push(M),L.push.apply(L,Se)}else if(Q)o.texts.push(H);else if(Z)o.captions.push(H);else if(H.startsWith("@kinemage"))o.kinemage=parseInt(H.substr(9).trim());else if(H.startsWith("@onewidth"))o.onewidth=!0;else if(H.startsWith("@1viewid"))o["1viewid"]=jy(H);else if(H.startsWith("@pdbfile"))o.pdbfile=jy(H);else if(H.startsWith("@group")){var E=Wy(H),R=E.groupName,z=E.groupFlags,U=E.groupMasters;for(var J in o.groupDict[R]||(o.groupDict[R]={dominant:!1,animate:!1},i=U),i&&i.forEach(function(nt){o.masterDict[nt]||(o.masterDict[nt]={indent:!1,visible:!1})}),z)o.groupDict[R][J]=z[J]}else if(H.startsWith("@subgroup")){var te=Wy(H),ae=te.groupName,we=te.groupFlags,_e=te.groupMasters;for(var Ie in o.subgroupDict[ae]||(o.subgroupDict[ae]={dominant:!1,animate:!1},r=_e),r&&r.forEach(function(nt){o.masterDict[nt]||(o.masterDict[nt]={indent:!1,visible:!1})}),we)o.subgroupDict[ae][Ie]=we[Ie]}else if(H.startsWith("@master")){var Ue=jy(H),Re=j8(H);o.masterDict[Ue]||(o.masterDict[Ue]={indent:!1,visible:!1}),Re==="on"?o.masterDict[Ue].visible=!0:Re==="off"?o.masterDict[Ue].visible=!1:Re==="indent"&&(o.masterDict[Ue].indent=!0)}else if(H.startsWith("@pointmaster")){var ke=Wy(H),ze=ke.groupName,Ze=ke.groupFlags;o.pointmasterDict[ze]={id:Object.keys(Ze)[0].replace(H8,"")}}else console.log(H);else D=!1,I=!1,B=!1,ee=!1}})(0,he.length,he)}),o.text=o.texts.join(`
`).trim(),o.caption=o.captions.join(`
`).trim(),o.ribbonLists){var re=[];o.ribbonLists.forEach(function(he){re.push(function(K){for(var ce=K.labelArray,se=K.positionArray,ue=K.colorArray,H=K.breakArray,j=[],X=[],ie=[],fe=[],me=0;me<H.length/3;me++){var ve=3*me,G=9*me;H[ve+1]||H[ve+2]||(j.push(ce[ve]),j.push(ce[ve+1]),j.push(ce[ve+2]),fe.push(H[ve]),fe.push(H[ve+1]),fe.push(H[ve+2]),X.push(se[G]),X.push(se[G+1]),X.push(se[G+2]),X.push(se[G+3]),X.push(se[G+4]),X.push(se[G+5]),X.push(se[G+6]),X.push(se[G+7]),X.push(se[G+8]),ie.push(ue[G]),ie.push(ue[G+1]),ie.push(ue[G+2]),ie.push(ue[G+3]),ie.push(ue[G+4]),ie.push(ue[G+5]),ie.push(ue[G+6]),ie.push(ue[G+7]),ie.push(ue[G+8]))}return{name:K.name,masterArray:K.masterArray,labelArray:j,positionArray:X,breakArray:fe,colorArray:ie}}(function(K){for(var ce=K.labelArray,se=K.positionArray,ue=K.colorArray,H=K.breakArray,j=[],X=0;X<3*(ce.length-2);++X)j[X]=ce[X-2*Math.floor(X/3)];for(var ie=[],fe=0;fe<3*(H.length-2);++fe)ie[fe]=H[fe-2*Math.floor(fe/3)];for(var me=[],ve=0;ve<9*(se.length/3-2);++ve)me[ve]=se[ve-6*Math.floor(ve/9)];for(var G=[],V=0;V<9*(ue.length/3-2);++V)G[V]=ue[V-6*Math.floor(V/9)];for(var pe=[],le=0;le<me.length/3;++le)pe.push(new T(me[3*le],me[3*le]+1,me[3*le]+2));return{name:K.name,masterArray:K.masterArray,labelArray:j,positionArray:me,breakArray:ie,colorArray:G}}(he)))}),o.ribbonLists=re}Pe&&de.timeEnd("KinParser._parse "+this.name)},Object.defineProperties(t.prototype,n),t}(Ci);ft.add("kin",W8);var AE=function(e){function t(i,r){e.call(this,i,r),this.loader=this.getLoader(),this.surface=new Si(this.name,this.path)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},__objName:{configurable:!0}};return n.type.get=function(){return"surface"},n.__objName.get=function(){return"surface"},t.prototype._parse=function(){var i=this.loader.parse(this.streamer.asText());this.surface.fromGeometry(i)},Object.defineProperties(t.prototype,n),t}(Ci),pb=function(){this.regexp={vertex_pattern:/^v\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,normal_pattern:/^vn\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,uv_pattern:/^vt\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}};pb.prototype={constructor:pb,setPath:function(e){this.path=e},_createParserState:function(){var e={objects:[],object:{},vertices:[],normals:[],startObject:function(t,n){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=t,void(this.object.fromDeclaration=n!==!1);this.object={name:t||"",geometry:{vertices:[],normals:[]},fromDeclaration:n!==!1},this.objects.push(this.object)},parseVertexIndex:function(t,n){var i=parseInt(t,10);return 3*(i>=0?i-1:i+n/3)},parseNormalIndex:function(t,n){var i=parseInt(t,10);return 3*(i>=0?i-1:i+n/3)},addVertex:function(t,n,i){var r=this.vertices,o=this.object.geometry.vertices;o.push(r[t+0]),o.push(r[t+1]),o.push(r[t+2]),o.push(r[n+0]),o.push(r[n+1]),o.push(r[n+2]),o.push(r[i+0]),o.push(r[i+1]),o.push(r[i+2])},addVertexLine:function(t){var n=this.vertices,i=this.object.geometry.vertices;i.push(n[t+0]),i.push(n[t+1]),i.push(n[t+2])},addNormal:function(t,n,i){var r=this.normals,o=this.object.geometry.normals;o.push(r[t+0]),o.push(r[t+1]),o.push(r[t+2]),o.push(r[n+0]),o.push(r[n+1]),o.push(r[n+2]),o.push(r[i+0]),o.push(r[i+1]),o.push(r[i+2])},addFace:function(t,n,i,r,o,s,a,c){var l,u=this.vertices.length,h=this.parseVertexIndex(t,u),f=this.parseVertexIndex(n,u),p=this.parseVertexIndex(i,u);if(r===void 0?this.addVertex(h,f,p):(l=this.parseVertexIndex(r,u),this.addVertex(h,f,l),this.addVertex(f,p,l)),o!==void 0){var m=this.normals.length;h=this.parseNormalIndex(o,m),f=o===s?h:this.parseNormalIndex(s,m),p=o===a?h:this.parseNormalIndex(a,m),r===void 0?this.addNormal(h,f,p):(l=this.parseNormalIndex(c,m),this.addNormal(h,f,l),this.addNormal(f,p,l))}},addLineGeometry:function(t){this.object.geometry.type="Line";for(var n=this.vertices.length,i=0,r=t.length;i<r;i++)this.addVertexLine(this.parseVertexIndex(t[i],n))}};return e.startObject("",!1),e},parse:function(e){var t,n,i=this._createParserState();e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));var r=e.split(`
`),o="",s="",a="",c=[],l=typeof"".trimLeft=="function";for(t=0,n=r.length;t<n;t++)if(o=r[t],(o=l?o.trimLeft():o.trim()).length!==0&&(s=o.charAt(0))!=="#"){if(s==="v"){if((a=o.charAt(1))===" "&&(c=this.regexp.vertex_pattern.exec(o))!==null)i.vertices.push(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]));else if(a==="n"&&(c=this.regexp.normal_pattern.exec(o))!==null)i.normals.push(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]));else if(a!=="t"||this.regexp.uv_pattern.exec(o)===null)throw new Error("Unexpected vertex/normal/uv line: '"+o+"'")}else if(s==="f"){if((c=this.regexp.face_vertex_uv_normal.exec(o))!==null)i.addFace(c[1],c[4],c[7],c[10],c[3],c[6],c[9],c[12]);else if(this.regexp.face_vertex_uv.exec(o)===null)if((c=this.regexp.face_vertex_normal.exec(o))!==null)i.addFace(c[1],c[3],c[5],c[7],c[2],c[4],c[6],c[8]);else{if((c=this.regexp.face_vertex.exec(o))===null)throw new Error("Unexpected face line: '"+o+"'");i.addFace(c[1],c[2],c[3],c[4])}}else if(s==="l"){var u=o.substring(1).trim().split(" "),h=[],f=[];if(o.indexOf("/")===-1)h=u;else for(var p=0,m=u.length;p<m;p++){var y=u[p].split("/");y[0]!==""&&h.push(y[0]),y[1]!==""&&f.push(y[1])}i.addLineGeometry(h,f)}else if((c=this.regexp.object_pattern.exec(o))!==null){var v=c[0].substr(1).trim();i.startObject(v)}else if(!this.regexp.material_use_pattern.test(o)){if(!this.regexp.material_library_pattern.test(o)){if(this.regexp.smoothing_pattern.exec(o)===null){if(o==="\0")continue;throw new Error("Unexpected line: '"+o+"'")}}}}var d=[];for(t=0,n=i.objects.length;t<n;t++){var g=i.objects[t].geometry;if(g.vertices.length!==0){var b=new We;b.setAttribute("position",new rt(new Float32Array(g.vertices),3)),g.normals.length>0?b.setAttribute("normal",new rt(new Float32Array(g.normals),3)):b.computeVertexNormals(),d.push(b)}}return d}};var q8=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"obj"},t.prototype.getLoader=function(){return new pb},Object.defineProperties(t.prototype,n),t}(AE);ft.add("obj",q8);var db=function(){this.propertyNameMapping={}};db.prototype={constructor:db,setPropertyNameMapping:function(e){this.propertyNameMapping=e},bin2str:function(e){for(var t=new Uint8Array(e),n="",i=0;i<e.byteLength;i++)n+=String.fromCharCode(t[i]);return n},isASCII:function(e){return this.parseHeader(this.bin2str(e)).format==="ascii"},parse:function(e){return e instanceof ArrayBuffer?this.isASCII(e)?this.parseASCII(this.bin2str(e)):this.parseBinary(e):this.parseASCII(e)},parseHeader:function(e){var t="",n=0,i=/ply([\s\S]*)end_header\s/.exec(e);i!==null&&(t=i[1],n=i[0].length);for(var r,o,s,a,c,l,u={comments:[],elements:[],headerLength:n},h=t.split(`
`),f=0;f<h.length;f++){var p=h[f];if((p=p.trim())!=="")switch(o=(s=p.split(/\s+/)).shift(),p=s.join(" "),o){case"format":u.format=s[0],u.version=s[1];break;case"comment":u.comments.push(p);break;case"element":r!==void 0&&u.elements.push(r),(r={}).name=s[0],r.count=parseInt(s[1]),r.properties=[];break;case"property":r.properties.push((a=s,c=this.propertyNameMapping,l=void 0,(l={type:a[0]}).type==="list"?(l.name=a[3],l.countType=a[1],l.itemType=a[2]):l.name=a[1],l.name in c&&(l.name=c[l.name]),l));break;default:console.log("unhandled",o,s)}}return r!==void 0&&u.elements.push(r),u},parseASCIINumber:function(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}},parseASCIIElement:function(e,t){for(var n=t.split(/\s+/),i={},r=0;r<e.length;r++)if(e[r].type==="list"){for(var o=[],s=this.parseASCIINumber(n.shift(),e[r].countType),a=0;a<s;a++)o.push(this.parseASCIINumber(n.shift(),e[r].itemType));i[e[r].name]=o}else i[e[r].name]=this.parseASCIINumber(n.shift(),e[r].type);return i},parseASCII:function(e){var t,n=new dt,i=this.parseHeader(e),r="";(t=/end_header\s([\s\S]*)$/.exec(e))!==null&&(r=t[1]);var o=r.split(`
`),s=0,a=0;n.useColor=!1;for(var c=0;c<o.length;c++){var l=o[c];if((l=l.trim())!==""){a>=i.elements[s].count&&(s++,a=0);var u=this.parseASCIIElement(i.elements[s].properties,l);this.handleElement(n,i.elements[s].name,u),a++}}return this.postProcess(n)},postProcess:function(e){if(e.useColor){for(var t=0;t<e.faces.length;t++)e.faces[t].vertexColors=[e.colors[e.faces[t].a],e.colors[e.faces[t].b],e.colors[e.faces[t].c]];e.elementsNeedUpdate=!0}return e.computeBoundingSphere(),e},handleElement:function(e,t,n){if(t==="vertex"){if(e.vertices.push(new T(n.x,n.y,n.z)),"red"in n&&"green"in n&&"blue"in n){e.useColor=!0;var i=new Fe;i.setRGB(n.red/255,n.green/255,n.blue/255),e.colors.push(i)}}else if(t==="face"){var r=n.vertex_indices;r.length===3?e.faces.push(new oc(r[0],r[1],r[2])):r.length===4&&e.faces.push(new oc(r[0],r[1],r[3]),new oc(r[1],r[2],r[3]))}},binaryRead:function(e,t,n,i){switch(n){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,i),2];case"uint16":case"ushort":return[e.getUint16(t,i),2];case"int32":case"int":return[e.getInt32(t,i),4];case"uint32":case"uint":return[e.getUint32(t,i),4];case"float32":case"float":return[e.getFloat32(t,i),4];case"float64":case"double":return[e.getFloat64(t,i),8]}},binaryReadElement:function(e,t,n,i){for(var r,o={},s=0,a=0;a<n.length;a++)if(n[a].type==="list"){var c=[],l=(r=this.binaryRead(e,t+s,n[a].countType,i))[0];s+=r[1];for(var u=0;u<l;u++)r=this.binaryRead(e,t+s,n[a].itemType,i),c.push(r[0]),s+=r[1];o[n[a].name]=c}else r=this.binaryRead(e,t+s,n[a].type,i),o[n[a].name]=r[0],s+=r[1];return[o,s]},parseBinary:function(e){for(var t,n=new dt,i=this.parseHeader(this.bin2str(e)),r=i.format==="binary_little_endian",o=new DataView(e,i.headerLength),s=0,a=0;a<i.elements.length;a++)for(var c=0;c<i.elements[a].count;c++){s+=(t=this.binaryReadElement(o,s,i.elements[a].properties,r))[1];var l=t[0];this.handleElement(n,i.elements[a].name,l)}return this.postProcess(n)}};var X8=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0}};return n.type.get=function(){return"ply"},t.prototype.getLoader=function(){return new db},Object.defineProperties(t.prototype,n),t}(AE);ft.add("ply",X8);var Y8=function(e){function t(i,r){var o=r||{};e.call(this,i,o),this.delimiter=O(o.delimiter,","),this.comment=O(o.comment,"#"),this.columnNames=O(o.columnNames,!1),this.table={name:this.name,path:this.path,columnNames:[],data:[]}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},__objName:{configurable:!0}};return n.type.get=function(){return"csv"},n.__objName.get=function(){return"table"},t.prototype._parse=function(){var i=this,r=this.table.data,o=new RegExp("\\s*"+this.delimiter+"\\s*"),s=0;this.streamer.eachChunkOfLines(function(a){for(var c=a.length,l=0;l<c;++l){var u=a[l].trim();if(!u.startsWith(i.comment)){var h=u.split(o);s===0?i.table.columnNames=h:u&&r.push(h),++s}}})},Object.defineProperties(t.prototype,n),t}(Ci);ft.add("csv",Y8);var Z8=function(e){function t(i,r){var o=r||{};e.call(this,i,o),this.string=O(o.string,!1),this.json={name:this.name,path:this.path,data:{}}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},__objName:{configurable:!0},isJson:{configurable:!0}};return n.type.get=function(){return"json"},n.__objName.get=function(){return"json"},n.isJson.get=function(){return!0},t.prototype._parse=function(){this.streamer.isBinary()||this.string?this.json.data=JSON.parse(this.streamer.asText()):this.json.data=this.streamer.data},Object.defineProperties(t.prototype,n),t}(Ci);ft.add("json",Z8);var K8=function(e){function t(i,r){var o=r||{};e.call(this,i,o),this.msgpack={name:this.name,path:this.path,data:void 0}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},__objName:{configurable:!0},isBinary:{configurable:!0}};return n.type.get=function(){return"msgpack"},n.__objName.get=function(){return"msgpack"},n.isBinary.get=function(){return!0},t.prototype._parse=function(){Pe&&de.time("MsgpackParser._parse "+this.name),this.msgpack.data=xE(this.streamer.data),Pe&&de.timeEnd("MsgpackParser._parse "+this.name)},Object.defineProperties(t.prototype,n),t}(Ci);ft.add("msgpack",K8);var Q8=function(e){function t(i,r){var o=r||{};e.call(this,i,o),this.netcdf={name:this.name,path:this.path,data:void 0}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},__objName:{configurable:!0},isBinary:{configurable:!0}};return n.type.get=function(){return"netcdf"},n.__objName.get=function(){return"netcdf"},n.isBinary.get=function(){return!0},t.prototype._parse=function(){Pe&&de.time("NetcdfParser._parse "+this.name),this.netcdf.data=new ef(this.streamer.data),Pe&&de.timeEnd("NetcdfParser._parse "+this.name)},Object.defineProperties(t.prototype,n),t}(Ci);ft.add("netcdf",Q8);var JM=function(e){function t(i,r){e.call(this,i,r),this.text={name:this.name,path:this.path,data:""}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},__objName:{configurable:!0}};return n.type.get=function(){return"text"},n.__objName.get=function(){return"text"},t.prototype._parse=function(){this.text.data=this.streamer.asText()},Object.defineProperties(t.prototype,n),t}(Ci);ft.add("txt",JM),ft.add("text",JM);var J8=/^['"]|['"]$/g,eU=/^<([\w-:.]+)\s*/,tU=/^([^<]*)/,nU=/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/;function iU(e){return e=e.trim().replace(/<!--[\s\S]*?-->/g,""),{declaration:t(),root:n()};function t(){if(r(/^<\?xml\s*/)){for(var a={attributes:{}};!o()&&!s("?>");){var c=i();if(!c)return a;a.attributes[c.name]=c.value}return r(/\?>\s*/),a}}function n(){var a=r(eU);if(a){for(var c,l={name:a[1],attributes:{},children:[]};!(o()||s(">")||s("?>")||s("/>"));){var u=i();if(!u)return l;l.attributes[u.name]=u.value}if(r(/^\s*\/>\s*/))return l;for(r(/\??>\s*/),l.content=function(){var h=r(tU);return h?h[1]:""}();c=n();)l.children.push(c);return r(/^<\/[\w-:.]+>\s*/),l}}function i(){var a,c=r(nU);if(c)return{name:c[1],value:(a=c[2],a.replace(J8,""))}}function r(a){var c=e.match(a);if(c)return e=e.slice(c[0].length),c}function o(){return e.length===0}function s(a){return e.indexOf(a)===0}}var CE=function(e){function t(i,r){var o=r||{};e.call(this,i,o),this.useDomParser=O(o.useDomParser,!1),this.xml={name:this.name,path:this.path,data:{}}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={type:{configurable:!0},__objName:{configurable:!0},isXml:{configurable:!0}};return n.type.get=function(){return"xml"},n.__objName.get=function(){return"xml"},n.isXml.get=function(){return!0},t.prototype.__xmlParser=function(i){return iU(i)},t.prototype.__domParser=function(i){return new window.DOMParser().parseFromString(i,"text/xml")},t.prototype._parse=function(){Pe&&de.time("XmlParser._parse "+this.name),this.useDomParser?this.streamer.data instanceof Document?this.xml.data=this.streamer.data:this.xml.data=this.__domParser(this.streamer.asText()):this.xml.data=this.__xmlParser(this.streamer.asText()),Pe&&de.timeEnd("XmlParser._parse "+this.name)},Object.defineProperties(t.prototype,n),t}(Ci);function Hn(e,t){var n=e.getNamedItem(t);return n!==null?n.value:""}function eA(e,t,n){n===void 0&&(n=!1);var i=Hn(e,"icode").trim(),r=Hn(e,"chain").trim(),o=Hn(e,"altcode"),s=Hn(e,"resnum");return i&&(s+="^"+i),r&&(s+=":"+r),t&&(s+="."+t),n&&o.trim()&&(s+="%"+o),s+="/"+(parseInt(Hn(e,"model"))-1)}function rU(e){var t=Hn(e,"chain").trim(),n="["+Hn(e,"rescode")+"]"+Hn(e,"resnum");return t&&(n+=":"+t),n}function qy(e,t,n){e[t]===void 0?e[t]=n:e[t]|=n}function Xy(e,t){return e!==null&&e.value===t}function oU(e,t,n){for(var i=0,r=t.getElementsByTagName("clash"),o=0,s=r.length;o<s;++o)if(e[Hn(r[o].attributes,"cid")]){i+=1;break}return t.getElementsByTagName("angle-outlier").length>0&&(i+=1),t.getElementsByTagName("bond-outlier").length>0&&(i+=1),t.getElementsByTagName("plane-outlier").length>0&&(i+=1),Xy(n.getNamedItem("rota"),"OUTLIER")&&(i+=1),Xy(n.getNamedItem("rama"),"OUTLIER")&&(i+=1),Xy(n.getNamedItem("RNApucker"),"outlier")&&(i+=1),i}ft.add("xml",CE);var Pm=function(e,t){this.name=e,this.path=t,this.rsrzDict={},this.rsccDict={},this.rciDict={},this.clashDict={},this.clashArray=[],this.geoDict={},this.geoAtomDict={},this.atomDict={},this.clashSele="NONE"},tA={type:{configurable:!0}};tA.type.get=function(){return"validation"},Pm.prototype.fromXml=function(e){Pe&&de.time("Validation.fromXml");var t=this.rsrzDict,n=this.rsccDict,i=this.rciDict,r=this.clashDict,o=this.clashArray,s=this.geoDict,a=this.geoAtomDict,c=this.atomDict,l=e.getElementsByTagName("Entry");if(l.length===1){var u=l[0].getElementsByTagName("chemical_shift_list");if(u.length===1)for(var h=u[0].getElementsByTagName("random_coil_index"),f=0,p=h.length;f<p;++f){var m=h[f].attributes;i[rU(m)]=parseFloat(Hn(m,"value"))}}var y=e.getElementsByTagName("ModelledSubgroup"),v={},d=[];Pe&&de.time("Validation.fromXml#clashDict");for(var g=0,b=y.length;g<b;++g){var x=y[g],_=x.attributes,S=eA(_);_.getNamedItem("rsrz")!==null&&(t[S]=parseFloat(Hn(_,"rsrz"))),_.getNamedItem("rscc")!==null&&(n[S]=parseFloat(Hn(_,"rscc")));var w=e.createAttribute("sele");w.value=S,_.setNamedItem(w);for(var C=x.getElementsByTagName("clash"),A=0,k=C.length;A<k;++A){var L=C[A].attributes,D=Hn(L,"atom");if(F_(D)!=="H"){var F=Hn(L,"cid"),I=eA(_,D,!0);if(c[I]=!0,v[F]===void 0)v[F]={sele1:I,res1:S};else{var P=v[F];P.res1!==S&&(P.sele2=I,P.res2=S,d.push(P.res1,S),r[F]=P,o.push(P))}}}}Pe&&de.timeEnd("Validation.fromXml#clashDict");for(var N=0,$=y.length;N<$;++N){var B=y[N],q=B.attributes,ee=Hn(q,"sele");if(Hn(q,"seq")!=="."){var W=oU(r,B,q);W>0&&(s[ee]=W)}else{var Q=B.getElementsByTagName("clash"),Z=B.getElementsByTagName("mog-bond-outlier"),re=B.getElementsByTagName("mog-angle-outlier");if(Z.length>0||re.length>0||Q.length>0){var he={};a[ee]=he;for(var K=0,ce=Q.length;K<ce;++K){var se=Q[K].attributes;r[Hn(se,"cid")]&&qy(he,Hn(se,"atom"),1)}for(var ue=0,H=Z.length;ue<H;++ue)Hn(Z[ue].attributes,"atoms").split(",").forEach(function(ie){qy(he,ie,2)});for(var j=0,X=re.length;j<X;++j)Hn(re[j].attributes,"atoms").split(",").forEach(function(ie){qy(he,ie,4)})}}}this.clashSele=d.length?d.join(" OR "):"NONE",Pe&&de.timeEnd("Validation.fromXml")},Pm.prototype.getClashData=function(e){Pe&&de.time("Validation.getClashData");var t=e||{},n=t.structure,i=n.atomSet,r=new Fe(O(t.color,"#f0027f")),o=n.getAtomProxy(),s=n.getAtomProxy(),a=new T,c=new T,l=new T,u=this.clashArray,h=u.length,f=new Float32Array(3*h),p=new Float32Array(3*h),m=tn(h,r.r,r.g,r.b),y=new Float32Array(h),v=new Float32Array(h);Pe&&de.time("Validation.getClashData#atomDict");var d=this.atomDict;n.eachAtom(function(b){var x=function(_){var S=_.inscode,w=_.chainname,C=_.atomname,A=_.altloc,k=_.resno+"";return S&&(k+="^"+S),w&&(k+=":"+w),C&&(k+="."+C),A&&(k+="%"+A),k+"/"+_.modelIndex}(b);d[x]===!0&&(d[x]=b.index)}),Pe&&de.timeEnd("Validation.getClashData#atomDict");var g=0;return u.forEach(function(b,x){if(o.index=d[b.sele1],s.index=d[b.sele2],o.index!==void 0&&s.index!==void 0&&i.isSet(o.index,s.index)){a.subVectors(s,o).setLength(o.vdw),c.copy(o).add(a),a.subVectors(o,s).setLength(s.vdw),l.copy(s).add(a);var _=o.distanceTo(s)/2,S=Math.sqrt(o.vdw*o.vdw-_*_),w=Math.sqrt(s.vdw*s.vdw-_*_);c.toArray(f,3*g),l.toArray(p,3*g),y[g]=(S+w)/2,v[g]=x,++g}}),Pe&&de.timeEnd("Validation.getClashData"),{position1:f.subarray(0,3*g),position2:p.subarray(0,3*g),color:m.subarray(0,3*g),color2:m.subarray(0,3*g),radius:y.subarray(0,g),picking:new ON(v.subarray(0,g),this,n)}},Object.defineProperties(Pm.prototype,tA);var sU=function(e){function t(i,r){var o=r||{};e.call(this,i,o),this.useDomParser=!0,this.validation=new Pm(this.name,this.path)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={__objName:{configurable:!0},isXml:{configurable:!0}};return n.__objName.get=function(){return"validation"},n.isXml.get=function(){return!0},t.prototype._parse=function(){e.prototype._parse.call(this),Pe&&de.time("ValidationParser._parse "+this.name),this.validation.fromXml(this.xml.data),Pe&&de.timeEnd("ValidationParser._parse "+this.name)},Object.defineProperties(t.prototype,n),t}(CE);function PE(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)}function Yl(e,t,n,i,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),r);else for(var o=0;o<i;o++)e[r+o]=t[n+o]}function mb(e,t,n,i){for(var r=65535&e|0,o=e>>>16&65535|0,s=0;n!==0;){n-=s=n>2e3?2e3:n;do o=o+(r=r+t[i++]|0)|0;while(--s);r%=65521,o%=65521}return r|o<<16|0}ft.add("validation",sU);var aU=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();function wo(e,t,n,i){var r=aU,o=i+n;e^=-1;for(var s=i;s<o;s++)e=e>>>8^r[255&(e^t[s])];return-1^e}function cU(e,t){var n,i,r,o,s,a,c,l,u,h,f,p,m,y,v,d,g,b,x,_,S,w,C,A,k;n=e.state,i=e.next_in,A=e.input,r=i+(e.avail_in-5),o=e.next_out,k=e.output,s=o-(t-e.avail_out),a=o+(e.avail_out-257),c=n.dmax,l=n.wsize,u=n.whave,h=n.wnext,f=n.window,p=n.hold,m=n.bits,y=n.lencode,v=n.distcode,d=(1<<n.lenbits)-1,g=(1<<n.distbits)-1;e:do{m<15&&(p+=A[i++]<<m,m+=8,p+=A[i++]<<m,m+=8),b=y[p&d];t:for(;;){if(p>>>=x=b>>>24,m-=x,(x=b>>>16&255)===0)k[o++]=65535&b;else{if(!(16&x)){if(!(64&x)){b=y[(65535&b)+(p&(1<<x)-1)];continue t}if(32&x){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}_=65535&b,(x&=15)&&(m<x&&(p+=A[i++]<<m,m+=8),_+=p&(1<<x)-1,p>>>=x,m-=x),m<15&&(p+=A[i++]<<m,m+=8,p+=A[i++]<<m,m+=8),b=v[p&g];n:for(;;){if(p>>>=x=b>>>24,m-=x,!(16&(x=b>>>16&255))){if(!(64&x)){b=v[(65535&b)+(p&(1<<x)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(S=65535&b,m<(x&=15)&&(p+=A[i++]<<m,(m+=8)<x&&(p+=A[i++]<<m,m+=8)),(S+=p&(1<<x)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(p>>>=x,m-=x,S>(x=o-s)){if((x=S-x)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(w=0,C=f,h===0){if(w+=l-x,x<_){_-=x;do k[o++]=f[w++];while(--x);w=o-S,C=k}}else if(h<x){if(w+=l+h-x,(x-=h)<_){_-=x;do k[o++]=f[w++];while(--x);if(w=0,h<_){_-=x=h;do k[o++]=f[w++];while(--x);w=o-S,C=k}}}else if(w+=h-x,x<_){_-=x;do k[o++]=f[w++];while(--x);w=o-S,C=k}for(;_>2;)k[o++]=C[w++],k[o++]=C[w++],k[o++]=C[w++],_-=3;_&&(k[o++]=C[w++],_>1&&(k[o++]=C[w++]))}else{w=o-S;do k[o++]=k[w++],k[o++]=k[w++],k[o++]=k[w++],_-=3;while(_>2);_&&(k[o++]=k[w++],_>1&&(k[o++]=k[w++]))}break}}break}}while(i<r&&o<a);i-=_=m>>3,p&=(1<<(m-=_<<3))-1,e.next_in=i,e.next_out=o,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=o<a?a-o+257:257-(o-a),n.hold=p,n.bits=m}var lU=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],uU=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],hU=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],fU=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function tf(e,t,n,i,r,o,s,a){var c,l,u,h,f,p,m,y,v,d=a.bits,g=0,b=0,x=0,_=0,S=0,w=0,C=0,A=0,k=0,L=0,D=null,F=0,I=new Uint16Array(16),P=new Uint16Array(16),N=null,$=0;for(g=0;g<=15;g++)I[g]=0;for(b=0;b<i;b++)I[t[n+b]]++;for(S=d,_=15;_>=1&&I[_]===0;_--);if(S>_&&(S=_),_===0)return r[o++]=20971520,r[o++]=20971520,a.bits=1,0;for(x=1;x<_&&I[x]===0;x++);for(S<x&&(S=x),A=1,g=1;g<=15;g++)if(A<<=1,(A-=I[g])<0)return-1;if(A>0&&(e===0||_!==1))return-1;for(P[1]=0,g=1;g<15;g++)P[g+1]=P[g]+I[g];for(b=0;b<i;b++)t[n+b]!==0&&(s[P[t[n+b]]++]=b);if(e===0?(D=N=s,p=19):e===1?(D=lU,F-=257,N=uU,$-=257,p=256):(D=hU,N=fU,p=-1),L=0,b=0,g=x,f=o,w=S,C=0,u=-1,h=(k=1<<S)-1,e===1&&k>852||e===2&&k>592)return 1;for(;;){m=g-C,s[b]<p?(y=0,v=s[b]):s[b]>p?(y=N[$+s[b]],v=D[F+s[b]]):(y=96,v=0),c=1<<g-C,x=l=1<<w;do r[f+(L>>C)+(l-=c)]=m<<24|y<<16|v|0;while(l!==0);for(c=1<<g-1;L&c;)c>>=1;if(c!==0?(L&=c-1,L+=c):L=0,b++,--I[g]==0){if(g===_)break;g=t[n+s[b]]}if(g>S&&(L&h)!==u){for(C===0&&(C=S),f+=x,A=1<<(w=g-C);w+C<_&&!((A-=I[w+C])<=0);)w++,A<<=1;if(k+=1<<w,e===1&&k>852||e===2&&k>592)return 1;r[u=L&h]=S<<24|w<<16|f-o|0}}return L!==0&&(r[f+L]=g-C<<24|64<<16|0),a.bits=S,0}function nA(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function pU(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function dU(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,function(n){var i;return n&&n.state?(i=n.state,n.total_in=n.total_out=i.total=0,n.msg="",i.wrap&&(n.adler=1&i.wrap),i.mode=1,i.last=0,i.havedict=0,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(852),i.distcode=i.distdyn=new Int32Array(592),i.sane=1,i.back=-1,0):-2}(e)):-2}function mU(e,t){var n,i;return e?(i=new pU,e.state=i,i.window=null,n=function(r,o){var s,a;return r&&r.state?(a=r.state,o<0?(s=0,o=-o):(s=1+(o>>4),o<48&&(o&=15)),o&&(o<8||o>15)?-2:(a.window!==null&&a.wbits!==o&&(a.window=null),a.wrap=s,a.wbits=o,dU(r))):-2}(e,t),n!==0&&(e.state=null),n):-2}var Yy,Zy,iA=!0;function gU(e){if(iA){var t;for(Yy=new Int32Array(512),Zy=new Int32Array(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(tf(1,e.lens,0,288,Yy,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;tf(2,e.lens,0,32,Zy,0,e.work,{bits:5}),iA=!1}e.lencode=Yy,e.lenbits=9,e.distcode=Zy,e.distbits=5}function TE(e,t,n,i){var r,o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(Yl(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((r=o.wsize-o.wnext)>i&&(r=i),Yl(o.window,t,n-i,r,o.wnext),(i-=r)?(Yl(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0}function yU(e,t){var n,i,r,o,s,a,c,l,u,h,f,p,m,y,v,d,g,b,x,_,S,w,C,A,k=0,L=new Uint8Array(4),D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return-2;(n=e.state).mode===12&&(n.mode=13),s=e.next_out,r=e.output,c=e.avail_out,o=e.next_in,i=e.input,a=e.avail_in,l=n.hold,u=n.bits,h=a,f=c,w=0;e:for(;;)switch(n.mode){case 1:if(n.wrap===0){n.mode=13;break}for(;u<16;){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}if(2&n.wrap&&l===35615){n.check=0,L[0]=255&l,L[1]=l>>>8&255,n.check=wo(n.check,L,2,0),l=0,u=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",n.mode=30;break}if((15&l)!=8){e.msg="unknown compression method",n.mode=30;break}if(u-=4,S=8+(15&(l>>>=4)),n.wbits===0)n.wbits=S;else if(S>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<S,e.adler=n.check=1,n.mode=512&l?10:12,l=0,u=0;break;case 2:for(;u<16;){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}if(n.flags=l,(255&n.flags)!=8){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=l>>8&1),512&n.flags&&(L[0]=255&l,L[1]=l>>>8&255,n.check=wo(n.check,L,2,0)),l=0,u=0,n.mode=3;case 3:for(;u<32;){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}n.head&&(n.head.time=l),512&n.flags&&(L[0]=255&l,L[1]=l>>>8&255,L[2]=l>>>16&255,L[3]=l>>>24&255,n.check=wo(n.check,L,4,0)),l=0,u=0,n.mode=4;case 4:for(;u<16;){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&n.flags&&(L[0]=255&l,L[1]=l>>>8&255,n.check=wo(n.check,L,2,0)),l=0,u=0,n.mode=5;case 5:if(1024&n.flags){for(;u<16;){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}n.length=l,n.head&&(n.head.extra_len=l),512&n.flags&&(L[0]=255&l,L[1]=l>>>8&255,n.check=wo(n.check,L,2,0)),l=0,u=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((p=n.length)>a&&(p=a),p&&(n.head&&(S=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),Yl(n.head.extra,i,o,p,S)),512&n.flags&&(n.check=wo(n.check,i,p,o)),a-=p,o+=p,n.length-=p),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(a===0)break e;p=0;do S=i[o+p++],n.head&&S&&n.length<65536&&(n.head.name+=String.fromCharCode(S));while(S&&p<a);if(512&n.flags&&(n.check=wo(n.check,i,p,o)),a-=p,o+=p,S)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(a===0)break e;p=0;do S=i[o+p++],n.head&&S&&n.length<65536&&(n.head.comment+=String.fromCharCode(S));while(S&&p<a);if(512&n.flags&&(n.check=wo(n.check,i,p,o)),a-=p,o+=p,S)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;u<16;){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}if(l!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}l=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;u<32;){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}e.adler=n.check=nA(l),l=0,u=0,n.mode=11;case 11:if(n.havedict===0)return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,n.hold=l,n.bits=u,2;e.adler=n.check=1,n.mode=12;case 12:if(t===5||t===6)break e;case 13:if(n.last){l>>>=7&u,u-=7&u,n.mode=27;break}for(;u<3;){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}switch(n.last=1&l,u-=1,3&(l>>>=1)){case 0:n.mode=14;break;case 1:if(gU(n),n.mode=20,t===6){l>>>=2,u-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}l>>>=2,u-=2;break;case 14:for(l>>>=7&u,u-=7&u;u<32;){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&l,l=0,u=0,n.mode=15,t===6)break e;case 15:n.mode=16;case 16:if(p=n.length){if(p>a&&(p=a),p>c&&(p=c),p===0)break e;Yl(r,i,o,p,s),a-=p,o+=p,c-=p,s+=p,n.length-=p;break}n.mode=12;break;case 17:for(;u<14;){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}if(n.nlen=257+(31&l),l>>>=5,u-=5,n.ndist=1+(31&l),l>>>=5,u-=5,n.ncode=4+(15&l),l>>>=4,u-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;u<3;){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}n.lens[D[n.have++]]=7&l,l>>>=3,u-=3}for(;n.have<19;)n.lens[D[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,C={bits:n.lenbits},w=tf(0,n.lens,0,19,n.lencode,0,n.work,C),n.lenbits=C.bits,w){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;d=(k=n.lencode[l&(1<<n.lenbits)-1])>>>16&255,g=65535&k,!((v=k>>>24)<=u);){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}if(g<16)l>>>=v,u-=v,n.lens[n.have++]=g;else{if(g===16){for(A=v+2;u<A;){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}if(l>>>=v,u-=v,n.have===0){e.msg="invalid bit length repeat",n.mode=30;break}S=n.lens[n.have-1],p=3+(3&l),l>>>=2,u-=2}else if(g===17){for(A=v+3;u<A;){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}u-=v,S=0,p=3+(7&(l>>>=v)),l>>>=3,u-=3}else{for(A=v+7;u<A;){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}u-=v,S=0,p=11+(127&(l>>>=v)),l>>>=7,u-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;p--;)n.lens[n.have++]=S}}if(n.mode===30)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,C={bits:n.lenbits},w=tf(1,n.lens,0,n.nlen,n.lencode,0,n.work,C),n.lenbits=C.bits,w){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,C={bits:n.distbits},w=tf(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,C),n.distbits=C.bits,w){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,t===6)break e;case 20:n.mode=21;case 21:if(a>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,n.hold=l,n.bits=u,cU(e,f),s=e.next_out,r=e.output,c=e.avail_out,o=e.next_in,i=e.input,a=e.avail_in,l=n.hold,u=n.bits,n.mode===12&&(n.back=-1);break}for(n.back=0;d=(k=n.lencode[l&(1<<n.lenbits)-1])>>>16&255,g=65535&k,!((v=k>>>24)<=u);){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}if(d&&!(240&d)){for(b=v,x=d,_=g;d=(k=n.lencode[_+((l&(1<<b+x)-1)>>b)])>>>16&255,g=65535&k,!(b+(v=k>>>24)<=u);){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}l>>>=b,u-=b,n.back+=b}if(l>>>=v,u-=v,n.back+=v,n.length=g,d===0){n.mode=26;break}if(32&d){n.back=-1,n.mode=12;break}if(64&d){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&d,n.mode=22;case 22:if(n.extra){for(A=n.extra;u<A;){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;d=(k=n.distcode[l&(1<<n.distbits)-1])>>>16&255,g=65535&k,!((v=k>>>24)<=u);){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}if(!(240&d)){for(b=v,x=d,_=g;d=(k=n.distcode[_+((l&(1<<b+x)-1)>>b)])>>>16&255,g=65535&k,!(b+(v=k>>>24)<=u);){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}l>>>=b,u-=b,n.back+=b}if(l>>>=v,u-=v,n.back+=v,64&d){e.msg="invalid distance code",n.mode=30;break}n.offset=g,n.extra=15&d,n.mode=24;case 24:if(n.extra){for(A=n.extra;u<A;){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(c===0)break e;if(p=f-c,n.offset>p){if((p=n.offset-p)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}p>n.wnext?(p-=n.wnext,m=n.wsize-p):m=n.wnext-p,p>n.length&&(p=n.length),y=n.window}else y=r,m=s-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do r[s++]=y[m++];while(--p);n.length===0&&(n.mode=21);break;case 26:if(c===0)break e;r[s++]=n.length,c--,n.mode=21;break;case 27:if(n.wrap){for(;u<32;){if(a===0)break e;a--,l|=i[o++]<<u,u+=8}if(f-=c,e.total_out+=f,n.total+=f,f&&(e.adler=n.check=n.flags?wo(n.check,r,f,s-f):mb(n.check,r,f,s-f)),f=c,(n.flags?l:nA(l))!==n.check){e.msg="incorrect data check",n.mode=30;break}l=0,u=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;u<32;){if(a===0)break e;a--,l+=i[o++]<<u,u+=8}if(l!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}l=0,u=0}n.mode=29;case 29:w=1;break e;case 30:w=-3;break e;case 31:return-4;default:return-2}return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,n.hold=l,n.bits=u,(n.wsize||f!==e.avail_out&&n.mode<30&&(n.mode<27||t!==4))&&TE(e,e.output,e.next_out,f-e.avail_out),h-=e.avail_in,f-=e.avail_out,e.total_in+=h,e.total_out+=f,n.total+=f,n.wrap&&f&&(e.adler=n.check=n.flags?wo(n.check,r,f,e.next_out-f):mb(n.check,r,f,e.next_out-f)),e.data_type=n.bits+(n.last?64:0)+(n.mode===12?128:0)+(n.mode===20||n.mode===15?256:0),(h===0&&f===0||t===4)&&w===0&&(w=-5),w}function vU(e,t){var n,i=t.length;return e&&e.state?(n=e.state).wrap!==0&&n.mode!==11?-2:n.mode===11&&mb(1,t,i,0)!==n.check?-3:TE(e,t,i,i)?(n.mode=31,-4):(n.havedict=1,0):-2}var EE=!0,IE=!0;try{String.fromCharCode.apply(null,[0])}catch{EE=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{IE=!1}for(var lp=new Uint8Array(256),Xs=0;Xs<256;Xs++)lp[Xs]=Xs>=252?6:Xs>=248?5:Xs>=240?4:Xs>=224?3:Xs>=192?2:1;function xU(e){var t,n,i,r,o,s=e.length,a=0;for(r=0;r<s;r++)(64512&(n=e.charCodeAt(r)))==55296&&r+1<s&&(64512&(i=e.charCodeAt(r+1)))==56320&&(n=65536+(n-55296<<10)+(i-56320),r++),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(a),o=0,r=0;o<a;r++)(64512&(n=e.charCodeAt(r)))==55296&&r+1<s&&(64512&(i=e.charCodeAt(r+1)))==56320&&(n=65536+(n-55296<<10)+(i-56320),r++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t}function bU(e,t){var n,i,r,o,s=t||e.length,a=new Array(2*s);for(i=0,n=0;n<s;)if((r=e[n++])<128)a[i++]=r;else if((o=lp[r])>4)a[i++]=65533,n+=o-1;else{for(r&=o===2?31:o===3?15:7;o>1&&n<s;)r=r<<6|63&e[n++],o--;o>1?a[i++]=65533:r<65536?a[i++]=r:(r-=65536,a[i++]=55296|r>>10&1023,a[i++]=56320|1023&r)}return function(c,l){if(l<65537&&(c.subarray&&IE||!c.subarray&&EE))return String.fromCharCode.apply(null,PE(c,l));for(var u="",h=0;h<l;h++)u+=String.fromCharCode(c[h]);return u}(a,i)}function _U(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+lp[e[n]]>t?n:t}lp[254]=lp[254]=1;var wU={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function SU(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function MU(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var rA=Object.prototype.toString;function Fl(e){if(!(this instanceof Fl))return new Fl(e);this.options=function(s){for(var a=Array.prototype.slice.call(arguments,1);a.length;){var c=a.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var l in c)c.hasOwnProperty(l)&&(s[l]=c[l])}}return s}({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new SU,this.strm.avail_out=0;var n,i,r,o=mU(this.strm,t.windowBits);if(o!==0)throw new Error(wU[o]);this.header=new MU,n=this.strm,i=this.header,n&&n.state&&(!(2&(r=n.state).wrap)||(r.head=i,i.done=!1))}Fl.prototype.push=function(e,t){var n,i,r,o,s,a,c=this.strm,l=this.options.chunkSize,u=this.options.dictionary,h=!1;if(this.ended)return!1;i=t===~~t?t:t===!0?4:0,typeof e=="string"?c.input=function(f){for(var p=new Uint8Array(f.length),m=0,y=p.length;m<y;m++)p[m]=f.charCodeAt(m);return p}(e):rA.call(e)==="[object ArrayBuffer]"?c.input=new Uint8Array(e):c.input=e,c.next_in=0,c.avail_in=c.input.length;do{if(c.avail_out===0&&(c.output=new Uint8Array(l),c.next_out=0,c.avail_out=l),(n=yU(c,0))===2&&u&&(a=typeof u=="string"?xU(u):rA.call(u)==="[object ArrayBuffer]"?new Uint8Array(u):u,n=vU(this.strm,a)),n===-5&&h===!0&&(n=0,h=!1),n!==1&&n!==0)return this.onEnd(n),this.ended=!0,!1;c.next_out&&(c.avail_out!==0&&n!==1&&(c.avail_in!==0||i!==4&&i!==2)||(this.options.to==="string"?(r=_U(c.output,c.next_out),o=c.next_out-r,s=bU(c.output,r),c.next_out=o,c.avail_out=l-o,o&&Yl(c.output,c.output,r,o,0),this.onData(s)):this.onData(PE(c.output,c.next_out)))),c.avail_in===0&&c.avail_out===0&&(h=!0)}while((c.avail_in>0||c.avail_out===0)&&n!==1);return n===1&&(i=4),i===4?(n=function(f){if(!f||!f.state)return-2;var p=f.state;return p.window&&(p.window=null),f.state=null,0}(this.strm),this.onEnd(n),this.ended=!0,n===0):i!==2||(this.onEnd(0),c.avail_out=0,!0)},Fl.prototype.onData=function(e){this.chunks.push(e)},Fl.prototype.onEnd=function(e){e===0&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=function(t){var n,i,r,o,s,a;for(r=0,n=0,i=t.length;n<i;n++)r+=t[n].length;for(a=new Uint8Array(r),o=0,n=0,i=t.length;n<i;n++)s=t[n],a.set(s,o),o+=s.length;return a}(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},I_.add("gz",function(e){var t;e instanceof ArrayBuffer&&(e=new Uint8Array(e));try{t=function(n,i){var r=new Fl(i);if(r.push(n,!0),r.err)throw r.msg;return r.result}(e)}catch{t=e}return t});var zu=function(){},Ky="//mmtf.rcsb.org/v1.0/full/",AU=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getUrl=function(n){var i,r=Jn(n),o=r.name.substr(0,4);return!["pdb","cif"].includes(r.ext)||r.compressed!==!1&&r.compressed!=="gz"?r.ext==="mmtf"?i=r.base.endsWith(".bb")?"//mmtf.rcsb.org/v1.0/reduced/"+o:Ky+o:(r.ext&&de.warn("unsupported ext",r.ext),i=Ky+o):i="//files.rcsb.org/download/"+r.path,A_()+i},t.prototype.getExt=function(n){var i=Jn(n).ext;return i||"mmtf"},t}(zu);cc.add("rcsb",new AU);var oA="//pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/",CU=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getUrl=function(n){var i,r=Jn(n),o=r.name;return r.ext&&r.ext!=="sdf"&&de.warn("unsupported ext",r.ext),i=oA+o+"/SDF?record_type=3d",A_()+i},t.prototype.getExt=function(n){var i=Jn(n).ext;return i||"sdf"},t}(zu);cc.add("pubchem",new CU);var Qy=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getUrl=function(n){return n},t.prototype.getExt=function(n){return Jn(n).ext},t}(zu);cc.add("ftp",new Qy),cc.add("http",new Qy),cc.add("https",new Qy);var sA="//alphafold.ebi.ac.uk/files/AF-",PU=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getUrl=function(n){var i,r=Jn(n),o=r.name;return r.ext&&r.ext!=="pdb"&&de.warn("unsupported AF ext",r.ext),i=sA+o+"-F1-model_v2.pdb",A_()+i},t.prototype.getExt=function(n){var i=Jn(n).ext;return i||"pdb"},t}(zu);cc.add("alphafold",new PU);var TU=/^((http|https|ftp):)*\/\//;(function(e){function t(n){n===void 0&&(n=""),e.call(this),this.baseUrl=n}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getUrl=function(n){var i,r,o,s,a=Jn(n),c=this.baseUrl+a.path;return TU.test(this.baseUrl)||(i=c,r=window.location,o=r.pathname,s=o.substring(0,o.lastIndexOf("/")+1),c=r.origin+s+i),c},t.prototype.getExt=function(n){return Jn(n).ext},t})(zu);(function(e){function t(n){n===void 0&&(n=""),e.call(this),this.baseUrl=n}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getListing=function(n){n===void 0&&(n="");var i=this.baseUrl+"dir/"+n;return i[i.length-1]!=="/"&&(i+="/"),jx(i,{ext:"json"}).then(function(r){return{path:n,data:r.data}})},t.prototype.getUrl=function(n){var i=Jn(n);return this.baseUrl+"file/"+i.path+i.query},t.prototype.getCountUrl=function(n){var i=Jn(n);return this.baseUrl+"traj/numframes/"+i.path+i.query},t.prototype.getFrameUrl=function(n,i){var r=Jn(n);return this.baseUrl+"traj/frame/"+i+"/"+r.path+r.query},t.prototype.getFrameParams=function(n,i){return"atomIndices="+i.join(";")},t.prototype.getPathUrl=function(n,i){var r=Jn(n);return this.baseUrl+"traj/path/"+i+"/"+r.path+r.query},t.prototype.getExt=function(n){return Jn(n).ext},t})(zu);function aA(e,t){return{type:"integer",max:e,min:t}}function rl(e,t,n){return{type:"number",precision:e,max:t,min:n}}function ol(e,t,n){return{type:"range",step:e,max:t,min:n}}function wh(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return{type:"select",options:e.reduce(function(n,i){var r;return Object.assign(Object.assign({},n),((r={})[i]=i,r))},{})}}wh("auto","low","medium","high"),ol(1,5,-1),rl(1,10,0),rl(1,10,0),rl(1,10,0),ol(1,100,0),ol(1,100,0),aA(200,0),wh("scene","camera"),wh("relative","absolute"),ol(1,100,0),ol(1,100,0),wh("perspective","orthographic","stereo"),rl(3,1,.01),ol(1,120,15),rl(2,10,0),rl(2,10,0),aA(1e4,-1),wh.apply(void 0,Object.keys(KT));window.Promise||(window.Promise=Ln);const EU=({selectedResidue:e,onClose:t})=>Di("div",{className:`side-menu-wrapper ${e?"visible":""}`,children:e&&gl("div",{className:"side-menu-content",children:[Di("button",{className:"side-menu-close-button",onClick:()=>{t()},children:"X"}),Di("h2",{children:e.residueName}),gl("p",{children:["Chain: ",e.chainName]}),gl("p",{children:["Residue name: ",e.residueName]}),gl("p",{children:["Atom type: ",e.atom]})]})}),IU=({pdbId:e,onResidueSelection:t})=>{const n=ko.useRef(null),i=ko.useRef(null);ko.useEffect(()=>{if(i.current){const o=new Gt(i.current,{backgroundColor:"white"});o.setParameters({cameraType:"perspective"}),o.mouseControls.remove("hoverPick"),n.current=o,(async()=>{try{const a=await o.loadFile(`https://files.rcsb.org/download/${e}.cif`);a.addRepresentation("cartoon",{color:"residueindex"}),o.mouseControls.remove("hoverPick"),o.mouseControls.remove("clickPick-left"),a.autoView(),o.signals.clicked.add(r),o.signals.hovered.add(c=>{if(c&&c.atom){const l=c.atom.resno;let u=Rt.addSelectionScheme([["red",l+""],["residueindex","*"]]),h=o.getRepresentationsByName("cartoon");h.setColor(u),h.update({color:!0})}else{let l=o.getRepresentationsByName("cartoon");l.setColor("residueindex"),l.update({color:!0})}})}catch(a){console.error(a)}})()}},[e]);const r=o=>{if(o&&o.atom){const s={atom:o.atom.qualifiedName(),residueName:o.atom.resname,residueIndex:o.atom.resno,chainName:o.atom.chainname,element:o.atom.element};console.log(s),t(s)}else t(null)};return Di("div",{style:{display:"flex",flexDirection:"row"},children:Di("div",{id:"viewport",ref:i,style:{width:"100%",height:"100vh"}})})},LU=()=>{const[e,t]=ko.useState("1BNA"),[n,i]=ko.useState(null);return gl(nI,{children:[gl("select",{value:e,onChange:a=>{t(a.target.value)},children:[Di("option",{value:"1BNA",children:"1BNA - Simple 1"}),Di("option",{value:"2MHR",children:"2MHR - Simple 2"}),Di("option",{value:"1CRN",children:"1CRN - Simple 3"}),Di("option",{value:"1MBA",children:"1MBA - Moderately Complex"}),Di("option",{value:"1F88",children:"1F88 - Complex"})]}),Di("div",{style:{width:"100%"},children:Di(IU,{pdbId:e,onResidueSelection:a=>{console.log(a),i(a)}},e)}),Di(EU,{selectedResidue:n,onClose:()=>{i(null)}})]})};Jy.createRoot(document.getElementById("root")).render(Di(YE.StrictMode,{children:Di(LU,{})}));
